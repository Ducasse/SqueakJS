window.module=function(l){if(""===l)return window;var a=l.split(".");l=a.pop();a=module(a.join("."));var b=a[l];b||(a[l]=b={loaded:!1,pending:[],requires:function(a){return{toRun:function(c){function e(){c();b.loaded=!0;b.pending.forEach(function(a){a()})}a&&!module(a).loaded?module(a).pending.push(e):e()}}}});return b};Object.extend=function(l){for(var a=1;a<arguments.length;a++)if("object"==typeof arguments[a])for(var b in arguments[a])l[b]=arguments[a][b]};
Function.prototype.subclass=function(l){var a=function(){this.initialize&&this.initialize.apply(this,arguments);return this},b=function(){};b.prototype=this.prototype;a.prototype=new b;for(b=1;b<arguments.length;b++)Object.extend(a.prototype,arguments[b]);b=l.split(".");var c=b.pop();return module(b.join("."))[c]=a};
(function(){var l=document.getElementsByTagName("script");l=l[l.length-1];var a=l.src.replace(/[^\/]*$/,"");l.src.match(/squeak\.min\.js$/)||"vm.js jit.js plugins/ADPCMCodecPlugin.js plugins/B2DPlugin.js plugins/BitBltPlugin.js plugins/FFTPlugin.js plugins/FloatArrayPlugin.js plugins/GeniePlugin.js plugins/JPEGReaderPlugin.js plugins/KedamaPlugin.js plugins/KedamaPlugin2.js plugins/Klatt.js plugins/LargeIntegers.js plugins/Matrix2x3Plugin.js plugins/MiscPrimitivePlugin.js plugins/ScratchPlugin.js plugins/SocketPlugin.js plugins/SpeechPlugin.js plugins/SqueakSSL.js plugins/SoundGenerationPlugin.js plugins/StarSqueakPlugin.js plugins/ZipPlugin.js lib/lz-string.js lib/jszip.js lib/FileSaver.js".split(" ").forEach(function(b){var c=document.createElement("script");
c.setAttribute("type","text/javascript");c.setAttribute("src",a+b);document.getElementsByTagName("head")[0].appendChild(c)})})();
module("SqueakJS").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a,b,c){function d(b){a.fullscreen=b;e.style.background=b?"black":"";c.header&&(c.header.style.display=b?"none":"");c.footer&&(c.footer.style.display=b?"none":"");c.fullscreenCheckbox&&(c.fullscreenCheckbox.checked=b);setTimeout(window.onresize,0)}var e=b.parentElement,f="fullscreenchange",p="fullscreenElement",m="fullscreenEnabled";e.requestFullscreen||[{req:e.webkitRequestFullscreen,exit:document.webkitExitFullscreen,
evt:"webkitfullscreenchange",elem:"webkitFullscreenElement",enable:"webkitFullscreenEnabled"},{req:e.mozRequestFullScreen,exit:document.mozCancelFullScreen,evt:"mozfullscreenchange",elem:"mozFullScreenElement",enable:"mozFullScreenEnabled"},{req:e.msRequestFullscreen,exit:document.msExitFullscreen,evt:"MSFullscreenChange",elem:"msFullscreenElement",enable:"msFullscreenEnabled"}].forEach(function(a){a.req&&(e.requestFullscreen=a.req,document.exitFullscreen=a.exit,f=a.evt,p=a.elem,m=a.enable)});if(e.requestFullscreen){document.addEventListener(f,
function(){d(e==document[p])});var g=function(){document[m]&&e==document[p]!=a.fullscreen&&(a.fullscreen?e.requestFullscreen():document.exitFullscreen())}}else{var x=!1;g=function(){(c.header||c.footer)&&x!=a.fullscreen&&(x=a.fullscreen,d(x))}}c.fullscreenCheckbox&&(c.fullscreenCheckbox.onclick=function(){a.fullscreen=c.fullscreenCheckbox.checked;g()});return g}function a(a){if(a.swapCheckbox){var b=q.squeakImageName||"default",c=JSON.parse(q["squeakSettings:"+b]||"{}");"swapButtons"in c&&(a.swapButtons=
c.swapButtons);a.swapCheckbox.checked=a.swapButtons;a.swapCheckbox.onclick=function(){a.swapButtons=a.swapCheckbox.checked;c.swapButtons=a.swapButtons;q["squeakSettings:"+b]=JSON.stringify(c)}}}function b(a,b){a=(a.shiftKey?Squeak.Keyboard_Shift:0)+(a.ctrlKey&&!a.altKey?Squeak.Keyboard_Ctrl:0)+(a.metaKey||a.altKey&&!a.ctrlKey?Squeak.Keyboard_Cmd:0);b.buttons=b.buttons&~Squeak.Keyboard_All|a;return a}function c(a,b,c){var d=u?a.offsetX:a.layerX;a=u?a.offsetY:a.layerY;c.cursorCanvas&&(c.cursorCanvas.style.left=
d+b.offsetLeft+c.cursorOffsetX+"px",c.cursorCanvas.style.top=a+b.offsetTop+c.cursorOffsetY+"px");a=a*b.height/b.offsetHeight|0;c.mouseX=Math.max(0,Math.min(c.width,d*b.width/b.offsetWidth|0));c.mouseY=Math.max(0,Math.min(c.height,a))}function e(a,d,e,f,p,m){c(d,e,f);if(f.vm){e=f.buttons&Squeak.Mouse_All;switch(a){case "mousedown":switch(d.button||0){case 0:e=Squeak.Mouse_Red;break;case 1:e=Squeak.Mouse_Yellow;break;case 2:e=Squeak.Mouse_Blue}m.swapButtons&&(e==Squeak.Mouse_Yellow?e=Squeak.Mouse_Blue:
e==Squeak.Mouse_Blue&&(e=Squeak.Mouse_Yellow));break;case "mouseup":e=0}f.buttons=e|b(d,f);p&&(p.push([Squeak.EventTypeMouse,d.timeStamp,f.mouseX,f.mouseY,f.buttons&Squeak.Mouse_All,f.buttons>>3]),f.signalInputEvent&&f.signalInputEvent());f.idle=0;"mouseup"==a?f.runFor&&f.runFor(100):f.runNow&&f.runNow()}}function g(a,b,c,d){if(c.vm){var e=c.buttons>>3<<8|a;e===c.vm.interruptKeycode?c.vm.interruptPending=!0:d?(d.push([Squeak.EventTypeKeyboard,b,a,Squeak.EventKeyChar,c.buttons>>3,a]),c.signalInputEvent&&
c.signalInputEvent()):c.keys.push(e);c.idle=0;c.runNow&&c.runNow()}}function h(a,b,d,e,f){e.vm&&f&&(c(b,d,e),f.push([Squeak.EventTypeDragDropFiles,b.timeStamp,a,e.mouseX,e.mouseY,e.buttons>>3,e.droppedFiles.length]),e.signalInputEvent&&e.signalInputEvent())}function f(a,b,c,d){c.buttons&=~Squeak.Keyboard_All;c.buttons=c.buttons|Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl;c.keys=[];g(a,b,c,d)}function d(c,d){function p(a){if(a.touches.length)for(var b=k.x=k.y=0;b<a.touches.length;b++)k.x+=a.touches[b].pageX/
a.touches.length,k.y+=a.touches[b].pageY/a.touches.length;return{timeStamp:a.timeStamp,button:k.button,offsetX:k.x-c.offsetLeft,offsetY:k.y-c.offsetTop}}function m(a,b,c,d){a-=c;b-=d;return Math.sqrt(a*a+b*b)}function x(a,b){return m(a.pageX,a.pageY,b.pageX,b.pageY)}function u(a,b,e,f){var p=q.cursorCanvas,m=e/c.width;c.style.left=(a|0)+"px";c.style.top=(b|0)+"px";c.style.width=(e|0)+"px";c.style.height=(f|0)+"px";p&&(p.style.left=(a+q.cursorOffsetX+q.mouseX*m|0)+"px",p.style.top=(b+q.cursorOffsetY+
q.mouseY*m|0)+"px",p.style.width=(p.width*m|0)+"px",p.style.height=(p.height*m|0)+"px");d.pixelated||(3<=m?(c.classList.add("pixelated"),p&&p.classList.add("pixelated")):(c.classList.remove("pixelated"),p&&q.cursorCanvas.classList.remove("pixelated")));return m}function t(a){for(var b=0;b<a.dataTransfer.types.length;b++)if("Files"==a.dataTransfer.types[b])return!0;return!1}d=d||{};d.fullscreen&&(document.body.style.margin=0,document.body.style.backgroundColor="black",document.ontouchmove=function(a){a.preventDefault()},
d.header&&(d.header.style.display="none"),d.footer&&(d.footer.style.display="none"));var q={context:c.getContext("2d"),fullscreen:!1,width:0,height:0,mouseX:0,mouseY:0,buttons:0,keys:[],clipboardString:"",clipboardStringChanged:!1,cursorCanvas:!1!==d.cursor&&document.createElement("canvas"),cursorOffsetX:0,cursorOffsetY:0,droppedFiles:[],signalInputEvent:null};a(d);d.pixelated&&(c.classList.add("pixelated"),q.cursorCanvas&&q.cursorCanvas.classList.add("pixelated"));var A=null;q.reset=function(){A=
null;q.signalInputEvent=null;q.lastTick=0;q.getNextEvent=function(a,b){A=[];A.push=function(a){A.offset=Date.now()-a[1];delete A.push;A.push(a)};q.getNextEvent=function(a,b){var c=A.shift();if(c)for(b-=A.offset,a[0]=c[0],a[1]=c[1]-b&Squeak.MillisecondClockMask,b=2;b<c.length;b++)a[b]=c[b];else a[0]=Squeak.EventTypeNone};q.getNextEvent(a,b)}};q.reset();var n=l(q,c,d);q.fullscreenRequest=function(a,b){q.fullscreen!=a?(q.fullscreen=a,q.resizeTodo=b,q.resizeTodoTimeout=setTimeout(q.resizeDone,1E3),n()):
b()};q.resizeDone=function(){clearTimeout(q.resizeTodoTimeout);var a=q.resizeTodo;a&&(q.resizeTodo=null,a())};q.clear=function(){c.width=c.width};q.showBanner=function(a,b){b=b||{};var d=q.context;d.clearRect(0,0,c.width,c.height);d.fillStyle=b.color||"#F90";d.font=b.font||"bold 48px sans-serif";!b.font&&d.measureText(a).width>c.width&&(d.font="bold 24px sans-serif");d.textAlign="center";d.textBaseline="middle";d.fillText(a,c.width/2,c.height/2)};q.showProgress=function(a,b){b=b||{};var d=q.context,
e=c.width/3|0,f=.5*c.width-e/2,p=.5*c.height+48;d.fillStyle=b.background||"#000";d.fillRect(f,p,e,24);d.lineWidth=2;d.strokeStyle=b.color||"#F90";d.strokeRect(f,p,e,24);d.fillStyle=b.color||"#F90";d.fillRect(f,p,e*a,24)};q.executeClipboardPaste=function(a,b){if(!q.vm)return!0;try{q.clipboardString=a,f(118,b,q,A)}catch(Q){console.error("paste error "+Q)}};q.executeClipboardCopy=function(a,b){if(!q.vm)return!0;q.clipboardStringChanged=!1;f((a||"c").charCodeAt(0),b,q,A);for(a=Date.now();!q.clipboardStringChanged&&
500>Date.now()-a;)q.vm.interpret(20);if(q.clipboardStringChanged)try{return q.clipboardString}catch(Q){console.error("copy error "+Q)}};c.onmousedown=function(a){n();e("mousedown",a,c,q,A,d);a.preventDefault();return!1};c.onmouseup=function(a){e("mouseup",a,c,q,A,d);n();a.preventDefault()};c.onmousemove=function(a){e("mousemove",a,c,q,A,d);a.preventDefault()};c.oncontextmenu=function(){return!1};var k={state:"idle",button:0,x:0,y:0,dist:0,down:{}};c.ontouchstart=function(a){a.preventDefault();for(var b=
p(a),f=0;f<a.changedTouches.length;f++)switch(k.state){case "idle":k.state="got1stFinger";k.first=b;setTimeout(function(){"got1stFinger"===k.state&&(k.state="mousing",k.button=b.button=0,e("mousemove",b,c,q,A,d),e("mousedown",b,c,q,A,d))},100);break;case "got1stFinger":k.state="got2ndFinger",k.dist=x(a.touches[0],a.touches[1]),k.down.x=k.x,k.down.y=k.y,k.down.dist=k.dist,k.down.left=c.offsetLeft,k.down.top=c.offsetTop,k.down.width=c.offsetWidth,k.down.height=c.offsetHeight,k.orig||(k.orig={left:k.down.left,
top:k.down.top,right:k.down.left+k.down.width,bottom:k.down.top+k.down.height,width:k.down.width,height:k.down.height}),setTimeout(function(){"got2ndFinger"===k.state&&(10<Math.abs(k.down.dist-k.dist)||10<m(k.down.x,k.down.y,k.x,k.y)?k.state="zooming":(k.state="mousing",k.button=b.button=2,e("mousemove",b,c,q,A,d),e("mousedown",b,c,q,A,d)))},200)}};c.ontouchmove=function(a){a.preventDefault();var b=p(a);switch(k.state){case "got1stFinger":k.state="mousing";k.button=b.button=0;e("mousemove",b,c,q,
A,d);e("mousedown",b,c,q,A,d);break;case "mousing":e("mousemove",b,c,q,A,d);break;case "got2ndFinger":1<a.touches.length&&(k.dist=x(a.touches[0],a.touches[1]));break;case "zooming":if(!(2>a.touches.length)){k.dist=x(a.touches[0],a.touches[1]);a=k.orig.width/k.down.width;var f=Math.min(Math.max(k.dist/k.down.dist,.95*a),5*a);a=k.down.width*f;b=k.orig.height*a/k.orig.width;var m=k.down.left-(k.down.x-k.down.left)*(f-1)+(k.x-k.down.x);f=k.down.top-(k.down.y-k.down.top)*(f-1)+(k.y-k.down.y);m=Math.max(Math.min(m,
k.orig.left+20),k.orig.right-a-20);f=Math.max(Math.min(f,k.orig.top+20),k.orig.bottom-b-20);u(m,f,a,b)}}};c.ontouchend=function(a){a.preventDefault();n();for(var b=p(a),f=0;f<a.changedTouches.length;f++)switch(k.state){case "mousing":if(0<a.touches.length)break;k.state="idle";e("mouseup",b,c,q,A,d);return;case "got1stFinger":k.state="idle";k.button=b.button=0;e("mousemove",b,c,q,A,d);e("mousedown",b,c,q,A,d);e("mouseup",b,c,q,A,d);return;case "got2ndFinger":k.state="mousing";k.button=b.button=2;e("mousemove",
b,c,q,A,d);e("mousedown",b,c,q,A,d);break;case "zooming":if(!(0<a.touches.length)){k.state="idle";a=c.offsetLeft;b=c.offsetTop;f=c.offsetWidth;f=Math.min(Math.max(f,k.orig.width),5*k.orig.width);var m=k.orig.height*f/k.orig.width;a=Math.max(Math.min(a,k.orig.left),k.orig.right-f);b=Math.max(Math.min(b,k.orig.top),k.orig.bottom-m);1E-4>u(a,b,f,m)-q.initialScale&&(k.orig=null,window.onresize());return}}};c.ontouchcancel=function(a){c.ontouchend(a)};if(q.cursorCanvas){var w="absolute"===window.getComputedStyle(c).position;
q.cursorCanvas.style.display="block";q.cursorCanvas.style.position=w?"absolute":"fixed";q.cursorCanvas.style.cursor="none";q.cursorCanvas.style.background="transparent";q.cursorCanvas.style.pointerEvents="none";c.parentElement.appendChild(q.cursorCanvas);c.style.cursor="none"}document.onkeypress=function(a){if(!q.vm||/[CXVR]/.test(String.fromCharCode(a.charCode+64)))return!0;b(a,q);g(a.charCode,a.timeStamp,q,A);a.preventDefault()};document.onkeydown=function(a){n();if(!q.vm)return!0;b(a,q);var c=
{8:8,9:9,13:13,27:27,32:32,33:11,34:12,35:4,36:1,37:28,38:30,39:29,40:31,45:5,46:127}[a.keyCode];if(c)return g(c,a.timeStamp,q,A),a.preventDefault();if(a.metaKey||a.altKey&&!a.ctrlKey)if(c=a.key,!c&&a.keyIdentifier&&"U+"==a.keyIdentifier.slice(0,2)&&(c=String.fromCharCode(parseInt(a.keyIdentifier.slice(2),16))),c&&1==c.length){if(/[CXVR]/i.test(c))return!0;var d=c.charCodeAt(0);/[A-Z]/.test(c)&&!a.shiftKey&&(d+=32);g(d,a.timeStamp,q,A);return a.preventDefault()}};document.onkeyup=function(a){if(!q.vm)return!0;
b(a,q)};document.oncopy=function(a,b){b=q.executeClipboardCopy(b,a.timeStamp);"string"===typeof b&&a.clipboardData.setData("Text",b);a.preventDefault()};document.oncut=function(a){if(!q.vm)return!0;document.oncopy(a,"x")};document.onpaste=function(a){var b=a.clipboardData.getData("Text");q.executeClipboardPaste(b,a.timeStamp);a.preventDefault()};"ontouchstart"in document&&(w=document.createElement("div"),w.innerHTML='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg width="50px" height="50px" viewBox="0 0 150 150" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="Page-1" stroke="none" fill="#000000"><rect x="33" y="105" width="10" height="10" rx="1"></rect><rect x="26" y="60" width="10" height="10" rx="1"></rect><rect x="41" y="60" width="10" height="10" rx="1"></rect><rect x="56" y="60" width="10" height="10" rx="1"></rect><rect x="71" y="60" width="10" height="10" rx="1"></rect><rect x="86" y="60" width="10" height="10" rx="1"></rect><rect x="101" y="60" width="10" height="10" rx="1"></rect><rect x="116" y="60" width="10" height="10" rx="1"></rect><rect x="108" y="105" width="10" height="10" rx="1"></rect><rect x="33" y="75" width="10" height="10" rx="1"></rect><rect x="48" y="75" width="10" height="10" rx="1"></rect><rect x="63" y="75" width="10" height="10" rx="1"></rect><rect x="78" y="75" width="10" height="10" rx="1"></rect><rect x="93" y="75" width="10" height="10" rx="1"></rect><rect x="108" y="75" width="10" height="10" rx="1"></rect><rect x="41" y="90" width="10" height="10" rx="1"></rect><rect x="26" y="90" width="10" height="10" rx="1"></rect><rect x="56" y="90" width="10" height="10" rx="1"></rect><rect x="71" y="90" width="10" height="10" rx="1"></rect><rect x="86" y="90" width="10" height="10" rx="1"></rect><rect x="101" y="90" width="10" height="10" rx="1"></rect><rect x="116" y="90" width="10" height="10" rx="1"></rect><rect x="48" y="105" width="55" height="10" rx="1"></rect><path d="M20.0056004,51 C18.3456532,51 17.0000001,52.3496496 17.0000001,54.0038284 L17.0000001,85.6824519 L17,120.003453 C17.0000001,121.6584 18.3455253,123 20.0056004,123 L131.9944,123 C133.654347,123 135,121.657592 135,119.997916 L135,54.0020839 C135,52.3440787 133.654475,51 131.9944,51 L20.0056004,51 Z" fill="none" stroke="#000000" stroke-width="2"></path><path d="M52.0410156,36.6054687 L75.5449219,21.6503905 L102.666016,36.6054687" id="Line" stroke="#000000" stroke-width="3" stroke-linecap="round" fill="none"></path></g></svg>',
w.setAttribute("style","position:fixed;right:0;bottom:0;background-color:rgba(128,128,128,0.5);border-radius:5px"),c.parentElement.appendChild(w),w.onmousedown=function(a){c.contentEditable=!0;c.setAttribute("autocomplete","off");c.setAttribute("autocorrect","off");c.setAttribute("autocapitalize","off");c.setAttribute("spellcheck","off");c.focus();a.preventDefault()},w.ontouchstart=w.onmousedown);document.ondragover=function(a){a.preventDefault();t(a)?(a.dataTransfer.dropEffect="copy",h(Squeak.EventDragMove,
a,c,q,A)):a.dataTransfer.dropEffect="none"};document.ondragenter=function(a){t(a)&&h(Squeak.EventDragEnter,a,c,q,A)};document.ondragleave=function(a){t(a)&&h(Squeak.EventDragLeave,a,c,q,A)};document.ondrop=function(a){a.preventDefault();if(!t(a))return!1;var b=[].slice.call(a.dataTransfer.files),e=[],f,p=null;q.droppedFiles=[];b.forEach(function(m){q.droppedFiles.push(m.name);var g=new FileReader;g.onload=function(){var g=this.result;Squeak.filePut(m.name,g);e.push(m.name);f||!/.*image$/.test(m.name)||
q.vm&&!confirm("Run "+m.name+" now?\n(cancel to use as file)")||(f=g,p=m.name);e.length==b.length&&(f?(SqueakJS.appName=p.slice(0,-6),SqueakJS.runImage(f,p,q,d)):h(Squeak.EventDragDrop,a,c,q,A))};g.readAsArrayBuffer(m)});return!1};window.onresize=function(){if(!k.orig){var a=window.innerWidth,b=window.innerHeight;setTimeout(function(){a==window.innerWidth&&b==window.innerHeight&&q.resizeDone()},300);if(d.header&&d.footer||d.fullscreen){var e=d.fullscreen||q.fullscreen,f=e?0:d.header.offsetTop+d.header.offsetHeight,
p=window.innerWidth;e=e?window.innerHeight:Math.max(100,d.footer.offsetTop-f);var m=0,g=0;if(d.fixedWidth){q.width=d.fixedWidth;q.height=d.fixedHeight;var x=q.width/q.height;p/e>x?m=p-Math.floor(e*x):g=e-Math.floor(p/x);q.initialScale=(p-m)/q.width}else d.minWidth||(d.minWidth=700),d.minHeight||(d.minHeight=700),x=Math.max(p<d.minWidth?d.minWidth/p:1,e<d.minHeight?d.minHeight/e:1),q.width=Math.floor(p*x),q.height=Math.floor(e*x),q.initialScale=p/q.width;c.style.left=0+Math.floor(m/2)+"px";c.style.top=
f+Math.floor(g/2)+"px";c.style.width=p-m+"px";c.style.height=e-g+"px";if(c.width!=q.width||c.height!=q.height)f=(d.fixedWidth||!q.resizeTodo)&&q.context.getImageData(0,0,c.width,c.height),c.width=q.width,c.height=q.height,f&&q.context.putImageData(f,0,0);q.cursorCanvas&&d.fixedWidth&&(f=q.cursorCanvas,x=c.offsetWidth/c.width,f.style.width=f.width*x+"px",f.style.height=f.height*x+"px")}else q.width=c.width,q.height=c.height}};window.onresize();return q}function n(a,b){b=b.spinner;if(!b)return null;
b.onmousedown=function(b){confirm(SqueakJS.appName+" is busy. Interrupt?")&&(a.interruptPending=!0)};return b.style}function k(a){var b=(location.hash||location.search).slice(1);if(b=b&&b.split("&"))for(var c=0;c<b.length;c++){var d=b[c].split("="),e=d[0],f=!0;if(1<d.length&&(f=decodeURIComponent(d.slice(1).join("=")),f.match(/^(true|false|null|[0-9"[{].*)$/)))try{f=JSON.parse(f)}catch(M){"["===f[0]&&(f=f.slice(1,-1).split(","))}a[e]=f}b=Squeak.splitFilePath(a.root||"/").fullname;Squeak.dirCreate(b,
!0);/\/$/.test(b)||(b+="/");a.root=b;SqueakJS.options=a}function y(a){if(a.templates){if(a.templates.constructor===Array){var b={};a.templates.forEach(function(a){b[a]=a});a.templates=b}for(var c in a.templates){var d="/"==c[0]?c:a.root+c,e=Squeak.splitUrl(a.templates[c],a.url).full;Squeak.fetchTemplateDir(d,e)}}}function w(a,b,c,d){Squeak.filePut(c.root+a.name,a.data,function(){console.log("Stored "+c.root+a.name);a.zip?t(a,b,c,d):d()})}function t(a,b,c,d){JSZip().loadAsync(a.data).then(function(e){var f=
[];e.forEach(function(e){!c.image.name&&e.match(/\.image$/)&&(c.image.name=e);if(c.forceDownload||!Squeak.fileExists(c.root+e))f.push(e);else if(c.image.name===e){var p=d;d=function(){Squeak.fileGet(c.root+e,function(a){c.image.data=a;return p()},function(){Squeak.fileDelete(c.root+a.name);return t(a,b,c,p)})}}});if(0===f.length)return d();var p=0;b.showBanner("Unzipping "+a.name);b.showProgress(0);f.forEach(function(m){console.log("Inflating "+a.name+": "+m);e.file(m).async("arraybuffer",function(a){b.showProgress((a.percent/
100+p)/f.length)}).then(function(a){console.log("Expanded size of "+m+": "+a.byteLength);var e={};c.image.name===m&&(e=c.image);e.name=m;e.data=a;w(e,b,c,function(){++p===f.length&&d()})})})})}function p(a,b,c,d,e){if(!Squeak.fileExists(c.root+a.name))return e();a.image||a.zip?Squeak.fileGet(c.root+a.name,function(e){a.data=e;a.zip?t(a,b,c,d):d()},function(){Squeak.fileDelete(c.root+a.name);return e()}):d()}function m(a,b,c,d){b.showBanner("Downloading "+a.name);var e=new XMLHttpRequest;e.open("GET",
(c.proxy||"")+a.url);c.ajax&&e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.responseType="arraybuffer";e.onprogress=function(a){a.lengthComputable&&b.showProgress(a.loaded/a.total)};e.onload=function(e){if(200==this.status)a.data=this.response,w(a,b,c,d);else this.onerror(this.statusText)};e.onerror=function(b){if(c.proxy)return console.error(Squeak.bytesAsString(new Uint8Array(this.response))),alert("Failed to download:\n"+a.url);console.warn("Retrying with CORS proxy: "+a.url);b=new XMLHttpRequest;
b.open("GET","https://crossorigin.me/"+a.url);c.ajax&&b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.responseType=e.responseType;b.onprogress=e.onprogress;b.onload=e.onload;b.onerror=function(){console.error(Squeak.bytesAsString(new Uint8Array(this.response)));alert("Failed to download:\n"+a.url)};b.send()};e.send()}function x(a,b,c,d){function e(){if(0===a.length)return d();var f=a.shift();c.forceDownload||f.forceDownload?m(f,b,c,e):p(f,b,c,function(){e()},function(){m(f,b,c,e)})}e()}
var q=window.localStorage;try{q["squeak-foo:"]="bar";if("bar"!==q["squeak-foo:"])throw Error();delete q["squeak-foo:"]}catch(P){q={}}var u=navigator.userAgent.match("AppleWebKit/"),A=0,B=0,D;SqueakJS.runImage=function(b,c,d,e){window.onbeforeunload=function(a){var b=SqueakJS.appName+" is still running";return a.returnValue=b};window.clearTimeout(D);d.reset();d.clear();d.showBanner("Loading "+SqueakJS.appName);d.showProgress(0);var f=this;window.setTimeout(function(){var p=new Squeak.Image(c);p.readFromBuffer(b,
function(){function b(){try{if(d.quitFlag)f.onQuit(m,d,e);else m.interpret(50,function(a){"sleep"==a&&(a=200);if(g){var c=g,e=m,f=500>e.lastTick-d.lastTick;0!==a||f?(c.display="none",B=0):0===B?B=e.lastTick:1E3<e.lastTick-B&&(c.display="block",A=(A+30)%360,c.webkitTransform=c.transform="rotate("+A+"deg)")}D=window.setTimeout(b,a)})}catch(G){console.error(G),alert(G)}}d.quitFlag=!1;var m=new Squeak.Interpreter(p,d);SqueakJS.vm=m;q.squeakImageName=c;a(e);d.clear();d.showBanner("Starting "+SqueakJS.appName);
var g=n(m,e);d.runNow=function(){window.clearTimeout(D);b()};d.runFor=function(a){a=Date.now()+a;do{if(d.quitFlag)break;d.runNow()}while(Date.now()<a)};b()},function(a){d.showProgress(a)})},0)};SqueakJS.runSqueak=function(a,b,c){k(c);!a&&c.image&&(a=c.image);var e=c.url||a&&a.replace(/[^\/]*$/,"")||"";c.url=e;y(c);var f=d(b,c),p={url:null,name:null,image:!0,data:null},m=[];f.argv=c.argv;a&&(a=Squeak.splitUrl(a,e),p.url=a.full,p.name=a.filename);c.files&&c.files.forEach(function(a){var b=Squeak.splitUrl(a,
e);p.name!==b.filename&&(!p.url&&a.match(/\.image$/)?(p.name=b.filename,p.url=b.full):m.push({url:b.full,name:b.filename}))});c.zip&&("string"===typeof c.zip?[c.zip]:c.zip).forEach(function(a){a=Squeak.splitUrl(a,e);m.push({url:a.full,name:a.filename,zip:!0})});p.url&&m.push(p);c.document&&(a=Squeak.splitUrl(c.document,e),m.push({url:a.full,name:a.filename,forceDownload:!1!==c.forceDownload}),f.documentName=c.root+a.filename);c.image=p;x(m,f,c,function(){Squeak.fsck();var a=c.image;if(!a.name)return alert("could not find an image");
if(!a.data)return alert("could not find image "+a.name);SqueakJS.appName=c.appName||a.name.replace(/\.image$/,"");SqueakJS.runImage(a.data,c.root+a.name,f,c)});return f};SqueakJS.quitSqueak=function(){SqueakJS.vm.quitFlag=!0};SqueakJS.onQuit=function(a,b,c){window.onbeforeunload=null;b.vm=null;c.spinner&&(c.spinner.style.display="none");if(c.onQuit)c.onQuit(a,b,c);else b.showBanner(SqueakJS.appName+" stopped.")}});
window.applicationCache&&applicationCache.addEventListener("updateready",function(){confirm((window.SqueakJS&&SqueakJS.options&&SqueakJS.options.appName||"SqueakJS")+" has been updated. Restart now?")&&(window.onbeforeunload=null,window.location.reload())});module("users.bert.SqueakJS.vm").requires().toRun(function(){window.Squeak=users.bert.SqueakJS.vm;var l=window.localStorage;try{l["squeak-foo:"]="bar";if("bar"!==l["squeak-foo:"])throw Error();delete l["squeak-foo:"]}catch(a){console.warn("localStorage not available, faking"),l={}}Object.extend(Squeak,"version",{vmVersion:"SqueakJS 0.9.7",vmDate:"2019-01-03",vmBuild:"unknown",vmPath:"/",vmFile:"vm.js",platformName:"Web",platformSubtype:"unknown",osVersion:navigator.userAgent,windowSystem:"HTML"},
"object header",{HeaderTypeMask:3,HeaderTypeSizeAndClass:0,HeaderTypeClass:1,HeaderTypeFree:2,HeaderTypeShort:3},"special objects",{splOb_NilObject:0,splOb_FalseObject:1,splOb_TrueObject:2,splOb_SchedulerAssociation:3,splOb_ClassBitmap:4,splOb_ClassInteger:5,splOb_ClassString:6,splOb_ClassArray:7,splOb_SmalltalkDictionary:8,splOb_ClassFloat:9,splOb_ClassMethodContext:10,splOb_ClassBlockContext:11,splOb_ClassPoint:12,splOb_ClassLargePositiveInteger:13,splOb_TheDisplay:14,splOb_ClassMessage:15,splOb_ClassCompiledMethod:16,
splOb_TheLowSpaceSemaphore:17,splOb_ClassSemaphore:18,splOb_ClassCharacter:19,splOb_SelectorDoesNotUnderstand:20,splOb_SelectorCannotReturn:21,splOb_TheInputSemaphore:22,splOb_SpecialSelectors:23,splOb_CharacterTable:24,splOb_SelectorMustBeBoolean:25,splOb_ClassByteArray:26,splOb_ClassProcess:27,splOb_CompactClasses:28,splOb_TheTimerSemaphore:29,splOb_TheInterruptSemaphore:30,splOb_FloatProto:31,splOb_SelectorCannotInterpret:34,splOb_MethodContextProto:35,splOb_ClassBlockClosure:36,splOb_BlockContextProto:37,
splOb_ExternalObjectsArray:38,splOb_ClassPseudoContext:39,splOb_ClassTranslatedMethod:40,splOb_TheFinalizationSemaphore:41,splOb_ClassLargeNegativeInteger:42,splOb_ClassExternalAddress:43,splOb_ClassExternalStructure:44,splOb_ClassExternalData:45,splOb_ClassExternalFunction:46,splOb_ClassExternalLibrary:47,splOb_SelectorAboutToReturn:48,splOb_SelectorRunWithIn:49,splOb_SelectorAttemptToAssign:50,splOb_PrimErrTableIndex:51,splOb_ClassAlien:52,splOb_InvokeCallbackSelector:53,splOb_ClassUnsafeAlien:54,
splOb_ClassWeakFinalizer:55},"known classes",{Class_superclass:0,Class_mdict:1,Class_format:2,Class_instVars:null,Class_name:6,Context_sender:0,Context_instructionPointer:1,Context_stackPointer:2,Context_method:3,Context_closure:4,Context_receiver:5,Context_tempFrameStart:6,Context_smallFrameSize:16,Context_largeFrameSize:56,BlockContext_caller:0,BlockContext_argumentCount:3,BlockContext_initialIP:4,BlockContext_home:5,Closure_outerContext:0,Closure_startpc:1,Closure_numArgs:2,Closure_firstCopiedValue:3,
Stream_array:0,Stream_position:1,Stream_limit:2,ProcSched_processLists:0,ProcSched_activeProcess:1,Link_nextLink:0,LinkedList_firstLink:0,LinkedList_lastLink:1,Semaphore_excessSignals:2,Mutex_owner:2,Proc_suspendedContext:1,Proc_priority:2,Proc_myList:3,Assn_key:0,Assn_value:1,MethodDict_array:1,MethodDict_selectorStart:2,Message_selector:0,Message_arguments:1,Message_lookupClass:2,Point_x:0,Point_y:1,LargeInteger_bytes:0,LargeInteger_neg:1,BitBlt_dest:0,BitBlt_source:1,BitBlt_halftone:2,BitBlt_combinationRule:3,
BitBlt_destX:4,BitBlt_destY:5,BitBlt_width:6,BitBlt_height:7,BitBlt_sourceX:8,BitBlt_sourceY:9,BitBlt_clipX:10,BitBlt_clipY:11,BitBlt_clipW:12,BitBlt_clipH:13,BitBlt_colorMap:14,BitBlt_warpBase:15,Form_bits:0,Form_width:1,Form_height:2,Form_depth:3,Form_offset:4,WeakFinalizationList_first:0,WeakFinalizerItem_list:0,WeakFinalizerItem_next:1,ExtLibFunc_handle:0,ExtLibFunc_flags:1,ExtLibFunc_argTypes:2,ExtLibFunc_name:3,ExtLibFunc_module:4,ExtLibFunc_errorCodeName:5},"events",{Mouse_Blue:1,Mouse_Yellow:2,
Mouse_Red:4,Keyboard_Shift:8,Keyboard_Ctrl:16,Keyboard_Alt:32,Keyboard_Cmd:64,Mouse_All:7,Keyboard_All:120,EventTypeNone:0,EventTypeMouse:1,EventTypeKeyboard:2,EventTypeDragDropFiles:3,EventKeyChar:0,EventKeyDown:1,EventKeyUp:2,EventDragEnter:1,EventDragMove:2,EventDragLeave:3,EventDragDrop:4},"constants",{MinSmallInt:-1073741824,MaxSmallInt:1073741823,NonSmallInt:-1342177280,MillisecondClockMask:536870911},"error codes",{PrimNoErr:0,PrimErrGenericFailure:1,PrimErrBadReceiver:2,PrimErrBadArgument:3,
PrimErrBadIndex:4,PrimErrBadNumArgs:5,PrimErrInappropriate:6,PrimErrUnsupported:7,PrimErrNoModification:8,PrimErrNoMemory:9,PrimErrNoCMemory:10,PrimErrNotFound:11,PrimErrBadMethod:12,PrimErrNamedInternal:13,PrimErrObjectMayMove:14,PrimErrLimitExceeded:15,PrimErrObjectIsPinned:16,PrimErrWritePastObject:17},"modules",{externalModules:Squeak.externalModules||{},registerExternalModule:function(a,b){this.externalModules[a]=b}},"files",{fsck:function(a,b,c,e){b=b||"";e=e||{dirs:0,files:0,bytes:0,deleted:0};
if(!c){c={};for(var g in l){var h=g.match(/squeak-file(\.lz)?:(.*)$/);h&&(c[h[2]]=!0)}if("undefined"!==typeof indexedDB)return this.dbTransaction("readonly","fsck cursor",function(d){d=d.openCursor();d.onsuccess=function(d){(d=d.target.result)?(c[d.key]=!0,d.continue()):Squeak.fsck(a,b,c,e)};d.onerror=function(a){console.error("fsck failed")}})}g=Squeak.dirList(b);for(var f in g){var d=b+"/"+f;g[f][3]?"squeak:"+d in l?(Squeak.fsck(null,d,c,e),e.dirs++):(console.log("Deleting stale directory "+d),
Squeak.dirDelete(d),e.deleted++):c[d]?(c[d]=!1,e.files++,e.bytes+=g[f][4]):(console.log("Deleting stale file entry "+d),Squeak.fileDelete(d,!0),e.deleted++)}if(""===b){console.log("squeak fsck: "+e.dirs+" directories, "+e.files+" files, "+(e.bytes/1E6).toFixed(1)+" MBytes");var n=[];f=0;for(d in c)f++,c[d]&&n.push(d);if(0<n.length){for(d=0;d<n.length;d++)console.log("Deleting orphaned file "+n[d]),delete l["squeak-file:"+n[d]],delete l["squeak-file.lz:"+n[d]],e.deleted++;"undefined"!==typeof indexedDB&&
this.dbTransaction("readwrite","fsck delete",function(a){for(var b=0;b<n.length;b++)a.delete(n[b])})}a&&a(e)}},dbTransaction:function(a,b,c,e){function g(){c(Squeak.dbFake());e&&e()}function h(){var d=SqueakDB.transaction("files",a),f=d.objectStore("files");d.oncomplete=function(a){e&&e()};d.onerror=function(a){console.error(a.target.error.name+": "+b)};d.onabort=function(a){console.error(a.target.error.name+": aborting "+b);c(Squeak.dbFake());e&&e()};c(f)}if("undefined"==typeof indexedDB)return g();
if(window.SqueakDB)return h();var f=indexedDB.open("squeak");if(!f)return g();f.onsuccess=function(a){console.log("Opened files database.");window.SqueakDB=this.result;SqueakDB.onversionchange=function(a){delete window.SqueakDB;this.close()};SqueakDB.onerror=function(a){console.error("Error accessing database: "+a.target.error.name)};h()};f.onupgradeneeded=function(a){console.log("Creating files database");a.target.result.createObjectStore("files")};f.onerror=function(a){console.error(a.target.error.name+
": cannot open files database");console.warn("Falling back to local storage");g()};f.onblocked=function(a){console.log("Database upgrade needed, but was blocked.");console.warn("Falling back to local storage");g()}},dbFake:function(){"undefined"==typeof SqueakDBFake&&("undefined"==typeof indexedDB&&console.warn("IndexedDB not supported by this browser, using localStorage"),window.SqueakDBFake={bigFiles:{},bigFileThreshold:1E5,get:function(a){var b=SqueakDBFake.bigFiles[a];if(!b){var c=l["squeak-file:"+
a];if(!c){var e=l["squeak-file.lz:"+a];e&&("object"==typeof LZString?c=LZString.decompressFromUTF16(e):console.error("LZString not loaded: cannot decompress "+a))}if(c){a=new Uint8Array(c.length);for(b=0;b<a.length;b++)a[b]=c.charCodeAt(b)&255;b=a.buffer}}var g={result:b};setTimeout(function(){if(g.onsuccess)g.onsuccess({target:g})},0);return g},put:function(a,b){a.byteLength>SqueakDBFake.bigFileThreshold?(SqueakDBFake.bigFiles[b]||console.log("File "+b+" ("+a.byteLength+" bytes) too large, storing in memory only"),
SqueakDBFake.bigFiles[b]=a):(a=Squeak.bytesAsString(new Uint8Array(a)),"object"==typeof LZString?(a=LZString.compressToUTF16(a),l["squeak-file.lz:"+b]=a,delete l["squeak-file:"+b]):l["squeak-file:"+b]=a);var c={};setTimeout(function(){if(c.onsuccess)c.onsuccess()},0);return c},delete:function(a){delete l["squeak-file:"+a];delete l["squeak-file.lz:"+a];delete SqueakDBFake.bigFiles[a];var b={};setTimeout(function(){if(b.onsuccess)b.onsuccess()},0);return b},openCursor:function(){var a={};setTimeout(function(){if(a.onsuccess)a.onsuccess({target:a})},
0);return a}});return SqueakDBFake},fileGet:function(a,b,c){c||(c=function(a){console.log(a)});var e=this.splitFilePath(a);if(!e.basename)return c("Invalid path: "+a);if(window.SqueakDBFake&&SqueakDBFake.bigFiles[e.fullname])return b(SqueakDBFake.bigFiles[e.fullname]);this.dbTransaction("readonly","get "+a,function(a){a=a.get(e.fullname);a.onerror=function(a){c(a.target.error.name)};a.onsuccess=function(a){if(void 0!==this.result)return b(this.result);Squeak.fetchTemplateFile(e.fullname,function(a){b(a)},
function(){if("undefined"==typeof indexedDB)return c("file not found: "+e.fullname);var a=Squeak.dbFake().get(e.fullname);a.onerror=function(a){c("file not found: "+e.fullname)};a.onsuccess=function(a){b(this.result)}})}})},filePut:function(a,b,c){var e=this.splitFilePath(a);if(!e.basename)return null;var g=this.dirList(e.dirname);if(!g)return null;var h=g[e.basename],f=this.totalSeconds();if(!h)h=[e.basename,f,0,!1,0],g[e.basename]=h;else if(h[3])return null;h[2]=f;h[4]=b.byteLength||b.length||0;
l["squeak:"+e.dirname]=JSON.stringify(g);this.dbTransaction("readwrite","put "+a,function(a){a.put(b,e.fullname)},function(){c&&c()});return h},fileDelete:function(a,b){var c=this.splitFilePath(a);if(!c.basename)return!1;var e=this.dirList(c.dirname);if(!e)return!1;var g=e[c.basename];if(!g||g[3])return!1;delete e[c.basename];l["squeak:"+c.dirname]=JSON.stringify(e);if(b)return!0;this.dbTransaction("readwrite","delete "+a,function(a){a.delete(c.fullname)});return!0},fileRename:function(a,b){var c=
this.splitFilePath(a);if(!c.basename)return!1;var e=this.splitFilePath(b);if(!e.basename)return!1;a=this.dirList(c.dirname);if(!a)return!1;b=a[c.basename];if(!b||b[3])return!1;var g=c.dirname==e.dirname,h=g?a:this.dirList(e.dirname);if(!h||h[e.basename])return!1;delete a[c.basename];b[0]=e.basename;h[e.basename]=b;l["squeak:"+e.dirname]=JSON.stringify(h);g||(l["squeak:"+c.dirname]=JSON.stringify(a));this.fileGet(c.fullname,function(a){this.dbTransaction("readwrite","rename "+c.fullname+" to "+e.fullname,
function(b){b.delete(c.fullname);b.put(a,e.fullname)})}.bind(this),function(a){console.log("File rename failed: "+a)}.bind(this));return!0},fileExists:function(a){a=this.splitFilePath(a);if(!a.basename)return!1;var b=this.dirList(a.dirname);if(!b)return!1;a=b[a.basename];return!a||a[3]?!1:!0},dirCreate:function(a,b){a=this.splitFilePath(a);if(!a.basename)return!1;b&&!l["squeak:"+a.dirname]&&Squeak.dirCreate(a.dirname,!0);b=this.dirList(a.dirname);if(!b||b[a.basename])return!1;var c=this.totalSeconds();
b[a.basename]=[a.basename,c,c,!0,0];l["squeak:"+a.fullname]=JSON.stringify({});l["squeak:"+a.dirname]=JSON.stringify(b);return!0},dirDelete:function(a){a=this.splitFilePath(a);if(!a.basename)return!1;var b=this.dirList(a.dirname);if(!b||!b[a.basename])return!1;var c=this.dirList(a.fullname);if(!c)return!1;for(var e in c)return!1;delete b[a.basename];l["squeak:"+a.dirname]=JSON.stringify(b);delete l["squeak:"+a.fullname];return!0},dirList:function(a,b){function c(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=
b[c];a[d[0]]=d}}var e=this.splitFilePath(a);a=l["squeak:"+e.fullname];b=b&&l["squeak-template:"+e.fullname];return a||b?(e={},b&&c(e,JSON.parse(b).entries),a&&c(e,JSON.parse(a)),e):"/"==e.fullname?{}:null},splitFilePath:function(a){"/"!==a[0]&&(a="/"+a);a=a.replace(/\/\//g,"/");var b=a.match(/(.*)\/(.*)/);return{fullname:a,dirname:b[1]?b[1]:"/",basename:b[2]?b[2]:null}},splitUrl:function(a,b){var c=a.match(/(.*\/)?(.*)/),e=c[1]||"";c=c[2]||"";e.match(/^[a-z]+:\/\//)||(b&&!b.match(/\/$/)&&(b+="/"),
e=(b||"")+e,a=e+c);return{full:a,uptoslash:e,filename:c}},flushFile:function(a){if(a.modified){var b=a.contents.buffer;b.byteLength!==a.size&&(b=new ArrayBuffer(a.size),(new Uint8Array(b)).set(a.contents.subarray(0,a.size)));Squeak.filePut(a.name,b);a.modified=!1}},flushAllFiles:function(){if("undefined"!=typeof SqueakFiles)for(var a in SqueakFiles)this.flushFile(SqueakFiles[a])},closeAllFiles:function(){Squeak.flushAllFiles();delete window.SqueakFiles},fetchTemplateDir:function(a,b){function c(a){var b=
Squeak.splitFilePath(a);"/"!==b.dirname&&c(b.dirname);a=JSON.parse(l["squeak-template:"+b.dirname]||'{"entries": {}}');if(!a.entries[b.basename]){var e=Squeak.totalSeconds();a.entries[b.basename]=[b.basename,e,e,!0,0];l["squeak-template:"+b.dirname]=JSON.stringify(a)}}function e(a,b){var c=JSON.parse(l["squeak-template:"+a]),d;for(d in c.entries){var e=c.entries[d];e[3]&&Squeak.fetchTemplateDir(a+"/"+e[0],b+"/"+e[0])}}a=Squeak.splitFilePath(a).fullname;if(l["squeak-template:"+a])e(a,b);else{var g=
b+"/sqindex.json",h=new XMLHttpRequest;h.open("GET",g,!0);h.onload=function(f){if(200==h.status){console.log("adding template "+a);c(a);f=JSON.parse(h.response);var d={url:b,entries:{}},g;for(g in f){var k=f[g];d.entries[k[0]]=k}l["squeak-template:"+a]=JSON.stringify(d);e(a,b)}else h.onerror(h.statusText)};h.onerror=function(a){console.log("cannot load template index "+g)};h.send()}},fetchTemplateFile:function(a,b,c){a=Squeak.splitFilePath(a);var e=l["squeak-template:"+a.dirname];if(!e)return c();
var g=JSON.parse(e).url;if(!g)return c();g+="/"+a.basename;e=new XMLHttpRequest;e.open("get",g,!0);e.responseType="arraybuffer";e.timeout=3E4;e.onreadystatechange=function(){if(this.readyState==this.DONE)if(200==this.status){var e=this.response;console.log("Got "+e.byteLength+" bytes from "+g);Squeak.dirCreate(a.dirname,!0);Squeak.filePut(a.fullname,e);b(e)}else console.error("Download failed ("+this.status+") "+g),c()};console.log("Fetching "+g);e.send()}},"audio",{startAudioOut:function(){if(!this.audioOutContext){var a=
window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioOutContext=a&&new a}return this.audioOutContext},startAudioIn:function(a,b){if(this.audioInContext)return this.audioInSource.disconnect(),a(this.audioInContext,this.audioInSource);navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(!navigator.getUserMedia)return b("test: audio input not supported");navigator.getUserMedia({audio:!0,
toString:function(){return"audio"}},function(b){var c=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioInContext=c&&new c;this.audioInSource=this.audioInContext.createMediaStreamSource(b);a(this.audioInContext,this.audioInSource)},function(){b("cannot access microphone")})},stopAudio:function(){this.audioInSource&&this.audioInSource.disconnect()}},"time",{Epoch:Date.UTC(1901,0,1)+6E4*(new Date).getTimezoneOffset(),EpochUTC:Date.UTC(1901,0,1),
totalSeconds:function(){return Math.floor((Date.now()-Squeak.Epoch)/1E3)}},"utils",{bytesAsString:function(a){for(var b=[],c=0;c<a.length;)b.push(String.fromCharCode.apply(null,a.subarray(c,c+=16348)));return b.join("")}});Object.subclass("Squeak.Image","about",{about:function(){}},"initializing",{initialize:function(a){this.totalMemory=1E8;this.name=a;this.newSpaceCount=this.youngSpaceCount=this.oldSpaceCount=this.allocationCount=this.gcTenured=this.pgcMilliseconds=this.pgcCount=this.gcMilliseconds=
this.gcCount=0;this.hasNewInstances={}},readFromBuffer:function(a,b,c){function e(){if(ha){for(var a=Q+(L.oldSpaceCount/20|0);ha&&Q<a;)ha.installFromImage(u,A,ba,aa,f,p),ha=ha.nextObject,Q++;c&&c(Q/L.oldSpaceCount);return!0}L.specialObjectsArray=K;L.decorateKnownObjects();L.isSpur?L.fixSkippedOops(P):(L.fixCompiledMethods(),L.fixCompactOops());return!1}function g(){e()?window.setTimeout(g,0):b&&b()}console.log("squeak: reading "+this.name+" ("+a.byteLength+" bytes)");this.startupTime=Date.now();for(var h=
new DataView(a),f=!1,d=0,n=function(){var a=h.getUint32(d,f);d+=4;return a},k=function(b,c){if(c){for(c=[];c.length<b;)c.push(n());return c}c=new Uint32Array(a,d,b);d+=4*b;return c},l=[6501,6502,6504,6505,6521,68E3,68002,68003,68021],w=0,t=0;;){f=!f;d=t;w=n();if(0<=l.indexOf(w))break;f||(t+=512);if(512<t)throw Error("bad image version");}this.version=w;var p=0<=[6505,6521,68003,68021].indexOf(w);this.hasClosures=0<=[6504,6505,6521,68002,68003,68021].indexOf(w);this.isSpur=0<=[6521,68021].indexOf(w);
if(68E3<=w)throw Error("64 bit images not supported yet");var m=n(),x=n();l=n();w=n();this.lastHash=n();this.savedHeaderWords=[];for(var q=0;6>q;q++)this.savedHeaderWords.push(n());q=n();var u={},A={};d=t+=m;if(this.isSpur){this.oldSpaceBytes=q-16;x=d+q;m=0;for(var B=q=null,D=0,P={};d<x;){for(;d<x-16;){var O=d,F=n(),C=n(),H=C>>>24;255===H&&(H=F,F=n(),C=n());v=m+d-8-t;N=F>>>24&31;var I=F&4194303;C&=4194303;F=k(H,10>N&&0<I);d+=4*(2>H?2-H:H&1);if(32<=I){G=new Squeak.ObjectSpur;G.initFromImage(v,I,N,
C);M&&(M.nextObject=G);this.oldSpaceCount++;var M=G;u[l+v]=G;A[v]=F;P[v]=D}else D+=d-O,q?B||(B=F):q=F,I&&(u[l+v]=F)}if(d!==x-16)throw Error("invalid segment");N=n();C=n();v=n();n();0!==v&&(N=C&4278190080?4*(N&16777215):0,x+=v,m+=N,D+=16+N,this.oldSpaceBytes+=N+v)}this.oldSpaceBytes-=D;this.firstOldObject=u[l];this.lastOldObject=G}else{for(;d<t+x;){m=G=0;q=n();switch(q&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:G=q>>>2;m=n();q=n();break;case Squeak.HeaderTypeClass:m=q-Squeak.HeaderTypeClass;
q=n();G=q>>>2&63;break;case Squeak.HeaderTypeShort:G=q>>>2&63;m=q>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block");}G--;var v=d-4-t,N=q>>>8&15;C=q>>>17&4095;F=k(G,5>N);var G=new Squeak.Object;G.initFromImage(v,m,N,C);32>m&&(G.hash|=268435456);M&&(M.nextObject=G);this.oldSpaceCount++;M=G;u[l+v]=G;A[v]=F}this.firstOldObject=u[l+4];this.lastOldObject=G;this.oldSpaceBytes=x}M=u[w];k=this.isSpur?this.spurClassTable(u,A,B,M):A[u[A[M.oop][Squeak.splOb_CompactClasses]].oop];t=
null;G=this.firstOldObject;for(M=null;G;)M=t,t=G.renameFromImage(u,A,k),M?M.nextObject=t:this.firstOldObject=t,u[l+G.oop]=t,G=G.nextObject;this.lastOldObject=t;var K=u[w],ba=A[u[A[K.oop][Squeak.splOb_CompactClasses]].oop],aa=u[A[K.oop][Squeak.splOb_ClassFloat]];this.isSpur&&(this.initCharacterTable(u[A[K.oop][Squeak.splOb_ClassCharacter]]),ba=this.spurClassTable(u,A,B,K),p=this.getCharacter.bind(this),this.initSpurOverrides());var ha=this.firstOldObject,Q=0,L=this;if(c)window.setTimeout(g,0);else{for(;e(););
b&&b()}},decorateKnownObjects:function(){var a=this.specialObjectsArray.pointers;a[Squeak.splOb_NilObject].isNil=!0;a[Squeak.splOb_TrueObject].isTrue=!0;a[Squeak.splOb_FalseObject].isFalse=!0;a[Squeak.splOb_ClassFloat].isFloatClass=!0;if(!this.isSpur)for(this.compactClasses=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers,a=0;a<this.compactClasses.length;a++)this.compactClasses[a].isNil||(this.compactClasses[a].isCompact=!0);Number.prototype.sqInstName||Object.defineProperty(Number.prototype,
"sqInstName",{enumerable:!1,value:function(){return this.toString()}})},fixCompactOops:function(){if(!this.isSpur){for(var a=this.firstOldObject,b=0;a;){var c=268435455<a.hash;if(c!==!!a.sqClass.isCompact){var e=0===a.snapshotSize().header;c!==e&&(b+=e?-4:4)}a.hash&=268435455;a.oop+=b;a=a.nextObject}this.oldSpaceBytes+=b}},fixCompiledMethods:function(){if(!(6502<=this.version))for(var a=this.firstOldObject,b=this.specialObjectsArray.pointers[Squeak.splOb_ClassCompiledMethod];a;)a.isMethod()&&(a.sqClass=
b),a=a.nextObject},fixSkippedOops:function(a){for(var b=this.firstOldObject;b;)b.oop-=a[b.oop],b=b.nextObject;b=this.lastOldObject;if(b.addr()+b.totalBytes()!==this.oldSpaceBytes)throw Error("image size doesn't match object sizes");}},"garbage collection - full",{fullGC:function(a){this.vm.addMessage("fullGC: "+a);var b=Date.now(),c=this.markReachableObjects();this.removeUnmarkedOldObjects();this.appendToOldObjects(c);this.finalizeWeakReferences();this.allocationCount+=this.newSpaceCount;this.youngSpaceCount=
this.newSpaceCount=0;this.hasNewInstances={};this.gcCount++;this.gcMilliseconds+=Date.now()-b;console.log("Full GC ("+a+"): "+(Date.now()-b)+" ms");return 0<c.length?c[0]:null},gcRoots:function(){this.vm.storeContextRegisters();return[this.specialObjectsArray,this.vm.activeContext]},markReachableObjects:function(){var a=this.gcRoots(),b=[];for(this.weakObjects=[];0<a.length;){var c=a.pop();if(!c.mark){0>c.oop&&b.push(c);c.mark=!0;c.sqClass.mark||a.push(c.sqClass);var e=c.pointers;if(e){var g=e.length;
c.isWeak()&&(g=c.sqClass.classInstSize(),this.weakObjects.push(c));if(this.vm.isContext(c))for(c=g=c.contextSizeWithStack();c<e.length;c++)e[c]=this.vm.nilObj;for(c=0;c<g;c++)"object"!==typeof e[c]||e[c].mark||a.push(e[c])}}}return this.isSpur?b:b.sort(function(a,b){return b.oop-a.oop})},removeUnmarkedOldObjects:function(){var a=0,b=0,c=this.firstOldObject;for(c.mark=!1;;){var e=c.nextObject;if(!e){this.lastOldObject=c;this.oldSpaceBytes-=b;this.oldSpaceCount-=a;break}e.dirty&&(e.dirty=!1);e.mark?
(c=e,c.mark=!1,c.oop-=b):(c.nextObject=e.nextObject,e.oop=-++this.newSpaceCount,b+=e.totalBytes(),a++)}},appendToOldObjects:function(a){for(var b=this.lastOldObject,c=0;c<a.length;c++){var e=a[c];e.mark=!1;this.oldSpaceBytes=e.setAddr(this.oldSpaceBytes);b=b.nextObject=e}b.nextObject=null;this.lastOldObject=b;this.oldSpaceCount+=a.length;this.gcTenured+=a.length},tenureIfYoung:function(a){0>a.oop&&this.appendToOldObjects([a])},finalizeWeakReferences:function(){var a=this.weakObjects;this.weakObjects=
null;for(var b=0;b<a.length;b++){for(var c=a[b],e=c.pointers,g=c.sqClass.classInstSize(),h=!1,f=g;f<e.length;f++)0>e[f].oop&&(e[f]=this.vm.nilObj,h=!0);h&&(this.vm.pendingFinalizationSignals++,2<=g&&(e=c.pointers[Squeak.WeakFinalizerItem_list],e.sqClass==this.vm.specialObjects[Squeak.splOb_ClassWeakFinalizer]&&(c.pointers[Squeak.WeakFinalizerItem_next]=e.pointers[Squeak.WeakFinalizationList_first],e.pointers[Squeak.WeakFinalizationList_first]=c)))}0<this.vm.pendingFinalizationSignals&&this.vm.forceInterruptCheck()}},
"garbage collection - partial",{partialGC:function(a){this.vm.addMessage("partialGC: "+a);var b=Date.now(),c=this.findYoungObjects();this.appendToYoungSpace(c);this.finalizeWeakReferences();this.cleanupYoungSpace(c);this.allocationCount+=this.newSpaceCount-c.length;this.newSpaceCount=this.youngSpaceCount=c.length;this.pgcCount++;this.pgcMilliseconds+=Date.now()-b;console.log("Partial GC ("+a+"): "+(Date.now()-b)+" ms");return c[0]},youngRoots:function(){for(var a=this.gcRoots().filter(function(a){return 0>
a.oop}),b=this.firstOldObject;b;){if(b.dirty){for(var c=b.pointers,e=!1,g=0;g<c.length;g++){var h=c[g];"object"===typeof h&&0>h.oop&&(a.push(h),e=!0)}b.dirty=e}b=b.nextObject}return a},findYoungObjects:function(){var a=this.youngRoots(),b=[];for(this.weakObjects=[];0<a.length;){var c=a.pop();if(!c.mark){b.push(c);c.mark=!0;0>c.sqClass.oop&&a.push(c.sqClass);var e=c.pointers;if(e){var g=e.length;c.isWeak()&&(g=c.sqClass.classInstSize(),this.weakObjects.push(c));if(this.vm.isContext(c))for(c=g=c.contextSizeWithStack();c<
e.length;c++)e[c]=this.vm.nilObj;for(c=0;c<g;c++){var h=e[c];"object"===typeof h&&0>h.oop&&a.push(e[c])}}}}return this.isSpur?b:b.sort(function(a,b){return b.oop-a.oop})},appendToYoungSpace:function(a){for(var b=this.lastOldObject.oop+1,c=0;c<a.length;c++){var e=a[c];this.hasNewInstances[e.oop]&&(delete this.hasNewInstances[e.oop],this.hasNewInstances[b]=!0);e.oop=b;e.nextObject=a[c+1];b++}},cleanupYoungSpace:function(a){a=a[0];for(var b=-1;a;)this.hasNewInstances[a.oop]&&(delete this.hasNewInstances[a.oop],
this.hasNewInstances[b]=!0),a.oop=b,a.mark=!1,a=a.nextObject,b--}},"creating",{registerObject:function(a){a.oop=-++this.newSpaceCount;this.lastHash=13849+27181*this.lastHash&4294967295;return this.lastHash&4095},registerObjectSpur:function(a){a.oop=-++this.newSpaceCount;return 0},instantiateClass:function(a,b,c){var e=new (a.classInstProto()),g=this.registerObject(e);e.initInstanceOf(a,b,g,c);this.hasNewInstances[a.oop]=!0;return e},clone:function(a){var b=new (a.sqClass.classInstProto()),c=this.registerObject(b);
b.initAsClone(a,c);this.hasNewInstances[b.sqClass.oop]=!0;return b}},"operations",{bulkBecome:function(a,b,c,e){if(!a)return!b;var g=a.length;if(g!==b.length)return!1;var h=null;0<this.newSpaceCount?h=this.partialGC("become"):this.vm.storeContextRegisters();for(var f={},d=0;d<g;d++){var n=a[d];if(!n.sqClass||f[n.oop])return!1;f[n.oop]=b[d]}if(c)for(d=0;d<g;d++){n=b[d];if(!n.sqClass||f[n.oop])return!1;f[n.oop]=a[d]}if(e)for(d=0;d<g;d++){if(!b[d].sqClass)return!1;n=a[d].hash;a[d].hash=b[d].hash;b[d].hash=
n}this.lastOldObject.nextObject=h;for(n=this.firstOldObject;n;){if(a=f[n.sqClass.oop])n.sqClass=a,0>a.oop&&(n.dirty=!0);if(b=n.pointers)for(g=0;g<b.length;g++)if(a=f[b[g].oop])b[g]=a,0>a.oop&&(n.dirty=!0);n=n.nextObject}this.lastOldObject.nextObject=null;this.vm.flushMethodCacheAfterBecome(f);return!0},objectAfter:function(a){return a.nextObject||this.nextObjectWithGC("nextObject",a)},someInstanceOf:function(a){for(var b=this.firstOldObject;b;){if(b.sqClass===a)return b;b=b.nextObject||this.nextObjectWithGCFor(b,
a)}return null},nextInstanceAfter:function(a){for(var b=a.sqClass;;){a=a.nextObject||this.nextObjectWithGCFor(a,b);if(!a)return null;if(a.sqClass===b)return a}},nextObjectWithGC:function(a,b){if(this.newSpaceCount<=(0<b.oop?0:this.youngSpaceCount))return null;0>b.oop&&this.fullGC(a);return this.partialGC(a)},nextObjectWithGCFor:function(a,b){return this.hasNewInstances[b.oop]?this.nextObjectWithGC("instance of "+b.className(),a):null},allInstancesOf:function(a){for(var b=this.firstOldObject,c=[];b;)b.sqClass===
a&&c.push(b),b=b.nextObject||this.nextObjectWithGCFor(b,a);return c},writeToBuffer:function(){var a=new DataView(new ArrayBuffer(64+this.oldSpaceBytes)),b=0,c=function(c){a.setUint32(b,c);b+=4};c(this.formatVersion());c(64);c(this.oldSpaceBytes);c(this.firstOldObject.addr());c(this.objectToOop(this.specialObjectsArray));c(this.lastHash);for(c(52429400);64>b;)c(0);c=this.firstOldObject;for(var e=0;c;)b=c.writeTo(a,b,this),c=c.nextObject,e++;if(b!==a.byteLength)throw Error("wrong image size");if(e!==
this.oldSpaceCount)throw Error("wrong object count");return a.buffer},objectToOop:function(a){if("number"===typeof a)return a<<1|1;if(0>a.oop)throw Error("temporary oop");return a.oop},bytesLeft:function(){return this.totalMemory-this.oldSpaceBytes},formatVersion:function(){return this.isSpur?6521:this.hasClosures?6504:6502},segmentVersion:function(){var a=new Uint32Array(this.specialObjectsArray.pointers[Squeak.splOb_SelectorDoesNotUnderstand].bytes.buffer,0,1);return this.formatVersion()|a[0]&4278190080},
loadImageSegment:function(a,b){var c=new DataView(a.words.buffer),e=!1,g=0,h=function(){var a=c.getUint32(g,e);g+=4;return a},f=function(a,b){if(5>b){for(b=[];b.length<a;)b.push(h());return b}b=new Uint32Array(c.buffer,g,a);g+=4*a;return b},d=h();if(d&1&&(e=!0,g=0,d=h(),d&1))return console.error("image segment format not supported"),null;this.tenureIfYoung(a);var n=a;d=n.nextObject;for(var k=a.oop,l={},w={};g<c.byteLength;){var t=0,p=0,m=h();switch(m&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:t=
m>>>2;p=h();m=h();break;case Squeak.HeaderTypeClass:p=m-Squeak.HeaderTypeClass;m=h();t=m>>>2&63;break;case Squeak.HeaderTypeShort:t=m>>>2&63;p=m>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block");}t--;var x=g,q=m>>>8&15;m=m>>>17&4095;var u=f(t,q);t=new Squeak.Object;t.initFromImage(x+k,p,q,m);n.nextObject=t;this.oldSpaceCount++;n=t;l[x]=t;w[x+k]=u}t.nextObject=d;for(f=0;f<b.pointers.length;f++)l[2147483652+4*f]=b.pointers[f];var A=0;b=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers.map(function(a){l[--A]=
a;return A});a.words=new Uint32Array([a.words[0]]);a=a.nextObject;f=this.specialObjectsArray.pointers[Squeak.splOb_ClassFloat];n=a;do n.installFromImage(l,w,b,f,e,!1),n=n.nextObject;while(n!==d);return a}},"spur support",{initSpurOverrides:function(){this.registerObject=this.registerObjectSpur;this.writeToBuffer=this.writeToBufferSpur},spurClassTable:function(a,b,c,e){for(var g={},h=this.firstOldObject,f=0;4096>f;f++){var d=a[c[f]];d.oop&&(d=b[d.oop]);if(1024===d.length)for(var n=0;1024>n;n++){var k=
a[d[n]];if(!k)throw Error("Invalid class table entry (oop "+d[n]+")");if(k!==h){var l=1024*f+n;g[l]=k}}}for(var w in Squeak)/^splOb_Class/.test(w)&&(c=a[b[e.oop][Squeak[w]]],c!==h&&(l=c.hash,0<l&&1024>l&&(g[l]=c)));g[3]=g[1];this.classTable=g;this.classTableIndex=1024;return g},enterIntoClassTable:function(a){for(var b=this.classTableIndex,c=this.classTable;4194303>=b;){if(!c[b])return c[b]=a,this.classTableIndex=a.hash=b;b++}console.error("class table full?");return null},initCharacterTable:function(a){a.classInstProto("Character");
this.characterClass=a;this.characterTable={}},getCharacter:function(a){var b=this.characterTable[a];b||(b=new this.characterClass.instProto,b.initInstanceOfChar(this.characterClass,a),this.characterTable[a]=b);return b},ensureClassesInTable:function(){for(var a=this.firstOldObject,b=1024;a;){var c=a.sqClass;0===c.hash&&this.enterIntoClassTable(c);c.hash>b&&(b=c.hash);if(this.classTable[c.hash]!==c)throw Error("Class not in class table");a=a.nextObject}return(b>>10)+1},classTableBytes:function(a){return 4*
(4108+1028*a)},writeFreeLists:function(a,b,c,e){a.setUint32(b,167772178,c);b+=4;a.setUint32(b,536870912,c);return b+4+128},writeClassTable:function(a,b,c,e,g){a.setUint32(b,4104,c);b+=4;a.setUint32(b,4278190080,c);b+=4;a.setUint32(b,33554448,c);b+=4;a.setUint32(b,4278190080,c);b+=4;for(var h=0;h<g;h++)a.setUint32(b,16624+4112*h,c),b+=4;b+=4*(4104-g);var f=0;for(h=0;h<g;h++){a.setUint32(b,1024,c);b+=4;a.setUint32(b,4278190080,c);b+=4;a.setUint32(b,33554448,c);b+=4;a.setUint32(b,4278190080,c);b+=4;
for(var d=0;1024>d;d++){var n=this.classTable[f];if(n&&n.pointers){if(!n.hash)throw Error("class without id");n.hash!==f&&32<=f&&(console.warn("freeing class index "+f+" "+n.className()),n=null)}n&&a.setUint32(b,e(n),c);b+=4;f++}}return b},writeToBufferSpur:function(){function a(a){g.setUint32(f,a,!0);f+=4}function b(a){if("number"===typeof a)return a<<1|1;if(7===a._format){if(a.hash!==a.oop>>2||2!==(a.oop&3))throw Error("Bad immediate char");return a.oop}if(0>a.oop)throw Error("temporary oop");return 48>
a.oop?a.oop:a.oop+e}var c=this.ensureClassesInTable(),e=136+this.classTableBytes(c),g=new DataView(new ArrayBuffer(64+e+this.oldSpaceBytes+16)),h=Date.now(),f=0;a(this.formatVersion());a(64);a(e+this.oldSpaceBytes+16);a(this.firstOldObject.addr());a(b(this.specialObjectsArray));a(this.lastHash);this.savedHeaderWords.forEach(a);for(a(e+this.oldSpaceBytes+16);64>f;)a(0);var d=this.firstOldObject,n=0;f=d.writeTo(g,f,!0,b);d=d.nextObject;n++;f=d.writeTo(g,f,!0,b);d=d.nextObject;n++;f=d.writeTo(g,f,!0,
b);d=d.nextObject;n++;f=this.writeFreeLists(g,f,!0,b);for(f=this.writeClassTable(g,f,!0,b,c);d;)f=d.writeTo(g,f,!0,b),d=d.nextObject,n++;a(1241513987);a(8388608);a(0);a(0);if(f!==g.byteLength)throw Error("wrong image size");if(n!==this.oldSpaceCount)throw Error("wrong object count");c=Date.now()-h;console.log("Wrote "+n+" objects in "+c+" ms, image size "+f+" bytes");return g.buffer}});Object.subclass("Squeak.Object","initialization",{initInstanceOf:function(a,b,c,e){this.sqClass=a;this.hash=c;c=
a.pointers[Squeak.Class_format];var g=(c>>1&63)+(c>>10&192)-1;this._format=c>>7&15;8>this._format?6!=this._format?0<g+b&&(this.pointers=this.fillArray(g+b,e)):0<b&&(a.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(b)):0<b&&(this.bytes=new Uint8Array(b))},initAsClone:function(a,b){this.sqClass=a.sqClass;this.hash=b;this._format=a._format;a.isFloat?(this.isFloat=a.isFloat,this.float=a.float):(a.pointers&&(this.pointers=a.pointers.slice(0)),a.words&&(this.words=new Uint32Array(a.words)),
a.bytes&&(this.bytes=new Uint8Array(a.bytes)))},initFromImage:function(a,b,c,e){this.oop=a;this.sqClass=b;this._format=c;this.hash=e},classNameFromImage:function(a,b){return(a=a[b[this.oop][Squeak.Class_name]])&&8<=a._format&&12>a._format?(b=b[a.oop],b=a.decodeBytes(b.length,b,0,a._format&3),Squeak.bytesAsString(b)):"Class"},renameFromImage:function(a,b,c){c=32>this.sqClass?a[c[this.sqClass-1]]:a[this.sqClass];if(!c)return this;a=c.instProto||c.classInstProto(c.classNameFromImage(a,b));if(!a)return this;
a=new a;a.oop=this.oop;a.sqClass=this.sqClass;a._format=this._format;a.hash=this.hash;return a},installFromImage:function(a,b,c,e,g,h){var f=this.sqClass;this.sqClass=0<f&&32>f?a[c[f-1]]:a[f];b=b[this.oop];c=b.length;if(5>this._format)0<c&&(this.pointers=this.decodePointers(c,b,a));else if(12<=this._format)e=this.decodeWords(1,b,g)[0]>>10&255,g=this.decodeWords(e+1,b,g),this.pointers=this.decodePointers(e+1,g,a),this.bytes=this.decodeBytes(c-(e+1),b,e+1,this._format&3);else if(8<=this._format)0<c&&
(this.bytes=this.decodeBytes(c,b,0,this._format&3));else if(this.sqClass==e){if(this.isFloat=!0,this.float=this.decodeFloat(b,g,h),1.3797216632888E-310==this.float&&!/noFloatDecodeWorkaround/.test(window.location.hash)&&(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this.float=this.decodeFloat(b,g,h),1.3797216632888E-310==this.float))throw Error("Cannot deoptimize decodeFloat");}else 0<c&&(this.words=this.decodeWords(c,b,g));this.mark=!1},decodePointers:function(a,b,c){for(var e=
Array(a),g=0;g<a;g++){var h=b[g];e[g]=1===(h&1)?h>>1:c[h]||42424242}return e},decodeWords:function(a,b,c){b=new DataView(b.buffer,b.byteOffset);for(var e=new Uint32Array(a),g=0;g<a;g++)e[g]=b.getUint32(4*g,c);return e},decodeBytes:function(a,b,c,e){a=4*a-e;b=new Uint8Array(b.buffer,b.byteOffset+4*c,a);c=new Uint8Array(a);c.set(b);return c},decodeFloat:function(a,b,c){a=new DataView(a.buffer,a.byteOffset);if(!b)return a.getFloat64(0,!1);if(c)return a.getFloat64(0,!0);b=new ArrayBuffer(8);b=new DataView(b);
b.setUint32(0,a.getUint32(4));b.setUint32(4,a.getUint32(0));return b.getFloat64(0,!0)},decodeFloatDeoptimized:function(a,b,c){a=new DataView(a.buffer,a.byteOffset);if(!b)return a.getFloat64(0,!1);if(c)return a.getFloat64(0,!0);b=new ArrayBuffer(8);b=new DataView(b);b.setUint32(0,a.getUint32(4));b.setUint32(4,a.getUint32(0));return b.getFloat64(0,!0)},fillArray:function(a,b){for(var c=[],e=0;e<a;e++)c[e]=b;return c}},"testing",{isWords:function(){return 6===this._format},isBytes:function(){var a=this._format;
return 8<=a&&11>=a},isWordsOrBytes:function(){var a=this._format;return 6==a||8<=a&&11>=a},isPointers:function(){return 4>=this._format},isWeak:function(){return 4===this._format},isMethod:function(){return 12<=this._format},sameFormats:function(a,b){return 8>a?a===b:(a&12)===(b&12)},sameFormatAs:function(a){return this.sameFormats(this._format,a._format)}},"printing",{toString:function(){return this.sqInstName()},bytesAsString:function(){return this.bytes?Squeak.bytesAsString(this.bytes):""},bytesAsNumberString:function(a){if(!this.bytes)return"";
for(var b=[],c=0,e=this.bytes.length-1;0<=e;e--)b.push("0123456789ABCDEF"[this.bytes[e]>>4]),b.push("0123456789ABCDEF"[this.bytes[e]&15]),c=256*c+this.bytes[e];a=a?"-":"";e=9007199254740991<c?"\u2248":"";return a+"16r"+b.join("")+" ("+e+a+c+"L)"},assnKeyAsString:function(){return this.pointers[Squeak.Assn_key].bytesAsString()},slotNameAt:function(a){var b=this.instSize();return a<=b?this.sqClass.allInstVarNames()[a-1]||"ivar"+(a-1):(a-b).toString()},sqInstName:function(){if(this.isNil)return"nil";
if(this.isTrue)return"true";if(this.isFalse)return"false";if(this.isFloat){var a=this.float.toString();/\./.test(a)||(a+=".0");return a}a=this.sqClass.className();if(/ /.test(a))return"the "+a;switch(a){case "String":case "ByteString":return"'"+this.bytesAsString()+"'";case "Symbol":case "ByteSymbol":return"#"+this.bytesAsString();case "Point":return this.pointers.join("@");case "Rectangle":return this.pointers.join(" corner: ");case "Association":case "ReadOnlyVariableBinding":return this.pointers.join("->");
case "LargePositiveInteger":return this.bytesAsNumberString(!1);case "LargeNegativeInteger":return this.bytesAsNumberString(!0);case "Character":return a=this.pointers?this.pointers[0]:this.hash,"$"+String.fromCharCode(a)+" ("+a.toString()+")"}return/^[aeiou]/i.test(a)?"an"+a:"a"+a}},"accessing",{pointersSize:function(){return this.pointers?this.pointers.length:0},bytesSize:function(){return this.bytes?this.bytes.length:0},wordsSize:function(){return this.isFloat?2:this.words?this.words.length:0},
instSize:function(){var a=this._format;return 4<a||2===a?0:2>a?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(a){var b=this._format;return 2>b?-1:3===b&&a.vm.isContext(this)&&!a.allowAccessBeyondSP?this.pointers[Squeak.Context_stackPointer]:6>b?this.pointersSize()-this.instSize():8>b?this.wordsSize():12>b?this.bytesSize():this.bytesSize()+4*this.pointersSize()},floatData:function(){var a=new ArrayBuffer(8);a=new DataView(a);a.setFloat64(0,this.float,!1);return a},wordsAsFloat32Array:function(){return this.float32Array||
this.words&&(this.float32Array=new Float32Array(this.words.buffer))},wordsAsFloat64Array:function(){return this.float64Array||this.words&&(this.float64Array=new Float64Array(this.words.buffer))},wordsAsInt32Array:function(){return this.int32Array||this.words&&(this.int32Array=new Int32Array(this.words.buffer))},wordsAsInt16Array:function(){return this.int16Array||this.words&&(this.int16Array=new Int16Array(this.words.buffer))},wordsAsUint16Array:function(){return this.uint16Array||this.words&&(this.uint16Array=
new Uint16Array(this.words.buffer))},wordsAsUint8Array:function(){return this.uint8Array||this.words&&(this.uint8Array=new Uint8Array(this.words.buffer))},wordsOrBytes:function(){return this.words?this.words:this.uint32Array?this.uint32Array:this.bytes?this.uint32Array=new Uint32Array(this.bytes.buffer,0,this.bytes.length>>>2):null},setAddr:function(a){var b=this.snapshotSize();this.oop=a+4*b.header;return a+4*(b.header+b.body)},snapshotSize:function(){var a=this.isFloat?2:this.words?this.words.length:
this.pointers?this.pointers.length:0;this.bytes&&(a+=this.bytes.length+3>>>2);a++;return{header:63<a?2:this.sqClass.isCompact?0:1,body:a}},addr:function(){return this.oop-4*this.snapshotSize().header},totalBytes:function(){var a=this.snapshotSize();return 4*(a.header+a.body)},writeTo:function(a,b,c){this.bytes&&(this._format|=-this.bytes.length&3);var e=b,g=this.snapshotSize(),h=(this._format&15)<<8|(this.hash&4095)<<17;switch(g.header){case 2:a.setUint32(b,g.body<<2|Squeak.HeaderTypeSizeAndClass);
b+=4;a.setUint32(b,this.sqClass.oop|Squeak.HeaderTypeSizeAndClass);b+=4;a.setUint32(b,h|Squeak.HeaderTypeSizeAndClass);b+=4;break;case 1:a.setUint32(b,this.sqClass.oop|Squeak.HeaderTypeClass);b+=4;a.setUint32(b,h|g.body<<2|Squeak.HeaderTypeClass);b+=4;break;case 0:var f=c.compactClasses.indexOf(this.sqClass)+1;a.setUint32(b,h|f<<12|g.body<<2|Squeak.HeaderTypeShort);b+=4}if(this.isFloat)a.setFloat64(b,this.float),b+=8;else if(this.words)for(g=0;g<this.words.length;g++)a.setUint32(b,this.words[g]),
b+=4;else if(this.pointers)for(g=0;g<this.pointers.length;g++)a.setUint32(b,c.objectToOop(this.pointers[g])),b+=4;if(this.bytes){for(g=0;g<this.bytes.length;g++)a.setUint8(b++,this.bytes[g]);b+=-this.bytes.length&3}if(b!==e+this.totalBytes())throw Error("written size does not match");return b}},"as class",{classInstFormat:function(){return this.pointers[Squeak.Class_format]>>7&15},classInstSize:function(){var a=this.pointers[Squeak.Class_format];return(a>>10&192)+(a>>1&63)-1},instVarNames:function(){for(var a=
3;4>=a;a++){var b=this.pointers[a].pointers;if(b&&b.length&&b[0].bytes)return b.map(function(a){return a.bytesAsString()})}return[]},allInstVarNames:function(){var a=this.superclass();return a.isNil?this.instVarNames():a.allInstVarNames().concat(this.instVarNames())},superclass:function(){return this.pointers[0]},className:function(){if(!this.pointers)return"_NOTACLASS_";for(var a=6;7>=a;a++){var b=this.pointers[a];if(b&&b.bytes)return b.bytesAsString()}for(var c=5;6>=c;c++){var e=this.pointers[c];
if(e&&e.pointers)for(a=6;7>=a;a++)if((b=e.pointers[a])&&b.bytes)return b.bytesAsString()+" class"}return"_SOMECLASS_"},defaultInst:function(){return Squeak.Object},classInstProto:function(a){if(this.instProto)return this.instProto;var b=this.defaultInst();try{a||(a=this.className());var c=a.replace(/[^A-Za-z0-9]/g,"_");c="UndefinedObject"===c?"nil":"True"===c?"true_":"False"===c?"false_":(/^[AEIOU]/.test(c)?"an":"a")+c;b=(new Function("return function "+c+"() {};"))();b.prototype=this.defaultInst().prototype}catch(e){}Object.defineProperty(this,
"instProto",{value:b});return b}},"as method",{methodNumLits:function(){return this.pointers[0]>>9&255},methodNumArgs:function(){return this.pointers[0]>>24&15},methodPrimitiveIndex:function(){var a=this.pointers[0]&805306879;return 511<a?(a&511)+(a>>19):a},methodClassForSuper:function(){return this.pointers[this.methodNumLits()].pointers[Squeak.Assn_value]},methodNeedsLargeFrame:function(){return 0<(this.pointers[0]&131072)},methodAddPointers:function(a){this.pointers=a},methodTempCount:function(){return this.pointers[0]>>
18&63},methodGetLiteral:function(a){return this.pointers[1+a]},methodGetSelector:function(a){return this.pointers[1+a]}},"as context",{contextHome:function(){return this.contextIsBlock()?this.pointers[Squeak.BlockContext_home]:this},contextIsBlock:function(){return"number"===typeof this.pointers[Squeak.BlockContext_argumentCount]},contextMethod:function(){return this.contextHome().pointers[Squeak.Context_method]},contextSender:function(){return this.pointers[Squeak.Context_sender]},contextSizeWithStack:function(a){if(a&&
a.activeContext===this)return a.sp+1;a=this.pointers[Squeak.Context_stackPointer];return Squeak.Context_tempFrameStart+("number"===typeof a?a:0)}});Squeak.Object.subclass("Squeak.ObjectSpur","initialization",{initInstanceOf:function(a,b,c,e){this.sqClass=a;this.hash=c;var g=a.pointers[Squeak.Class_format];c=g&65535;this._format=g=g>>16&31;12>g?10>g?0<c+b&&(this.pointers=this.fillArray(c+b,e)):0<b&&(a.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(b)):0<b&&(this.bytes=new Uint8Array(b))},
installFromImage:function(a,b,c,e,g,h){var f=this.sqClass;if(32>f)throw Error("Invalid class ID: "+f);this.sqClass=c[f];if(!this.sqClass)throw Error("Class ID not in class table: "+f);b=b[this.oop];c=b.length;switch(this._format){case 0:case 1:case 2:case 3:case 4:case 5:0<c&&(this.pointers=this.decodePointers(c,b,a,h));break;case 10:if(this.sqClass===e){if(this.isFloat=!0,this.float=this.decodeFloat(b,g,!0),1.3797216632888E-310==this.float&&!/noFloatDecodeWorkaround/.test(window.location.hash)&&
(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this.float=this.decodeFloat(b,g,!0),1.3797216632888E-310==this.float))throw Error("Cannot deoptimize decodeFloat");}else 0<c&&(this.words=this.decodeWords(c,b,g));break;case 12:case 13:throw Error("16 bit arrays not supported yet");case 16:case 17:case 18:case 19:0<c&&(this.bytes=this.decodeBytes(c,b,0,this._format&3));break;case 24:case 25:case 26:case 27:e=this.decodeWords(1,b,g)[0];if(e&2147483648)throw Error("Alternate bytecode set not supported");
e=e>>1&32767;g=this.decodeWords(e+1,b,g);this.pointers=this.decodePointers(e+1,g,a,h);this.bytes=this.decodeBytes(c-(e+1),b,e+1,this._format&3);break;default:throw Error("Unknown object format: "+this._format);}this.mark=!1},decodePointers:function(a,b,c,e){for(var g=Array(a),h=0;h<a;h++){var f=b[h];g[h]=1===(f&1)?f>>1:2===(f&3)?e(f>>>2):c[f]||42424242}return g},initInstanceOfChar:function(a,b){this.oop=b<<2|2;this.sqClass=a;this.hash=b;this._format=7;this.mark=!0},classNameFromImage:function(a,b){return(a=
a[b[this.oop][Squeak.Class_name]])&&16<=a._format&&24>a._format?(b=b[a.oop],b=a.decodeBytes(b.length,b,0,a._format&7),Squeak.bytesAsString(b)):"Class"},renameFromImage:function(a,b,c){c=c[this.sqClass];if(!c)return this;a=c.instProto||c.classInstProto(c.classNameFromImage(a,b));if(!a)return this;a=new a;a.oop=this.oop;a.sqClass=this.sqClass;a._format=this._format;a.hash=this.hash;return a}},"accessing",{instSize:function(){return 2>this._format?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(a){var b=
this._format;return 2>b?-1:3===b&&a.vm.isContext(this)?this.pointers[Squeak.Context_stackPointer]:6>b?this.pointersSize()-this.instSize():12>b?this.wordsSize():16>b?this.shortsSize():24>b?this.bytesSize():4*this.pointersSize()+this.bytesSize()},snapshotSize:function(){var a=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(a+=this.bytes.length+3>>>2);var b=255<=a?2:0;a=a+(a&1)+2;4>a&&(a=4);return{header:b,body:a}},writeTo:function(a,b,c,e){var g=this.isFloat?
2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(g+=this.bytes.length+3>>>2,this._format|=-this.bytes.length&3);var h=b,f=this._format<<24|this.sqClass.hash&4194303,d=g<<24|this.hash&4194303;255<=g&&(a.setUint32(b,g,c),b+=4,d=-16777216|this.hash&4194303,a.setUint32(b,d,c),b+=4);a.setUint32(b,f,c);b+=4;a.setUint32(b,d,c);b+=4;if(this.isFloat)a.setFloat64(b,this.float,c),b+=8;else if(this.words)for(f=0;f<this.words.length;f++)a.setUint32(b,this.words[f],c),b+=4;else if(this.pointers)for(f=
0;f<this.pointers.length;f++)a.setUint32(b,e(this.pointers[f]),c),b+=4;if(this.bytes){for(f=0;f<this.bytes.length;f++)a.setUint8(b++,this.bytes[f]);b+=-this.bytes.length&3}b=0===g?b+8:b+4*(g&1);if(b!==h+this.totalBytes())throw Error("written size does not match");return b}},"testing",{isBytes:function(){var a=this._format;return 16<=a&&23>=a},isPointers:function(){return 6>=this._format},isWords:function(){return 10===this._format},isWordsOrBytes:function(){var a=this._format;return 10===a||16<=a&&
23>=a},isWeak:function(){return 4===this._format},isMethod:function(){return 24<=this._format},sameFormats:function(a,b){return 16>a?a===b:(a&248)===(b&248)}},"as class",{defaultInst:function(){return Squeak.ObjectSpur},classInstFormat:function(){return this.pointers[Squeak.Class_format]>>16&31},classInstSize:function(){return this.pointers[Squeak.Class_format]&65535},classByteSizeOfInstance:function(a){var b=this.classInstFormat(),c=this.classInstSize();c=9>b?c+a:16<=b?c+((a+3)/4|0):12<=b?c+((a+
1)/2|0):10<=b?c+a:c+2*a;c+=c&1;c+=255<=c?4:2;4>c&&(c=4);return 4*c}},"as method",{methodNumLits:function(){return this.pointers[0]&32767},methodPrimitiveIndex:function(){return 0===(this.pointers[0]&65536)?0:this.bytes[1]+256*this.bytes[2]}});Object.subclass("Squeak.Interpreter","initialization",{initialize:function(a,b){console.log("squeak: initializing interpreter "+Squeak.vmVersion);this.Squeak=Squeak;this.image=a;this.image.vm=this;this.primHandler=new Squeak.Primitives(this,b);this.loadImageState();
this.hackImage();this.initVMState();this.loadInitialContext();this.initCompiler();console.log("squeak: ready")},loadImageState:function(){this.specialObjects=this.image.specialObjectsArray.pointers;this.specialSelectors=this.specialObjects[Squeak.splOb_SpecialSelectors].pointers;this.nilObj=this.specialObjects[Squeak.splOb_NilObject];this.falseObj=this.specialObjects[Squeak.splOb_FalseObject];this.trueObj=this.specialObjects[Squeak.splOb_TrueObject];this.hasClosures=this.image.hasClosures;this.globals=
this.findGlobals();this.hasClosures||this.findMethod("UnixFileDirectory class>>pathNameDelimiter")||(this.primHandler.emulateMac=!0);6501==this.image.version&&(this.primHandler.reverseDisplay=!0)},initVMState:function(){this.interruptCheckCounter=this.sendCount=this.byteCodeCount=0;this.interruptCheckCounterFeedBackReset=1E3;this.interruptChecksEveryNms=3;this.lastTick=this.nextWakeupTick=this.nextPollTick=0;this.interruptKeycode=2094;this.interruptPending=!1;this.pendingFinalizationSignals=0;this.freeLargeContexts=
this.freeContexts=this.nilObj;this.nAllocatedContexts=this.nRecycledContexts=this.reclaimableContextCount=0;this.methodCacheSize=1024;this.methodCacheMask=this.methodCacheSize-1;this.methodCacheRandomish=0;this.methodCache=[];for(var a=0;a<this.methodCacheSize;a++)this.methodCache[a]={lkupClass:null,selector:null,method:null,primIndex:0,argCount:0,mClass:null};this.breakOutOfInterpreter=!1;this.breakOutTick=0;this.breakOnMethod=null;this.breakOnContextChanged=this.breakOnNewMethod=!1;this.breakOnContextReturned=
null;this.messages={};this.startupTime=Date.now()},loadInitialContext:function(){this.activeContext=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value].pointers[Squeak.ProcSched_activeProcess].pointers[Squeak.Proc_suspendedContext];this.activeContext.dirty=!0;this.fetchContextRegisters(this.activeContext);this.reclaimableContextCount=0},findGlobals:function(){var a=this.specialObjects[Squeak.splOb_SmalltalkDictionary],b=a.sqClass.className();"Association"===b&&(a=a.pointers[1],
b=a.sqClass.className());if("SystemDictionary"===b)return a.pointers[1].pointers;if("SmalltalkImage"===b){a=a.pointers[0];b=a.sqClass.className();if("SystemDictionary"===b)return a.pointers[1].pointers;if("Environment"===b)return a.pointers[2].pointers[1].pointers}console.warn("cannot find global dict");return[]},initCompiler:function(){if(!Squeak.Compiler)return console.warn("Squeak.Compiler not loaded, using interpreter only");try{if(42!==(new Function("return 42"))())return console.warn("function constructor not working, disabling JIT")}catch(b){return console.warn("disabling JIT: "+
b)}var a=this.image.oldSpaceCount/(this.startupTime-this.image.startupTime);if(10>a)return console.warn("Slow machine detected (loaded "+(1E3*a|0)+" objects/sec), using interpreter only");try{console.log("squeak: initializing JIT compiler"),this.compiler=new Squeak.Compiler(this)}catch(b){console.warn("Compiler "+b)}},hackImage:function(){[].forEach(function(a){var b=this.findMethod(a.method);b&&(b.pointers[0]|=a.primitive,console.warn("Hacking "+a.method))},this);this.findMethod("PharoClassInstaller>>initialize")&&
(Squeak.platformName="unix")}},"interpreting",{interpretOne:function(a){if(this.method.compiled){if(a){if(!this.compiler.enableSingleStepping(this.method))return this.method.compiled=null,this.interpretOne(a);this.breakNow()}this.method.compiled(this)}else{a=this.Squeak;this.byteCodeCount++;var b=this.nextByte();if(128>b)switch(b){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:this.push(this.receiver.pointers[b&15]);return;case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:this.push(this.homeContext.pointers[a.Context_tempFrameStart+
(b&15)]);return;case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:this.push(this.method.methodGetLiteral(b&31));return;case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:this.push(this.method.methodGetLiteral(b&
31).pointers[a.Assn_value]);return;case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:this.receiver.dirty=!0;this.receiver.pointers[b&7]=this.pop();return;case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:this.homeContext.pointers[a.Context_tempFrameStart+(b&7)]=this.pop();return;case 112:this.push(this.receiver);return;case 113:this.push(this.trueObj);return;case 114:this.push(this.falseObj);return;case 115:this.push(this.nilObj);return;case 116:this.push(-1);
return;case 117:this.push(0);return;case 118:this.push(1);return;case 119:this.push(2);return;case 120:this.doReturn(this.receiver);return;case 121:this.doReturn(this.trueObj);return;case 122:this.doReturn(this.falseObj);return;case 123:this.doReturn(this.nilObj);return;case 124:this.doReturn(this.pop());return;case 125:this.doReturn(this.pop(),this.activeContext.pointers[a.BlockContext_caller]);return;case 126:this.nono();return;case 127:this.nono();return}else switch(b){case 128:this.extendedPush(this.nextByte());
return;case 129:this.extendedStore(this.nextByte());return;case 130:this.extendedStorePop(this.nextByte());return;case 131:var c=this.nextByte();this.send(this.method.methodGetSelector(c&31),c>>5,!1);return;case 132:this.doubleExtendedDoAnything(this.nextByte());return;case 133:c=this.nextByte();this.send(this.method.methodGetSelector(c&31),c>>5,!0);return;case 134:c=this.nextByte();this.send(this.method.methodGetSelector(c&63),c>>6,!1);return;case 135:this.pop();return;case 136:this.push(this.top());
return;case 137:this.push(this.exportThisContext());return;case 138:this.pushNewArray(this.nextByte());return;case 139:this.callPrimBytecode();return;case 140:c=this.nextByte();this.push(this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[c]);return;case 141:c=this.nextByte();this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[c]=this.top();return;case 142:c=this.nextByte();this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[c]=
this.pop();return;case 143:this.pushClosureCopy();return;case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:this.pc+=(b&7)+1;return;case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:this.jumpIfFalse((b&7)+1);return;case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:c=this.nextByte();this.pc+=256*((b&7)-4)+c;4>(b&7)&&0>=this.interruptCheckCounter--&&this.checkForInterrupts();return;case 168:case 169:case 170:case 171:this.jumpIfTrue(256*
(b&3)+this.nextByte());return;case 172:case 173:case 174:case 175:this.jumpIfFalse(256*(b&3)+this.nextByte());return;case 176:this.success=!0;this.resultIsFloat=!1;this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 177:this.success=!0;this.resultIsFloat=!1;this.pop2AndPushNumResult(this.stackIntOrFloat(1)-this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 178:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||
this.sendSpecial(b&15);return;case 179:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 180:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 181:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 182:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===
this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 183:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 184:this.success=!0;this.resultIsFloat=!1;this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 185:this.success=!0;this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 186:this.success=
!0;this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 187:this.success=!0;this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(b&15);return;case 188:this.success=!0;this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 189:this.success=!0;this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 190:this.success=
!0;this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(b&15);return;case 191:this.success=!0;this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(b&15);return;case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:this.primHandler.quickSendOther(this.receiver,b&15)||this.sendSpecial((b&15)+16);return;case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:this.send(this.method.methodGetSelector(b&
15),0,!1);return;case 224:case 225:case 226:case 227:case 228:case 229:case 230:case 231:case 232:case 233:case 234:case 235:case 236:case 237:case 238:case 239:this.send(this.method.methodGetSelector(b&15),1,!1);return;case 240:case 241:case 242:case 243:case 244:case 245:case 246:case 247:case 248:case 249:case 250:case 251:case 252:case 253:case 254:case 255:this.send(this.method.methodGetSelector(b&15),2,!1);return}throw Error("not a bytecode: "+b);}},interpret:function(a,b){if(this.frozen)return"frozen";
this.breakOutOfInterpreter=this.isIdle=!1;for(this.breakOutTick=this.primHandler.millisecondClockValue()+(a||500);!1===this.breakOutOfInterpreter;)this.method.compiled?this.method.compiled(this):this.interpretOne();if("function"==typeof this.breakOutOfInterpreter)return this.breakOutOfInterpreter(b);a="break"==this.breakOutOfInterpreter?"break":this.isIdle?this.nextWakeupTick?Math.max(1,this.nextWakeupTick-this.primHandler.millisecondClockValue()):"sleep":0;b&&b(a);return a},goIdle:function(){var a=
0!==this.nextWakeupTick;this.forceInterruptCheck();this.checkForInterrupts();this.isIdle=0!==this.nextWakeupTick||!a;this.breakOut()},freeze:function(a){var b;this.frozen=!0;this.breakOutOfInterpreter=function(a){if(!a)throw Error("need function to restart interpreter");b=a;return"frozen"}.bind(this);var c=function(){this.frozen=!1;if(!b)throw Error("no continue function");b(0)}.bind(this);a&&window.setTimeout(function(){a(c)},0);return c},breakOut:function(){this.breakOutOfInterpreter=this.breakOutOfInterpreter||
!0},nextByte:function(){return this.method.bytes[this.pc++]},nono:function(){throw Error("Oh No!");},forceInterruptCheck:function(){this.interruptCheckCounter=-1E3},checkForInterrupts:function(){var a=this.primHandler.millisecondClockValue();a<this.lastTick&&(this.nextPollTick=a+(this.nextPollTick-this.lastTick),this.breakOutTick=a+(this.breakOutTick-this.lastTick),0!==this.nextWakeupTick&&(this.nextWakeupTick=a+(this.nextWakeupTick-this.lastTick)));-100<this.interruptCheckCounter&&(this.interruptCheckCounterFeedBackReset=
a-this.lastTick<this.interruptChecksEveryNms?this.interruptCheckCounterFeedBackReset+10:1E3>=this.interruptCheckCounterFeedBackReset?1E3:this.interruptCheckCounterFeedBackReset-12);this.interruptCheckCounter=this.interruptCheckCounterFeedBackReset;this.lastTick=a;if(this.interruptPending){this.interruptPending=!1;var b=this.specialObjects[Squeak.splOb_TheInterruptSemaphore];b.isNil||this.primHandler.synchronousSignal(b)}0!==this.nextWakeupTick&&a>=this.nextWakeupTick&&(this.nextWakeupTick=0,b=this.specialObjects[Squeak.splOb_TheTimerSemaphore],
b.isNil||this.primHandler.synchronousSignal(b));0<this.pendingFinalizationSignals&&(b=this.specialObjects[Squeak.splOb_TheFinalizationSemaphore],this.pendingFinalizationSignals=0,b.isNil||this.primHandler.synchronousSignal(b));0<this.primHandler.semaphoresToSignal.length&&this.primHandler.signalExternalSemaphores();!this.method.compiled&&this.compiler&&this.compiler.compile(this.method);a>=this.breakOutTick&&this.breakOut()},extendedPush:function(a){var b=a&63;switch(a>>6){case 0:this.push(this.receiver.pointers[b]);
break;case 1:this.push(this.homeContext.pointers[Squeak.Context_tempFrameStart+b]);break;case 2:this.push(this.method.methodGetLiteral(b));break;case 3:this.push(this.method.methodGetLiteral(b).pointers[Squeak.Assn_value])}},extendedStore:function(a){var b=a&63;switch(a>>6){case 0:this.receiver.dirty=!0;this.receiver.pointers[b]=this.top();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+b]=this.top();break;case 2:this.nono();break;case 3:a=this.method.methodGetLiteral(b),a.dirty=
!0,a.pointers[Squeak.Assn_value]=this.top()}},extendedStorePop:function(a){var b=a&63;switch(a>>6){case 0:this.receiver.dirty=!0;this.receiver.pointers[b]=this.pop();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+b]=this.pop();break;case 2:this.nono();break;case 3:a=this.method.methodGetLiteral(b),a.dirty=!0,a.pointers[Squeak.Assn_value]=this.pop()}},doubleExtendedDoAnything:function(a){var b=this.nextByte();switch(a>>5){case 0:this.send(this.method.methodGetSelector(b),a&31,
!1);break;case 1:this.send(this.method.methodGetSelector(b),a&31,!0);break;case 2:this.push(this.receiver.pointers[b]);break;case 3:this.push(this.method.methodGetLiteral(b));break;case 4:this.push(this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]);break;case 5:this.receiver.dirty=!0;this.receiver.pointers[b]=this.top();break;case 6:this.receiver.dirty=!0;this.receiver.pointers[b]=this.pop();break;case 7:a=this.method.methodGetLiteral(b),a.dirty=!0,a.pointers[Squeak.Assn_value]=this.top()}},
jumpIfTrue:function(a){var b=this.pop();b.isTrue?this.pc+=a:b.isFalse||(this.push(b),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},jumpIfFalse:function(a){var b=this.pop();b.isFalse?this.pc+=a:b.isTrue||(this.push(b),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},sendSpecial:function(a){this.send(this.specialSelectors[2*a],this.specialSelectors[2*a+1],!1)},callPrimBytecode:function(){this.pc+=2;this.primFailCode&&(129===this.method.bytes[this.pc]&&
this.stackTopPut(this.getErrorObjectFromPrimFailCode()),this.primFailCode=0)},getErrorObjectFromPrimFailCode:function(){var a=this.specialObjects[Squeak.splOb_PrimErrTableIndex];return a&&a.pointers&&(a=a.pointers[this.primFailCode-1])?a:this.primFailCode}},"closures",{pushNewArray:function(a){var b=127<a;a&=127;var c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],a);if(b){for(b=0;b<a;b++)c.pointers[b]=this.stackValue(a-b-1);this.popN(a)}this.push(c)},pushClosureCopy:function(){var a=
this.nextByte(),b=a&15;a>>=4;var c=256*this.nextByte()+this.nextByte(),e=this.encodeSqueakPC(this.pc,this.method);b=this.newClosure(b,e,a);b.pointers[Squeak.Closure_outerContext]=this.activeContext;this.reclaimableContextCount=0;if(0<a){for(e=0;e<a;e++)b.pointers[Squeak.Closure_firstCopiedValue+e]=this.stackValue(a-e-1);this.popN(a)}this.pc+=c;this.push(b)},newClosure:function(a,b,c){c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassBlockClosure],c);c.pointers[Squeak.Closure_startpc]=
b;c.pointers[Squeak.Closure_numArgs]=a;return c}},"sending",{send:function(a,b,c){var e=this.stackValue(b),g=this.getClass(e);c&&(g=this.method.methodClassForSuper(),g=g.pointers[Squeak.Class_superclass]);b=this.findSelectorInClass(a,b,g);b.primIndex&&(this.verifyAtSelector=a,this.verifyAtClass=g);this.executeNewMethod(e,b.method,b.argCount,b.primIndex,b.mClass,a)},sendAsPrimitiveFailure:function(a,b,c){this.executeNewMethod(a,b,c,0)},findSelectorInClass:function(a,b,c){var e=this.findMethodCacheEntry(a,
c);if(e.method)return e;for(var g=c,h;!g.isNil;){h=g.pointers[Squeak.Class_mdict];if(h.isNil)return e=this.specialObjects[Squeak.splOb_SelectorCannotInterpret],c=this.createActualMessage(a,b,c),this.popNandPush(b,c),this.findSelectorInClass(e,1,g.superclass());h=this.lookupSelectorInDict(h,a);if(!h.isNil)return this.currentSelector=a,this.currentLookupClass=c,e.method=h,e.primIndex=h.isMethod()?h.methodPrimitiveIndex():248,e.argCount=b,e.mClass=g,e;g=g.superclass()}g=this.specialObjects[Squeak.splOb_SelectorDoesNotUnderstand];
if(a===g)throw Error("Recursive not understood error encountered");a=this.createActualMessage(a,b,c);this.popNandPush(b,a);return this.findSelectorInClass(g,1,c)},lookupSelectorInDict:function(a,b){for(var c=a.pointersSize(),e=(c-Squeak.MethodDict_selectorStart-1&b.hash)+Squeak.MethodDict_selectorStart,g=!1;;){var h=a.pointers[e];if(h===b)return a.pointers[Squeak.MethodDict_array].pointers[e-Squeak.MethodDict_selectorStart];if(h.isNil)return this.nilObj;if(++e===c){if(g)return this.nilObj;e=Squeak.MethodDict_selectorStart;
g=!0}}},executeNewMethod:function(a,b,c,e,g,h){this.sendCount++;b===this.breakOnMethod&&this.breakNow("executing method "+this.printMethod(b,g,h));this.logSends&&console.log(this.sendCount+" "+this.printMethod(b,g,h));this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow());if(!(0<e&&this.tryPrimitive(e,c,b))){e=this.allocateOrRecycleContext(b.methodNeedsLargeFrame());var f=b.methodTempCount(),d=Squeak.Context_tempFrameStart+f-1;e.pointers[Squeak.Context_method]=b;e.pointers[Squeak.BlockContext_initialIP]=
this.nilObj;e.pointers[Squeak.Context_sender]=this.activeContext;this.arrayCopy(this.activeContext.pointers,this.sp-c,e.pointers,Squeak.Context_tempFrameStart-1,c+1);this.arrayFill(e.pointers,Squeak.Context_tempFrameStart+c,Squeak.Context_tempFrameStart+f,this.nilObj);this.popN(c+1);this.reclaimableContextCount++;this.storeContextRegisters();this.activeContext=e;this.activeContext.dirty=!0;this.homeContext=e;this.method=b;this.pc=0;this.sp=d;this.receiver=e.pointers[Squeak.Context_receiver];if(this.receiver!==
a)throw Error("receivers don't match");!b.compiled&&this.compiler&&this.compiler.compile(b,g,h);0>=this.interruptCheckCounter--&&this.checkForInterrupts()}},doReturn:function(a,b){if(!b){b=this.homeContext;if(this.hasClosures)for(var c;!(c=b.pointers[Squeak.Context_closure]).isNil;)b=c.pointers[Squeak.Closure_outerContext];b=b.pointers[Squeak.Context_sender]}if(b.isNil||b.pointers[Squeak.Context_instructionPointer].isNil)return this.cannotReturn(a);for(c=this.activeContext.pointers[Squeak.Context_sender];c!==
b;){if(c.isNil)return this.cannotReturn(a);if(this.isUnwindMarked(c))return this.aboutToReturnThrough(a,c);c=c.pointers[Squeak.Context_sender]}for(c=this.activeContext;c!==b;){this.breakOnContextReturned===c&&(this.breakOnContextReturned=null,this.breakNow());var e=c.pointers[Squeak.Context_sender];c.pointers[Squeak.Context_sender]=this.nilObj;c.pointers[Squeak.Context_instructionPointer]=this.nilObj;0<this.reclaimableContextCount&&(this.reclaimableContextCount--,this.recycleIfPossible(c));c=e}this.activeContext=
c;this.activeContext.dirty=!0;this.fetchContextRegisters(this.activeContext);this.push(a);this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},aboutToReturnThrough:function(a,b){this.push(this.exportThisContext());this.push(a);this.push(b);this.send(this.specialObjects[Squeak.splOb_SelectorAboutToReturn],2)},cannotReturn:function(a){this.push(this.exportThisContext());this.push(a);this.send(this.specialObjects[Squeak.splOb_SelectorCannotReturn],1)},tryPrimitive:function(a,
b,c){if(255<a&&520>a){if(264<=a)return this.popNandPush(1,this.top().pointers[a-264]),!0;switch(a){case 256:return!0;case 257:return this.popNandPush(1,this.trueObj),!0;case 258:return this.popNandPush(1,this.falseObj),!0;case 259:return this.popNandPush(1,this.nilObj),!0}this.popNandPush(1,a-261);return!0}return this.primHandler.doPrimitive(a,b,c)},createActualMessage:function(a,b,c){var e=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMessage],0),g=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],
b);this.arrayCopy(this.activeContext.pointers,this.sp-b+1,g.pointers,0,b);e.pointers[Squeak.Message_selector]=a;e.pointers[Squeak.Message_arguments]=g;e.pointers.length>Squeak.Message_lookupClass&&(e.pointers[Squeak.Message_lookupClass]=c);return e},primitivePerform:function(a){var b=this.stackValue(a-1),c=this.stackValue(a);--a;var e=this.sp-a,g=this.activeContext.pointers;this.arrayCopy(g,e+1,g,e,a);this.sp--;a=this.findSelectorInClass(b,a,this.getClass(c));this.executeNewMethod(c,a.method,a.argCount,
a.primIndex,a.mClass,b);return!0},primitivePerformWithArgs:function(a,b){var c=this.stackValue(a),e=this.stackValue(a-1),g=this.stackValue(a-2);if(g.sqClass!==this.specialObjects[Squeak.splOb_ClassArray])return!1;var h=b?this.stackValue(a-3):this.getClass(c);if(b)for(b=this.getClass(c);b!==h;)if(b=b.pointers[Squeak.Class_superclass],b.isNil)return!1;b=g.pointersSize();this.arrayCopy(g.pointers,0,this.activeContext.pointers,this.sp-1,b);this.sp+=b-a;a=this.findSelectorInClass(e,b,h);this.executeNewMethod(c,
a.method,a.argCount,a.primIndex,a.mClass,e);return!0},primitiveInvokeObjectAsMethod:function(a,b){for(var c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],a),e=0;e<a;e++)c.pointers[a-e-1]=this.pop();a=this.pop();e=this.currentSelector;var g=this.specialObjects[Squeak.splOb_SelectorRunWithIn];this.push(b);this.push(e);this.push(c);this.push(a);this.send(g,3,!1);return!0},findMethodCacheEntry:function(a,b){this.methodCacheRandomish=this.methodCacheRandomish+1&3;for(var c=(a.hash^
b.hash)&this.methodCacheMask,e=c,g=0;4>g;g++){var h=this.methodCache[e];if(h.selector===a&&h.lkupClass===b)return h;g===this.methodCacheRandomish&&(c=e);e=e+a.hash&this.methodCacheMask}h=this.methodCache[c];h.lkupClass=b;h.selector=a;h.method=null;return h},flushMethodCache:function(){for(var a=0;a<this.methodCacheSize;a++)this.methodCache[a].selector=null,this.methodCache[a].method=null;return!0},flushMethodCacheForSelector:function(a){for(var b=0;b<this.methodCacheSize;b++)this.methodCache[b].selector===
a&&(this.methodCache[b].selector=null,this.methodCache[b].method=null);return!0},flushMethodCacheForMethod:function(a){for(var b=0;b<this.methodCacheSize;b++)this.methodCache[b].method===a&&(this.methodCache[b].selector=null,this.methodCache[b].method=null);return!0},flushMethodCacheAfterBecome:function(a){this.flushMethodCache()}},"contexts",{isUnwindMarked:function(a){return this.isMethodContext(a)?198==a.pointers[Squeak.Context_method].methodPrimitiveIndex():!1},newActiveContext:function(a){this.storeContextRegisters();
this.activeContext=a;this.activeContext.dirty=!0;this.fetchContextRegisters(a)},exportThisContext:function(){this.storeContextRegisters();this.reclaimableContextCount=0;return this.activeContext},fetchContextRegisters:function(a){var b=a.pointers[Squeak.Context_method];this.isSmallInt(b)?(this.homeContext=a.pointers[Squeak.BlockContext_home],b=this.homeContext.pointers[Squeak.Context_method]):this.homeContext=a;this.receiver=this.homeContext.pointers[Squeak.Context_receiver];this.method=b;this.pc=
this.decodeSqueakPC(a.pointers[Squeak.Context_instructionPointer],b);this.sp=this.decodeSqueakSP(a.pointers[Squeak.Context_stackPointer])},storeContextRegisters:function(){this.activeContext.pointers[Squeak.Context_instructionPointer]=this.encodeSqueakPC(this.pc,this.method);this.activeContext.pointers[Squeak.Context_stackPointer]=this.encodeSqueakSP(this.sp)},encodeSqueakPC:function(a,b){return a+4*b.pointers.length+1},decodeSqueakPC:function(a,b){return a-4*b.pointers.length-1},encodeSqueakSP:function(a){return a-
(Squeak.Context_tempFrameStart-1)},decodeSqueakSP:function(a){return a+(Squeak.Context_tempFrameStart-1)},recycleIfPossible:function(a){this.isMethodContext(a)&&(a.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_smallFrameSize?(a.pointers[0]=this.freeContexts,this.freeContexts=a):a.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_largeFrameSize&&(a.pointers[0]=this.freeLargeContexts,this.freeLargeContexts=a))},allocateOrRecycleContext:function(a){if(a){if(!this.freeLargeContexts.isNil)return a=
this.freeLargeContexts,this.freeLargeContexts=a.pointers[0],this.nRecycledContexts++,a;this.nAllocatedContexts++;return this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_largeFrameSize)}if(!this.freeContexts.isNil)return a=this.freeContexts,this.freeContexts=a.pointers[0],this.nRecycledContexts++,a;this.nAllocatedContexts++;return this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_smallFrameSize)}},"stack access",{pop:function(){return this.activeContext.pointers[this.sp--]},
popN:function(a){this.sp-=a},push:function(a){this.activeContext.pointers[++this.sp]=a},popNandPush:function(a,b){this.activeContext.pointers[this.sp-=a-1]=b},top:function(){return this.activeContext.pointers[this.sp]},stackTopPut:function(a){this.activeContext.pointers[this.sp]=a},stackValue:function(a){return this.activeContext.pointers[this.sp-a]},stackInteger:function(a){return this.checkSmallInt(this.stackValue(a))},stackIntOrFloat:function(a){a=this.stackValue(a);if("number"===typeof a)return a;
if(a.isFloat)return this.resultIsFloat=!0,a.float;var b=a.bytes;if(b&&4==b.length){for(var c=0,e=3;0<=e;e--)c=256*c+b[e];if(a.sqClass===this.specialObjects[Squeak.splOb_ClassLargePositiveInteger])return c;if(a.sqClass===this.specialObjects[Squeak.splOb_ClassLargeNegativeInteger])return-c}this.success=!1;return 0},pop2AndPushIntResult:function(a){return this.success&&this.canBeSmallInt(a)?(this.popNandPush(2,a),!0):!1},pop2AndPushNumResult:function(a){if(this.success){if(this.resultIsFloat)return this.popNandPush(2,
this.primHandler.makeFloat(a)),!0;if(a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt)return this.popNandPush(2,a),!0;if(-4294967295<=a&&4294967295>=a){var b=0>a;a=b?-a:a;b=this.instantiateClass(this.specialObjects[b?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger],4);var c=b.bytes;c[0]=a&255;c[1]=a>>8&255;c[2]=a>>16&255;c[3]=a>>24&255;this.popNandPush(2,b);return!0}}return!1},pop2AndPushBoolResult:function(a){if(!this.success)return!1;this.popNandPush(2,a?this.trueObj:this.falseObj);
return!0}},"numbers",{getClass:function(a){return this.isSmallInt(a)?this.specialObjects[Squeak.splOb_ClassInteger]:a.sqClass},canBeSmallInt:function(a){return a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt},isSmallInt:function(a){return"number"===typeof a},checkSmallInt:function(a){if("number"===typeof a)return a;this.success=!1;return 1},quickDivide:function(a,b){if(0===b)return Squeak.NonSmallInt;var c=a/b|0;return c*b===a?c:Squeak.NonSmallInt},div:function(a,b){return 0===b?Squeak.NonSmallInt:Math.floor(a/
b)},mod:function(a,b){return 0===b?Squeak.NonSmallInt:a-Math.floor(a/b)*b},safeShift:function(a,b){if(0>b)return-31>b?0>a?-1:0:a>>-b;if(31<b)return 0==a?0:Squeak.NonSmallInt;var c=a<<b;return c>>b===a?c:Squeak.NonSmallInt}},"utils",{isContext:function(a){return a.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]||a.sqClass===this.specialObjects[Squeak.splOb_ClassBlockContext]?!0:!1},isMethodContext:function(a){return a.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]},instantiateClass:function(a,
b){return this.image.instantiateClass(a,b,this.nilObj)},arrayFill:function(a,b,c,e){for(;b<c;b++)a[b]=e},arrayCopy:function(a,b,c,e,g){if(a===c&&b<e)for(var h=g-1;0<=h;h--)c[e+h]=a[b+h];else for(h=0;h<g;h++)c[e+h]=a[b+h]}},"debugging",{addMessage:function(a){return this.messages[a]?++this.messages[a]:this.messages[a]=1},warnOnce:function(a){1==this.addMessage(a)&&console.warn(a)},printMethod:function(a,b,c){if(c)return b.className()+">>"+c.bytesAsString();a||(a=this.activeContext.contextMethod());
var e;this.allMethodsDo(function(b,c,f){if(c===a)return e=b.className()+">>"+f.bytesAsString()});return e?e:b?"("+b.pointers[Squeak.Context_receiver]+")>>?":"?>>?"},allInstancesOf:function(a,b){"string"===typeof a&&(a=this.globalNamed(a));var c=[];for(a=this.image.someInstanceOf(a);a;)b?b(a):c.push(a),a=this.image.nextInstanceAfter(a);return c},globalNamed:function(a){return this.allGlobalsDo(function(b,c){if(b.bytesAsString()===a)return c})},allGlobalsDo:function(a){for(var b=this.globals,c=0;c<
b.length;c++){var e=b[c];if(!e.isNil&&(e=a(e.pointers[0],e.pointers[1])))return e}},allMethodsDo:function(a){this.allGlobalsDo(function(b,c){if(c.pointers&&9<=c.pointers.length)for(b=[c,c.sqClass],c=0;c<b.length;c++){var e=b[c],g=e.pointers[1];if(g.pointers&&g.pointers[1]){var h=g.pointers[1].pointers;if(h){g=g.pointers;for(var f=0;f<h.length;f++)if(a.call(this,e,h[f],g[2+f]))return!0}}}})},printStack:function(a,b){"number"==typeof a&&(b=a,a=null);a||(a=this.activeContext);b||(b=100);for(var c=[],
e=Math.max(b,1E6);!a.isNil&&0<e--;)c.push(a),a=a.pointers[Squeak.Context_sender];c.length>b+200&&(a.isNil||c.push("..."),c=c.slice(0,b).concat(["..."]).concat(c.slice(-200)));b=[];for(e=c.length;0<e--;)if(a=c[e],a.pointers){var g="",h=a.pointers[Squeak.Context_method];"number"===typeof h?(h=a.pointers[Squeak.BlockContext_home].pointers[Squeak.Context_method],g="[] in "):a.pointers[Squeak.Context_closure].isNil||(g="[] in ");b.push(g+this.printMethod(h,a)+"\n")}else b.push("...\n");return b.join("")},
findMethod:function(a){var b,c=a.split(">>")[0],e=a.split(">>")[1];this.allMethodsDo(function(a,h,f){if(e.length==f.bytesSize()&&e==f.bytesAsString()&&c==a.className())return b=h});return b},breakNow:function(a){a&&console.log("Break: "+a);this.breakOutOfInterpreter="break"},breakOn:function(a){return this.breakOnMethod=a&&this.findMethod(a)},breakOnReturnFromThisContext:function(){this.breakOnContextChanged=!1;this.breakOnContextReturned=this.activeContext},breakOnSendOrReturn:function(){this.breakOnContextChanged=
!0;this.breakOnContextReturned=null},printActiveContext:function(a){function b(b){b=b.sqInstName?b.sqInstName():b.toString();b=JSON.stringify(b).slice(1,-1);b.length>a-3&&(b=b.slice(0,a-3)+"...");return b}a||(a=72);var c=this.activeContext,e="number"===typeof c.pointers[Squeak.BlockContext_argumentCount],g=c.pointers[Squeak.Context_closure],h=e?c.pointers[Squeak.BlockContext_home]:c;g=e||g.isNil?h.pointers[Squeak.Context_method].methodTempCount():g.pointers[Squeak.Closure_numArgs];var f=this.decodeSqueakSP(0),
d=h.contextSizeWithStack(this)-1,n=f+1,k=n+g-1;g="";for(var l=f;l<=d;l++){var w=b(h.pointers[l]),t="";l==f?t="=rcvr":l<=k&&(t="=tmp"+(l-n));g+="\nctx["+l+"]"+t+": "+w}if(e)for(g+="\n",h=c.pointers[3],e=this.decodeSqueakSP(1),h=e+h,l=e;l<=this.sp;l++)w=b(c.pointers[l]),t="",l<=h&&(t="=arg"+(l-e)),g+="\nblk["+l+"]"+t+": "+w;return g},printAllProcesses:function(){for(var a=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value],b="Active: "+this.printProcess(a.pointers[Squeak.ProcSched_activeProcess],
!0),c=a.pointers[Squeak.ProcSched_processLists].pointers,e=c.length-1;0<=e;e--)for(a=c[e].pointers[Squeak.LinkedList_firstLink];!a.isNil;)b+="\nRunnable: "+this.printProcess(a),a=a.pointers[Squeak.Link_nextLink];for(c=this.image.someInstanceOf(this.specialObjects[Squeak.splOb_ClassSemaphore]);c;){for(a=c.pointers[Squeak.LinkedList_firstLink];!a.isNil;)b+="\nWaiting: "+this.printProcess(a),a=a.pointers[Squeak.Link_nextLink];c=this.image.nextInstanceAfter(c)}return b},printProcess:function(a,b){var c=
a.pointers[Squeak.Proc_suspendedContext],e=a.pointers[Squeak.Proc_priority];b=this.printStack(b?null:c);return a.toString()+" at priority "+e+"\n"+b},printByteCodes:function(a,b,c,e){a||(a=this.method);return(new Squeak.InstructionPrinter(a,this)).printInstructions(b,c,e)},willSendOrReturn:function(){var a=this.method.bytes[this.pc];if(120<=a&&125>=a)return!0;if(131>a||200==a)return!1;if(176<=a)return!0;if(134>=a){if(132===a){if(1<this.method.bytes[this.pc+1]>>5)return!1;a=this.method.bytes[this.pc+
2]}else a=this.method.bytes[this.pc+1]&(134===a?63:31);if("blockCopy:"!==this.method.methodGetLiteral(a).bytesAsString())return!0}return!1},nextSendSelector:function(){var a=this.method.bytes[this.pc];if(131>a||200==a)return null;if(208<=a)var b=this.method.methodGetLiteral(a&15);else if(176<=a)b=this.specialSelectors[2*(a-176)];else if(134>=a){if(132===a){if(1<this.method.bytes[this.pc+1]>>5)return null;a=this.method.bytes[this.pc+2]}else a=this.method.bytes[this.pc+1]&(134===a?63:31);b=this.method.methodGetLiteral(a)}if(b&&
(a=b.bytesAsString(),"blockCopy:"!==a))return a}});Object.subclass("Squeak.Primitives","initialization",{initialize:function(a,b){this.vm=a;this.display=b;this.display.vm=this.vm;this.allowAccessBeyondSP=this.oldPrims=!this.vm.image.hasClosures;this.deferDisplayUpdates=!1;this.semaphoresToSignal=[];this.initDisplay();this.initAtCache();this.initModules();a.image.isSpur&&(this.charFromInt=this.charFromIntSpur,this.charToInt=this.charToIntSpur,this.identityHash=this.identityHashSpur)},initModules:function(){this.loadedModules=
{};this.builtinModules={JavaScriptPlugin:this.findPluginFunctions("js_"),FilePlugin:this.findPluginFunctions("","primitive(Disable)?(File|Directory)"),DropPlugin:this.findPluginFunctions("","primitiveDropRequest"),SoundPlugin:this.findPluginFunctions("snd_"),JPEGReadWriter2Plugin:this.findPluginFunctions("jpeg2_"),SqueakFFIPrims:this.findPluginFunctions("ffi_","",!0),SecurityPlugin:{primitiveDisableImageWrite:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveDisableImageWrite",0)}};this.patchModules=
{ScratchPlugin:this.findPluginFunctions("scratch_")};this.interpreterProxy=new Squeak.InterpreterProxy(this.vm)},findPluginFunctions:function(a,b,c){var e={};b=new RegExp("^"+a+(b||"(initialise|shutdown|prim)"),"i");for(var g in this)if(b.test(g)&&"function"==typeof this[g]){var h=g;a&&(h=g[a.length].toLowerCase()+g.slice(a.length+1));e[h]=c?g:this[g].bind(this)}return e},initDisplay:function(){this.indexedColors=[4294967295,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,
4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,
4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,
4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,
4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,
4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,
4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}},"dispatch",{quickSendOther:function(a,b){this.success=!0;switch(b){case 0:return this.popNandPushIfOK(2,this.objectAt(!0,!0,!1));case 1:return this.popNandPushIfOK(3,this.objectAtPut(!0,!0,!1));case 2:return this.popNandPushIfOK(1,this.objectSize(!0));case 6:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===
this.vm.stackValue(0));case 7:return this.popNandPushIfOK(1,this.vm.getClass(this.vm.top()));case 8:return this.popNandPushIfOK(2,this.doBlockCopy());case 9:return this.primitiveBlockValue(0);case 10:return this.primitiveBlockValue(1)}return!1},doPrimitive:function(a,b,c){this.success=!0;if(128>a)switch(a){case 1:return this.popNandPushIntIfOK(2,this.stackInteger(1)+this.stackInteger(0));case 2:return this.popNandPushIntIfOK(2,this.stackInteger(1)-this.stackInteger(0));case 3:return this.pop2andPushBoolIfOK(this.stackInteger(1)<
this.stackInteger(0));case 4:return this.pop2andPushBoolIfOK(this.stackInteger(1)>this.stackInteger(0));case 5:return this.pop2andPushBoolIfOK(this.stackInteger(1)<=this.stackInteger(0));case 6:return this.pop2andPushBoolIfOK(this.stackInteger(1)>=this.stackInteger(0));case 7:return this.pop2andPushBoolIfOK(this.stackInteger(1)===this.stackInteger(0));case 8:return this.pop2andPushBoolIfOK(this.stackInteger(1)!==this.stackInteger(0));case 9:return this.popNandPushIntIfOK(2,this.stackInteger(1)*this.stackInteger(0));
case 10:return this.popNandPushIntIfOK(2,this.vm.quickDivide(this.stackInteger(1),this.stackInteger(0)));case 11:return this.popNandPushIntIfOK(2,this.vm.mod(this.stackInteger(1),this.stackInteger(0)));case 12:return this.popNandPushIntIfOK(2,this.vm.div(this.stackInteger(1),this.stackInteger(0)));case 13:return this.popNandPushIntIfOK(2,this.stackInteger(1)/this.stackInteger(0)|0);case 14:return this.popNandPushIfOK(2,this.doBitAnd());case 15:return this.popNandPushIfOK(2,this.doBitOr());case 16:return this.popNandPushIfOK(2,
this.doBitXor());case 17:return this.popNandPushIfOK(2,this.doBitShift());case 18:return this.primitiveMakePoint(b,!1);case 19:return!1;case 20:return!1;case 21:return!1;case 22:return!1;case 23:return this.primitiveLessThanLargeIntegers();case 24:return this.primitiveGreaterThanLargeIntegers();case 25:return this.primitiveLessOrEqualLargeIntegers();case 26:return this.primitiveGreaterOrEqualLargeIntegers();case 27:return this.primitiveEqualLargeIntegers();case 28:return this.primitiveNotEqualLargeIntegers();
case 29:return!1;case 30:return!1;case 31:return!1;case 32:return!1;case 33:return!1;case 34:return!1;case 35:return!1;case 36:return!1;case 37:return!1;case 38:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!1));case 39:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!1));case 40:return this.popNandPushFloatIfOK(b+1,this.stackInteger(0));case 41:return this.popNandPushFloatIfOK(b+1,this.stackFloat(1)+this.stackFloat(0));case 42:return this.popNandPushFloatIfOK(b+1,this.stackFloat(1)-
this.stackFloat(0));case 43:return this.pop2andPushBoolIfOK(this.stackFloat(1)<this.stackFloat(0));case 44:return this.pop2andPushBoolIfOK(this.stackFloat(1)>this.stackFloat(0));case 45:return this.pop2andPushBoolIfOK(this.stackFloat(1)<=this.stackFloat(0));case 46:return this.pop2andPushBoolIfOK(this.stackFloat(1)>=this.stackFloat(0));case 47:return this.pop2andPushBoolIfOK(this.stackFloat(1)===this.stackFloat(0));case 48:return this.pop2andPushBoolIfOK(this.stackFloat(1)!==this.stackFloat(0));case 49:return this.popNandPushFloatIfOK(b+
1,this.stackFloat(1)*this.stackFloat(0));case 50:return this.popNandPushFloatIfOK(b+1,this.safeFDiv(this.stackFloat(1),this.stackFloat(0)));case 51:return this.popNandPushIfOK(b+1,this.floatAsSmallInt(this.stackFloat(0)));case 52:return!1;case 53:return this.popNandPushIntIfOK(b+1,this.frexp_exponent(this.stackFloat(0))-1);case 54:return this.popNandPushFloatIfOK(2,this.ldexp(this.stackFloat(1),this.stackFloat(0)));case 55:return this.popNandPushFloatIfOK(b+1,Math.sqrt(this.stackFloat(0)));case 56:return this.popNandPushFloatIfOK(b+
1,Math.sin(this.stackFloat(0)));case 57:return this.popNandPushFloatIfOK(b+1,Math.atan(this.stackFloat(0)));case 58:return this.popNandPushFloatIfOK(b+1,Math.log(this.stackFloat(0)));case 59:return this.popNandPushFloatIfOK(b+1,Math.exp(this.stackFloat(0)));case 60:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!1));case 61:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!1));case 62:return this.popNandPushIfOK(b+1,this.objectSize(!1));case 63:return this.popNandPushIfOK(b+1,this.objectAt(!1,
!0,!1));case 64:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!0,!1));case 65:return!1;case 66:return!1;case 67:return!1;case 68:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!0));case 69:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!0));case 70:return this.popNandPushIfOK(b+1,this.instantiateClass(this.stackNonInteger(0),0));case 71:return this.popNandPushIfOK(b+1,this.instantiateClass(this.stackNonInteger(1),this.stackPos32BitInt(0)));case 72:return this.primitiveArrayBecome(b,
!1);case 73:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!0));case 74:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!0));case 75:return this.popNandPushIfOK(b+1,this.identityHash(this.stackNonInteger(0)));case 76:return this.primitiveStoreStackp(b);case 77:return this.popNandPushIfOK(b+1,this.someInstanceOf(this.stackNonInteger(0)));case 78:return this.popNandPushIfOK(b+1,this.nextInstanceAfter(this.stackNonInteger(0)));case 79:return this.primitiveNewMethod(b);case 80:return this.popNandPushIfOK(2,
this.doBlockCopy());case 81:return this.primitiveBlockValue(b);case 82:return this.primitiveBlockValueWithArgs(b);case 83:return this.vm.primitivePerform(b);case 84:return this.vm.primitivePerformWithArgs(b,!1);case 85:return this.primitiveSignal();case 86:return this.primitiveWait();case 87:return this.primitiveResume();case 88:return this.primitiveSuspend();case 89:return this.vm.flushMethodCache();case 90:return this.primitiveMousePoint(b);case 91:return this.primitiveTestDisplayDepth(b);case 93:return this.primitiveInputSemaphore(b);
case 94:return this.primitiveGetNextEvent(b);case 95:return this.primitiveInputWord(b);case 96:return this.namedPrimitive("BitBltPlugin","primitiveCopyBits",b);case 97:return this.primitiveSnapshot(b);case 99:return this.primitiveLoadImageSegment(b);case 100:return this.vm.primitivePerformWithArgs(b,!0);case 101:return this.primitiveBeCursor(b);case 102:return this.primitiveBeDisplay(b);case 103:return!1;case 104:return!1;case 105:return this.popNandPushIfOK(b+1,this.doStringReplace());case 106:return this.primitiveScreenSize(b);
case 107:return this.primitiveMouseButtons(b);case 108:return this.primitiveKeyboardNext(b);case 109:return this.primitiveKeyboardPeek(b);case 110:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 111:return this.popNandPushIfOK(b+1,this.vm.getClass(this.vm.top()));case 112:return this.popNandPushIfOK(b+1,this.vm.image.bytesLeft());case 113:return this.primitiveQuit(b);case 114:return this.primitiveExitToDebugger(b);case 115:return this.primitiveChangeClass(b);case 116:return this.vm.flushMethodCacheForMethod(this.vm.top());
case 117:return this.doNamedPrimitive(b,c);case 118:return this.primitiveDoPrimitiveWithArgs(b);case 119:return this.vm.flushMethodCacheForSelector(this.vm.top());case 120:return!1;case 121:return this.primitiveImageName(b);case 122:return this.primitiveReverseDisplay(b);case 124:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheLowSpaceSemaphore));case 125:return this.popNandPushIfOK(2,this.setLowSpaceThreshold());case 126:return this.primitiveDeferDisplayUpdates(b);case 127:return this.primitiveShowDisplayRect(b)}else if(256>
a)switch(a){case 128:return this.primitiveArrayBecome(b,!0);case 129:return this.popNandPushIfOK(1,this.vm.image.specialObjectsArray);case 130:return this.primitiveFullGC(b);case 131:return this.primitivePartialGC(b);case 132:return this.pop2andPushBoolIfOK(this.pointsTo(this.stackNonInteger(1),this.vm.top()));case 133:return!0;case 134:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheInterruptSemaphore));case 135:return this.popNandPushIfOK(1,this.millisecondClockValue());case 136:return this.primitiveSignalAtMilliseconds(b);
case 137:return this.popNandPushIfOK(1,this.secondClock());case 138:return this.popNandPushIfOK(b+1,this.someObject());case 139:return this.popNandPushIfOK(b+1,this.nextObject(this.vm.top()));case 140:return this.primitiveBeep(b);case 141:return this.primitiveClipboardText(b);case 142:return this.popNandPushIfOK(b+1,this.makeStString(this.filenameToSqueak(Squeak.vmPath)));case 143:case 144:return this.primitiveShortAtAndPut(b);case 145:return this.primitiveConstantFill(b);case 146:return this.namedPrimitive("JoystickTabletPlugin",
"primitiveReadJoystick",b);case 147:return this.namedPrimitive("BitBltPlugin","primitiveWarpBits",b);case 148:return this.popNandPushIfOK(b+1,this.vm.image.clone(this.vm.top()));case 149:return this.primitiveGetAttribute(b);case 150:if(this.oldPrims)return this.primitiveFileAtEnd(b);case 151:if(this.oldPrims)return this.primitiveFileClose(b);case 152:if(this.oldPrims)return this.primitiveFileGetPosition(b);case 153:if(this.oldPrims)return this.primitiveFileOpen(b);case 154:if(this.oldPrims)return this.primitiveFileRead(b);
case 155:if(this.oldPrims)return this.primitiveFileSetPosition(b);case 156:if(this.oldPrims)return this.primitiveFileDelete(b);case 157:if(this.oldPrims)return this.primitiveFileSize(b);case 158:if(this.oldPrims)return this.primitiveFileWrite(b);case 159:if(this.oldPrims)return this.primitiveFileRename(b);break;case 160:return this.oldPrims?this.primitiveDirectoryCreate(b):this.primitiveAdoptInstance(b);case 161:if(this.oldPrims)return this.primitiveDirectoryDelimitor(b);break;case 162:if(this.oldPrims)return this.primitiveDirectoryLookup(b);
break;case 163:if(this.oldPrims)return this.primitiveDirectoryDelete(b);break;case 165:case 166:return this.primitiveIntegerAtAndPut(b);case 167:return!1;case 168:return this.primitiveCopyObject(b);case 169:return this.oldPrims?this.primitiveDirectorySetMacTypeAndCreator(b):this.pop2andPushBoolIfOK(this.vm.stackValue(1)!==this.vm.stackValue(0));case 170:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStart",b):this.primitiveAsCharacter(b);case 171:return this.oldPrims?this.namedPrimitive("SoundPlugin",
"primitiveSoundStartWithSemaphore",b):this.popNandPushIfOK(b+1,this.stackNonInteger(0).hash);case 172:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStop",b);break;case 173:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundAvailableSpace",b):this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!0));case 174:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySamples",b):this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!0));case 175:return this.oldPrims?
this.namedPrimitive("SoundPlugin","primitiveSoundPlaySilence",b):this.popNandPushIfOK(b+1,this.behaviorHash(this.stackNonInteger(0)));case 176:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primWaveTableSoundmixSampleCountintostartingAtpan",b);break;case 177:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primFMSoundmixSampleCountintostartingAtpan",b):this.popNandPushIfOK(b+1,this.allInstancesOf(this.stackNonInteger(0)));case 178:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin",
"primPluckedSoundmixSampleCountintostartingAtpan",b):!1;case 179:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primSampledSoundmixSampleCountintostartingAtpan",b);break;case 180:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixFMSound",b):!1;case 181:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixPluckedSound",b):this.primitiveSizeInBytesOfInstance(b);case 182:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin",
"oldprimSampledSoundmixSampleCountintostartingAtleftVolrightVol",b):this.primitiveSizeInBytes(b);case 183:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveApplyReverb",b);break;case 184:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixLoopedSampledSound",b);break;case 185:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixSampledSound",b):this.primitiveExitCriticalSection(b);case 186:if(this.oldPrims)break;else return this.primitiveEnterCriticalSection(b);
case 187:if(this.oldPrims)break;else return this.primitiveTestAndSetOwnershipOfCriticalSection(b);case 188:if(this.oldPrims)break;else return this.primitiveExecuteMethodArgsArray(b);case 189:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundInsertSamples",b):this.primitiveExecuteMethod(b);case 190:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartRecording",b);case 191:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStopRecording",
b);case 192:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundGetRecordingSampleRate",b);case 193:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundRecordSamples",b);case 194:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundSetRecordLevel",b);break;case 195:return!1;case 196:return!1;case 197:return!1;case 198:return!1;case 199:return!1;case 200:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveInitializeNetwork",
b):this.primitiveClosureCopyWithCopiedValues(b);case 201:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartNameLookup",b):this.primitiveClosureValue(b);case 202:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverNameLookupResult",b):this.primitiveClosureValue(b);case 203:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartAddressLookup",b):this.primitiveClosureValue(b);case 204:return this.oldPrims?this.namedPrimitive("SocketPlugin",
"primitiveResolverAddressLookupResult",b):this.primitiveClosureValue(b);case 205:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAbortLookup",b):this.primitiveClosureValue(b);case 206:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverLocalAddress",b):this.primitiveClosureValueWithArgs(b);case 207:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveResolverStatus",b);case 208:if(this.oldPrims)return this.namedPrimitive("SocketPlugin",
"primitiveResolverError",b);case 209:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCreate",b);break;case 210:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketDestroy",b):this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 211:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketConnectionStatus",b):this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!1));case 212:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketError",
b):this.popNandPushIfOK(1,this.objectSize(!1));case 213:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalAddress",b);case 214:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalPort",b);case 215:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemoteAddress",b);case 216:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemotePort",b);case 217:if(this.oldPrims)return this.namedPrimitive("SocketPlugin",
"primitiveSocketConnectToPort",b);case 218:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketListenOnPort",b);case 219:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCloseConnection",b);case 220:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAbortConnection",b);break;case 221:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataBufCount",b):this.primitiveClosureValueNoContextSwitch(b);case 222:return this.oldPrims?
this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataAvailable",b):this.primitiveClosureValueNoContextSwitch(b);case 223:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDataBufCount",b);case 224:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDone",b);break;case 230:return this.primitiveRelinquishProcessorForMicroseconds(b);case 231:return this.primitiveForceDisplayUpdate(b);case 233:return this.primitiveSetFullScreen(b);case 234:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin",
"primitiveDecompressFromByteArray",b);case 235:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompareString",b);case 236:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveConvert8BitSigned",b);case 237:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompressToByteArray",b);case 238:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortOpen",b);case 239:if(this.oldPrims)return this.namedPrimitive("SerialPlugin",
"primitiveSerialPortClose",b);break;case 240:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortWrite",b):this.popNandPushIfOK(1,this.microsecondClockUTC());case 241:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortRead",b):this.popNandPushIfOK(1,this.microsecondClockLocal());case 242:if(this.oldPrims)break;else return this.primitiveSignalAtUTCMicroseconds(b);case 243:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveTranslateStringWithTable",
b);case 244:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindFirstInString",b);case 245:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveIndexOfAsciiInString",b);case 246:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindSubstring",b);break;case 248:return this.vm.primitiveInvokeObjectAsMethod(b,c);case 249:return this.primitiveArrayBecome(b,!1);case 254:return this.primitiveVMParameter(b)}else switch(a){case 521:return this.namedPrimitive("MIDIPlugin",
"primitiveMIDIClosePort",b);case 522:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetClock",b);case 523:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortCount",b);case 524:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortDirectionality",b);case 525:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortName",b);case 526:return this.namedPrimitive("MIDIPlugin","primitiveMIDIOpenPort",b);case 527:return this.namedPrimitive("MIDIPlugin","primitiveMIDIParameterGetOrSet",
b);case 528:return this.namedPrimitive("MIDIPlugin","primitiveMIDIRead",b);case 529:return this.namedPrimitive("MIDIPlugin","primitiveMIDIWrite",b);case 550:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeMono",b);case 551:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeStereo",b);case 552:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeMono",b);case 553:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeStereo",b);case 571:return this.primitiveUnloadModule(b);
case 572:return this.primitiveListBuiltinModule(b);case 573:return this.primitiveListLoadedModule(b)}console.error("primitive "+a+" not implemented yet");return!1},namedPrimitive:function(a,b,c){var e=""===a?this:this.loadedModules[a];void 0===e&&(e=this.loadModule(a),this.loadedModules[a]=e);var g=!1;if(e){this.interpreterProxy.argCount=c;var h=e[b];"function"===typeof h?g=e[b](c):"string"===typeof h?g=this[h](c):this.vm.warnOnce("missing primitive: "+a+"."+b)}else this.vm.warnOnce("missing module: "+
a+" ("+b+")");return!0===g||!1===g?g:this.success},doNamedPrimitive:function(a,b){if(2>b.pointersSize())return!1;var c=b.pointers[1];if(4!==c.pointersSize())return!1;this.primMethod=b;b=c.pointers[0].bytesAsString();c=c.pointers[1].bytesAsString();return this.namedPrimitive(b,c,a)},fakePrimitive:function(a,b,c){this.vm.warnOnce("faking primitive: "+a);void 0===b?this.vm.popN(c):this.vm.popNandPush(c+1,this.makeStObject(b));return!0}},"modules",{loadModule:function(a){var b=Squeak.externalModules[a]||
this.builtinModules[a];if(!b)return null;this.patchModules[a]&&this.patchModule(b,a);if(b.setInterpreter&&!b.setInterpreter(this.interpreterProxy))return console.log("Wrong interpreter proxy version: "+a),null;var c=b.initialiseModule;if("function"===typeof c)b.initialiseModule();else if("string"===typeof c)this[c]();if(this.interpreterProxy.failed())return console.log("Module initialization failed: "+a),null;console.log("Loaded module: "+a);return b},patchModule:function(a,b){b=this.patchModules[b];
for(var c in b)a[c]=b[c]},unloadModule:function(a){var b=this.loadedModules[a];if(!a||!b||b===this)return null;delete this.loadedModules[a];var c=b.unloadModule;if("function"===typeof c)b.unloadModule(this);else if("string"===typeof c)this[c](this);console.log("Unloaded module: "+a);return b},loadFunctionFrom:function(a,b){var c=""===b?this:this.loadedModules[b];void 0===c&&(c=this.loadModule(b),this.loadedModules[b]=c);if(!c)return null;var e=c[a];if("function"===typeof e)return e.bind(c);if("string"===
typeof e)return this[e].bind(this);this.vm.warnOnce("missing primitive: "+b+"."+a);return null},primitiveUnloadModule:function(a){var b=this.stackNonInteger(0).bytesAsString();if(!b)return!1;this.unloadModule(b);return this.popNIfOK(a)},primitiveListBuiltinModule:function(a){var b=this.stackInteger(0)-1;if(!this.success)return!1;var c=Object.keys(this.builtinModules);return this.popNandPushIfOK(a+1,this.makeStObject(c[b]))},primitiveListLoadedModule:function(a){var b=this.stackInteger(0)-1;if(!this.success)return!1;
var c=[],e;for(e in this.loadedModules){var g=this.loadedModules[e];g&&(g=g.getModuleName?g.getModuleName():e,c.push(g))}return this.popNandPushIfOK(a+1,this.makeStObject(c[b]))}},"stack access",{popNIfOK:function(a){if(!this.success)return!1;this.vm.popN(a);return!0},pop2andPushBoolIfOK:function(a){this.vm.success=this.success;return this.vm.pop2AndPushBoolResult(a)},popNandPushIfOK:function(a,b){if(!this.success||null==b)return!1;this.vm.popNandPush(a,b);return!0},popNandPushIntIfOK:function(a,
b){return this.success&&this.vm.canBeSmallInt(b)?this.popNandPushIfOK(a,b):!1},popNandPushFloatIfOK:function(a,b){return this.success?this.popNandPushIfOK(a,this.makeFloat(b)):!1},stackNonInteger:function(a){return this.checkNonInteger(this.vm.stackValue(a))},stackInteger:function(a){return this.checkSmallInt(this.vm.stackValue(a))},stackPos32BitInt:function(a){return this.positive32BitValueOf(this.vm.stackValue(a))},pos32BitIntFor:function(a){if(0<=a&&a<=Squeak.MaxSmallInt)return a;for(var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],
4),c=b.bytes,e=0;4>e;e++)c[e]=a>>>8*e&255;return b},pos53BitIntFor:function(a){if(4294967295>=a)return this.pos32BitIntFor(a);if(9007199254740991<a)return console.warn("Out of range: pos53BitIntFor("+a+")"),this.success=!1,0;for(var b=0xffffffffff>=a?5:0xffffffffffff>=a?6:7,c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],b),e=c.bytes,g=0;g<b;g++)e[g]=a&255,a/=256;return c},stackSigned32BitInt:function(a){a=this.vm.stackValue(a);if("number"===typeof a)return a;
if(4!==a.bytesSize())return this.success=!1,0;for(var b=a.bytes,c=0,e=0,g=1;4>e;e++,g*=256)c+=b[e]*g;if(this.isA(a,Squeak.splOb_ClassLargePositiveInteger)&&2147483647>=c)return c;if(this.isA(a,Squeak.splOb_ClassLargeNegativeInteger)&&-2147483648<=-c)return-c;this.success=!1;return 0},signed32BitIntegerFor:function(a){if(a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt)return a;var b=0>a;a=b?-a:a;b=this.vm.instantiateClass(this.vm.specialObjects[b?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger],
4);for(var c=b.bytes,e=0;4>e;e++)c[e]=a>>>8*e&255;return b},stackFloat:function(a){return this.checkFloat(this.vm.stackValue(a))},stackBoolean:function(a){return this.checkBoolean(this.vm.stackValue(a))},stackSigned53BitInt:function(a){a=this.vm.stackValue(a);if("number"===typeof a)return a;var b=a.bytesSize();if(7>=b){for(var c=a.bytes,e=0,g=0,h=1;g<b;g++,h*=256)e+=c[g]*h;if(9007199254740991>=e){if(this.isA(a,Squeak.splOb_ClassLargePositiveInteger))return e;if(this.isA(a,Squeak.splOb_ClassLargeNegativeInteger))return-e}}this.success=
!1;return 0}},"numbers",{doBitAnd:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a&b):0},doBitOr:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a|b):0},doBitXor:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a^b):0},doBitShift:function(){var a=this.stackPos32BitInt(1),b=this.stackInteger(0);if(!this.success)return 0;
if(0<this.vm.safeShift(a,b))return this.pos32BitIntFor(this.vm.safeShift(a,b));this.success=!1;return 0},safeFDiv:function(a,b){return 0===b?(this.success=!1,1):a/b},floatAsSmallInt:function(a){return this.ensureSmallInt(0<=a?Math.floor(a):Math.ceil(a))},frexp_exponent:function(a){if(0==a)return 0;var b=new DataView(new ArrayBuffer(8));b.setFloat64(0,a);var c=b.getUint32(0)>>>20&2047;0===c&&(b.setFloat64(0,a*Math.pow(2,64)),c=(b.getUint32(0)>>>20&2047)-64);return c-1022},ldexp:function(a,b){for(var c=
Math.min(3,Math.ceil(Math.abs(b)/1023)),e=0;e<c;e++)a*=Math.pow(2,Math.floor((b+e)/c));return a},primitiveLessThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<this.stackSigned53BitInt(0))},primitiveGreaterThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>this.stackSigned53BitInt(0))},primitiveLessOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<=this.stackSigned53BitInt(0))},primitiveGreaterOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>=
this.stackSigned53BitInt(0))},primitiveEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)===this.stackSigned53BitInt(0))},primitiveNotEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)!==this.stackSigned53BitInt(0))}},"utils",{floatOrInt:function(a){return a.isFloat?a.float:"number"===typeof a?a:0},positive32BitValueOf:function(a){if("number"===typeof a){if(0<=a)return a;this.success=!1;return 0}if(!this.isA(a,Squeak.splOb_ClassLargePositiveInteger)||
4!==a.bytesSize())return this.success=!1,0;a=a.bytes;for(var b=0,c=0,e=1;4>c;c++,e*=256)b+=a[c]*e;return b},checkFloat:function(a){if(a.isFloat)return a.float;if("number"===typeof a)return a;this.success=!1;return 0},checkSmallInt:function(a){if("number"===typeof a)return a;this.success=!1;return 0},checkNonInteger:function(a){if("number"!==typeof a)return a;this.success=!1;return this.vm.nilObj},checkBoolean:function(a){return a.isTrue?!0:a.isFalse?!1:this.success=!1},indexableSize:function(a){return"number"===
typeof a?-1:a.indexableSize(this)},isA:function(a,b){return a.sqClass===this.vm.specialObjects[b]},isKindOf:function(a,b){a=a.sqClass;for(b=this.vm.specialObjects[b];!a.isNil;){if(a===b)return!0;a=a.pointers[Squeak.Class_superclass]}return!1},isAssociation:function(a){return"number"!==typeof a&&2==a.pointersSize()},ensureSmallInt:function(a){if(a===(a|0)&&this.vm.canBeSmallInt(a))return a;this.success=!1;return 0},charFromInt:function(a){var b=this.vm.specialObjects[Squeak.splOb_CharacterTable].pointers[a];
if(b)return b;b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassCharacter],0);b.pointers[0]=a;return b},charFromIntSpur:function(a){return this.vm.image.getCharacter(a)},charToInt:function(a){return a.pointers[0]},charToIntSpur:function(a){return a.hash},makeFloat:function(a){var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassFloat],2);b.float=a;return b},makeLargeIfNeeded:function(a){return this.vm.canBeSmallInt(a)?a:this.makeLargeInt(a)},makeLargeInt:function(a){if(0>
a)throw Error("negative large ints not implemented yet");if(4294967295<a)throw Error("large large ints not implemented yet");return this.pos32BitIntFor(a)},makePointWithXandY:function(a,b){var c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassPoint],0);c.pointers[Squeak.Point_x]=a;c.pointers[Squeak.Point_y]=b;return c},makeStArray:function(a,b){for(var c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],a.length),e=0;e<a.length;e++)c.pointers[e]=this.makeStObject(a[e],
b);return c},makeStString:function(a){for(var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],a.length),c=0;c<a.length;++c)b.bytes[c]=a.charCodeAt(c)&255;return b},makeStObject:function(a,b){if(void 0===a||null===a)return this.vm.nilObj;if(!0===a)return this.vm.trueObj;if(!1===a)return this.vm.falseObj;if(a.sqClass)return a;if("number"===typeof a)return a===(a|0)?this.makeLargeIfNeeded(a):this.makeFloat(a);if(b)return b=this.vm.instantiateClass(b,0),b.jsObject=a,b;if("string"===
typeof a||"Uint8Array"===a.constructor.name)return this.makeStString(a);if("Array"===a.constructor.name)return this.makeStArray(a);throw Error("cannot make smalltalk object");},pointsTo:function(a,b){return a.pointers?0<=a.pointers.indexOf(b):!1},asUint8Array:function(a){if("Uint8Array"===a.constructor.name)return a;if("ArrayBuffer"===a.constructor.name)return new Uint8Array(a);if("string"===typeof a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}throw Error("unknown buffer type");
},filenameToSqueak:function(a){a="/SqueakJS"+("/"!==a[0]?"/":"")+a;this.emulateMac&&(a=("Macintosh HD"+a).replace(/\//g,"\u20ac").replace(/:/g,"/").replace(/\u20ac/g,":"));return a},filenameFromSqueak:function(a){a=this.emulateMac?a.replace(/^[^:]*:/,":").replace(/\//g,"\u20ac").replace(/:/g,"/").replace(/\u20ac/g,":"):a;return a=a.replace(/^\/*SqueakJS\/?/,"/")}},"indexing",{objectAt:function(a,b,c){var e=this.stackNonInteger(1),g=this.stackPos32BitInt(0);if(!this.success)return e;if(a){if(a=this.atCache[e.hash&
this.atCacheMask],a.array!==e)return this.success=!1,e}else{if(e.isFloat){c=e.floatData();if(1==g)return this.pos32BitIntFor(c.getUint32(0,!1));if(2==g)return this.pos32BitIntFor(c.getUint32(4,!1));this.success=!1;return e}a=this.makeAtCacheInfo(this.atCache,this.vm.specialSelectors[32],e,b,c)}if(1>g||g>a.size)return this.success=!1,e;if(c)return e.pointers[g-1];if(e.isPointers())return e.pointers[g-1+a.ivarOffset];if(e.isWords())return a.convertChars?this.charFromInt(e.words[g-1]&1073741823):this.pos32BitIntFor(e.words[g-
1]);if(e.isBytes())return a.convertChars?this.charFromInt(e.bytes[g-1]&255):e.bytes[g-1]&255;c=4*e.pointersSize();return 0>g-1-c?(this.success=!1,e):e.bytes[g-1-c]&255},objectAtPut:function(a,b,c){var e=this.stackNonInteger(2),g=this.stackPos32BitInt(1);if(!this.success)return e;if(a){var h=this.atPutCache[e.hash&this.atCacheMask];if(h.array!==e)return this.success=!1,e}else{if(e.isFloat)return a=this.stackPos32BitInt(0),!this.success||1!=g&&2!=g?this.success=!1:(b=e.floatData(),b.setUint32(1==g?
0:4,a,!1),e.float=b.getFloat64(0)),this.vm.stackValue(0);h=this.makeAtCacheInfo(this.atPutCache,this.vm.specialSelectors[34],e,b,c)}if(1>g||g>h.size)return this.success=!1,e;a=this.vm.stackValue(0);if(c)return e.dirty=!0,e.pointers[g-1]=a;if(e.isPointers())return e.dirty=!0,e.pointers[g-1+h.ivarOffset]=a;if(e.isWords()){if(b){if(a.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,a;b=this.charToInt(a);if("number"!==typeof b)return this.success=!1,a}else b=this.stackPos32BitInt(0);
this.success&&(e.words[g-1]=b);return a}if(b){if(a.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,a;b=this.charToInt(a);if("number"!==typeof b)return this.success=!1,a}else{if("number"!==typeof a)return this.success=!1,a;b=a}if(0>b||255<b)return this.success=!1,a;if(e.isBytes())return e.bytes[g-1]=b;c=4*e.pointersSize();if(0>g-1-c)return this.success=!1,e;e.bytes[g-1-c]=b;return a},objectSize:function(a){var b=this.vm.stackValue(0),c=-1;a?b.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]?
c=b.pointersSize():b.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString]&&(c=b.bytesSize()):c=this.indexableSize(b);return-1===c?(this.success=!1,-1):this.pos32BitIntFor(c)},initAtCache:function(){this.atCacheSize=32;this.atCacheMask=this.atCacheSize-1;this.atCache=[];this.atPutCache=[];this.nonCachedInfo={};for(var a=0;a<this.atCacheSize;a++)this.atCache.push({}),this.atPutCache.push({})},makeAtCacheInfo:function(a,b,c,e,g){a=this.vm.verifyAtSelector!==b||this.vm.verifyAtClass!==c.sqClass||
this.vm.isContext(c)?this.nonCachedInfo:a[c.hash&this.atCacheMask];a.array=c;a.convertChars=e;g?(a.size=c.instSize()+Math.max(0,c.indexableSize(this)),a.ivarOffset=0):(a.size=c.indexableSize(this),a.ivarOffset=c.isPointers()?c.instSize():0);return a}},"basic",{instantiateClass:function(a,b){return 4*b>this.vm.image.bytesLeft()?(console.warn("squeak: out of memory"),this.success=!1,this.vm.primFailCode=Squeak.PrimErrNoMemory,null):this.vm.instantiateClass(a,b)},someObject:function(){return this.vm.image.firstOldObject},
nextObject:function(a){return this.vm.image.objectAfter(a)||0},someInstanceOf:function(a){if(a=this.vm.image.someInstanceOf(a))return a;this.success=!1;return 0},nextInstanceAfter:function(a){if(a=this.vm.image.nextInstanceAfter(a))return a;this.success=!1;return 0},allInstancesOf:function(a){a=this.vm.image.allInstancesOf(a);var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],a.length);b.pointers=a;return b},identityHash:function(a){return a.hash},identityHashSpur:function(a){var b=
a.hash;return 0<b?b:a.hash=this.newObjectHash()},behaviorHash:function(a){var b=a.hash;return 0<b?b:this.vm.image.enterIntoClassTable(a)},newObjectHash:function(a){return Math.floor(4194302*Math.random())+1},primitiveSizeInBytesOfInstance:function(a){if(1<a)return!1;var b=this.stackNonInteger(a),c=a?this.stackInteger(0):0;b=b.classByteSizeOfInstance(c);return this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b))},primitiveSizeInBytes:function(a){var b=this.stackNonInteger(0).totalBytes();return this.popNandPushIfOK(a+
1,this.makeLargeIfNeeded(b))},primitiveAsCharacter:function(a){var b=this.stackInteger(0);return 0>b||1073741823<b?!1:(b=this.charFromInt(b))?this.popNandPushIfOK(a+1,b):!1},primitiveFullGC:function(a){this.vm.image.fullGC("primitive");a=this.vm.image.bytesLeft();return this.popNandPushIfOK(1,this.makeLargeIfNeeded(a))},primitivePartialGC:function(a){this.vm.image.partialGC("primitive");a=this.vm.image.bytesLeft();return this.popNandPushIfOK(1,this.makeLargeIfNeeded(a))},primitiveMakePoint:function(a,
b){var c=this.vm.stackValue(1),e=this.vm.stackValue(0);if(b&&(this.checkFloat(c),this.checkFloat(e),!this.success))return!1;this.vm.popNandPush(1+a,this.makePointWithXandY(c,e));return!0},primitiveStoreStackp:function(a){var b=this.stackNonInteger(1),c=this.stackInteger(0);if(!this.success||0>c||this.vm.decodeSqueakSP(c)>=b.pointers.length)return!1;for(var e=b.pointers[Squeak.Context_stackPointer];e<c;)b.pointers[this.vm.decodeSqueakSP(++e)]=this.vm.nilObj;b.pointers[Squeak.Context_stackPointer]=
c;this.vm.popN(a);return!0},primitiveChangeClass:function(a){if(2<a)return!1;var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.success||b.sqClass.isCompact!==c.sqClass.isCompact)return!1;if(b.isPointers()){if(!c.isPointers()||b.sqClass.classInstSize()!==c.sqClass.classInstSize())return!1}else{if(c.isPointers())return!1;var e=b.isBytes(),g=c.isBytes();if(e&&!g){if(b.bytes){if(b.bytes.length&3)return!1;b.words=new Uint32Array(b.bytes.buffer);delete b.bytes}}else!e&&g&&b.words&&(b.bytes=
new Uint8Array(b.words.buffer),delete b.words)}b._format=c._format;b.sqClass=c.sqClass;return this.popNIfOK(a)},primitiveAdoptInstance:function(a){if(2<a)return!1;var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.success||b.classInstFormat()!==c.sqClass.classInstFormat()||b.isCompact!==c.sqClass.isCompact||b.classInstSize()!==c.sqClass.classInstSize())return!1;c.sqClass=b;return this.popNIfOK(a)},primitiveDoPrimitiveWithArgs:function(a){a=this.stackNonInteger(0);var b=this.stackInteger(1);
if(!this.success)return!1;var c=a.pointersSize(),e=this.vm.activeContext.pointersSize();if(this.vm.sp+c>=e)return!1;this.vm.popN(2);for(e=0;e<c;e++)this.vm.push(a.pointers[e]);if(this.vm.tryPrimitive(b,c))return!0;this.vm.popN(c);this.vm.push(b);this.vm.push(a);return!1},primitiveShortAtAndPut:function(a){var b=this.stackNonInteger(a),c=this.stackInteger(a-1)-1;b=b.wordsAsInt16Array();if(!this.success||!b||0>c||c>=b.length)return!1;if(2>a)var e=b[c];else{e=this.stackInteger(0);if(-32768>e||32767<
e)return!1;b[c]=e}this.popNandPushIfOK(a+1,e);return!0},primitiveIntegerAtAndPut:function(a){var b=this.stackNonInteger(a),c=this.stackInteger(a-1)-1;b=b.wordsAsInt32Array();if(!this.success||!b||0>c||c>=b.length)return!1;if(2>a)var e=this.signed32BitIntegerFor(b[c]);else{e=this.stackSigned32BitInt(0);if(!this.success)return!1;b[c]=e}this.popNandPushIfOK(a+1,e);return!0},primitiveConstantFill:function(a){var b=this.stackNonInteger(1),c=this.stackPos32BitInt(0);if(!this.success||!b.isWordsOrBytes())return!1;
var e=b.words||b.bytes;if(e){if(e===b.bytes&&255<c)return!1;for(b=0;b<e.length;b++)e[b]=c}this.vm.popN(a);return!0},primitiveNewMethod:function(a){var b=this.stackInteger(0),c=this.stackInteger(1);if(!this.success)return 0;c=this.vm.instantiateClass(this.vm.stackValue(2),c);c.pointers=[b];b=c.methodNumLits();for(var e=0;e<b;e++)c.pointers.push(this.vm.nilObj);this.vm.popNandPush(1+a,c);this.vm.breakOnNewMethod&&(this.vm.breakOnMethod=c);return!0},primitiveExecuteMethodArgsArray:function(a){var b=
this.stackNonInteger(0),c=this.stackNonInteger(1),e=this.vm.stackValue(2);if(!this.success||!b.isMethod()||4<a)return!1;var g=b.methodNumArgs();if(g!==c.pointersSize())return!1;this.vm.popNandPush(a+1,e);for(a=0;a<g;a++)this.vm.push(c.pointers[a]);this.vm.executeNewMethod(e,b,g,b.methodPrimitiveIndex(),null,null);return!0},primitiveArrayBecome:function(a,b){var c=this.stackNonInteger(a),e=this.stackNonInteger(a-1),g=1<a?this.stackBoolean(a-2):!0;if(!this.success)return!1;this.success=this.vm.image.bulkBecome(c.pointers,
e.pointers,b,g);return this.popNIfOK(a)},doStringReplace:function(){var a=this.stackNonInteger(4),b=this.stackInteger(3)-1,c=this.stackInteger(2)-b,e=this.stackNonInteger(1),g=this.stackInteger(0)-1;if(!this.success)return a;if(!e.sameFormatAs(a))return this.success=!1,a;if(e.isPointers()){var h=e.pointersSize(),f=e.instSize();g+=f;if(0>g||g+c>h)return this.success=!1,a;h=a.pointersSize();f=a.instSize();b+=f;if(0>b||b+c>h)return this.success=!1,a;for(h=0;h<c;h++)a.pointers[b+h]=e.pointers[g+h]}else if(e.isWords()){h=
e.wordsSize();if(0>g||g+c>h)return this.success=!1,a;h=a.wordsSize();if(0>b||b+c>h)return this.success=!1,a;if(e.isFloat&&a.isFloat)a.float=e.float;else if(e.isFloat)a.wordsAsFloat64Array()[b]=e.float;else if(a.isFloat)a.float=e.wordsAsFloat64Array()[g];else for(h=0;h<c;h++)a.words[b+h]=e.words[g+h]}else{h=e.bytesSize();if(0>g||g+c>h)return this.success=!1,a;h=a.bytesSize();if(0>b||b+c>h)return this.success=!1,a;for(h=0;h<c;h++)a.bytes[b+h]=e.bytes[g+h]}return a},primitiveCopyObject:function(a){var b=
this.stackNonInteger(1),c=this.stackNonInteger(0),e=b.pointersSize();if(!this.success||b.isWordsOrBytes()||b.sqClass!==c.sqClass||e!==c.pointersSize())return!1;for(var g=0;g<e;g++)b.pointers[g]=c.pointers[g];b.dirty=c.dirty;this.vm.pop(a);return!0},primitiveLoadImageSegment:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0);return b.words&&c.pointers?(b=this.vm.image.loadImageSegment(b,c))?this.popNandPushIfOK(a+1,b):!1:!1}},"blocks/closures",{doBlockCopy:function(){var a=this.vm.stackValue(1),
b=this.stackInteger(0),c=a;this.vm.isContext(c)||(this.success=!1);if(!this.success)return a;"number"===typeof c.pointers[Squeak.Context_method]&&(c=c.pointers[Squeak.BlockContext_home]);a=c.pointersSize()-c.instSize();a=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassBlockContext],a);var e=this.vm.encodeSqueakPC(this.vm.pc+2,this.vm.method);a.pointers[Squeak.BlockContext_initialIP]=e;a.pointers[Squeak.Context_instructionPointer]=e;a.pointers[Squeak.Context_stackPointer]=0;a.pointers[Squeak.BlockContext_argumentCount]=
b;a.pointers[Squeak.BlockContext_home]=c;a.pointers[Squeak.Context_sender]=this.vm.nilObj;return a},primitiveBlockValue:function(a){var b=this.vm.stackValue(a);if(!this.isA(b,Squeak.splOb_ClassBlockContext))return!1;var c=b.pointers[Squeak.BlockContext_argumentCount];if("number"!==typeof c||c!=a||!b.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(this.vm.activeContext.pointers,this.vm.sp-a+1,b.pointers,Squeak.Context_tempFrameStart,a);b.pointers[Squeak.Context_instructionPointer]=
b.pointers[Squeak.BlockContext_initialIP];b.pointers[Squeak.Context_stackPointer]=a;b.pointers[Squeak.BlockContext_caller]=this.vm.activeContext;this.vm.popN(a+1);this.vm.newActiveContext(b);return!0},primitiveBlockValueWithArgs:function(a){var b=this.vm.stackValue(1),c=this.vm.stackValue(0);if(!this.isA(b,Squeak.splOb_ClassBlockContext)||!this.isA(c,Squeak.splOb_ClassArray))return!1;var e=b.pointers[Squeak.BlockContext_argumentCount];if("number"!==typeof e||e!=c.pointersSize()||!b.pointers[Squeak.BlockContext_caller].isNil)return!1;
this.vm.arrayCopy(c.pointers,0,b.pointers,Squeak.Context_tempFrameStart,e);b.pointers[Squeak.Context_instructionPointer]=b.pointers[Squeak.BlockContext_initialIP];b.pointers[Squeak.Context_stackPointer]=e;b.pointers[Squeak.BlockContext_caller]=this.vm.activeContext;this.vm.popN(a+1);this.vm.newActiveContext(b);return!0},primitiveClosureCopyWithCopiedValues:function(a){this.vm.breakNow("primitiveClosureCopyWithCopiedValues");debugger;return!1},primitiveClosureValue:function(a){var b=this.vm.stackValue(a);
return a!==b.pointers[Squeak.Closure_numArgs]?!1:this.activateNewClosureMethod(b,a)},primitiveClosureValueWithArgs:function(a){var b=this.vm.top(),c=b.pointersSize();a=this.vm.stackValue(a);if(c!==a.pointers[Squeak.Closure_numArgs])return!1;this.vm.pop();for(var e=0;e<c;e++)this.vm.push(b.pointers[e]);return this.activateNewClosureMethod(a,c)},primitiveClosureValueNoContextSwitch:function(a){return this.primitiveClosureValue(a)},activateNewClosureMethod:function(a,b){var c=a.pointers[Squeak.Closure_outerContext],
e=this.vm.allocateOrRecycleContext(c.pointers[Squeak.Context_method].methodNeedsLargeFrame()),g=a.pointers.length-Squeak.Closure_firstCopiedValue;e.pointers[Squeak.Context_sender]=this.vm.activeContext;e.pointers[Squeak.Context_instructionPointer]=a.pointers[Squeak.Closure_startpc];e.pointers[Squeak.Context_stackPointer]=b+g;e.pointers[Squeak.Context_method]=c.pointers[Squeak.Context_method];e.pointers[Squeak.Context_closure]=a;e.pointers[Squeak.Context_receiver]=c.pointers[Squeak.Context_receiver];
c=Squeak.Context_tempFrameStart;for(var h=0;h<b;h++)e.pointers[c++]=this.vm.stackValue(b-h-1);for(h=0;h<g;h++)e.pointers[c++]=a.pointers[Squeak.Closure_firstCopiedValue+h];this.vm.popN(b+1);this.vm.newActiveContext(e);return!0}},"scheduling",{primitiveResume:function(){this.resume(this.vm.top());return!0},primitiveSuspend:function(){var a=this.vm.top();if(a===this.activeProcess())this.vm.popNandPush(1,this.vm.nilObj),this.transferTo(this.wakeHighestPriority());else{var b=a.pointers[Squeak.Proc_myList];
if(b.isNil)return!1;this.removeProcessFromList(a,b);if(!this.success)return!1;a.pointers[Squeak.Proc_myList]=this.vm.nilObj;this.vm.popNandPush(1,b)}return!0},getScheduler:function(){return this.vm.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value]},activeProcess:function(){return this.getScheduler().pointers[Squeak.ProcSched_activeProcess]},resume:function(a){var b=this.activeProcess();a.pointers[Squeak.Proc_priority]>b.pointers[Squeak.Proc_priority]?(this.putToSleep(b),
this.transferTo(a)):this.putToSleep(a)},putToSleep:function(a){var b=a.pointers[Squeak.Proc_priority];b=this.getScheduler().pointers[Squeak.ProcSched_processLists].pointers[b-1];this.linkProcessToList(a,b)},transferTo:function(a){var b=this.getScheduler(),c=b.pointers[Squeak.ProcSched_activeProcess];b.pointers[Squeak.ProcSched_activeProcess]=a;b.dirty=!0;c.pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext;c.dirty=!0;this.vm.newActiveContext(a.pointers[Squeak.Proc_suspendedContext]);a.pointers[Squeak.Proc_suspendedContext]=
this.vm.nilObj;this.vm.reclaimableContextCount=0;this.vm.breakOnContextChanged&&(this.vm.breakOnContextChanged=!1,this.vm.breakNow())},wakeHighestPriority:function(){var a=this.getScheduler().pointers[Squeak.ProcSched_processLists],b=a.pointersSize()-1;do{if(0>b)throw Error("scheduler could not find a runnable process");var c=a.pointers[b--]}while(this.isEmptyList(c));return this.removeFirstLinkOfList(c)},linkProcessToList:function(a,b){if(this.isEmptyList(b))b.pointers[Squeak.LinkedList_firstLink]=
a;else{var c=b.pointers[Squeak.LinkedList_lastLink];c.pointers[Squeak.Link_nextLink]=a;c.dirty=!0}b.pointers[Squeak.LinkedList_lastLink]=a;b.dirty=!0;a.pointers[Squeak.Proc_myList]=b;a.dirty=!0},isEmptyList:function(a){return a.pointers[Squeak.LinkedList_firstLink].isNil},removeFirstLinkOfList:function(a){var b=a.pointers[Squeak.LinkedList_firstLink];b===a.pointers[Squeak.LinkedList_lastLink]?(a.pointers[Squeak.LinkedList_firstLink]=this.vm.nilObj,a.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj):
(a.pointers[Squeak.LinkedList_firstLink]=b.pointers[Squeak.Link_nextLink],a.dirty=!0);b.pointers[Squeak.Link_nextLink]=this.vm.nilObj;return b},removeProcessFromList:function(a,b){var c=b.pointers[Squeak.LinkedList_firstLink],e=b.pointers[Squeak.LinkedList_lastLink];if(a===c)c=a.pointers[Squeak.Link_nextLink],b.pointers[Squeak.LinkedList_firstLink]=c,a===e&&(b.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj);else{for(var g=c;;){if(g.isNil)return this.success=!1;c=g.pointers[Squeak.Link_nextLink];
if(c===a)break;g=c}c=a.pointers[Squeak.Link_nextLink];g.pointers[Squeak.Link_nextLink]=c;a===e&&(b.pointers[Squeak.LinkedList_lastLink]=g)}a.pointers[Squeak.Link_nextLink]=this.vm.nilObj},registerSemaphore:function(a){var b=this.vm.top();this.isA(b,Squeak.splOb_ClassSemaphore)?this.vm.specialObjects[a]=b:this.vm.specialObjects[a]=this.vm.nilObj;return this.vm.stackValue(1)},primitiveWait:function(){var a=this.vm.top();if(!this.isA(a,Squeak.splOb_ClassSemaphore))return!1;var b=a.pointers[Squeak.Semaphore_excessSignals];
0<b?a.pointers[Squeak.Semaphore_excessSignals]=b-1:(this.linkProcessToList(this.activeProcess(),a),this.transferTo(this.wakeHighestPriority()));return!0},primitiveSignal:function(){var a=this.vm.top();if(!this.isA(a,Squeak.splOb_ClassSemaphore))return!1;this.synchronousSignal(a);return!0},synchronousSignal:function(a){this.isEmptyList(a)?a.pointers[Squeak.Semaphore_excessSignals]++:this.resume(this.removeFirstLinkOfList(a))},signalAtMilliseconds:function(a,b){this.isA(a,Squeak.splOb_ClassSemaphore)?
(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=a,this.vm.nextWakeupTick=b):(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=this.vm.nilObj,this.vm.nextWakeupTick=0)},primitiveSignalAtMilliseconds:function(a){var b=this.stackInteger(0),c=this.stackNonInteger(1);if(!this.success)return!1;this.signalAtMilliseconds(c,b);this.vm.popN(a);return!0},primitiveSignalAtUTCMicroseconds:function(a){var b=this.stackSigned53BitInt(0),c=this.stackNonInteger(1);if(!this.success)return!1;this.signalAtMilliseconds(c,
b/1E3+Squeak.EpochUTC-this.vm.startupTime&Squeak.MillisecondClockMask);this.vm.popN(a);return!0},signalSemaphoreWithIndex:function(a){this.semaphoresToSignal.push(a)},signalExternalSemaphores:function(){for(var a=this.vm.specialObjects[Squeak.splOb_ExternalObjectsArray].pointers,b=this.vm.specialObjects[Squeak.splOb_ClassSemaphore];this.semaphoresToSignal.length;){var c=this.semaphoresToSignal.shift();c=a[c-1];c.sqClass==b&&this.synchronousSignal(c)}},primitiveEnterCriticalSection:function(a){if(1<
a)return!1;var b=this.vm.stackValue(a),c=a?this.vm.top():this.activeProcess(),e=b.pointers[Squeak.Mutex_owner];e.isNil?(b.pointers[Squeak.Mutex_owner]=c,b.dirty=!0,this.popNandPushIfOK(a+1,this.vm.falseObj)):e===c?this.popNandPushIfOK(a+1,this.vm.trueObj):(this.popNandPushIfOK(a+1,this.vm.falseObj),this.linkProcessToList(c,b),this.transferTo(this.wakeHighestPriority()));return!0},primitiveExitCriticalSection:function(a){a=this.vm.top();if(this.isEmptyList(a))a.pointers[Squeak.Mutex_owner]=this.vm.nilObj;
else{var b=this.removeFirstLinkOfList(a);a.pointers[Squeak.Mutex_owner]=b;a.dirty=!0;this.resume(b)}return!0},primitiveTestAndSetOwnershipOfCriticalSection:function(a){if(1<a)return!1;var b=this.vm.stackValue(a),c=a?this.vm.top():this.activeProcess(),e=b.pointers[Squeak.Mutex_owner];e.isNil?(b.pointers[Squeak.Mutex_owner]=c,b.dirty=!0,this.popNandPushIfOK(a+1,this.vm.falseObj)):e===c?this.popNandPushIfOK(a+1,this.vm.trueObj):this.popNandPushIfOK(a+1,this.vm.nilObj);return!0}},"vm functions",{primitiveGetAttribute:function(a){var b=
this.stackInteger(0);if(!this.success)return!1;var c=this.display.argv;switch(b){case 0:b=c&&c[0]||this.filenameToSqueak(Squeak.vmPath+Squeak.vmFile);break;case 1:b=c&&c[1]||this.display.documentName;break;case 2:b=c&&c[2]||this.display.documentName;break;case 1001:b=Squeak.platformName;break;case 1002:b=Squeak.osVersion;break;case 1003:b=Squeak.platformSubtype;break;case 1004:b=Squeak.vmVersion;break;case 1005:b=Squeak.windowSystem;break;case 1006:b=Squeak.vmBuild;break;case 1007:b=Squeak.vmVersion;
break;case 1009:b=Squeak.vmVersion+" Date: "+Squeak.vmDate;break;default:if(c&&c.length>b)b=c[b];else return!1}this.vm.popNandPush(a+1,this.makeStObject(b));return!0},setLowSpaceThreshold:function(){var a=this.stackInteger(0);this.success&&(this.vm.lowSpaceThreshold=a);return this.vm.stackValue(1)},primitiveVMParameter:function(a){var b=this.vm.image.isSpur?54:44;switch(a){case 0:a=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],b);for(var c=0;c<b;c++)a.pointers[c]=this.makeStObject(this.vmParameterAt(c+
1));return this.popNandPushIfOK(1,a);case 1:return a=this.stackInteger(0),1>a||a>b?!1:this.popNandPushIfOK(2,this.makeStObject(this.vmParameterAt(a)));case 2:return this.popNandPushIfOK(3,0)}return!1},vmParameterAt:function(a){switch(a){case 1:return this.vm.image.oldSpaceBytes;case 2:return this.vm.image.oldSpaceBytes;case 3:return this.vm.image.totalMemory;case 4:return this.vm.image.allocationCount+this.vm.image.newSpaceCount;case 7:return this.vm.image.gcCount;case 8:return this.vm.image.gcMilliseconds;
case 9:return this.vm.image.pgcCount;case 10:return this.vm.image.pgcMilliseconds;case 11:return this.vm.image.gcTenured;case 15:case 16:case 17:return 0;case 22:return 0;case 23:return this.vm.image.extraVMMemory;case 40:return 4;case 41:return this.vm.image.formatVersion();case 44:return 0;case 48:return 0;case 54:return this.vm.image.bytesLeft()}return null},primitiveImageName:function(a){if(0==a)return this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(this.vm.image.name)));this.vm.image.name=
this.filenameFromSqueak(this.vm.top().bytesAsString());window.localStorage.squeakImageName=this.vm.image.name;return!0},primitiveSnapshot:function(a){this.vm.popNandPush(1,this.vm.trueObj);this.vm.storeContextRegisters();this.activeProcess().pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext;this.vm.image.fullGC("snapshot");a=this.vm.image.writeToBuffer();Squeak.flushAllFiles();Squeak.filePut(this.vm.image.name,a);this.vm.popNandPush(1,this.vm.falseObj);return!0},primitiveQuit:function(a){Squeak.flushAllFiles();
this.display.quitFlag=!0;this.vm.breakNow("quit");return!0},primitiveExitToDebugger:function(a){this.vm.breakNow("debugger primitive");debugger;return!0},primitiveSetGCBiasToGrow:function(a){return this.fakePrimitive(".primitiveSetGCBiasToGrow",0,a)},primitiveSetGCBiasToGrowGCLimit:function(a){return this.fakePrimitive(".primitiveSetGCBiasToGrowGCLimit",0,a)}},"display",{primitiveBeCursor:function(a){if(this.display.cursorCanvas){var b=this.loadForm(this.stackNonInteger(a),!0),c=1===a?this.loadForm(this.stackNonInteger(0)):
null;if(!this.success||!b)return!1;var e=this.display.cursorCanvas,g=e.getContext("2d"),h={left:0,top:0,right:b.width,bottom:b.height};e.width=b.width;e.height=b.height;1===b.depth?c?(b=this.cursorMergeMask(b,c),this.showForm(g,b,h,[0,4278190335,4294967295,4278190080])):this.showForm(g,b,h,[0,4278190080]):this.showForm(g,b,h,!0);c=this.display.context.canvas;c=c.offsetWidth/c.width;e.style.width=(e.width*c|0)+"px";e.style.height=(e.height*c|0)+"px";this.display.cursorOffsetX=b.offsetX*c|0;this.display.cursorOffsetY=
b.offsetY*c|0}this.vm.popN(a);return!0},cursorMergeMask:function(a,b){for(var c=new Uint32Array(16),e=0;16>e;e++){for(var g=a.bits[e],h=b.bits[e],f=2147483648,d=0,n=0;16>n;n++)d=d|(h&f)>>n|(g&f)>>n+1,f>>>=1;c[e]=d}return{obj:a.obj,bits:c,depth:2,width:16,height:16,offsetX:a.offsetX,offsetY:a.offsetY,msb:!0,pixPerWord:16,pitch:1}},primitiveBeDisplay:function(a){var b=this.vm.stackValue(0);this.vm.specialObjects[Squeak.splOb_TheDisplay]=b;this.vm.popN(a);return!0},primitiveReverseDisplay:function(a){this.reverseDisplay=
!this.reverseDisplay;this.redrawDisplay();if(this.display.cursorCanvas){var b=this.display.cursorCanvas;a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=new Uint32Array(b.data.buffer),e=0;e<c.length;e++)c[e]^=16777215;a.putImageData(b,0,0)}return!0},primitiveShowDisplayRect:function(a){var b={left:this.stackInteger(3),top:this.stackInteger(1),right:this.stackInteger(2),bottom:this.stackInteger(0)};if(!this.success)return!1;this.redrawDisplay(b);this.vm.popN(a);return!0},redrawDisplay:function(a){var b=
this.theDisplay(),c={left:0,top:0,right:b.width,bottom:b.height};a&&(a.left>c.left&&(c.left=a.left),a.right<c.right&&(c.right=a.right),a.top>c.top&&(c.top=a.top),a.bottom<c.bottom&&(c.bottom=a.bottom));c.left<c.right&&c.top<c.bottom&&this.displayUpdate(b,c)},showForm:function(a,b,c,e){if(c){var g=c.left,h=c.top,f=c.right-g,d=c.bottom-h,n=a.createImageData(f,d),k=n.data;k.buffer||(k=new Uint8Array(f*d*4));var l=new Uint32Array(k.buffer);switch(b.depth){case 1:case 2:case 4:case 8:var w=e||this.swappedColors;
if(!w){w=[];for(var t=0;256>t;t++){var p=this.indexedColors[t];p=(p&4278255360)+((p&16711680)>>16)+((p&255)<<16);w[t]=p}this.swappedColors=w}this.reverseDisplay&&(e?w=e.map(function(a){return a^16777215}):(this.reversedColors||(this.reversedColors=w.map(function(a){return a^16777215})),w=this.reversedColors));var m=(1<<b.depth)-1;p=32-(g%b.pixPerWord+1)*b.depth;for(e=0;e<d;e++){t=b.pitch*h+(g/b.pixPerWord|0);for(var x=p,q=b.bits[t],u=n.width*e,A=0;A<f;A++)l[u++]=w[q>>>x&m],0>(x-=b.depth)&&(x=32-b.depth,
q=b.bits[++t]);h++}break;case 16:p=g%2?0:16;for(e=0;e<d;e++){t=b.pitch*h+(g/2|0);x=p;q=b.bits[t];u=n.width*e;for(A=0;A<f;A++)w=q>>>x,l[u++]=((w&31744)>>7)+((w&992)<<6)+((w&31)<<19)+4278190080,0>(x-=16)&&(x=16,q=b.bits[++t]);h++}break;case 32:w=e?0:4278190080;for(e=0;e<d;e++){t=b.pitch*h+g;u=n.width*e;for(A=0;A<f;A++)p=b.bits[t++],p=p&4278255360|(p&16711680)>>16|(p&255)<<16|w,l[u++]=p;h++}break;default:throw Error("depth not implemented");}n.data!==k&&n.data.set(k);a.putImageData(n,c.left,c.top)}},
primitiveDeferDisplayUpdates:function(a){var b=this.stackBoolean(0);if(!this.success)return!1;this.deferDisplayUpdates=b;this.vm.popN(a);return!0},primitiveForceDisplayUpdate:function(a){this.vm.breakOut();this.vm.popN(a);return!0},primitiveScreenSize:function(a){var b=this.display;return this.popNandPushIfOK(a+1,this.makePointWithXandY(b.width||b.context.canvas.width,b.height||b.context.canvas.height))},primitiveSetFullScreen:function(a){var b=this.stackBoolean(0);if(!this.success)return!1;if(this.display.fullscreen!=
b)if(this.display.fullscreenRequest){var c=this.vm.freeze();this.display.fullscreenRequest(b,function(){c()})}else this.display.fullscreen=b,this.vm.breakOut();this.vm.popN(a);return!0},primitiveTestDisplayDepth:function(a){return this.pop2andPushBoolIfOK(0<=[1,2,4,8,16,32].indexOf(this.stackInteger(0)))},loadForm:function(a,b){if(a.isNil)return null;var c={obj:a,bits:a.pointers[Squeak.Form_bits].wordsOrBytes(),depth:a.pointers[Squeak.Form_depth],width:a.pointers[Squeak.Form_width],height:a.pointers[Squeak.Form_height]};
b&&(a=a.pointers[Squeak.Form_offset],c.offsetX=a.pointers?a.pointers[Squeak.Point_x]:0,c.offsetY=a.pointers?a.pointers[Squeak.Point_y]:0);if(0===c.width||0===c.height)return c;if(!(0<c.width&&0<c.height))return null;c.msb=0<c.depth;c.msb||(c.depth=-c.depth);if(!(0<c.depth))return null;c.pixPerWord=32/c.depth;c.pitch=(c.width+(c.pixPerWord-1))/c.pixPerWord|0;return c.bits.length!==c.pitch*c.height?null:c},theDisplay:function(){return this.loadForm(this.vm.specialObjects[Squeak.splOb_TheDisplay])},
displayDirty:function(a,b){this.deferDisplayUpdates||a!=this.vm.specialObjects[Squeak.splOb_TheDisplay]||this.displayUpdate(this.theDisplay(),b)},displayUpdate:function(a,b){this.showForm(this.display.context,a,b);this.display.lastTick=this.vm.lastTick;this.display.idle=0},primitiveBeep:function(a){var b=Squeak.startAudioOut();if(b){var c=b.createOscillator();c.connect(b.destination);c.type="square";c.frequency.value=880;c.start();c.stop(b.currentTime+.2)}else this.vm.warnOnce("could not initialize audio");
return this.popNIfOK(a)}},"input",{primitiveClipboardText:function(a){if(0===a){if("string"!==typeof this.display.clipboardString)return!1;this.vm.popNandPush(1,this.makeStString(this.display.clipboardString))}else 1===a&&(a=this.vm.top(),a.bytes&&(this.display.clipboardString=a.bytesAsString(),this.display.clipboardStringChanged=!0),this.vm.pop());return!0},primitiveKeyboardNext:function(a){return this.popNandPushIfOK(a+1,this.ensureSmallInt(this.display.keys.shift()))},primitiveKeyboardPeek:function(a){return this.popNandPushIfOK(a+
1,this.display.keys.length?this.ensureSmallInt(this.display.keys[0]||0):this.vm.nilObj)},primitiveMouseButtons:function(a){this.popNandPushIfOK(a+1,this.ensureSmallInt(this.display.buttons));this.vm.breakOut();20<this.display.idle++&&this.vm.goIdle();return!0},primitiveMousePoint:function(a){var b=this.ensureSmallInt(this.display.mouseX),c=this.ensureSmallInt(this.display.mouseY);return this.popNandPushIfOK(a+1,this.makePointWithXandY(b,c))},primitiveInputSemaphore:function(a){a=this.stackInteger(0);
if(!this.success)return!1;this.inputEventSemaIndex=a;this.display.signalInputEvent=function(){this.signalSemaphoreWithIndex(this.inputEventSemaIndex)}.bind(this);this.display.signalInputEvent();return!0},primitiveInputWord:function(a){return this.popNandPushIfOK(1,0)},primitiveGetNextEvent:function(a){this.display.idle++;a=this.stackNonInteger(0);if(!this.display.getNextEvent)return!1;this.display.getNextEvent(a.pointers,this.vm.startupTime);return!0}},"time",{primitiveRelinquishProcessorForMicroseconds:function(a){this.vm.pop(a);
this.vm.goIdle();return!0},millisecondClockValue:function(){return Date.now()-this.vm.startupTime&Squeak.MillisecondClockMask},millisecondClockValueSet:function(a){this.vm.startupTime=Date.now()-a},secondClock:function(){return this.pos32BitIntFor(Squeak.totalSeconds())},microsecondClock:function(a){var b=Date.now()-a.epoch;if("object"!==typeof performance)return this.pos53BitIntFor(1E3*b);var c=1E3*performance.now()%1E3|0,e=a.millis,g=a.micros;e>b&&(b=e);b===e&&c<g&&b++;a.millis=b;a.micros=c;return this.pos53BitIntFor(1E3*
b+c)},microsecondClockUTC:function(){this.microsecondClockUTCState||(this.microsecondClockUTCState={epoch:Squeak.EpochUTC,millis:0,micros:0});return this.microsecondClock(this.microsecondClockUTCState)},microsecondClockLocal:function(){this.microsecondClockLocalState||(this.microsecondClockLocalState={epoch:Squeak.Epoch,millis:0,micros:0});return this.microsecondClock(this.microsecondClockLocalState)},primitiveUtcWithOffset:function(a){var b=new Date,c=this.pos53BitIntFor(1E3*b.getTime());b=-60*b.getTimezoneOffset();
if(0<a){var e=this.vm.stackValue(0);e.pointers[0]=c;e.pointers[1]=b;this.popNandPushIfOK(a+1,e);return!0}this.popNandPushIfOK(a+1,this.makeStArray([c,b]));return!0}},"FilePlugin",{primitiveDirectoryCreate:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());this.success=Squeak.dirCreate(b);this.success||(b=Squeak.splitFilePath(b),console.log("Directory not created: "+b.fullname));return this.popNIfOK(a)},primitiveDirectoryDelete:function(a){var b=
this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());this.success=Squeak.dirDelete(b);return this.popNIfOK(a)},primitiveDirectoryDelimitor:function(a){return this.popNandPushIfOK(1,this.charFromInt((this.emulateMac?":":"/").charCodeAt(0)))},primitiveDirectoryEntry:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.success)return!1;c.bytesAsString();c=this.filenameFromSqueak(c.bytesAsString());b.bytesAsString();b=this.filenameFromSqueak(b.bytesAsString());
var e=Squeak.dirList(b,!0);if(!e)return a=Squeak.splitFilePath(b),console.log("Directory not found: "+a.fullname),!1;this.popNandPushIfOK(a+1,this.makeStObject(e[c]));return!0},primitiveDirectoryLookup:function(a){var b=this.stackInteger(0),c=this.stackNonInteger(1);if(!this.success)return!1;c=c.bytesAsString();var e=this.filenameFromSqueak(c),g=Squeak.dirList(e,!0);if(!g)return a=Squeak.splitFilePath(e),console.log("Directory not found: "+a.fullname),!1;e=Object.keys(g).sort();g=g[e[b-1]];"/"===
c&&(1===b?(g||(g=[0,0,0,0,0]),g[0]="SqueakJS",g[3]=!0):g=null);this.popNandPushIfOK(a+1,this.makeStObject(g));return!0},primitiveDirectorySetMacTypeAndCreator:function(a){return this.popNIfOK(a)},primitiveFileAtEnd:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;this.popNandPushIfOK(a+1,this.makeStObject(b.filePos>=b.file.size));return!0},primitiveFileClose:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;"string"===typeof b.file?this.fileConsoleFlush(b.file):
(this.fileClose(b.file),this.vm.breakOut(),b.file=null);return this.popNIfOK(a)},primitiveFileDelete:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());this.success=Squeak.fileDelete(b);return this.popNIfOK(a)},primitiveFileFlush:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;"string"===typeof b.file?this.fileConsoleFlush(b.file):(Squeak.flushFile(b.file),this.vm.breakOut());return this.popNIfOK(a)},primitiveFileGetPosition:function(a){var b=
this.stackNonInteger(0);if(!this.success||!b.file)return!1;this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b.filePos));return!0},makeFileHandle:function(a,b,c){a=this.makeStString("squeakjs:"+a);a.file=b;a.fileWrite=c;a.filePos=0;return a},primitiveFileOpen:function(a){var b=this.stackBoolean(0),c=this.stackNonInteger(1);if(!this.success)return!1;c=this.filenameFromSqueak(c.bytesAsString());c=this.fileOpen(c,b);if(!c)return!1;b=this.makeFileHandle(c.name,c,b);this.popNandPushIfOK(a+1,b);return!0},
primitiveFileRead:function(a){var b=this.stackInteger(0),c=this.stackInteger(1)-1,e=this.stackNonInteger(2),g=this.stackNonInteger(3);return this.success&&g.file?b?e.bytes?0>c||c+b>e.bytes.length?!1:"string"===typeof g.file?(this.popNandPushIfOK(a+1,0),!0):this.fileContentsDo(g.file,function(h){if(!h.contents)return this.popNandPushIfOK(a+1,0);var f=h.contents,d=e.bytes;b=Math.min(b,h.size-g.filePos);for(h=0;h<b;h++)d[c+h]=f[g.filePos++];this.popNandPushIfOK(a+1,b)}.bind(this)):(console.log("File reading into non-bytes object not implemented yet"),
!1):this.popNandPushIfOK(a+1,0):!1},primitiveFileRename:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());c=this.filenameFromSqueak(c.bytesAsString());this.success=Squeak.fileRename(b,c);this.vm.breakOut();return this.popNIfOK(a)},primitiveFileSetPosition:function(a){var b=this.stackPos32BitInt(0),c=this.stackNonInteger(1);if(!this.success||!c.file)return!1;c.filePos=b;return this.popNIfOK(a)},primitiveFileSize:function(a){var b=
this.stackNonInteger(0);if(!this.success||!b.file)return!1;this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b.file.size));return!0},primitiveFileStdioHandles:function(a){var b=[null,this.makeFileHandle("console.log","log",!0),this.makeFileHandle("console.error","error",!0)];this.popNandPushIfOK(a+1,this.makeStArray(b));return!0},primitiveFileTruncate:function(a){var b=this.stackPos32BitInt(0),c=this.stackNonInteger(1);if(!this.success||!c.file||!c.fileWrite)return!1;c.file.size>b&&(c.file.size=b,c.file.modified=
!0,c.filePos>c.file.size&&(c.filePos=c.file.size));return this.popNIfOK(a)},primitiveDisableFileAccess:function(a){return this.fakePrimitive("FilePlugin.primitiveDisableFileAccess",0,a)},primitiveFileWrite:function(a){var b=this.stackInteger(0),c=this.stackInteger(1)-1,e=this.stackNonInteger(2),g=this.stackNonInteger(3);if(!this.success||!g.file||!g.fileWrite)return!1;if(!b)return this.popNandPushIfOK(a+1,0);var h=e.bytes||e.wordsAsUint8Array();return!h||0>c||c+b>h.length?!1:"string"===typeof g.file?
(this.fileConsoleWrite(g.file,h,c,b),this.popNandPushIfOK(a+1,b),!0):this.fileContentsDo(g.file,function(e){var d=e.contents||[];g.filePos+b>d.length&&(e.contents=new Uint8Array(0===d.length?g.filePos+b:Math.max(g.filePos+b,d.length+1E4)),e.contents.set(d),d=e.contents);for(var f=0;f<b;f++)d[g.filePos++]=h[c+f];g.filePos>e.size&&(e.size=g.filePos);e.modified=!0;this.popNandPushIfOK(a+1,b)}.bind(this))},fileOpen:function(a,b){"undefined"==typeof SqueakFiles&&(window.SqueakFiles={});a=Squeak.splitFilePath(a);
if(!a.basename)return null;var c=Squeak.dirList(a.dirname,!0);if(!c)return null;c=c[a.basename];var e=null;if(c){if(b=SqueakFiles[a.fullname])return++b.refCount,b}else{if(!b)return console.log("File not found: "+a.fullname),null;e=new Uint8Array;c=Squeak.filePut(a.fullname,e.buffer);if(!c)return console.log("Cannot create file: "+a.fullname),null}b={name:a.fullname,size:c[4],contents:e,modified:!1,refCount:1};return SqueakFiles[b.name]=b},fileClose:function(a){Squeak.flushFile(a);0==--a.refCount&&
delete SqueakFiles[a.name]},fileContentsDo:function(a,b){if(a.contents)b(a);else{if(!1===a.contents)return!1;this.vm.freeze(function(c){Squeak.fileGet(a.name,function(e){if(null==e)return error(a.name);a.contents=this.asUint8Array(e);c();b(a)}.bind(this),function(e){console.log("File get failed: "+e);a.contents=!1;c();b(a)}.bind(this))}.bind(this))}return!0},fileConsoleBuffer:{log:"",error:""},fileConsoleWrite:function(a,b,c,e){b=b.subarray(c,c+e);b=this.fileConsoleBuffer[a]+Squeak.bytesAsString(b);
if(c=b.match("([^]*)\n(.*)"))console[a](c[1]),b=c[2];this.fileConsoleBuffer[a]=b},fileConsoleFlush:function(a){var b=this.fileConsoleBuffer[a];b&&(console[a](b),this.fileConsoleBuffer[a]="")}},"DropPlugin",{primitiveDropRequestFileHandle:function(a){var b=this.stackInteger(0),c=this.display.droppedFiles||[];if(1>b||b>c.length)return!1;b=c[b-1];c=this.fileOpen(b,!1);if(!c)return!1;b=this.makeFileHandle(b,c,!1);this.popNandPushIfOK(a+1,b);return!0},primitiveDropRequestFileName:function(a){var b=this.stackInteger(0),
c=this.display.droppedFiles||[];if(1>b||b>c.length)return!1;b=this.makeStString(this.filenameToSqueak(c[b-1]));return this.popNandPushIfOK(a+1,b)}},"SoundPlugin",{snd_primitiveSoundStart:function(a){return this.snd_primitiveSoundStartWithSemaphore(a)},snd_primitiveSoundStartWithSemaphore:function(a){var b=this.stackInteger(a-1),c=this.stackInteger(a-2),e=this.stackBoolean(a-3),g=3<a?this.stackInteger(a-4):0;if(!this.success)return!1;this.audioContext=Squeak.startAudioOut();if(!this.audioContext)return this.vm.warnOnce("could not initialize audio"),
!1;this.audioSema=g;this.audioNextTimeSlot=0;this.audioBuffersReady=[];this.audioBuffersUnused=[this.audioContext.createBuffer(e?2:1,b,c),this.audioContext.createBuffer(e?2:1,b,c)];console.log("sound: started");return this.popNIfOK(a)},snd_playNextBuffer:function(){if(this.audioContext&&0!==this.audioBuffersReady.length){var a=this.audioContext.createBufferSource();a.buffer=this.audioBuffersReady.shift();a.connect(this.audioContext.destination);this.audioNextTimeSlot<this.audioContext.currentTime&&
(0<this.audioNextTimeSlot&&console.warn("sound "+this.audioContext.currentTime.toFixed(3)+": buffer underrun by "+(this.audioContext.currentTime-this.audioNextTimeSlot).toFixed(3)+" s"),this.audioNextTimeSlot=this.audioContext.currentTime);a.start(this.audioNextTimeSlot);this.audioNextTimeSlot+=a.buffer.duration;window.setTimeout(function(){this.audioContext&&(this.audioBuffersUnused.push(a.buffer),this.audioSema&&this.signalSemaphoreWithIndex(this.audioSema),this.vm.forceInterruptCheck())}.bind(this),
1E3*(this.audioNextTimeSlot-this.audioContext.currentTime));this.snd_playNextBuffer()}},snd_primitiveSoundAvailableSpace:function(a){if(!this.audioContext)return console.log("sound: no audio context"),!1;var b=0;0<this.audioBuffersUnused.length&&(b=this.audioBuffersUnused[0],b=b.length*b.numberOfChannels*2);return this.popNandPushIfOK(a+1,b)},snd_primitiveSoundPlaySamples:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;
var b=this.stackInteger(2),c=this.stackNonInteger(1).wordsAsInt16Array(),e=this.stackInteger(0)-1;if(!this.success||!c)return!1;for(var g=this.audioBuffersUnused.shift(),h=g.numberOfChannels,f=0;f<h;f++)for(var d=g.getChannelData(f),n=e+f,k=0;k<b;k++)d[k]=c[n]/32768,n+=h;this.audioBuffersReady.push(g);this.snd_playNextBuffer();return this.popNIfOK(a)},snd_primitiveSoundPlaySilence:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),
!1;for(var b=this.audioBuffersUnused.shift(),c=b.numberOfChannels,e=b.length,g=0;g<c;g++)for(var h=b.getChannelData(g),f=0;f<e;f++)h[f]=0;this.audioBuffersReady.push(b);this.snd_playNextBuffer();return this.popNandPushIfOK(a+1,e)},snd_primitiveSoundStop:function(a){this.audioContext&&(this.audioBuffersUnused=this.audioBuffersReady=this.audioContext=null,this.audioSema=this.audioNextTimeSlot=0,console.log("sound: stopped"));return this.popNIfOK(a)},snd_primitiveSoundStartRecording:function(a){if(3!==
a)return!1;var b=this.stackNonInteger(3),c=this.stackInteger(2),e=this.stackBoolean(1),g=this.stackInteger(0);if(!this.success)return!1;var h=this.primMethod,f=this.vm.freeze(),d=this;Squeak.startAudioIn(function(b,h){console.log("sound: recording started");d.audioInContext=b;d.audioInSource=h;d.audioInSema=g;d.audioInBuffers=[];d.audioInBufferIndex=0;for(d.audioInOverSample=1;c*d.audioInOverSample<d.audioInContext.sampleRate;)d.audioInOverSample*=2;for(h=1024*d.audioInOverSample;.1>h/d.audioInContext.sampleRate;)h*=
2;d.audioInProcessor=b.createScriptProcessor(h,e?2:1,e?2:1);d.audioInProcessor.onaudioprocess=function(a){d.snd_recordNextBuffer(a.inputBuffer)};d.audioInSource.connect(d.audioInProcessor);d.audioInProcessor.connect(b.destination);d.vm.popN(a);window.setTimeout(f,0)},function(c){console.warn(c);d.vm.sendAsPrimitiveFailure(b,h,a);window.setTimeout(f,0)});return!0},snd_recordNextBuffer:function(a){this.audioInContext&&(5<this.audioInBuffers.length&&this.audioInBuffers.shift(),this.audioInBuffers.push(a),
this.audioInSema&&this.signalSemaphoreWithIndex(this.audioInSema),this.vm.forceInterruptCheck())},snd_primitiveSoundGetRecordingSampleRate:function(a){if(!this.audioInContext)return!1;var b=this.audioInContext.sampleRate/this.audioInOverSample|0;console.log("sound: actual recording rate "+b+"x"+this.audioInOverSample);return this.popNandPushIfOK(a+1,b)},snd_primitiveSoundRecordSamples:function(a){var b=this.stackNonInteger(1).wordsAsInt16Array(),c=this.stackInteger(0)-1;if(!this.success)return!1;
for(var e=0;c<b.length&&0!==this.audioInBuffers.length;){for(var g=this.audioInBuffers[0],h=g.numberOfChannels,f=h,d=this.audioInOverSample,l=Math.min((g.length-this.audioInBufferIndex)/d,(b.length-c)/f),k=0;k<h;k++)for(var y=g.getChannelData(k),w=this.audioInBufferIndex,t=c+k,p=0;p<l;p++)b[t]=32768*y[w]&65535,t+=f,w+=d;e+=l*h;c+=l*h;w<g.length?this.audioInBufferIndex=w:(this.audioInBufferIndex=0,this.audioInBuffers.shift())}return this.popNandPushIfOK(a+1,e)},snd_primitiveSoundStopRecording:function(a){this.audioInContext&&
(this.audioInSource.disconnect(),this.audioInProcessor.disconnect(),this.audioInContext=null,this.audioInSema=0,this.audioInProcessor=this.audioInSource=this.audioInBuffers=null,console.log("sound recording stopped"));return!0},snd_primitiveSoundSetRecordLevel:function(a){return!0}},"JPEGReadWriter2Plugin",{jpeg2_primJPEGPluginIsPresent:function(a){return this.popNandPushIfOK(a+1,this.vm.trueObj)},jpeg2_primImageHeight:function(a){var b=this.stackNonInteger(0).wordsOrBytes();return b?this.popNandPushIfOK(a+
1,b[1]):!1},jpeg2_primImageWidth:function(a){var b=this.stackNonInteger(0).wordsOrBytes();return b?this.popNandPushIfOK(a+1,b[0]):!1},jpeg2_primJPEGCompressStructSize:function(a){return this.popNandPushIfOK(a+1,0)},jpeg2_primJPEGDecompressStructSize:function(a){return this.popNandPushIfOK(a+1,8)},jpeg2_primJPEGErrorMgr2StructSize:function(a){return this.popNandPushIfOK(a+1,0)},jpeg2_primJPEGReadHeaderfromByteArrayerrorMgr:function(a){var b=this.stackNonInteger(2).wordsOrBytes(),c=this.stackNonInteger(1).bytes;
if(!b||!c)return!1;var e=this.vm.freeze();this.jpeg2_readImageFromBytes(c,function(a){this.jpeg2state={src:c,img:a};b[0]=a.width;b[1]=a.height;e()}.bind(this),function(){b[0]=0;b[1]=0;e()}.bind(this));return this.popNIfOK(a)},jpeg2_primJPEGReadImagefromByteArrayonFormdoDitheringerrorMgr:function(a){var b=this.stackNonInteger(3).bytes,c=this.stackNonInteger(2).pointers,e=this.stackBoolean(1);if(!this.success||!b||!c)return!1;var g=this.jpeg2state;if(!g||g.src!==b)return console.error("jpeg read did not match header info"),
!1;b=c[Squeak.Form_depth];g=this.jpeg2_getPixelsFromImage(g.img);c=c[Squeak.Form_bits].words;if(32===b)this.jpeg2_copyPixelsToForm32(g,c);else if(16===b)e?this.jpeg2_ditherPixelsToForm16(g,c):this.jpeg2_copyPixelsToForm16(g,c);else return!1;return this.popNIfOK(a)},jpeg2_primJPEGWriteImageonByteArrayformqualityprogressiveJPEGerrorMgr:function(a){this.vm.warnOnce("JPEGReadWritePlugin2: writing not implemented yet");return!1},jpeg2_readImageFromBytes:function(a,b,c){a=new Blob([a],{type:"image/jpeg"});
var e=new Image;e.onload=function(){b(e)};e.onerror=function(){console.warn("could not render JPEG");c()};e.src=(window.URL||window.webkitURL).createObjectURL(a)},jpeg2_getPixelsFromImage:function(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return c.getImageData(0,0,a.width,a.height)},jpeg2_copyPixelsToForm32:function(a,b){a=a.data;for(var c=0;c<b.length;c++)b[c]=4278190080|a[4*c+0]<<16|a[4*c+1]<<8|a[4*c+2]},jpeg2_copyPixelsToForm16:function(a,
b){var c=a.width,e=a.height;a=a.data;for(var g=0;g<e;g++)for(var h=0;h<c;h+=2){var f=g*e+h,d=a[4*f+4]>>3,l=a[4*f+5]>>3,k=a[4*f+6]>>3,y=a[4*f+0]>>3<<10|a[4*f+1]>>3<<5|a[4*f+2]>>3;0===y&&(y=1);y=y<<16|d<<10|l<<5|k;0===(y&65535)&&(y|=1);b[f>>1]=y}},jpeg2_ditherPixelsToForm16:function(a,b){var c=a.width>>1,e=a.height;a=a.data;for(var g=[2,0,14,12,1,3,13,15],h=[10,8,6,4,9,11,5,7],f=0;f<e;f++)for(var d=0;d<c;d++){var l=f*e+2*d<<2,k=a[l+0],y=a[l+1],w=a[l+2],t=a[l+4],p=a[l+5],m=a[l+6],x=(f&3)<<1|d&1,q=g[x];
x=h[x];var u=496*k>>8;var A=u&15;u>>=4;k=q<A?u+1:u;u=496*y>>8;A=u&15;u>>=4;y=q<A?u+1:u;u=496*w>>8;A=u&15;u>>=4;w=q<A?u+1:u;u=496*t>>8;A=u&15;u>>=4;t=x<A?u+1:u;u=496*p>>8;A=u&15;u>>=4;p=x<A?u+1:u;u=496*m>>8;A=u&15;u>>=4;m=x<A?u+1:u;k=k<<10|y<<5|w;0===k&&(k=1);k=k<<16|t<<10|p<<5|m;0===(k&65535)&&(k|=1);b[l>>3]=k}}},"ScratchPluginAdditions",{scratch_primitiveOpenURL:function(a){var b=this.stackNonInteger(0).bytesAsString();if(""==b)return!1;if(/^\/SqueakJS\//.test(b)){b=b.slice(10);var c=Squeak.splitFilePath(b),
e=l["squeak-template:"+c.dirname];e&&(b=JSON.parse(e).url+"/"+c.basename)}window.open(b,"_blank");return this.popNIfOK(a)},scratch_primitiveGetFolderPath:function(a){var b=this.stackInteger(0);if(!this.success)return!1;switch(b){case 1:var c="/"}if(!c)return!1;this.vm.popNandPush(a+1,this.makeStString(this.filenameToSqueak(c)));return!0}},"JavaScriptPlugin",{js_primitiveDoUnderstand:function(a){var b=this.stackNonInteger(1),c=this.js_objectOrGlobal(b),e=this.stackNonInteger(0).pointers,g=e[0].bytesAsString();
e=e[1].pointers||[];var h=!("jsObject"in b),f=null;try{var d=g.match(/([^:]*)/)[0];if(h||"new"!==d){if(!(d in c))return this.js_setError("Property not found: "+d);var l=c[d];if("function"==typeof l&&(!h||0<e.length))f=l.apply(c,this.js_fromStArray(e));else if(0==e.length)f=l;else if(1==e.length)c[d]=this.js_fromStObject(e[0]);else return this.js_setError("Property "+d+" is not a function")}else if(0===e.length)f=new c;else{var k=[null].concat(this.js_fromStArray(e));f=new (Function.prototype.bind.apply(c,
k))}}catch(y){return this.js_setError(y.message)}b=this.makeStObject(f,b.sqClass);return this.popNandPushIfOK(a+1,b)},js_primitiveAsString:function(a){var b=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(a+1,this.makeStString(String(b)))},js_primitiveTypeof:function(a){var b=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(a+1,this.makeStString(typeof b))},js_primitiveAt:function(a){var b=this.stackNonInteger(1),c=this.vm.stackValue(0);try{var e=
this.js_objectOrGlobal(b),g=this.js_fromStObject(c);var h=this.makeStObject(e[g],b.sqClass)}catch(f){return this.js_setError(f.message)}return this.popNandPushIfOK(a+1,h)},js_primitiveAtPut:function(a){var b=this.stackNonInteger(2),c=this.vm.stackValue(1),e=this.vm.stackValue(0);try{var g=this.js_objectOrGlobal(b),h=this.js_fromStObject(c),f=this.js_fromStObject(e);g[h]=f}catch(d){return this.js_setError(d.message)}return this.popNandPushIfOK(a+1,e)},js_primitiveSqueakAsJSObject:function(a){var b=
this.stackNonInteger(1),c=this.vm.stackValue(0);this.success&&(b.jsObject=c);return this.popNIfOK(a)},js_primitiveInitCallbacks:function(a){this.js_callbackSema=this.stackInteger(0);this.js_activeCallback=null;return this.popNIfOK(a)},js_primitiveGetActiveCallbackBlock:function(a){var b=this.js_activeCallback;return b?this.popNandPushIfOK(a+1,b.block):this.js_setError("No active callback")},js_primitiveGetActiveCallbackArgs:function(a){var b=this.stackNonInteger(a),c=this.js_activeCallback;if(!c)return this.js_setError("No active callback");
try{var e=this.makeStArray(c.args,b);return this.popNandPushIfOK(a+1,e)}catch(g){return this.js_setError(g.message)}},js_primitiveReturnFromCallback:function(a){if(1!==a)return!1;if(!this.js_activeCallback)return this.js_setError("No active callback");this.js_activeCallback.result=this.vm.pop();this.vm.breakOut();return!0},js_primitiveGetError:function(a){var b=this.makeStObject(this.js_error);this.js_error=null;return this.popNandPushIfOK(a+1,b)},js_setError:function(a){this.js_error=String(a);return!1},
js_fromStObject:function(a){if("number"===typeof a)return a;if(a.jsObject)return a.jsObject;if(a.isFloat)return a.float;if(a.isNil)return null;if(a.isTrue)return!0;if(a.isFalse)return!1;if(a.bytes||a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString])return a.bytesAsString();if(a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray])return this.js_fromStArray(a.pointers||[],!0);if(a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockContext]||a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockClosure])return this.js_fromStBlock(a);
throw Error("asJSArgument needed for "+a);},js_fromStArray:function(a,b){if(0<a.length&&b&&this.isAssociation(a[0]))return this.js_fromStDict(a);b=[];for(var c=0;c<a.length;c++)b.push(this.js_fromStObject(a[c]));return b},js_fromStDict:function(a){for(var b={},c=0;c<a.length;c++){var e=a[c].pointers;if(!e||2!==e.length)throw Error(e+" is not an Association");var g=this.js_fromStObject(e[0]);e=this.js_fromStObject(e[1]);b[g]=e}return b},js_fromStBlock:function(a){if(!this.js_callbackSema)throw Error("CallbackSemaphore not set");
this.vm.reclaimableContextCount=0;var b=a.pointers[Squeak.BlockContext_argumentCount];"number"!==typeof b&&(b=a.pointers[Squeak.Closure_numArgs]);var c=this;return function(){for(var e=[],g=0;g<b;g++)e.push(arguments[g]);return new Promise(function(b,f){setTimeout(function(){c.js_executeCallbackAsync(a,e,b,f)},0)})}},js_executeCallbackAsync:function(a,b,c,e){function g(){h.js_executeCallbackAsync(a,b,c,e)}var h=this;this.js_activeCallback||this.vm.frozen?setTimeout(g,0):this.js_executeCallback(a,
b,c,e)},js_executeCallback:function(a,b,c,e){if(this.js_activeCallback)return console.error("Callback: already active");this.js_activeCallback={block:a,args:b,result:null};this.signalSemaphoreWithIndex(this.js_callbackSema);this.vm.forceInterruptCheck();for(a=Date.now()+500;Date.now()<a&&!this.js_activeCallback.result;)this.vm.interpret();a=this.js_activeCallback.result;this.js_activeCallback=null;if(a)try{c(this.js_fromStObject(a))}catch(g){c(a.toString())}else e(Error("SqueakJS timeout"))},js_objectOrGlobal:function(a){return"jsObject"in
a?a.jsObject:window}},"FFI",{ffi_primitiveCalloutWithArgs:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.isKindOf(b,Squeak.splOb_ClassExternalFunction))return!1;a=b.pointers[Squeak.ExtLibFunc_module].bytesAsString();b=b.pointers[Squeak.ExtLibFunc_name].bytesAsString();c=c.pointers.join(", ");this.vm.warnOnce("FFI: ignoring "+a+": "+b+"("+c+")");return!1}},"Obsolete",{primitiveFloatArrayAt:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAt",a)},primitiveFloatArrayMulFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin",
"primitiveMulFloatArray",a)},primitiveFloatArrayAddScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAddScalar",a)},primitiveFloatArrayDivFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDivFloatArray",a)},primitiveFloatArrayDivScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDivScalar",a)},primitiveFloatArrayHash:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveHash",a)},primitiveFloatArrayAtPut:function(a){return this.namedPrimitive("FloatArrayPlugin",
"primitiveAtPut",a)},primitiveFloatArrayMulScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveMulScalar",a)},primitiveFloatArrayAddFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAddFloatArray",a)},primitiveFloatArraySubScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveSubScalar",a)},primitiveFloatArraySubFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveSubFloatArray",a)},primitiveFloatArrayEqual:function(a){return this.namedPrimitive("FloatArrayPlugin",
"primitiveEqual",a)},primitiveFloatArrayDotProduct:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDotProduct",a)},m23PrimitiveInvertRectInto:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertRectInto",a)},m23PrimitiveTransformPoint:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformPoint",a)},m23PrimitiveIsPureTranslation:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsPureTranslation",a)},m23PrimitiveComposeMatrix:function(a){return this.namedPrimitive("Matrix2x3Plugin",
"primitiveComposeMatrix",a)},m23PrimitiveTransformRectInto:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformRectInto",a)},m23PrimitiveIsIdentity:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsIdentity",a)},m23PrimitiveInvertPoint:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertPoint",a)},primitiveDeflateBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveDeflateBlock",a)},primitiveDeflateUpdateHashTable:function(a){return this.namedPrimitive("ZipPlugin",
"primitiveDeflateUpdateHashTable",a)},primitiveUpdateGZipCrc32:function(a){return this.namedPrimitive("ZipPlugin","primitiveUpdateGZipCrc32",a)},primitiveInflateDecompressBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveInflateDecompressBlock",a)},primitiveZipSendBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveZipSendBlock",a)},primitiveFFTTransformData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTTransformData",a)},primitiveFFTScaleData:function(a){return this.namedPrimitive("FFTPlugin",
"primitiveFFTScaleData",a)},primitiveFFTPermuteData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTPermuteData",a)},gePrimitiveMergeFillFrom:function(a){return this.namedPrimitive("B2DPlugin","primitiveMergeFillFrom",a)},gePrimitiveCopyBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveCopyBuffer",a)},gePrimitiveAddRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddRect",a)},gePrimitiveAddGradientFill:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveAddGradientFill",a)},gePrimitiveSetClipRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetClipRect",a)},gePrimitiveSetBitBltPlugin:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetBitBltPlugin",a)},gePrimitiveRegisterExternalEdge:function(a){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalEdge",a)},gePrimitiveGetClipRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetClipRect",a)},gePrimitiveAddBezier:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveAddBezier",a)},gePrimitiveInitializeProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveInitializeProcessing",a)},gePrimitiveRenderImage:function(a){return this.namedPrimitive("B2DPlugin","primitiveRenderImage",a)},gePrimitiveGetOffset:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetOffset",a)},gePrimitiveSetDepth:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetDepth",a)},gePrimitiveAddBezierShape:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveAddBezierShape",a)},gePrimitiveSetEdgeTransform:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetEdgeTransform",a)},gePrimitiveGetTimes:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetTimes",a)},gePrimitiveNextActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextActiveEdgeEntry",a)},gePrimitiveAddBitmapFill:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddBitmapFill",a)},gePrimitiveGetDepth:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveGetDepth",a)},gePrimitiveAbortProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveAbortProcessing",a)},gePrimitiveNextGlobalEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextGlobalEdgeEntry",a)},gePrimitiveGetFailureReason:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetFailureReason",a)},gePrimitiveDisplaySpanBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveDisplaySpanBuffer",a)},gePrimitiveGetCounts:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveGetCounts",a)},gePrimitiveChangedActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveChangedActiveEdgeEntry",a)},gePrimitiveRenderScanline:function(a){return this.namedPrimitive("B2DPlugin","primitiveRenderScanline",a)},gePrimitiveGetBezierStats:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetBezierStats",a)},gePrimitiveFinishedProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveFinishedProcessing",a)},gePrimitiveNeedsFlush:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveNeedsFlush",a)},gePrimitiveAddLine:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddLine",a)},gePrimitiveSetOffset:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetOffset",a)},gePrimitiveNextFillEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextFillEntry",a)},gePrimitiveInitializeBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveInitializeBuffer",a)},gePrimitiveDoProfileStats:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveDoProfileStats",a)},gePrimitiveAddActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddActiveEdgeEntry",a)},gePrimitiveSetAALevel:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetAALevel",a)},gePrimitiveNeedsFlushPut:function(a){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlushPut",a)},gePrimitiveAddCompressedShape:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddCompressedShape",a)},gePrimitiveSetColorTransform:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveSetColorTransform",a)},gePrimitiveAddOval:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddOval",a)},gePrimitiveRegisterExternalFill:function(a){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalFill",a)},gePrimitiveAddPolygon:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddPolygon",a)},gePrimitiveGetAALevel:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetAALevel",a)}});Object.subclass("Squeak.InterpreterProxy","initialization",
{VM_PROXY_MAJOR:1,VM_PROXY_MINOR:11,initialize:function(a){this.vm=a;this.remappableOops=[];Object.defineProperty(this,"successFlag",{get:function(){return a.primHandler.success},set:function(b){a.primHandler.success=b}})},majorVersion:function(){return this.VM_PROXY_MAJOR},minorVersion:function(){return this.VM_PROXY_MINOR}},"success",{failed:function(){return!this.successFlag},primitiveFail:function(){this.successFlag=!1},primitiveFailFor:function(a){this.successFlag=!1},success:function(a){a||
(this.successFlag=!1)}},"stack access",{pop:function(a){this.vm.popN(a)},popthenPush:function(a,b){this.vm.popNandPush(a,b)},push:function(a){this.vm.push(a)},pushBool:function(a){this.vm.push(a?this.vm.trueObj:this.vm.falseObj)},pushInteger:function(a){this.vm.push(a)},pushFloat:function(a){this.vm.push(this.floatObjectOf(a))},stackValue:function(a){return this.vm.stackValue(a)},stackIntegerValue:function(a){a=this.vm.stackValue(a);if("number"===typeof a)return a;this.successFlag=!1;return 0},stackFloatValue:function(a){this.vm.success=
!0;a=this.vm.stackIntOrFloat(a);if(this.vm.success)return a;this.successFlag=!1;return 0},stackObjectValue:function(a){a=this.vm.stackValue(a);if("number"!==typeof a)return a;this.successFlag=!1;return this.vm.nilObj},stackBytes:function(a){a=this.vm.stackValue(a);if(a.bytes)return a.bytes;"number"!==typeof a&&a.isBytes()||(this.successFlag=!1);return[]},stackWords:function(a){a=this.vm.stackValue(a);if(a.words)return a.words;"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},stackInt32Array:function(a){a=
this.vm.stackValue(a);if(a.words)return a.wordsAsInt32Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},stackInt16Array:function(a){a=this.vm.stackValue(a);if(a.words)return a.wordsAsInt16Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},stackUint16Array:function(a){a=this.vm.stackValue(a);if(a.words)return a.wordsAsUint16Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]}},"object access",{isBytes:function(a){return"number"!==
typeof a&&a.isBytes()},isWords:function(a){return"number"!==typeof a&&a.isWords()},isWordsOrBytes:function(a){return"number"!==typeof a&&a.isWordsOrBytes()},isPointers:function(a){return"number"!==typeof a&&a.isPointers()},isIntegerValue:function(a){return"number"===typeof a&&-1073741824<=a&&1073741823>=a},isArray:function(a){return a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]},isMemberOf:function(a,b){a=a.sqClass.pointers[Squeak.Class_name].bytes;if(b.length!==a.length)return!1;for(var c=
0;c<b.length;c++)if(b.charCodeAt(c)!==a[c])return!1;return!0},booleanValueOf:function(a){return a.isTrue?!0:a.isFalse?!1:this.successFlag=!1},positive32BitValueOf:function(a){return this.vm.primHandler.positive32BitValueOf(a)},positive32BitIntegerFor:function(a){return this.vm.primHandler.pos32BitIntFor(a)},floatValueOf:function(a){if(a.isFloat)return a.float;this.successFlag=!1;return 0},floatObjectOf:function(a){return this.vm.primHandler.makeFloat(a)},fetchPointerofObject:function(a,b){return b.pointers[a]},
fetchBytesofObject:function(a,b){a=b.pointers[a];if(a.bytes)return a.bytes;if(a.words)return a.wordsAsUint8Array();"number"!==typeof a&&a.isWordsOrBytes()||(this.successFlag=!1);return[]},fetchWordsofObject:function(a,b){a=b.pointers[a];if(a.words)return a.words;"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},fetchInt32ArrayofObject:function(a,b){a=b.pointers[a];if(a.words)return a.wordsAsInt32Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},fetchInt16ArrayofObject:function(a,
b){a=b.pointers[a];if(a.words)return a.wordsAsInt16Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},fetchUint16ArrayofObject:function(a,b){a=b.pointers[a];if(a.words)return a.wordsAsUint16Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},fetchIntegerofObject:function(a,b){a=b.pointers[a];if("number"===typeof a)return a;this.successFlag=!1;return 0},fetchLong32ofObject:function(a,b){return b.words[a]},fetchFloatofObject:function(a,b){return this.floatValueOf(b.pointers[a])},
storeIntegerofObjectwithValue:function(a,b,c){"number"===typeof c?b.pointers[a]=c:this.successFlag=!1},storePointerofObjectwithValue:function(a,b,c){b.pointers[a]=c},stObjectatput:function(a,b,c){if(a.sqClass!==this.classArray())throw Error("Array expected");if(1>b||b>=a.pointers.length)return this.successFlag=!1;a.pointers[b]=c}},"constant access",{isKindOfInteger:function(a){return"number"===typeof a||a.sqClass==this.classLargeNegativeInteger()||a.sqClass==this.classLargePositiveInteger()},classArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassArray]},
classBitmap:function(){return this.vm.specialObjects[Squeak.splOb_ClassBitmap]},classSmallInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassInteger]},classLargePositiveInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger]},classLargeNegativeInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargeNegativeInteger]},classPoint:function(){return this.vm.specialObjects[Squeak.splOb_ClassPoint]},classString:function(){return this.vm.specialObjects[Squeak.splOb_ClassString]},
nilObject:function(){return this.vm.nilObj},falseObject:function(){return this.vm.falseObj},trueObject:function(){return this.vm.trueObj}},"vm functions",{instantiateClassindexableSize:function(a,b){return this.vm.instantiateClass(a,b)},methodArgumentCount:function(){return this.argCount},makePointwithxValueyValue:function(a,b){return this.vm.primHandler.makePointWithXandY(a,b)},pushRemappableOop:function(a){this.remappableOops.push(a)},popRemappableOop:function(){return this.remappableOops.pop()},
showDisplayBitsLeftTopRightBottom:function(a,b,c,e,g){b<e&&c<g&&this.vm.primHandler.displayDirty(a,{left:b,top:c,right:e,bottom:g})},ioLoadFunctionFrom:function(a,b){return this.vm.primHandler.loadFunctionFrom(a,b)}});Object.subclass("Squeak.InstructionPrinter","initialization",{initialize:function(a,b){this.method=a;this.vm=b}},"printing",{printInstructions:function(a,b,c){this.indent=a;this.highlight=b;this.highlightPC=c;this.innerIndents={};this.result="";this.scanner=new Squeak.InstructionStream(this.method,
this.vm);this.oldPC=this.scanner.pc;this.endPC=0;for(this.done=!1;!this.done;)this.scanner.interpretNextInstructionFor(this);return this.result},print:function(a){this.oldPC===this.highlightPC?this.highlight&&(this.result+=this.highlight):this.indent&&(this.result+=this.indent);this.result+=this.oldPC;for(var b=0;b<this.innerIndents[this.oldPC];b++)this.result+="   ";this.result+=" <";for(b=this.oldPC;b<this.scanner.pc;b++)b>this.oldPC&&(this.result+=" "),this.result+=(this.method.bytes[b]+256).toString(16).substr(-2).toUpperCase();
this.result+="> "+a+"\n";this.oldPC=this.scanner.pc}},"decoding",{blockReturnTop:function(){this.print("blockReturn")},doDup:function(){this.print("dup")},doPop:function(){this.print("pop")},jump:function(a){this.print("jumpTo: "+(this.scanner.pc+a));this.scanner.pc+a>this.endPC&&(this.endPC=this.scanner.pc+a)},jumpIf:function(a,b){this.print((a?"jumpIfTrue: ":"jumpIfFalse: ")+(this.scanner.pc+b));this.scanner.pc+b>this.endPC&&(this.endPC=this.scanner.pc+b)},methodReturnReceiver:function(){this.print("return: receiver");
this.done=this.scanner.pc>this.endPC},methodReturnTop:function(){this.print("return: topOfStack");this.done=this.scanner.pc>this.endPC},methodReturnConstant:function(a){this.print("returnConst: "+a.toString());this.done=this.scanner.pc>this.endPC},popIntoLiteralVariable:function(a){this.print("popIntoBinding: "+a.assnKeyAsString())},popIntoReceiverVariable:function(a){this.print("popIntoInstVar: "+a)},popIntoTemporaryVariable:function(a){this.print("popIntoTemp: "+a)},pushActiveContext:function(){this.print("push: thisContext")},
pushConstant:function(a){a=a.sqInstName?a.sqInstName():a.toString();this.print("pushConst: "+a)},pushLiteralVariable:function(a){this.print("pushBinding: "+a.assnKeyAsString())},pushReceiver:function(){this.print("push: self")},pushReceiverVariable:function(a){this.print("pushInstVar: "+a)},pushTemporaryVariable:function(a){this.print("pushTemp: "+a)},send:function(a,b,c){this.print((c?"superSend: #":"send: #")+(a.bytesAsString?a.bytesAsString():a))},storeIntoLiteralVariable:function(a){this.print("storeIntoBinding: "+
a.assnKeyAsString())},storeIntoReceiverVariable:function(a){this.print("storeIntoInstVar: "+a)},storeIntoTemporaryVariable:function(a){this.print("storeIntoTemp: "+a)},pushNewArray:function(a){this.print("push: (Array new: "+a+")")},popIntoNewArray:function(a){this.print("pop: "+a+" into: (Array new: "+a+")")},pushRemoteTemp:function(a,b){this.print("push: "+a+" ofTemp: "+b)},storeIntoRemoteTemp:function(a,b){this.print("storeInto: "+a+" ofTemp: "+b)},popIntoRemoteTemp:function(a,b){this.print("popInto: "+
a+" ofTemp: "+b)},pushClosureCopy:function(a,b,c){var e=this.scanner.pc;c=e+c;this.print("closure("+e+"-"+(c-1)+"): "+a+" copied, "+b+" args");for(a=e;a<c;a++)this.innerIndents[a]=(this.innerIndents[a]||0)+1;c>this.endPC&&(this.endPC=c)},callPrimitive:function(a){this.print("primitive: "+a)}});Object.subclass("Squeak.InstructionStream","initialization",{initialize:function(a,b){this.vm=b;this.method=a;this.pc=0;this.specialConstants=[b.trueObj,b.falseObj,b.nilObj,-1,0,1,2]}},"decoding",{interpretNextInstructionFor:function(a){var b=
this.method,c=b.bytes[this.pc++],e=c/16|0,g=c%16;if(0===e)return a.pushReceiverVariable(g);if(1===e)return a.pushTemporaryVariable(g);if(2===e)return a.pushConstant(b.methodGetLiteral(g));if(3===e)return a.pushConstant(b.methodGetLiteral(g+16));if(4===e)return a.pushLiteralVariable(b.methodGetLiteral(g));if(5===e)return a.pushLiteralVariable(b.methodGetLiteral(g+16));if(6===e)return 8>g?a.popIntoReceiverVariable(g):a.popIntoTemporaryVariable(g-8);if(7===e){if(0===g)return a.pushReceiver();if(8>g)return a.pushConstant(this.specialConstants[g-
1]);if(8===g)return a.methodReturnReceiver();if(12>g)return a.methodReturnConstant(this.specialConstants[g-9]);if(12===g)return a.methodReturnTop();if(13===g)return a.blockReturnTop();if(13<g)throw Error("unusedBytecode");}if(8===e)return this.interpretExtension(g,b,a);if(9===e)return 8>g?a.jump(g+1):a.jumpIf(!1,g-8+1);if(10===e)return c=this.method.bytes[this.pc++],8>g?a.jump(256*(g-4)+c):a.jumpIf(12>g,256*(g&3)+c);if(11===e)return a.send(this.vm.specialSelectors[2*g],this.vm.specialSelectors[2*
g+1],!1);if(12===e)return a.send(this.vm.specialSelectors[2*(g+16)],this.vm.specialSelectors[2*(g+16)+1],!1);if(12<e)return a.send(b.methodGetLiteral(g),e-13,!1)},interpretExtension:function(a,b,c){if(6>=a){b=this.method.bytes[this.pc++];if(2>=a){var e=b/64|0,g=b%64;if(0===a){if(0===e)return c.pushReceiverVariable(g);if(1===e)return c.pushTemporaryVariable(g);if(2===e)return c.pushConstant(this.method.methodGetLiteral(g));if(3===e)return c.pushLiteralVariable(this.method.methodGetLiteral(g))}if(1===
a){if(0===e)return c.storeIntoReceiverVariable(g);if(1===e)return c.storeIntoTemporaryVariable(g);if(2===e)throw Error("illegalStore");if(3===e)return c.storeIntoLiteralVariable(this.method.methodGetLiteral(g))}if(2===a){if(0===e)return c.popIntoReceiverVariable(g);if(1===e)return c.popIntoTemporaryVariable(g);if(2===e)throw Error("illegalStore");if(3===e)return c.popIntoLiteralVariable(this.method.methodGetLiteral(g))}}if(3===a)return c.send(this.method.methodGetLiteral(b%32),b/32|0,!1);if(4===a){g=
this.method.bytes[this.pc++];e=b/32|0;if(0===e)return c.send(this.method.methodGetLiteral(g),b%32,!1);if(1===e)return c.send(this.method.methodGetLiteral(g),b%32,!0);if(2===e)return c.pushReceiverVariable(g);if(3===e)return c.pushConstant(this.method.methodGetLiteral(g));if(4===e)return c.pushLiteralVariable(this.method.methodGetLiteral(g));if(5===e)return c.storeIntoReceiverVariable(g);if(6===e)return c.popIntoReceiverVariable(g);if(7===e)return c.storeIntoLiteralVariable(this.method.methodGetLiteral(g))}if(5===
a)return c.send(this.method.methodGetLiteral(b&31),b>>5,!0);if(6===a)return c.send(this.method.methodGetLiteral(b&63),b>>6,!1)}if(7===a)return c.doPop();if(8===a)return c.doDup();if(9===a)return c.pushActiveContext();b=this.method.bytes[this.pc++];if(10===a)return 128>b?c.pushNewArray(b):c.popIntoNewArray(b-128);g=this.method.bytes[this.pc++];if(11===a)return c.callPrimitive(b+256*g);if(12===a)return c.pushRemoteTemp(b,g);if(13===a)return c.storeIntoRemoteTemp(b,g);if(14===a)return c.popIntoRemoteTemp(b,
g);a=this.method.bytes[this.pc++];return c.pushClosureCopy(b>>4,b&15,256*g+a)}})});module("users.bert.SqueakJS.jit").requires("users.bert.SqueakJS.vm").toRun(function(){Object.subclass("Squeak.Compiler","initialization",{initialize:function(l){this.vm=l;this.comments=!!Squeak.Compiler.comments;this.specialSelectors="+ - < > <= >= = ~= * / \\ @ bitShift: // bitAnd: bitOr: at: at:put: size next nextPut: atEnd == class blockCopy: value value: do: new new: x y".split(" ")}},"accessing",{compile:function(l,a,b){void 0===l.compiled?l.compiled=!1:(this.singleStep=!1,this.debug=this.comments,
a=a&&a.className(),b=b&&b.bytesAsString(),l.compiled=this.generate(l,a,b))},enableSingleStepping:function(l,a,b){if(!l.compiled||!l.compiled.canSingleStep){this.debug=this.singleStep=!0;a||this.vm.allMethodsDo(function(c,e,d){if(e===l)return a=c,b=d,!0});var c=a&&a.className(),e=b&&b.bytesAsString(),g=a&&a.allInstVarNames();l.compiled=this.generate(l,c,e,g);l.compiled.canSingleStep=!0}return!0},functionNameFor:function(l,a){if(void 0===l||"?"===l)return"Squeak_DOIT";if(!/[^a-zA-Z0-9:_]/.test(a))return(l+
"_"+a).replace(/[: ]/g,"_");a=a.replace(/./g,function(a){return{"|":"OR","~":"NOT","<":"LT","=":"EQ",">":"GT","&":"AND","@":"AT","*":"TIMES","+":"PLUS","\\":"MOD","-":"MINUS",",":"COMMA","/":"DIV","?":"IF"}[a]||"OPERATOR"});return l.replace(/[ ]/,"_")+"__"+a+"__"}},"generating",{generate:function(l,a,b,c){this.method=l;this.prevPC=this.endPC=this.pc=0;this.source=[];this.sourceLabels={};this.needsLabel={};this.sourcePos={};this.needsVar={};this.needsBreak=!1;a&&b&&this.source.push("// ",a,">>",b,
"\n");this.instVarNames=c;this.allVars="context stack rcvr inst[ temp[ lit[".split(" ");this.sourcePos.context=this.source.length;this.source.push("var context = vm.activeContext;\n");this.sourcePos.stack=this.source.length;this.source.push("var stack = context.pointers;\n");this.sourcePos.rcvr=this.source.length;this.source.push("var rcvr = vm.receiver;\n");this.sourcePos["inst["]=this.source.length;this.source.push("var inst = rcvr.pointers;\n");this.sourcePos["temp["]=this.source.length;this.source.push("var temp = vm.homeContext.pointers;\n");
this.sourcePos["lit["]=this.source.length;this.source.push("var lit = vm.method.pointers;\n");this.sourcePos["loop-start"]=this.source.length;this.source.push("while (true) switch (vm.pc) {\ncase 0:\n");for(this.done=!1;!this.done;)switch(c=l.bytes[this.pc++],c&248){case 0:case 8:this.generatePush("inst[",c&15,"]");break;case 16:case 24:this.generatePush("temp[",6+(c&15),"]");break;case 32:case 40:case 48:case 56:this.generatePush("lit[",1+(c&31),"]");break;case 64:case 72:case 80:case 88:this.generatePush("lit[",
1+(c&31),"].pointers[1]");break;case 96:this.generatePopInto("inst[",c&7,"]");break;case 104:this.generatePopInto("temp[",6+(c&7),"]");break;case 112:switch(c){case 112:this.generatePush("rcvr");break;case 113:this.generatePush("vm.trueObj");break;case 114:this.generatePush("vm.falseObj");break;case 115:this.generatePush("vm.nilObj");break;case 116:this.generatePush("-1");break;case 117:this.generatePush("0");break;case 118:this.generatePush("1");break;case 119:this.generatePush("2")}break;case 120:switch(c){case 120:this.generateReturn("rcvr");
break;case 121:this.generateReturn("vm.trueObj");break;case 122:this.generateReturn("vm.falseObj");break;case 123:this.generateReturn("vm.nilObj");break;case 124:this.generateReturn("stack[vm.sp]");break;case 125:this.generateBlockReturn();break;default:throw Error("unusedBytecode");}break;case 128:case 136:this.generateExtended(c);break;case 144:this.generateJump((c&7)+1);break;case 152:this.generateJumpIf(!1,(c&7)+1);break;case 160:var e=l.bytes[this.pc++];this.generateJump(256*((c&7)-4)+e);break;
case 168:e=l.bytes[this.pc++];this.generateJumpIf(172>c,256*(c&3)+e);break;case 176:case 184:this.generateNumericOp(c);break;case 192:case 200:this.generateQuickPrim(c);break;case 208:case 216:this.generateSend("lit[",1+(c&15),"]",0,!1);break;case 224:case 232:this.generateSend("lit[",1+(c&15),"]",1,!1);break;case 240:case 248:this.generateSend("lit[",1+(c&15),"]",2,!1)}l=this.functionNameFor(a,b);this.singleStep?(this.debug&&this.source.push("// all valid PCs have a label;\n"),this.source.push("default: throw Error('invalid PC');\n}")):
(this.sourcePos["loop-end"]=this.source.length,this.source.push("default: vm.interpretOne(true); return;\n}"),this.deleteUnneededLabels());this.deleteUnneededVariables();return(new Function("'use strict';\nreturn function "+l+"(vm) {\n"+this.source.join("")+"}"))()},generateExtended:function(l){switch(l){case 128:switch(l=this.method.bytes[this.pc++],l>>6){case 0:this.generatePush("inst[",l&63,"]");return;case 1:this.generatePush("temp[",6+(l&63),"]");return;case 2:this.generatePush("lit[",1+(l&63),
"]");return;case 3:this.generatePush("lit[",1+(l&63),"].pointers[1]");return}case 129:l=this.method.bytes[this.pc++];switch(l>>6){case 0:this.generateStoreInto("inst[",l&63,"]");break;case 1:this.generateStoreInto("temp[",6+(l&63),"]");break;case 2:throw Error("illegal store into literal");case 3:this.generateStoreInto("lit[",1+(l&63),"].pointers[1]")}break;case 130:switch(l=this.method.bytes[this.pc++],l>>6){case 0:this.generatePopInto("inst[",l&63,"]");return;case 1:this.generatePopInto("temp[",
6+(l&63),"]");return;case 2:throw Error("illegal pop into literal");case 3:this.generatePopInto("lit[",1+(l&63),"].pointers[1]");return}case 131:l=this.method.bytes[this.pc++];this.generateSend("lit[",1+(l&31),"]",l>>5,!1);break;case 132:l=this.method.bytes[this.pc++];var a=this.method.bytes[this.pc++];switch(l>>5){case 0:this.generateSend("lit[",1+a,"]",l&31,!1);return;case 1:this.generateSend("lit[",1+a,"]",l&31,!0);return;case 2:this.generatePush("inst[",a,"]");return;case 3:this.generatePush("lit[",
1+a,"]");return;case 4:this.generatePush("lit[",1+a,"].pointers[1]");return;case 5:this.generateStoreInto("inst[",a,"]");return;case 6:this.generatePopInto("inst[",a,"]");return;case 7:this.generateStoreInto("lit[",1+a,"].pointers[1]");return}case 133:l=this.method.bytes[this.pc++];this.generateSend("lit[",1+(l&31),"]",l>>5,!0);break;case 134:l=this.method.bytes[this.pc++];this.generateSend("lit[",1+(l&63),"]",l>>6,!1);break;case 135:this.generateInstruction("pop","vm.sp--");break;case 136:this.needsVar.stack=
!0;this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");break;case 137:this.needsVar.stack=!0;this.generateInstruction("push thisContext","stack[++vm.sp] = vm.exportThisContext()");break;case 138:l=this.method.bytes[this.pc++];this.generateClosureTemps(l&127,127<l);break;case 139:l=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generateCallPrimitive(l+256*a);break;case 140:l=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generatePush("temp[",
6+a,"].pointers[",l,"]");break;case 141:l=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generateStoreInto("temp[",6+a,"].pointers[",l,"]");break;case 142:l=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generatePopInto("temp[",6+a,"].pointers[",l,"]");break;case 143:l=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];var b=this.method.bytes[this.pc++];this.generateClosureCopy(l&15,l>>4,a<<8|b)}},generatePush:function(l,a,b,c,e){this.debug&&this.generateDebugCode("push",
l,a,b,c,e);this.generateLabel();this.needsVar[l]=!0;this.needsVar.stack=!0;this.source.push("stack[++vm.sp] = ",l);void 0!==a&&(this.source.push(a,b),void 0!==c&&this.source.push(c,e));this.source.push(";\n")},generateStoreInto:function(l,a,b,c,e){this.debug&&this.generateDebugCode("store into",l,a,b,c,e);this.generateLabel();this.needsVar[l]=!0;this.needsVar.stack=!0;this.source.push(l);void 0!==a&&(this.source.push(a,b),void 0!==c&&this.source.push(c,e));this.source.push(" = stack[vm.sp];\n");this.generateDirty(l,
a)},generatePopInto:function(l,a,b,c,e){this.debug&&this.generateDebugCode("pop into",l,a,b,c,e);this.generateLabel();this.needsVar[l]=!0;this.needsVar.stack=!0;this.source.push(l);void 0!==a&&(this.source.push(a,b),void 0!==c&&this.source.push(c,e));this.source.push(" = stack[vm.sp--];\n");this.generateDirty(l,a)},generateReturn:function(l){this.debug&&this.generateDebugCode("return",l);this.generateLabel();this.needsVar[l]=!0;this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",l,"); return;\n");
this.needsBreak=!1;this.done=this.pc>this.endPC},generateBlockReturn:function(){this.debug&&this.generateDebugCode("block return");this.generateLabel();this.needsVar.stack=!0;this.source.push("vm.pc = ",this.pc,"; vm.doReturn(stack[vm.sp--], context.pointers[0]); return;\n");this.needsBreak=!1},generateJump:function(l){var a=this.pc+l;this.debug&&this.generateDebugCode("jump to "+a);this.generateLabel();this.needsVar.context=!0;this.source.push("vm.pc = ",a,"; ");0>l&&this.source.push("\nif (vm.interruptCheckCounter-- <= 0) {\n",
"   vm.checkForInterrupts();\n","   if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n","}\n");this.singleStep&&this.source.push("\nif (vm.breakOutOfInterpreter) return;\n");this.source.push("continue;\n");this.needsBreak=!1;this.needsLabel[a]=!0;a>this.endPC&&(this.endPC=a)},generateJumpIf:function(l,a){a=this.pc+a;this.debug&&this.generateDebugCode("jump if "+l+" to "+a);this.generateLabel();this.needsVar.stack=!0;this.source.push("var cond = stack[vm.sp--]; if (cond === vm.",
l,"Obj) {vm.pc = ",a,"; ");this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return; else ");this.source.push("continue}\n","else if (cond !== vm.",!l,"Obj) {vm.sp++; vm.pc = ",this.pc,"; vm.send(vm.specialObjects[25], 0, false); return}\n");this.needsLabel[this.pc]=!0;this.needsLabel[a]=!0;a>this.endPC&&(this.endPC=a)},generateQuickPrim:function(l){this.debug&&this.generateDebugCode("quick prim "+this.specialSelectors[(l&15)+16]);this.generateLabel();switch(l){case 194:this.needsVar.stack=
!0;this.source.push("if (stack[vm.sp].sqClass === vm.specialObjects[7]) stack[vm.sp] = stack[vm.sp].pointersSize();\n","else if (stack[vm.sp].sqClass === vm.specialObjects[6]) stack[vm.sp] = stack[vm.sp].bytesSize();\n","else { vm.pc = ",this.pc,"; vm.sendSpecial(18); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return; }\n");this.needsLabel[this.pc]=!0;return;case 198:this.needsVar.stack=!0;this.source.push("var cond = stack[vm.sp-1] === stack[vm.sp];\nstack[--vm.sp] = cond ? vm.trueObj : vm.falseObj;\n");
return;case 199:this.needsVar.stack=!0;this.source.push("stack[vm.sp] = typeof stack[vm.sp] === 'number' ? vm.specialObjects[5] : stack[vm.sp].sqClass;\n");return;case 200:this.needsVar.rcvr=!0;this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",l&15,")) ","{vm.sendSpecial(",(l&15)+16,"); return}\n");this.needsLabel[this.pc]=!0;this.needsLabel[this.pc+2]=!0;return;case 201:case 202:case 203:this.needsVar.rcvr=!0;this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",
l&15,")) vm.sendSpecial(",(l&15)+16,"); return;\n");this.needsLabel[this.pc]=!0;return}this.needsVar.rcvr=!0;this.needsVar.context=!0;this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",l&15,"))"," vm.sendSpecial(",(l&15)+16,");\n","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n");this.needsBreak=!1;this.needsLabel[this.pc]=!0},generateNumericOp:function(l){this.debug&&this.generateDebugCode("numeric op "+this.specialSelectors[l&15]);
this.generateLabel();this.needsLabel[this.pc]=!0;switch(l){case 176:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a + b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(0); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 177:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n",
"if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a - b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(1); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 178:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a < b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,
"; vm.sendSpecial(2); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 179:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a > b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(3); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 180:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n",
"if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a <= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(4); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 181:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a >= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(5); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");
break;case 182:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a === b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.trueObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(6); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 183:this.needsVar.stack=!0;this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n",
"if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a !== b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(7); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");break;case 184:this.source.push("vm.success = true; vm.resultIsFloat = false; if(!vm.pop2AndPushNumResult(vm.stackIntOrFloat(1) * vm.stackIntOrFloat(0))) { vm.pc = ",
this.pc,"; vm.sendSpecial(8); return}\n");break;case 185:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.quickDivide(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(9); return}\n");break;case 186:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.mod(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(10); return}\n");break;case 187:this.source.push("vm.success = true; if(!vm.primHandler.primitiveMakePoint(1, true)) { vm.pc = ",
this.pc,"; vm.sendSpecial(11); return}\n");break;case 188:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.safeShift(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(12); return}\n");break;case 189:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.div(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(13); return}\n");break;case 190:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) & vm.stackInteger(0))) { vm.pc = ",
this.pc,"; vm.sendSpecial(14); return}\n");break;case 191:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) | vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(15); return}\n")}},generateSend:function(l,a,b,c,e){this.debug&&this.generateDebugCode("send "+("lit["===l?this.method.pointers[a].bytesAsString():"..."));this.generateLabel();this.needsVar[l]=!0;this.needsVar.context=!0;this.source.push("vm.pc = ",this.pc,"; vm.send(",l,a,b,", ",c,", ",e,"); ","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n");
this.needsBreak=!1;this.needsLabel[this.pc]=!0},generateClosureTemps:function(l,a){this.debug&&this.generateDebugCode("closure temps");this.generateLabel();this.needsVar.stack=!0;this.source.push("var array = vm.instantiateClass(vm.specialObjects[7], ",l,");\n");if(a){for(a=0;a<l;a++)this.source.push("array.pointers[",a,"] = stack[vm.sp - ",l-a-1,"];\n");this.source.push("stack[vm.sp -= ",l-1,"] = array;\n")}else this.source.push("stack[++vm.sp] = array;\n")},generateClosureCopy:function(l,a,b){var c=
this.pc;b=c+b;this.debug&&this.generateDebugCode("push closure("+c+"-"+(b-1)+"): "+a+" copied, "+l+" args");this.generateLabel();this.needsVar.stack=!0;this.source.push("var closure = vm.instantiateClass(vm.specialObjects[36], ",a,");\n","closure.pointers[0] = context; vm.reclaimableContextCount = 0;\n","closure.pointers[1] = ",c+4*this.method.pointers.length+1,";\n","closure.pointers[2] = ",l,";\n");if(0<a){for(l=0;l<a;l++)this.source.push("closure.pointers[",l+3,"] = stack[vm.sp - ",a-l-1,"];\n");
this.source.push("stack[vm.sp -= ",a-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n");this.source.push("vm.pc = ",b,";\n");this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return;\n");this.source.push("continue;\n");this.needsBreak=!1;this.needsLabel[c]=!0;this.needsLabel[b]=!0;b>this.endPC&&(this.endPC=b)},generateCallPrimitive:function(l){this.debug&&this.generateDebugCode("call primitive "+l);this.generateLabel();129===this.method.bytes[this.pc]&&(this.needsVar.stack=
!0,this.source.push("if (vm.primFailCode) {stack[vm.sp] = vm.getErrorObjectFromPrimFailCode(); vm.primFailCode = 0;}\n"))},generateDirty:function(l,a){switch(l){case "inst[":this.source.push("rcvr.dirty = true;\n");break;case "lit[":this.source.push(l,a,"].dirty = true;\n");break;case "temp[":break;default:throw Error("unexpected target "+l);}},generateLabel:function(){this.prevPC&&(this.sourceLabels[this.prevPC]=this.source.length,this.source.push("case ",this.prevPC,":\n"));this.prevPC=this.pc},
generateDebugCode:function(l,a,b,c,e,g){this.needsBreak&&(this.source.push("if (vm.breakOutOfInterpreter) {vm.pc = ",this.prevPC,"; return}\n"),this.needsLabel[this.prevPC]=!0);g=[];for(var h=this.prevPC;h<this.pc;h++)g.push((this.method.bytes[h]+256).toString(16).slice(-2).toUpperCase());this.source.push("// ",this.prevPC," <",g.join(" "),"> ",l);if(a)switch(this.source.push(" "),a){case "vm.nilObj":this.source.push("nil");break;case "vm.trueObj":this.source.push("true");break;case "vm.falseObj":this.source.push("false");
break;case "rcvr":this.source.push("self");break;case "stack[vm.sp]":this.source.push("top of stack");break;case "inst[":this.instVarNames?this.source.push(this.instVarNames[b]):this.source.push("inst var ",b);break;case "temp[":this.source.push("tmp",b-6);"]"!==c&&this.source.push("[",e,"]");break;case "lit[":l=this.method.pointers[b];"]"===c?this.source.push(l):this.source.push(l.pointers[0].bytesAsString());break;default:this.source.push(a)}this.source.push("\n");this.needsBreak=this.singleStep},
generateInstruction:function(l,a){this.debug&&this.generateDebugCode(l);this.generateLabel();this.source.push(a,";\n")},deleteUnneededLabels:function(){var l=!1,a;for(a in this.sourceLabels)if(this.needsLabel[a])l=!0;else for(var b=0;3>b;b++)this.source[this.sourceLabels[a]+b]="";l||(this.source[this.sourcePos["loop-start"]]="",this.source[this.sourcePos["loop-end"]]="")},deleteUnneededVariables:function(){this.needsVar.stack&&(this.needsVar.context=!0);this.needsVar["inst["]&&(this.needsVar.rcvr=
!0);for(var l=0;l<this.allVars.length;l++){var a=this.allVars[l];this.needsVar[a]||(this.source[this.sourcePos[a]]="")}}})});module("users.bert.SqueakJS.plugins.ADPCMCodecPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a,b){return 31<b?0:a>>>b}function a(a){var b;for(b=0;;){var d=a-c;if(0<d)b+=31<d?0:g<<d,a-=c,g=h[++e-1],c=8;else return b+=l(g,0-d),c-=a,g&=l(255,8-c),b}}function b(a,b){var d;for(d=a;;){a=8-c;var f=a-d;if(0>f)g+=l(b,0-f),h[++e-1]=g,g=c=0,f=0-f,b&=(31<f?0:1<<f)-1,d-=a;else return g+=31<f?0:b<<f,c+=d,self}}var c=0,e=0,g=0,h=null,f=null,d=null;Squeak.registerExternalModule("ADPCMCodecPlugin",
{primitiveDecodeStereo:function(){var b,l,y;var w=f.stackValue(1);var t=f.stackIntegerValue(0);var p=f.fetchInt16ArrayofObject(0,w);var m=f.fetchInt16ArrayofObject(1,w);var x=f.fetchIntegerofObject(2,w);var q=f.fetchIntegerofObject(3,w);var u=f.fetchIntegerofObject(4,w);var A=f.fetchIntegerofObject(5,w);g=f.fetchIntegerofObject(6,w);c=f.fetchIntegerofObject(7,w);e=f.fetchIntegerofObject(8,w);h=f.fetchBytesofObject(9,w);var B=f.fetchInt16ArrayofObject(10,w);var D=f.fetchInt16ArrayofObject(11,w);var P=
f.fetchIntegerofObject(12,w);var O=f.fetchIntegerofObject(13,w);d=f.fetchInt16ArrayofObject(14,w);var F=f.fetchInt16ArrayofObject(15,w);if(f.failed())return null;var C=p[0];var H=p[1];var I=m[0];var M=m[1];for(l=1;l<=t;l++){if(1===(l&A))C=a(16),I=a(6),H=a(16),M=a(6),32767<C&&(C-=65536),32767<H&&(H-=65536);else{var v=a(O);var N=a(O);var G=d[I];var K=d[M];var ba=y=0;for(b=u;0<b;)0<(v&b)&&(ba+=G),0<(N&b)&&(y+=K),G>>>=1,K>>>=1,b>>>=1;ba+=G;y+=K;C=0<(v&x)?C-ba:C+ba;H=0<(N&x)?H-y:H+y;32767<C?C=32767:-32768>
C&&(C=-32768);32767<H?H=32767:-32768>H&&(H=-32768);I+=F[v&q];0>I?I=0:88<I&&(I=88);M+=F[N&q];0>M?M=0:88<M&&(M=88)}B[++P-1]=C;D[P-1]=H}p[0]=C;p[1]=H;m[0]=I;m[1]=M;if(f.failed())return null;f.storeIntegerofObjectwithValue(6,w,g);f.storeIntegerofObjectwithValue(7,w,c);f.storeIntegerofObjectwithValue(8,w,e);f.storeIntegerofObjectwithValue(12,w,P);f.pop(1)},primitiveEncodeStereo:function(){var a=f.stackValue(1);f.stackIntegerValue(0);g=f.fetchIntegerofObject(6,a);c=f.fetchIntegerofObject(7,a);e=f.fetchIntegerofObject(8,
a);h=f.fetchIntegerofObject(9,a);d=f.fetchIntegerofObject(14,a);if(f.failed())return null;success(!1);if(f.failed())return null;f.storeIntegerofObjectwithValue(6,a,g);f.storeIntegerofObjectwithValue(7,a,c);f.storeIntegerofObjectwithValue(8,a,e);f.pop(1)},setInterpreter:function(a){f=a;a=1==f.majorVersion();return!1===a?!1:a=11<=f.minorVersion()},primitiveEncodeMono:function(){var a,l,y;var w=f.stackValue(1);var t=f.stackIntegerValue(0);var p=f.fetchIntegerofObject(0,w);var m=f.fetchIntegerofObject(1,
w);var x=f.fetchIntegerofObject(2,w);var q=f.fetchIntegerofObject(4,w);var u=f.fetchIntegerofObject(5,w);g=f.fetchIntegerofObject(6,w);c=f.fetchIntegerofObject(7,w);e=f.fetchIntegerofObject(8,w);h=f.fetchBytesofObject(9,w);var A=f.fetchInt16ArrayofObject(10,w);var B=f.fetchIntegerofObject(12,w);var D=f.fetchIntegerofObject(13,w);d=f.fetchInt16ArrayofObject(14,w);var P=f.fetchInt16ArrayofObject(15,w);if(f.failed())return null;var O=d[0];for(l=1;l<=t;l++)if(1===(l&u)){p=A[++B-1];0>(y=p)&&(y+=65536);
b(16,y);if(l<t){var F=A[B]-p;0>F&&(F=0-F);var C=63;for(a=1;62>=a;a++)63===C&&d[a-1]>=F&&(C=a);m=C}b(6,m)}else{var H=0;C=A[++B-1]-p;0>C&&(H=x,C=0-C);var I=F=0;for(a=q;0<a;)C>=O&&(F+=a,I+=O,C-=O),O>>>=1,a>>>=1;I+=O;p=0<H?p-I:p+I;32767<p?p=32767:-32768>p&&(p=-32768);m+=P[F];0>m?m=0:88<m&&(m=88);O=d[m];b(D,H|F)}0<c&&(h[++e-1]=g);if(f.failed())return null;f.storeIntegerofObjectwithValue(0,w,p);f.storeIntegerofObjectwithValue(1,w,m);f.storeIntegerofObjectwithValue(6,w,g);f.storeIntegerofObjectwithValue(7,
w,c);f.storeIntegerofObjectwithValue(8,w,e);f.storeIntegerofObjectwithValue(12,w,B);f.pop(1)},primitiveDecodeMono:function(){var b,l;var y=f.stackValue(1);var w=f.stackIntegerValue(0);var t=f.fetchIntegerofObject(0,y);var p=f.fetchIntegerofObject(1,y);var m=f.fetchIntegerofObject(2,y);var x=f.fetchIntegerofObject(3,y);var q=f.fetchIntegerofObject(4,y);var u=f.fetchIntegerofObject(5,y);g=f.fetchIntegerofObject(6,y);c=f.fetchIntegerofObject(7,y);e=f.fetchIntegerofObject(8,y);h=f.fetchBytesofObject(9,
y);var A=f.fetchInt16ArrayofObject(10,y);var B=f.fetchIntegerofObject(12,y);var D=f.fetchIntegerofObject(13,y);d=f.fetchInt16ArrayofObject(14,y);var P=f.fetchInt16ArrayofObject(15,y);if(f.failed())return null;for(l=1;l<=w;l++){if(1===(l&u))t=a(16),32767<t&&(t-=65536),p=a(6);else{var O=a(D);var F=d[p];var C=0;for(b=q;0<b;)0<(O&b)&&(C+=F),F>>>=1,b>>>=1;C+=F;t=0<(O&m)?t-C:t+C;32767<t?t=32767:-32768>t&&(t=-32768);p+=P[O&x];0>p?p=0:88<p&&(p=88)}A[++B-1]=t}if(f.failed())return null;f.storeIntegerofObjectwithValue(0,
y,t);f.storeIntegerofObjectwithValue(1,y,p);f.storeIntegerofObjectwithValue(6,y,g);f.storeIntegerofObjectwithValue(7,y,c);f.storeIntegerofObjectwithValue(8,y,e);f.storeIntegerofObjectwithValue(12,y,B);f.pop(1)},getModuleName:function(){return"ADPCMCodecPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.B2DPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return"number"===typeof a?r.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return 31<b?0:a<<b}function c(a,b){return 31<b?0:a>>>b}function e(a,b){return new Int32Array(a.buffer,a.byteOffset+4*b)}function g(a,b){return new Float32Array(a.buffer,a.byteOffset+4*b)}function h(a,b){a=a+z[48]-1&
~(z[48]-1);return a>b?b:a}function f(){return z[49]}function d(a,b){if(0===a)return 0>b?0-b:b;if(0===b)return 0>a?0-a:a;a=a*a+b*b;a=32>a?[0,1,1,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6][a]:Math.sqrt(a)+.5|0;return a}function n(a){if(!y(1))return 0;Wa[z[12]]=a;z[12]+=1}function k(){Cb(6);return na()}function y(a){var b;if(!za(a))return!1;if(0!==z[14]){var c=z[14];var d=z[14]+a;var f=1;for(b=z[14];f<=b;f++)U[--d]=U[--c]}U=e(U,a);return!0}function w(a){var b;if(!y(a))return!1;if(0!==
z[12]){var c=z[12];var d=z[12]+a;var f=1;for(b=z[12];f<=b;f++)Wa[--d]=Wa[--c]}Wa=e(Wa,a);return!0}function t(a,b,c){if(b>c){if(a>b)return b;if(a<c)return c}else{if(a<b)return b;if(a>c)return c}return a}function p(a){return e(E,a+10)}function m(a,d,f,p){var m=E[a+12];var g=E[a+14];if(32===m)return d=d[g*p+f]|0,0!==d&&0===(d&4278190080)&&(d|=4278190080),pb(d);var q=[0,5,4,0,3,0,0,0,2,0,0,0,0,0,0,0,1][m];d=d[g*p+c(f,q)];p=b(1,m)-1;q=32-m-(f&b(1,q)-1)*m;d=c(d,q)&p;16===m?0!==d&&(a=(d&31)<<3,f=(d>>>5&
31)<<3,m=(d>>>10&31)<<3,d=a+(a>>>5)+(f+(f>>>5)<<8)+(m+(m>>>5)<<16)+-16777216):d=0===E[a+15]?0:e(E,a+18)[d];return pb(d)}function x(a){return Aa(na()-a+4)}function q(a,b){return hb(na()-a+4,b)}function u(a){return Aa(na()-a+5)}function A(a,b){return hb(na()-a+5,b)}function B(a){return Aa(na()-a+0)}function D(a,b){return hb(na()-a+0,b)}function P(a){return Aa(na()-a+1)}function O(a,b){return hb(na()-a+1,b)}function F(a){return Aa(na()-a+2)}function C(a,b){return hb(na()-a+2,b)}function H(a){return Aa(na()-
a+3)}function I(a,b){return hb(na()-a+3,b)}function M(b,c,d){var e,f;var p=a(b);b=b.wordsAsInt32Array();for(e=f=0;e<=p-1;e++){var m=(b[e]|0)>>>16;var g=(b[e]|0)&65535;if(!(0<=g&&g<=c))return!1;f+=m}return f===d}function v(){return[1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,
-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0,.1950903220161282,.38268343236509,.555570233019602,.707106781186547,.831469612302545,.9238795325112865,.98078528040323,1]}function N(){return[0,.1950903220161282,.3826834323650897,.555570233019602,.707106781186547,.831469612302545,.923879532511287,.98078528040323,1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,
-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0]}function G(a,b){return 0>a?0:a>=b?b-1:a}function K(){var a=c(z[32],f());var b=c(z[34],f())+1;0>a&&(a=0);for(b>z[33]&&(b=z[33]);a<b;)da[a]=0,++a;z[32]=z[33];z[34]=0}function ba(a,b){var c,d,e,f;var p=c=B(a);var m=d=P(a);var g=e=F(a);var xa=f=H(a);var h=x(a);var l=
u(a);c=p+=(e-c)*b|0;var v=m+=(f-d)*b|0;g+=(h-e)*b|0;xa+=(l-f)*b|0;c+=(g-p)*b|0;v+=(xa-m)*b|0;m=t(m,d,v);xa=t(xa,v,l);b=k();if(X)return 0;C(a,p);I(a,m);q(a,c);A(a,v);D(b,c);O(b,v);C(b,g);I(b,xa);q(b,h);A(b,l);return b}function aa(a){var b,c,d,e;var f=k();if(X)return 0;var p=b=B(a);var m=d=P(a);var g=e=F(a);var t=c=H(a);var xa=x(a);var h=u(a);p+=e-b>>1;m+=c-d>>1;b=g+=xa-e>>1;c=t+=h-c>>1;b+=p-g>>1;c+=m-t>>1;C(a,p);I(a,m);q(a,b);A(a,c);D(f,b);O(f,c);C(f,g);I(f,t);q(f,xa);A(f,h);return f}function ha(a,
b){var c=p(a)[0]>>8;var d=$a(a)[0]>>8;if(c>d){var e=c;c=d;d=e}R(a,c);d-c>b?E[a+17]=d-c:E[a+17]=b}function Q(){return z[88]}function L(a){var b=c(z[32],f());b<z[42]&&(b=z[42]);var d=c(z[34]+z[48]-1,f());d>z[43]&&(d=z[43]);a=c(a,f());if(a<z[44]||a>=z[45]||d<z[42]||b>=z[43])return 0;(kb||ib())&&kb(b,d,a)}function T(a){return E[a+4]}function R(a,b){return E[a+4]=b}function ca(a,b){return E[a+5]=b}function ua(a,b){var c;S();var d=a;for(c=Na();c<b;){a=S();if(0!==a&&va(a,d,c))return!0;gc(c);d=c;c=Na()}a=
S();return 0!==a?va(a,d,b):!1}function Ka(a,b,d){if(1!==z[48]){var e;var p=h(b,d);var m=d-1&~(z[48]-1);var g=z[48];var q=f();if(b<p)for(e=c(a&z[51],z[50]);b<p;){var x=c(b,q);da[x]+=e;++b}if(b<m)for(p=c(z[51],f())|4042322160,e=c(a&p,f());b<m;)x=c(b,q),da[x]+=e,b+=g;if(b<d)for(e=c(a&z[51],z[50]);b<d;)x=c(b,q),da[x]+=e,++b}else{for(g=b;g+4<d;)da[g]=a,da[g+1]=a,da[g+2]=a,da[g+3]=a,g+=4;for(;g<d;)da[g]=a,++g}}function oa(a,b){var c=Aa(a+1)-Aa(b+1);return 0!==c?0<c:Aa(a)>>>0<Aa(b)>>>0}function va(a,p,g){if(0===
a)return!1;var q=p<z[35]?z[35]:p;var x=g>b(z[33],f())?b(z[33],f()):g;q<z[36]&&(q=z[36]);x>z[37]&&(x=z[37]);q<z[32]&&(z[32]=q);x>z[34]&&(z[34]=x);x>z[35]&&(z[35]=x);if(q>=x)return!1;if(0!==(a&4278190080))Ka(a,q,x);else{z[66]=a;z[67]=q;z[68]=x;var t=(ub(a)&65280)>>>8;if(1>=t)return!0;switch(t){case 2:var u=z[66],A=z[67],xa=z[68],l=Q(),k,v;var N=e(E,u+12);var n=E[u+10];var I=E[u+6];var w=(A-E[u+4])*I+(l-E[u+5])*E[u+7];for(v=A;(0>(k=w>>16)||k>=n)&&v<xa;)++v,w+=I;v>A&&(0>k&&(k=0),k>=n&&(k=n-1),Ka(N[k],
A,v));if(1===z[48])for(;(k=w>>16)<n&&0<=k&&v<xa;)da[v]=N[k],++v,w+=I;else{var r=w,F=v,y;var ra=z[48];var L=f();var B=E[u+10];var K=r;var D=F;var P=K>>16;var ic=h(F,xa);var M=xa-1&~(z[48]-1);var ba=z[51];for(y=z[50];D<ic&&P<B&&0<=P;){var O=N[P];for(O=c(O&ba,y);D<ic&&K>>16===P;){var C=c(D,L);da[C]+=O;++D;K+=I}P=K>>16}ba=c(z[51],f())|4042322160;for(y=f();D<M&&P<B&&0<=P;){O=N[P];for(O=c(O&ba,y);D<M&&K>>16===P;)C=c(D,L),da[C]+=O,D+=ra,K+=b(I,y);P=K>>16}ba=z[51];for(y=z[50];D<xa&&P<B&&0<=P;){O=N[P];for(O=
c(O&ba,y);D<xa&&K>>16===P;)C=c(D,L),da[C]+=O,++D,K+=I;P=K>>16}v=D}v<xa&&(0>k&&(k=0),k>=n&&(k=n-1),Ka(N[k],v,xa));break;case 3:var Kb=z[66],xc=z[67],Lb=z[68],T=Q(),aa;var R=e(E,Kb+12);var oa=E[Kb+10];var bb=xc-E[Kb+4];var H=T-E[Kb+5];var J=E[Kb+6];var ca=E[Kb+8];var ha=bb*J+H*E[Kb+7];var Qa=bb*ca+H*E[Kb+9];var wa=xc;for(aa=(oa-1)*(oa-1);ia(ha>>16,Qa>>16)>=aa&&wa<Lb;)++wa,ha+=J,Qa+=ca;wa>xc&&Ka(R[oa-1],xc,wa);var va=fa();va[0]=ha;va[1]=Qa;if(wa<E[Kb+4])if(1===z[48]){var Y=wa,Ba;var fb=va[0]|0;var S=
va[1]|0;var ua=d(fb>>16,S>>16);var U=R[ua];var ta=(ua-1)*(ua-1);var Oa=Y;var ib=Lb;for(ib>E[Kb+4]&&(ib=E[Kb+4]);Oa<ib;){for(;Oa<ib&&ia(fb>>16,S>>16)>=ta;)da[Oa]=U,++Oa,fb+=J,S+=ca;for(Ba=ia(fb>>16,S>>16);Ba<ta;)--ua,U=R[ua],ta=(ua-1)*(ua-1)}va[0]=fb;va[1]=S;wa=Oa}else{var V=wa,X;var Ca=va[0]|0;var nb=va[1]|0;var ja=z[48];var ka=f();var W=d(Ca>>16,nb>>16);var ea=(W-1)*(W-1);var Z=V;var ma=E[Kb+4];ma>Lb&&(ma=Lb);var pa=h(V,ma);var qa=ma-1&~(z[48]-1);if(Z<pa){var na=z[51];var sa=z[50];var la=R[W];for(la=
c(la&na,sa);Z<pa;){for(;Z<pa&&ia(Ca>>16,nb>>16)>=ea;){var ya=c(Z,ka);da[ya]+=la;++Z;Ca+=J;nb+=ca}for(X=ia(Ca>>16,nb>>16);X<ea;)--W,la=R[W],la=c(la&na,sa),ea=(W-1)*(W-1)}}if(Z<qa)for(na=c(z[51],f())|4042322160,sa=f(),la=R[W],la=c(la&na,sa);Z<qa;){for(;Z<qa&&ia(Ca>>16,nb>>16)>=ea;)ya=c(Z,ka),da[ya]+=la,Z+=ja,Ca+=b(J,sa),nb+=b(ca,sa);for(X=ia(Ca>>16,nb>>16);X<ea;)--W,la=R[W],la=c(la&na,sa),ea=(W-1)*(W-1)}if(Z<ma)for(na=z[51],sa=z[50],la=R[W],la=c(la&na,sa);Z<ma;){for(;Z<ma&&ia(Ca>>16,nb>>16)>=ea;)ya=
c(Z,ka),da[ya]+=la,++Z,Ca+=J,nb+=ca;for(X=ia(Ca>>16,nb>>16);X<ea;)--W,la=R[W],la=c(la&na,sa),ea=(W-1)*(W-1)}va[0]=Ca;va[1]=nb;wa=Z}if(wa<Lb)if(1===z[48]){var Ja=wa,Aa;var Fa=va[0]|0;var Ia=va[1]|0;var eb=d(Fa>>16,Ia>>16);var Ra=R[eb];var Ua=E[Kb+10];var Za=(Ua-1)*(Ua-1);var Ta=(eb+1)*(eb+1);var Va=ia(Fa>>16,Ia>>16);for(Aa=Ja;Aa<Lb&&Va<Za;){for(;Aa<Lb&&ia(Fa>>16,Ia>>16)<=Ta;)da[Aa]=Ra,++Aa,Fa+=J,Ia+=ca;for(Va=ia(Fa>>16,Ia>>16);Va>Ta;)++eb,Ra=R[eb],Ta=(eb+1)*(eb+1)}va[0]=Fa;va[1]=Ia;wa=Aa}else{var cb=
wa;var Ya=va[0]|0;var Ga=va[1]|0;var gb=z[48];var $a=f();var za=d(Ya>>16,Ga>>16);var jb=E[Kb+10];var Wa=(jb-1)*(jb-1);var Na=(za+1)*(za+1);var La=ia(Ya>>16,Ga>>16);var Da=cb;var mb=h(cb,Lb);var pb=Lb-1&~(z[48]-1);if(Da<mb&&La<Wa){var Xa=z[51];var Sa=z[50];var wb=R[za];for(wb=c(wb&Xa,Sa);Da<mb&&La<Wa;){for(;Da<mb&&ia(Ya>>16,Ga>>16)<=Na;){var ab=c(Da,$a);da[ab]+=wb;++Da;Ya+=J;Ga+=ca}for(La=ia(Ya>>16,Ga>>16);La>Na;)++za,wb=R[za],wb=c(wb&Xa,Sa),Na=(za+1)*(za+1)}}if(Da<pb&&La<Wa)for(Xa=c(z[51],f())|4042322160,
Sa=f(),wb=R[za],wb=c(wb&Xa,Sa);Da<pb&&La<Wa;){for(;Da<pb&&ia(Ya>>16,Ga>>16)<=Na;)ab=c(Da,$a),da[ab]+=wb,Da+=gb,Ya+=b(J,Sa),Ga+=b(ca,Sa);for(La=ia(Ya>>16,Ga>>16);La>Na;)++za,wb=R[za],wb=c(wb&Xa,Sa),Na=(za+1)*(za+1)}if(Da<Lb&&La<Wa)for(Xa=z[51],Sa=z[50],wb=R[za],wb=c(wb&Xa,Sa);Da<Lb&&La<Wa;){for(;Da<Lb&&ia(Ya>>16,Ga>>16)<=Na;)ab=c(Da,$a),da[ab]+=wb,++Da,Ya+=J,Ga+=ca;for(La=ia(Ya>>16,Ga>>16);La>Na;)++za,wb=R[za],wb=c(wb&Xa,Sa),Na=(za+1)*(za+1)}va[0]=Ya;va[1]=Ga;wa=Da}wa<Lb&&Ka(R[oa-1],wa,Lb);break;case 4:case 5:var lb=
z[66],ob=z[67],qb=z[68],yb=Q(),zb,sb;if(1!==z[48]){var xb,hb;if(xb=pc(lb)){var kb=E[lb+10];var Gb=E[lb+11];var tb=1===E[lb+16];var Nb=ob-E[lb+4];var nc=yb-E[lb+5];var Bb=E[lb+6];var Fb=E[lb+8];var Pb=Nb*Bb+nc*E[lb+7];var Qb=Nb*Fb+nc*E[lb+9];var Ob=z[48];var rc=h(ob,qb);var Vb=qb-1&~(z[48]-1);var Mb=f();var Ib=z[51];var Hb=z[50];for(hb=ob;hb<rc;){tb&&(Pb=Pa(Pb,kb<<16),Qb=Pa(Qb,Gb<<16));var Db=Pb>>16;var Eb=Qb>>16;tb||(Db=G(Db,kb),Eb=G(Eb,Gb));if(0<=Db&&0<=Eb&&Db<kb&&Eb<Gb){var Ub=m(lb,xb,Db,Eb);Ub=
c(Ub&Ib,Hb);var Cb=c(hb,Mb);da[Cb]+=Ub}Pb+=Bb;Qb+=Fb;++hb}Ib=c(z[51],f())|4042322160;for(Hb=f();hb<Vb;)tb&&(Pb=Pa(Pb,kb<<16),Qb=Pa(Qb,Gb<<16)),Db=Pb>>16,Eb=Qb>>16,tb||(Db=G(Db,kb),Eb=G(Eb,Gb)),0<=Db&&0<=Eb&&Db<kb&&Eb<Gb&&(Ub=m(lb,xb,Db,Eb),Ub=c(Ub&Ib,Hb),Cb=c(hb,Mb),da[Cb]+=Ub),Pb+=b(Bb,Hb),Qb+=b(Fb,Hb),hb+=Ob;Ib=z[51];for(Hb=z[50];hb<qb;)tb&&(Pb=Pa(Pb,kb<<16),Qb=Pa(Qb,Gb<<16)),Db=Pb>>16,Eb=Qb>>16,tb||(Db=G(Db,kb),Eb=G(Eb,Gb)),0<=Db&&0<=Eb&&Db<kb&&Eb<Gb&&(Ub=m(lb,xb,Db,Eb),Ub=c(Ub&Ib,Hb),Cb=c(hb,
Mb),da[Cb]+=Ub),Pb+=Bb,Qb+=Fb,++hb}}else if(zb=pc(lb)){var Rb=E[lb+10];var Sb=E[lb+11];var oc=1===E[lb+16];var bc=ob-E[lb+4];var cc=yb-E[lb+5];var dc=E[lb+6];var gc=E[lb+8];var Wb=bc*dc+cc*E[lb+7];var Xb=bc*gc+cc*E[lb+9];for(sb=ob;sb<qb;){oc&&(Wb=Pa(Wb,Rb<<16),Xb=Pa(Xb,Sb<<16));var ac=Wb>>16;var Yb=Xb>>16;oc||(ac=G(ac,Rb),Yb=G(Yb,Sb));if(0<=ac&&0<=Yb&&ac<Rb&&Yb<Sb){var qc=m(lb,zb,ac,Yb);da[sb]=qc}Wb+=dc;Xb+=gc;++sb}}}}return!1}function wa(){var a;for(a=Q();z[11]<z[12];){var b=Wa[z[11]];if(E[b+5]>
a)break;var c=ub(b);if(2===(c&254))return!0;if(!za(1))break;switch(c){case 4:Sa(Wa[z[11]],Q());break;case 5:var d=Wa[z[11]],e=Q();var f=E[d+20];var m=f>>1;var g=T(d);c=E[d+5];Sa(d,c);var q=E[d+7];var x=E[d+10];R(d,g-m);E[d+7]=q+f;0<x?E[d+17]=E[d+12]+f:(E[d+17]=f-E[d+12],R(d,T(d)+E[d+12]));x=0-q-m;E[d+18]=0;E[d+19]=x;0>=m&&0>x?mb(d,ub(d)&-65537):mb(d,ub(d)|65536);if(c!==e){for(m=c;m<=e-1;m++)Xa(d,m);E[d+7]-=e-c}break;case 6:Vb(Wa[z[11]],Q());break;case 7:m=Wa[z[11]];x=Q();d=E[m+20];e=d>>1;q=E[m+14];
c=E[m+5];Vb(m,c);g=E[m+7];for(f=0;5>=f;f++)$a(m)[f]=p(m)[f];f=p(m)[2];0===f&&p(m)[4];f=0<=f?1:-1;0>f?(p(m)[0]=p(m)[0]-256*e,f=$a(m)[0],$a(m)[0]=f+256*(d-e),f=$a(m)[1],$a(m)[1]=f+256*d,E[m+21]=q-e):(p(m)[0]=p(m)[0]+256*e,f=$a(m)[0],$a(m)[0]=f-256*(d-e),f=$a(m)[1],$a(m)[1]=f+256*d,E[m+21]=q-e+d);0===g&&(p(m)[0]=256*E[m+21]);E[m+7]=g+d;g=0-g-e;E[m+18]=0;E[m+19]=g;0>=e&&0>g?mb(m,ub(m)&-65537):mb(m,ub(m)|65536);ha(m,d);if(c!==x){for(f=c;f<=x-1;f++)La(m,f);E[m+7]-=x-c}}nb(b);z[11]+=1}return!1}function Ba(){var a;
for(a=z[37];z[13]<z[14];){var b=U[z[13]];var c=a=T(b);if(c>=z[37])return!1;gc(c);if(eb(b)){var d=b;var e=ub(d)>>>1;Mb=d;switch(e){case 2:ab=E[Mb+17];break;case 3:ab=E[Mb+17]}var f=ab;switch(e){case 2:ab=E[Mb+16];break;case 3:ab=E[Mb+16]}e=ab;if(0!==e&&za(3)){var m=(E[d+6]<<1)+1;f=T(d)+f;var p=bb(e,m);-1===p?Ta(e,m,f):Aa(p+2)<f&&la(p,f);gc(T(d))}}if(0===(E[b+0]&65536)&&(e=b,za(6)&&(d=E[e+6]<<1,b=E[e+8],0!==b&&Ib(b,d,999999999),b=E[e+9],0!==b&&Ib(b,d,999999999),gc(T(e))),X))return!1;z[13]+=1;z[13]<
z[14]&&(a=U[z[13]],a=T(a),a>=z[36]&&ua(c,a))}a<z[37]&&ua(a,z[37]);return!1}function ta(){for(var a,b;z[13]<z[14];)if(b=U[z[13]],a=E[b+7]-1,0===a)qc();else{E[b+7]=a;a=ub(b);if(2===(a&254))return!0;switch(a){case 4:qb(U[z[13]],Q());break;case 5:Xa(U[z[13]],Q());break;case 6:a=U[z[13]];b=Q();b=jb(p(a),b);R(a,b);break;case 7:La(U[z[13]],Q())}Ua();z[13]+=1}return!1}function bb(a,b){var c;for(c=0;c<na()&&(Aa(c)!==a||Aa(c+1)!==b);)c+=3;return c>=na()?-1:c}function Qa(a,b){if(a===b)return!0;var c=E[a+5]-
E[b+5];if(0!==c)return 0>c;c=T(a)-T(b);return 0>c}function fb(a,b){b=bb(a,b);if(-1===b)return!1;if(0===b)return z[10]+=3,!0;xb(b,Aa(0));W(b,Aa(1));la(b,Aa(2));z[10]+=3;if(3>=na())return!0;a=0;for(b=3;b<na();)oa(b,a)&&(a=b),b+=3;if(a+3===na())return!0;b=Aa(a);xb(a,Aa(na()-3));ma(b);b=Aa(a+1);W(a,Aa(na()-3+1));yb(b);b=Aa(a+2);la(a,Aa(na()-3+2));Fb(b);return!0}function Y(a,b){return z[a]+=b}function ib(){Ia=r.ioLoadFunctionFrom("loadBitBltFrom",ea);kb=r.ioLoadFunctionFrom("copyBitsFromtoat",ea);return!!Ia&&
!!kb}function Oa(){cb(z[48]);0>z[42]&&(z[42]=0);z[43]>z[33]&&(z[43]=z[33]);z[36]=b(z[42],f());z[38]=b(z[44],f());z[37]=b(z[43],f());z[39]=b(z[45],f());z[12]=0;z[14]=0;Wa=e(E,V);U=e(E,V);var a;var c=0;for(a=V;c<a;){var d=c;if((255<ub(d)?0:0!==(ub(d)&255))&&!(E[c+5]>=z[39]))if(d=c,4===(ub(d)&254)){var m=d;d=eb(m)?E[m+20]:0;E[m+15]+d<z[38]||T(m)-d>=z[37]&&E[m+14]-d>=z[37]||n(m)}else 6===(ub(d)&254)?(m=d,d=eb(m)?E[m+20]:0,E[m+15]+d<z[38]||T(m)-d>=z[37]&&E[m+14]-d>=z[37]||n(m)):n(d);c+=E[c+1]}if(X)return null;
if(0===z[12])return z[88]=z[39],0;Wb(Wa,0,z[12]-1);z[88]=E[Wa[0]+5];Q()<z[38]&&(z[88]=z[38]);z[32]=0;z[34]=b(z[33],f())-1;K()}function nb(a){var b;if(0>=E[a+7])return null;var c=T(a);for(b=0;b<z[14]&&T(U[b])<c;)++b;for(;b<z[14]&&T(U[b])===c&&Qa(U[b],a);)++b;if(za(1)){for(c=z[14]-1;!(c<b);)U[c+1]=U[c],--c;U[b]=a;z[14]+=1}}function Ca(a){var b;(b=0===a)||(b=0!==(a&4278190080))||!(b=0<=a&&a<V)||(b=0!==(a&4278190080)||0!==(ub(a)&65280));return b}function eb(a){return 0!==(ub(a)&1)}function Ya(a,b,c,d){var e=
k();if(X)return 0;D(e,a[0]);O(e,a[1]);C(e,b[0]);I(e,b[1]);q(e,c[0]);A(e,c[1]);a=P(e);c=H(e);b=u(e);a=c-a;b-=c;0<=a*b?a=e:(Y(108,1),b-=a,0>a&&(a=0-a),0>b&&(b=0-b),a=ba(e,a/b));a=b=c=a;d&&(b=ja(e));b>c&&(c=b);e!==a&&d&&(b=ja(a));b>c&&(c=b);for(d=a=c;e<=a;e+=6)if(b=Rb(e),b>d&&(d=b),X)return 0;return Math.floor(d/6)|0}function Gb(a){return Ia||ib()?Ia(a):!1}function Nb(c,d,f,m,p,g,q){if(d.isNil){var x=0;var u=null}else{if(l(d)!==r.classBitmap())return r.primitiveFail();x=a(d);u=d.wordsAsInt32Array()}if("number"===
typeof c||!r.isPointers(c)||5>a(c))return r.primitiveFail();d=r.fetchPointerofObject(0,c);if(l(d)!==r.classBitmap())return r.primitiveFail();d=a(d);var t=r.fetchIntegerofObject(1,c);var A=r.fetchIntegerofObject(2,c);c=r.fetchIntegerofObject(3,c);if(r.failed())return null;if(!(0<=t&&0<=A)||32!==c&&8!==c&&16!==c&&1!==c&&2!==c&&4!==c||0!==x&&x!==b(1,c))return r.primitiveFail();var h=Math.floor(32/c)|0;h=Math.floor((t+(h-1))/h)|0;if(d!==h*A)return r.primitiveFail();var xa;var k=18+x;if(w(k)){var v=V;
V=v+k;mb(v,1024);E[v+2]=0;E[v+1]=k;k=e(E,v+18);if(0!==z[17])for(xa=0;xa<=x-1;xa++)k[xa]=ka(u[xa]);else for(xa=0;xa<=x-1;xa++)k[xa]=u[xa];E[v+15]=x;x=v}else x=0;if(X)return null;E[x+10]=t;E[x+11]=A;E[x+12]=c;E[x+14]=h;E[x+13]=d;E[x+16]=f;E[x+2]=q;nc(x,m,p,g,t,A);return x}function pc(b){var c=E[b+2];if(c>a(Bb))return null;c=r.fetchPointerofObject(c,Bb);c=r.fetchPointerofObject(0,c);return a(c)!==E[b+13]?null:c.wordsAsInt32Array()}function oc(a,b,c,d,e,f,m){if(d===e&&(0===f||0===m))return null;a*=6;
if(c){c=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+0];var p=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+1];var g=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+2];var q=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+3];var x=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+4];b=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+5]}else c=b[a+0]|0,p=b[a+1]|
0,g=b[a+2]|0,q=b[a+3]|0,x=b[a+4]|0,b=b[a+5]|0;if(c===g&&p===q||g===x&&q===b){if(c===x&&p===b)return null;fa()[0]=c;fa()[1]=p;pa()[0]=x;pa()[1]=b;Ra(2);return Ob(f,fa(),pa(),m,d,e)}fa()[0]=c;fa()[1]=p;pa()[0]=g;pa()[1]=q;Fa()[0]=x;Fa()[1]=b;Ra(3);b=Ya(fa(),pa(),Fa(),0!==f&&0!==m);if(X)return null;Xb(f,m,d,e,b)}function ac(b){var c=z[65];if(6>a(b))return null;R(c,r.fetchIntegerofObject(1,b));ca(c,r.fetchIntegerofObject(2,b));var d=r.fetchIntegerofObject(3,b);E[c+6]=d;b=r.fetchIntegerofObject(4,b);E[c+
7]=b;return c}function nc(a,b,c,d,e,f){c[0]+=b[0];c[1]+=b[1];d[0]+=b[0];d[1]+=b[1];Z(b);Z(c);Z(d);var m=c[0]-b[0];var p=c[1]-b[1];c=d[0]-b[0];d=d[1]-b[1];var g=m*m+p*p;0<g?(m=m*e*65536/g|0,e=p*e*65536/g|0):e=m=0;p=c*c+d*d;0<p?(c=c*f*65536/p|0,f=d*f*65536/p|0):f=c=0;E[a+4]=b[0];E[a+5]=b[1];E[a+6]=m;E[a+7]=e;E[a+8]=c;E[a+9]=f}function rc(b){if(!r.isArray(b))return!1;Bb=b;for(b=0;b<=a(Bb)-1;b++){var c=r.fetchPointerofObject(b,Bb);if("number"===typeof c||!r.isPointers(c)||5>a(c))return!1;var d=r.fetchPointerofObject(0,
c);if(l(d)!==r.classBitmap())return!1;d=a(d);var e=r.fetchIntegerofObject(1,c);var f=r.fetchIntegerofObject(2,c);c=r.fetchIntegerofObject(3,c);if(r.failed()||!(0<=e&&0<=f))return!1;c=Math.floor(32/c)|0;e=Math.floor((e+(c-1))/c)|0;if(d!==e*f)return!1}return!0}function Va(a,b){if(l(b)!==r.classPoint())return r.primitiveFail();var c=r.fetchPointerofObject(0,b);if("number"!==typeof c&&!c.isFloat)return r.primitiveFail();a[0]="number"===typeof c?c:r.floatValueOf(c)|0;c=r.fetchPointerofObject(1,b);if("number"!==
typeof c&&!c.isFloat)return r.primitiveFail();a[1]="number"===typeof c?c:r.floatValueOf(c)|0}function yc(){var b;if(2!==r.methodArgumentCount())return 5;if(0!==(b=zb(r.stackValue(2))))return b;var c=r.stackObjectValue(0);var d=r.stackObjectValue(1);if(r.failed())return 3;if(0!==(b=bc(r.fetchPointerofObject(1,Da))))return b;if(!Gb(r.fetchPointerofObject(2,Da)))return 122;if(!rc(r.fetchPointerofObject(3,Da)))return 123;if(6>a(d))return 112;if(6>a(c))return 113;d=z[2];return 2===d||4===d||7===d?116:
0}function bc(b){if(l(b)!==r.classBitmap())return 114;da=b.words;z[33]=a(b)-1;return 0}function cc(b,c,d){if(b.isNil)return!1;if("number"===typeof b||a(b)!==d)return r.primitiveFail();if(r.isWords(b)){var e=b.wordsAsFloat32Array();for(b=0;b<=d-1;b++)c[b]=e[b]}else a:for(e=0;e<=d-1;e++){var f=r.fetchPointerofObject(e,b);if("number"!==typeof f&&!f.isFloat){r.primitiveFail();break a}c[e]="number"===typeof f?f:r.floatValueOf(f)}return!0}function Xb(a,b,c,d,e){if(0===a||0===b){var f=!1;var m=0}else f=
!0,m=a>>1;for(e*=6;0<e;){if(f)if(w(28)){var p=V;V=p+28;mb(p,7);E[p+2]=0;E[p+1]=28}else p=0;else w(16)?(p=V,V=p+16,mb(p,6),E[p+2]=0,E[p+1]=16):p=0;if(X)return 0;var g=p,q=e,t=c,A=d,h=m;if(u(q)>=P(q)){R(g,B(q));ca(g,P(q)-h);var l=F(q);E[g+12]=l;l=H(q)-h;E[g+13]=l;l=x(q);E[g+14]=l;q=u(q)-h}else R(g,x(q)),ca(g,u(q)-h),l=F(q),E[g+12]=l,l=H(q)-h,E[g+13]=l,l=B(q),E[g+14]=l,q=P(q)-h;E[g+15]=q;E[g+6]=z[113];E[g+8]=t;E[g+9]=A;f&&(E[p+16]=b,E[p+17]=a,E[p+20]=a);e-=6}Ga()}function Ob(a,b,c,d,e,f){if(0===a||0===
d){if(w(16)){var m=V;V=m+16;mb(m,4);E[m+2]=0;E[m+1]=16}else m=0;var p=0}else w(21)?(m=V,V=m+21,mb(m,5),E[m+2]=0,E[m+1]=21):m=0,p=a>>1;if(X)return 0;var g=m;if(b[1]<=c[1]){var q=b;b=c;c=1}else q=c,c=-1;R(g,q[0]);ca(g,q[1]-p);E[g+6]=z[113];E[g+8]=e;E[g+9]=f;E[g+14]=b[0];E[g+15]=b[1]-p;E[g+11]=c;eb(m)&&(E[m+16]=d,E[m+17]=a,E[m+20]=a)}function Sb(b){if("number"===typeof b)return 105;if(!r.isWords(b))return 106;if(256>a(b))return 107;z=b.wordsAsInt32Array();if(1097753705!==z[0])return 108;if(z[1]!==a(b))return 109;
if(128!==z[8])return 110;E=e(z,z[8]);Wa=e(E,z[9]);U=e(Wa,z[12]);return 128+z[9]+z[12]+z[14]>z[1]?111:0}function za(a){return 128+V+z[12]+z[14]+a>z[10]?(gb(1),!1):!0}function ya(a){return z[9]=a}function ub(a){return E[a+0]&65535}function mb(a,b){return E[a+0]=b}function fa(){return e(z,80)}function pa(){return e(z,82)}function Fa(){return e(z,84)}function dc(){z[11]>=z[12]&&0===z[14]&&sa(8);Q()>=z[39]&&sa(8)}function Hb(){for(var a;8!==z[2];){qa&&(J=r.ioMicroMSecs());a=wa();qa&&(Y(95,1),Y(94,r.ioMicroMSecs()-
J));if(X)return sa(1);if(a)return sa(2),gb(4);z[13]=0;Ga();z[69]=1;qa&&(J=r.ioMicroMSecs());0!==z[69]&&0===(Q()&z[52])&&K();z[69]=0;a=Ba();qa&&(Y(99,1),Y(98,r.ioMicroMSecs()-J));if(X)return sa(3);if(a)return sa(4),gb(5);Ga();z[35]=0;qa&&(J=r.ioMicroMSecs());(Q()&z[52])===z[52]&&(L(Q()),dc());qa&&(Y(103,1),Y(102,r.ioMicroMSecs()-J));if(X)return sa(5);if(8===z[2])return 0;z[13]=0;z[88]=Q()+1;qa&&(J=r.ioMicroMSecs());a=ta();qa&&(Y(105,1),Y(104,r.ioMicroMSecs()-J));if(X)return sa(6);if(a)return sa(7),
gb(6)}}function zc(){var a=z[2];if(0===a){Oa();if(X)return 0;a=1}if(1===a){qa&&(J=r.ioMicroMSecs());a=wa();qa&&(Y(95,1),Y(94,r.ioMicroMSecs()-J));if(X)return sa(1);if(a)return sa(2),gb(4);z[13]=0;Ga();z[69]=1;a=3}if(3===a){qa&&(J=r.ioMicroMSecs());0!==z[69]&&0===(Q()&z[52])&&K();z[69]=0;a=Ba();qa&&(Y(99,1),Y(98,r.ioMicroMSecs()-J));if(X)return sa(3);if(a)return sa(4),gb(5);a=5;Ga();z[35]=0}if(5===a){qa&&(J=r.ioMicroMSecs());(Q()&z[52])===z[52]&&(L(Q()),dc());qa&&(Y(103,1),Y(102,r.ioMicroMSecs()-J));
if(X)return sa(5);if(8===z[2])return 0;a=6;z[13]=0;z[88]=Q()+1}if(6===a){qa&&(J=r.ioMicroMSecs());a=ta();qa&&(Y(105,1),Y(104,r.ioMicroMSecs()-J));if(X)return sa(6);if(a)return sa(7),gb(6);sa(1)}}function zb(b){if(r.failed())return 100;if("number"===typeof b)return 101;if(!r.isPointers(b))return 102;if(12>a(b))return 103;Da=b;if(0!==(b=Sb(r.fetchPointerofObject(0,b))))return b;z[64]=0;V=z[9];X=!1;return 0}function Za(a,b){if(0!==(a=zb(a)))return a;if(z[2]===b)return 0;z[64]=2;return 116}function gc(a){if(0===
na())return null;for(;Na()<=a;){var b=S();var c=0===na()?-1:Aa(na()-3+1);fb(b,c);if(0===na())return null}}function Wb(a,b,c){var d;if(1>=(d=c+1-b))return 0;var e=a[b];var f=a[c];var m=Qa(e,f);if(!m){m=a[b];a[b]=a[c];a[c]=m;var p=e;e=f;f=p}if(2>=d)return 0;var g=b+c>>1;p=a[g];(m=Qa(e,p))?(m=Qa(p,f),m||(m=a[c],a[c]=a[g],a[g]=m,p=f)):(m=a[b],a[b]=a[g],a[g]=m,p=e);if(3>=d)return 0;e=b;f=c;for(d=!0;d;){for(m=!0;m;)e<=--f?(m=a[f],m=Qa(p,m)):m=!1;for(m=!0;m;)++e<=f?(m=a[e],m=Qa(m,p)):m=!1;if(d=e<=f)m=a[e],
a[e]=a[f],a[f]=m}Wb(a,b,f);Wb(a,e,c)}function qc(){var a=z[13];for(--z[14];a<z[14];)U[a]=U[a+1],++a}function Pa(a,b){for(;0>a;)a+=b;for(;a>=b;)a-=b;return a}function Ua(){if(0===z[13])return null;var a=U[z[13]];var b=T(a);if(T(U[z[13]-1])<=b)return null;var c;for(c=z[13];0<c&&T(U[c-1])>b;)U[c]=U[c-1],--c;U[c]=a}function cb(a){var b;4<=a&&(b=4);2<=a&&4>a&&(b=2);2>a&&(b=1);z[48]=b;1===b&&(z[49]=0,z[51]=4294967295,z[52]=0);2===b&&(z[49]=1,z[51]=4244438268,z[52]=1);4===b&&(z[49]=2,z[51]=4042322160,z[52]=
3);z[50]=2*f();z[53]=f()}function Ta(a,b,c){if(!Cb(3))return null;hb(0,a);W(0,b);la(0,c);if(3===na())return null;oa(0,na()-3)&&(xb(0,Aa(na()-3)),W(0,Aa(na()-3+1)),la(0,Aa(na()-3+2)),ma(a),yb(b),Fb(c))}function ia(a,b){return a*a+b*b}function W(a,b){return hb(a+1,b)}function la(a,b){return hb(a+2,b)}function xb(a,b){return hb(a,b)}function sa(a){return z[2]=a}function Vb(a,b){if(!eb(a)&&b>=E[a+15])return E[a+7]=0;var c=T(a);var d=E[a+5];var e=E[a+12];var f=E[a+13];var m=E[a+14];var g=E[a+15];var q=
g-d;var x=2*q;2>x&&(x=2);x=Math.floor(16777216/x)|0;var u=x&65535;var t=x>>>16&255;u=(u*u>>>16)+u*t*2+(t*t<<16)>>>8;m=(c+m-2*e)*u*2;e=2*(e-c)*x+(m>>1);g=(d+g-2*f)*u*2;f=2*(f-d)*x+(g>>1);E[a+7]=q;x=p(a);x[0]=256*c;x[1]=256*d;x[2]=e;x[3]=f;x[4]=m;x[5]=g;(d=E[a+5])!==b&&(c=jb(p(a),b),R(a,c),E[a+7]=q-(b-d))}function Sa(a,b){if(!eb(a)&&b>=E[a+15])return E[a+7]=0;var c=E[a+14]-T(a);var d=E[a+15]-E[a+5];if(0<=c){var e=1;var f=c;var m=0}else e=-1,f=0-c,m=1-d;0===d?f=m=0:d>f?c=0:(c=(Math.floor(f/d)|0)*e,f=
f-(Math.floor(f/d)|0)*d|0);E[a+7]=d;E[a+10]=e;E[a+12]=c;E[a+13]=m;E[a+14]=f;E[a+15]=d;if((e=E[a+5])!==b){for(m=e;m<=b-1;m++)qb(a,m);E[a+7]=d-(b-e)}}function jb(a,b){var c=a[0];var d=a[1];var e=a[2];var f=a[3];for(b*=256;b>d&&0<=f;)c+=e+32768>>16,d+=f+32768>>16,e+=a[4],f+=a[5];a[0]=c;a[1]=d;a[2]=e;a[3]=f;return c>>8}function qb(a,b){var c=T(a)+E[a+12];b=E[a+13]+E[a+14];0<b&&(c+=E[a+10],b-=E[a+15]);E[a+13]=b;R(a,c)}function La(a,b){var c=E[a+20];var d=c>>1;var e=E[a+18]+1;var f=E[a+19]+1;E[a+18]=e;
E[a+19]=f;e>=d&&mb(a,ub(a)&-65537);0<=f&&mb(a,ub(a)|65536);0>f+d?jb(p(a),b):p(a)[0]=256*E[a+21];jb($a(a),b);ha(a,c)}function Xa(a,b){var c=E[a+18]+1;var d=E[a+19]+1;E[a+18]=c;E[a+19]=d;var e=E[a+20];var f=e>>1;c>=f&&mb(a,ub(a)&-65537);0<=d&&mb(a,ub(a)|65536);var m=T(a);qb(a,b);b=T(a);if(c<=e||0<=d+f){var p=E[a+18];var g=E[a+19];f=E[a+20];e=f>>1;c=E[a+17];d=E[a+10];b-=m;p<f&&(0>d?c-=b:(c+=b,R(a,m)));0===g+e&&(0<d?c-=E[a+12]:(c+=E[a+12],R(a,m)));0<g+e&&(0>d?(c+=b,R(a,m)):c-=b);E[a+17]=c}}function gb(a){z[64]=
a;X=!0}function ob(b,c){if(6>a(c))return r.primitiveFail();r.storeIntegerofObjectwithValue(0,c,E[b+2]);r.storeIntegerofObjectwithValue(1,c,T(b));r.storeIntegerofObjectwithValue(2,c,Q());r.storeIntegerofObjectwithValue(3,c,E[b+6]);r.storeIntegerofObjectwithValue(4,c,E[b+7]);z[65]=b}function sb(b){var c=z[66];var d=z[67];var e=z[68];if(6>a(b))return r.primitiveFail();r.storeIntegerofObjectwithValue(0,b,E[c+2]);r.storeIntegerofObjectwithValue(1,b,d);r.storeIntegerofObjectwithValue(2,b,e);r.storeIntegerofObjectwithValue(3,
b,Q())}function Ja(){if(r.failed())return null;if(X){var a=r.stackObjectValue(1),b=r.stackObjectValue(0);var c=z[64];if(4===c){var d=Wa[z[11]];ob(d,a);z[11]+=1}5===c&&sb(b);6===c&&(d=U[z[13]],ob(d,a))}ya(V);r.pop(3);r.pushInteger(z[64])}function Yb(a){var b=P(a);var c=u(a);if(c===b)return a;c-=b;0>c&&(c=0-c);if(255<c)return Y(109,1),aa(a);b=B(a);b=x(a)-b;0>b&&(b=0-b);return 32*c<b?(Y(110,1),aa(a)):a}function Rb(a){var b=Yb(a);if(b!==a){a=Rb(a);if(X)return 0;b=Rb(b);return X?0:a>=b?a:b}return a}function ja(a){var b=
B(a);var c=F(a);var d=x(a);b=c-b;d-=c;if(0<=b*d)return a;Y(108,1);d-=b;0>b&&(b=0-b);0>d&&(d=0-d);return ba(a,b/d)}function Ib(a,b,c){var d;0===na()?Cb(3)&&(ma(a),yb(b),Fb(c)):(d=fb(a,b))||Ta(a,b,c)}function S(){return 0===na()?0:Aa(na()-3)}function yb(a){return W(na()-3,a)}function Fb(a){return la(na()-3,a)}function ma(a){return xb(na()-3,a)}function Na(){return 0===na()?999999999:Aa(na()-3+2)}function ka(a){if(0!==a&&0===(a&4278190080))return a;var b=a&255;var c=a>>>8&255;var d=a>>>16&255;a=a>>>
24&255;if(0!==z[17]){var e=g(z,24);var f=(a*e[6]+e[7])/a;d=(d*e[0]+e[1])*f|0;c=(c*e[2]+e[3])*f|0;b=(b*e[4]+e[5])*f|0;d=Math.max(d,0);d=Math.min(d,255);c=Math.max(c,0);c=Math.min(c,255);b=Math.max(b,0);b=Math.min(b,255);a=Math.max(a*f|0,0);a=Math.min(a,255)}if(1>a)return 0;255>a&&0!==z[63]&&gb(3);return b+(c<<8)+(d<<16)+(a<<24)}function Z(a){if(0!==z[16]){var b=a[0]|0,c=a[1]|0;var d=g(z,18);var e=(d[0]*b+d[1]*c+d[2])*z[48]|0;b=(d[3]*b+d[4]*c+d[5])*z[48]|0;a[0]=e;a[1]=b}else a[0]=(a[0]+z[46])*z[48],
a[1]=(a[1]+z[47])*z[48]}function Ra(a){0<a&&Z(fa());1<a&&Z(pa());2<a&&Z(Fa());3<a&&Z(e(z,86))}function tb(a){if(0===a)return 0;fa()[0]=0;fa()[1]=0;pa()[0]=256*a;pa()[1]=0;Fa()[0]=0;Fa()[1]=256*a;Ra(3);var b=pa()[0]-fa()[0];var c=pa()[1]-fa()[1];a=(Math.sqrt(b*b+c*c)|0)+128>>8;b=Fa()[0]-fa()[0];c=Fa()[1]-fa()[1];b=(Math.sqrt(b*b+c*c)|0)+128>>8;b<a&&(a=b);return 0===a?1:a}function pb(a){if(0===z[17])return a;var b=a&255;var c=a>>>8&255;var d=a>>>16&255;a=a>>>24&255;var e=g(z,24);d=d*e[0]+e[1]|0;c=c*
e[2]+e[3]|0;b=b*e[4]+e[5]|0;a=a*e[6]+e[7]|0;d=Math.max(d,0);d=Math.min(d,255);c=Math.max(c,0);c=Math.min(c,255);b=Math.max(b,0);b=Math.min(b,255);a=Math.max(a,0);a=Math.min(a,255);return 16>a?0:b+(c<<8)+(d<<16)+(a<<24)}function Ga(){z[10]=z[1]}function Cb(a){if(!za(a))return!1;z[10]-=a;return!0}function na(){return z[1]-z[10]}function Aa(a){return z[z[10]+a]}function hb(a,b){return z[z[10]+a]=b}function $a(a){return e(E,a+22)}var U=null,ea="BitBltPlugin",kb=null,ab=0,Mb=0,qa=0,Da=0,X=0,Bb=0,J=0,Wa=
null,r=null,Ia=null,E=null,V=0,da=null,z=null;Squeak.registerExternalModule("B2DPlugin",{primitiveMergeFillFrom:function(){var b;qa&&(J=r.ioMicroMSecs());if(2!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=Za(r.stackValue(2),4))||0!==(b=bc(r.fetchPointerofObject(1,Da))))return r.primitiveFailFor(b);var d=r.stackObjectValue(0);b=r.stackObjectValue(1);if(r.failed()||l(b)!==r.classBitmap())return r.primitiveFailFor(3);if(6>a(d))return r.primitiveFailFor(113);var e=r.fetchIntegerofObject(0,
d);if(E[z[66]+2]!==e)return r.primitiveFailFor(117);e=r.fetchIntegerofObject(1,d);if(z[67]!==e)return r.primitiveFailFor(117);e=r.fetchIntegerofObject(2,d);if(z[68]!==e)return r.primitiveFailFor(117);if(a(b)<z[68]-z[67])return r.primitiveFailFor(3);if(r.failed())return null;b=b.wordsAsInt32Array();d=z[68];var m=z[67];var p=-1;if(1===z[48])for(;m<d;){var g=b[++p]|0;da[m]=g;++m}else{var q=z[51];var x=z[50];for(e=f();m<d;){var u=c(m,e);g=b[++p]|0;g=c(g&q,x);da[u]+=g;++m}}d>z[34]&&(z[34]=d);d>z[35]&&
(z[35]=d);sa(3);ya(V);r.pop(2);qa&&(Y(101,1),Y(100,r.ioMicroMSecs()-J))},primitiveCopyBuffer:function(){var b,c;if(2!==r.methodArgumentCount())return r.primitiveFailFor(5);var d=r.stackValue(0);var f=r.stackValue(1);if(0!==(b=Sb(f)))return r.primitiveFailFor(b);if(l(f)!==l(d))return r.primitiveFailFor(114);f=a(d)-a(f);if(0>f)return r.primitiveFailFor(115);var m=z;b=d.wordsAsInt32Array();var p=0;for(c=z[10]-1;p<=c;p++)b[p]=m[p];b[10]=z[10]+f;b[1]=z[1]+f;m=e(m,z[10]);b=e(b,z[10]+f);p=0;for(c=z[1]-z[10]-
1;p<=c;p++)b[p]=m[p];if(0!==(b=Sb(d)))return r.primitiveFailFor(b);r.pop(2)},primitiveAddRect:function(){var a;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);var b=r.positive32BitValueOf(r.stackValue(0));var c=r.stackIntegerValue(1);var d=r.positive32BitValueOf(r.stackValue(2));var f=r.stackObjectValue(3);var m=r.stackObjectValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(a=Za(r.stackValue(5),0)))return r.primitiveFailFor(a);if(!Ca(b)||!Ca(d))return r.primitiveFailFor(117);
b=ka(b);d=ka(d);if(X)return r.primitiveFailFor(104);if(0===d&&(0===b||0===c))return r.pop(5);if(!za(64))return r.primitiveFailFor(111);c=0<c&&0!==b?tb(c):0;Va(fa(),m);Va(Fa(),f);if(r.failed())return r.primitiveFailFor(121);pa()[0]=Fa()[0];pa()[1]=fa()[1];e(z,86)[0]=fa()[0];e(z,86)[1]=Fa()[1];Ra(4);Ob(c,fa(),pa(),b,0,d);Ob(c,pa(),Fa(),b,0,d);Ob(c,Fa(),e(z,86),b,0,d);Ob(c,e(z,86),fa(),b,0,d);if(r.failed())return r.primitiveFailFor(119);z[63]=1;ya(V);r.pop(5)},primitiveAddGradientFill:function(){var b;
if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);var c=r.booleanValueOf(r.stackValue(0));var d=r.stackValue(1);var f=r.stackValue(2);var m=r.stackValue(3);var p=r.stackValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(b=Za(r.stackValue(5),0)))return r.primitiveFailFor(b);Va(fa(),m);Va(pa(),f);Va(Fa(),d);if(r.failed())return r.primitiveFailFor(121);f=fa();b=pa();d=Fa();if(l(p)!==r.classBitmap())c=r.primitiveFail();else{m=a(p);p=p.wordsAsInt32Array();var g=12+m;if(w(g)){var q=V;
V=q+g;c?mb(q,768):mb(q,512);E[q+2]=0;E[q+1]=g;g=e(E,q+12);if(0!==z[17])for(c=0;c<=m-1;c++)g[c]=ka(p[c]);else for(c=0;c<=m-1;c++)g[c]=p[c];E[q+10]=m;c=q}else c=0;X?c=null:nc(c,f,b,d,m,m)}if(X)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);ya(V);r.popthenPush(6,r.positive32BitIntegerFor(c))},primitiveSetClipRect:function(){var b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=Za(r.stackValue(1),0)))return r.primitiveFailFor(b);b=r.stackObjectValue(0);
if(r.failed()||!(r.isPointers(b)&&2<=a(b)))return r.primitiveFailFor(3);Va(fa(),r.fetchPointerofObject(0,b));Va(pa(),r.fetchPointerofObject(1,b));if(r.failed())return r.primitiveFailFor(3);z[42]=fa()[0];z[44]=fa()[1];z[43]=pa()[0];z[45]=pa()[1];ya(V);r.pop(1)},initialiseModule:ib,primitiveSetBitBltPlugin:function(){var a=r.stackValue(0);if(!r.isBytes(a)||256<=(a.bytes?a.bytes.length:a.words?4*a.words.length:0))return r.primitiveFail();var b=!1;a=a.bytesAsString();a!==ea&&(ea=a,b=!0);if(b&&!ib())return r.primitiveFail();
r.pop(1)},primitiveRegisterExternalEdge:function(){var a;if(6!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(6),0)))return r.primitiveFailFor(a);var b=r.positive32BitValueOf(r.stackValue(0));var c=r.positive32BitValueOf(r.stackValue(1));var d=r.stackIntegerValue(2);var e=r.stackIntegerValue(3);var f=r.stackIntegerValue(4);var m=r.stackIntegerValue(5);if(r.failed())return r.primitiveFailFor(3);if(!w(10))return r.primitiveFailFor(111);if(!Ca(c)||!Ca(b))return r.primitiveFailFor(117);
a=V;V=a+10;mb(a,2);E[a+1]=10;E[a+2]=m;R(a,f);ca(a,e);E[a+6]=d;m=ka(c);E[a+8]=m;b=ka(b);E[a+9]=b;if(X)return r.primitiveFailFor(104);r.failed()||(ya(V),r.pop(6))},primitiveGetClipRect:function(){var b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=zb(r.stackValue(1))))return r.primitiveFailFor(b);var c=r.stackObjectValue(0);if(r.failed()||!(r.isPointers(c)&&2<=a(c)))return r.primitiveFailFor(3);r.pushRemappableOop(c);b=r.makePointwithxValueyValue(z[42],z[44]);r.storePointerofObjectwithValue(0,
r.topRemappableOop(),b);b=r.makePointwithxValueyValue(z[43],z[45]);c=r.popRemappableOop();r.storePointerofObjectwithValue(1,c,b);r.popthenPush(2,c)},primitiveAddBezier:function(){var a;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);var b=r.positive32BitValueOf(r.stackValue(0));var c=r.positive32BitValueOf(r.stackValue(1));var d=r.stackObjectValue(2);var e=r.stackObjectValue(3);var f=r.stackObjectValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(a=Za(r.stackValue(5),0)))return r.primitiveFailFor(a);
if(!Ca(c)||!Ca(b))return r.primitiveFailFor(117);Va(fa(),f);Va(pa(),d);Va(Fa(),e);if(r.failed())return r.primitiveFailFor(3);Ra(3);e=Ya(fa(),pa(),Fa(),!1);za(16*e);X||(c=ka(c),b=ka(b));X||Xb(0,0,c,b,e);if(X)return Ga(),r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);ya(V);r.pop(5)},primitiveInitializeProcessing:function(){var a;qa&&(J=r.ioMicroMSecs());if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(0),0))||0!==(a=bc(r.fetchPointerofObject(1,
Da))))return r.primitiveFailFor(a);Oa();if(X)return r.primitiveFailFor(104);sa(1);r.failed()||ya(V);qa&&(Y(91,1),Y(90,r.ioMicroMSecs()-J))},primitiveRenderImage:function(){var a;if(0!==(a=yc()))return r.primitiveFailFor(a);zc();if(X)return Ja();Hb();Ja()},primitiveGetOffset:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=zb(r.stackValue(0))))return r.primitiveFailFor(a);a=r.makePointwithxValueyValue(z[46],z[47]);r.popthenPush(1,a)},primitiveSetDepth:function(){var a;
if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(1),0)))return r.primitiveFailFor(a);a=r.stackIntegerValue(0);if(r.failed())return r.primitiveFailFor(3);z[113]=a;ya(V);r.pop(1)},primitiveAddBezierShape:function(){var b;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);var c=r.positive32BitValueOf(r.stackValue(0));var d=r.stackIntegerValue(1);var e=r.positive32BitValueOf(r.stackValue(2));var f=r.stackIntegerValue(3);var m=r.stackObjectValue(4);if(r.failed())return r.primitiveFailFor(3);
if(0!==(b=Za(r.stackValue(5),0)))return r.primitiveFailFor(b);b=a(m);if(r.isWords(m)){var p=!1;if(b!==3*f&&b!==6*f)return r.primitiveFailFor(3)}else{if(!r.isArray(m)||b!==3*f)return r.primitiveFailFor(3);p=!0}if(!za((0===d||0===c?16:21)*f))return r.primitiveFailFor(111);if(!Ca(c)||!Ca(e))return r.primitiveFailFor(117);c=ka(c);e=ka(e);if(X)return r.primitiveFailFor(104);if((0===c||0===d)&&0===e)return r.pop(5);0!==d&&(d=tb(d),1>d&&(d=1));if(p)a:for(b=e,e=0;e<=f-1;e++){p=r.fetchPointerofObject(3*e,
m);Va(fa(),p);p=r.fetchPointerofObject(3*e+1,m);Va(pa(),p);p=r.fetchPointerofObject(3*e+2,m);Va(Fa(),p);if(r.failed())break a;Ra(3);p=fa()[0];var g=fa()[1];var q=pa()[0];var x=pa()[1];var u=Fa()[0];var t=Fa()[1];if(p===g&&q===x||q===u&&x===t)Ob(d,fa(),Fa(),c,b,0);else{p=Ya(fa(),pa(),Fa(),0!==d&&0!==c);if(X)break a;Xb(d,c,b,0,p)}if(X)break a}else a:for(m=m.wordsAsInt32Array(),b=3*f===b,p=1;p<=f;p++)if(oc(p-1,m,b,e,0,d,c),X)break a;if(X)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);
z[63]=1;ya(V);r.pop(5)},primitiveSetEdgeTransform:function(){var a;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(1),0)))return r.primitiveFailFor(a);var b=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);z[16]=0;a=g(z,18);b=cc(b,a,6);!r.failed()&&b&&(z[16]=1,a[2]+=z[46],a[5]+=z[47]);if(r.failed())return r.primitiveFailFor(3);ya(V);r.pop(1)},getModuleName:function(){return"B2DPlugin 14 November 2014 (e)"},primitiveGetTimes:function(){var b;if(1!==
r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=zb(r.stackValue(1))))return r.primitiveFailFor(b);b=r.stackObjectValue(0);if(r.failed()||!(r.isWords(b)&&9<=a(b)))return r.primitiveFailFor(3);b=b.wordsAsInt32Array();b[0]+=z[90];b[1]+=z[92];b[2]+=z[94];b[3]+=z[96];b[4]+=z[98];b[5]+=z[100];b[6]+=z[102];b[7]+=z[104];b[8]+=z[106];r.pop(1)},primitiveNextActiveEdgeEntry:function(){qa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);var a=r.stackValue(1);0===
(a=zb(a))&&(6===z[2]?a=0:8===z[2]?a=0:(z[64]=2,a=116));if(0!==a)return r.primitiveFailFor(a);var b=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);var c=!1;8!==z[2]&&((c=ta())?(a=U[z[13]],ob(a,b),sa(7)):sa(1));if(r.failed())return null;ya(V);r.pop(2);r.pushBool(!c);qa&&(Y(105,1),Y(104,r.ioMicroMSecs()-J))},primitiveAddBitmapFill:function(){var a;if(7!==r.methodArgumentCount())return r.primitiveFailFor(5);var b=r.stackIntegerValue(0);if(0>=b)return r.primitiveFailFor(3);var c=r.stackObjectValue(1);
var d=r.stackObjectValue(2);var e=r.stackObjectValue(3);var f=r.booleanValueOf(r.stackValue(4));var m=r.stackObjectValue(5);var p=r.stackObjectValue(6);if(r.failed())return r.primitiveFailFor(3);if(0!==(a=Za(r.stackValue(7),0)))return r.primitiveFailFor(a);Va(fa(),e);Va(pa(),d);Va(Fa(),c);if(r.failed())return r.primitiveFailFor(121);m=Nb(p,m,f?1:0,fa(),pa(),Fa(),b-1);if(X)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);ya(V);r.popthenPush(8,r.positive32BitIntegerFor(m))},
primitiveGetDepth:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=zb(r.stackValue(0))))return r.primitiveFailFor(a);r.pop(1);r.pushInteger(z[113])},primitiveAbortProcessing:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=zb(r.stackValue(0))))return r.primitiveFailFor(a);sa(8);ya(V)},primitiveNextGlobalEdgeEntry:function(){var a,b;qa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==
(a=Za(r.stackValue(1),1)))return r.primitiveFailFor(a);var c=r.stackObjectValue(0);if(b=wa())a=Wa[z[11]],ob(a,c),z[11]+=1;if(r.failed())return r.primitiveFailFor(118);b?sa(2):(sa(3),z[69]=1,z[13]=0,Ga());ya(V);r.pop(2);r.pushBool(!b);qa&&(Y(95,1),Y(94,r.ioMicroMSecs()-J))},primitiveGetFailureReason:function(){var b;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);Da=r.stackValue(0);if("number"===typeof Da)return r.primitiveFailFor(101);if(!r.isPointers(Da))return r.primitiveFailFor(102);
if(12>a(Da))return r.primitiveFailFor(103);if(0!==(b=Sb(r.fetchPointerofObject(0,Da))))return r.primitiveFailFor(b);r.pop(1);r.pushInteger(z[64])},primitiveDisplaySpanBuffer:function(){var a;qa&&(J=r.ioMicroMSecs());if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(0),5))||0!==(a=bc(r.fetchPointerofObject(1,Da))))return r.primitiveFailFor(a);if(!Gb(r.fetchPointerofObject(2,Da)))return r.primitiveFailFor(122);(Q()&z[52])===z[52]&&(L(Q()),dc());8!==z[2]&&(z[13]=0,
z[88]=Q()+1,sa(6));ya(V);qa&&(Y(103,1),Y(102,r.ioMicroMSecs()-J))},moduleUnloaded:function(a){0===strcmp(a,ea)&&(kb=Ia=0)},primitiveGetCounts:function(){var b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=zb(r.stackValue(1))))return r.primitiveFailFor(b);b=r.stackObjectValue(0);if(r.failed()||!(r.isWords(b)&&9<=a(b)))return r.primitiveFailFor(3);b=b.wordsAsInt32Array();b[0]+=z[91];b[1]+=z[93];b[2]+=z[95];b[3]+=z[97];b[4]+=z[99];b[5]+=z[101];b[6]+=z[103];b[7]+=z[105];b[8]+=
z[107];r.pop(1)},primitiveChangedActiveEdgeEntry:function(){var a;qa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(1),7)))return r.primitiveFailFor(a);a=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);a=ac(a);if(!a)return r.primitiveFailFor(112);0===E[a+7]?qc():(Ua(),z[13]+=1);sa(6);ya(V);r.pop(1);qa&&(Y(107,1),Y(106,r.ioMicroMSecs()-J))},primitiveRenderScanline:function(){var a;if(0!==(a=yc()))return r.primitiveFailFor(a);
zc();Ja()},primitiveGetBezierStats:function(){var b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=zb(r.stackValue(1))))return r.primitiveFailFor(b);b=r.stackObjectValue(0);if(r.failed()||!(r.isWords(b)&&4<=a(b)))return r.primitiveFailFor(3);b=b.wordsAsInt32Array();b[0]+=z[108];b[1]+=z[109];b[2]+=z[110];b[3]+=z[111];r.pop(1)},primitiveFinishedProcessing:function(){var a;qa&&(J=r.ioMicroMSecs());if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=zb(r.stackValue(0))))return r.primitiveFailFor(a);
a=8===z[2];ya(V);r.pop(1);r.pushBool(a);qa&&(Y(93,1),Y(92,r.ioMicroMSecs()-J))},setInterpreter:function(a){r=a;a=1==r.majorVersion();return!1===a?!1:a=11<=r.minorVersion()},primitiveNeedsFlush:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=zb(r.stackValue(0))))return r.primitiveFailFor(a);a=0!==z[63];ya(V);r.pop(1);r.pushBool(a)},primitiveAddLine:function(){var a;if(4!==r.methodArgumentCount())return r.primitiveFailFor(5);var b=r.positive32BitValueOf(r.stackValue(0));
var c=r.positive32BitValueOf(r.stackValue(1));var d=r.stackObjectValue(2);var e=r.stackObjectValue(3);if(r.failed())return r.primitiveFailFor(3);if(0!==(a=Za(r.stackValue(4),0)))return r.primitiveFailFor(a);if(!Ca(c)||!Ca(b))return r.primitiveFailFor(117);Va(fa(),e);Va(pa(),d);if(r.failed())return r.primitiveFailFor(121);Ra(2);c=ka(c);b=ka(b);if(X)return r.primitiveFailFor(104);Ob(0,fa(),pa(),0,c,b);if(X)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);ya(V);r.pop(4)},primitiveSetOffset:function(){var a;
if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(1),0)))return r.primitiveFailFor(a);a=r.stackValue(0);if(l(a)!==r.classPoint())return r.primitiveFailFor(3);Va(fa(),a);if(r.failed())return r.primitiveFailFor(3);z[46]=fa()[0];z[47]=fa()[1];ya(V);r.pop(1)},primitiveNextFillEntry:function(){var a;qa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(1),3))||0!==(a=bc(r.fetchPointerofObject(1,Da))))return r.primitiveFailFor(a);
if(!rc(r.fetchPointerofObject(3,Da)))return r.primitiveFailFor(123);0!==z[69]&&(0===(Q()&z[52])&&K(),z[69]=0);a=r.stackObjectValue(0);var b=Ba();if(X)return r.primitiveFailFor(104);b&&sb(a);if(r.failed())return r.primitiveFailFor(117);b?sa(4):(Ga(),z[35]=0,sa(5));ya(V);r.pop(2);r.pushBool(!b);qa&&(Y(99,1),Y(98,r.ioMicroMSecs()-J))},primitiveInitializeBuffer:function(){var b;if(1!==r.methodArgumentCount())return r.primitiveFail();var c=r.stackObjectValue(0);if(r.failed())return null;if(!r.isWords(c)||
256>(b=a(c)))return r.primitiveFail();z=c.wordsAsInt32Array();E=e(z,128);z[0]=1097753705;z[1]=b;z[10]=b;sa(0);z[8]=128;ya(4);mb(0,256);E[1]=4;E[2]=0;z[11]=0;z[12]=0;z[13]=0;z[14]=0;z[64]=0;z[63]=0;z[42]=0;z[43]=0;z[44]=0;z[45]=0;z[113]=0;z[90]=0;z[92]=0;z[94]=0;z[96]=0;z[98]=0;z[100]=0;z[102]=0;z[104]=0;z[106]=0;z[91]=0;z[93]=0;z[95]=0;z[97]=0;z[99]=0;z[101]=0;z[103]=0;z[105]=0;z[107]=0;z[108]=0;z[109]=0;z[110]=0;z[111]=0;b=g(z,18);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;z[16]=0;b=g(z,24);b[0]=
1;b[1]=0;b[2]=1;b[3]=0;b[4]=1;b[5]=0;b[6]=1;b[7]=0;z[17]=0;r.pop(2);r.push(c)},primitiveDoProfileStats:function(){var a=qa;var b=r.stackObjectValue(0);b=r.booleanValueOf(b);r.failed()||(qa=b,r.pop(2),r.pushBool(a))},primitiveAddActiveEdgeEntry:function(){var a;qa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(1),2)))return r.primitiveFailFor(a);a=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);a=ac(a);if(!a)return r.primitiveFailFor(112);
if(!za(1))return r.primitiveFailFor(111);0<E[a+7]&&nb(a);if(X)return r.primitiveFailFor(104);sa(1);ya(V);r.pop(1);qa&&(Y(97,1),Y(96,r.ioMicroMSecs()-J))},primitiveSetAALevel:function(){var a;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(1),0)))return r.primitiveFailFor(a);a=r.stackIntegerValue(0);if(r.failed())return r.primitiveFailFor(3);cb(a);ya(V);r.pop(1)},primitiveNeedsFlushPut:function(){var a;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);
if(0!==(a=zb(r.stackValue(1))))return r.primitiveFailFor(a);a=r.booleanValueOf(r.stackValue(0));if(r.failed())return r.primitiveFailFor(3);z[63]=!0===a?1:0;ya(V);r.pop(1)},primitiveAddCompressedShape:function(){var b;if(7!==r.methodArgumentCount())return r.primitiveFailFor(5);var c=r.stackObjectValue(0);var d=r.stackObjectValue(1);var e=r.stackObjectValue(2);var f=r.stackObjectValue(3);var m=r.stackObjectValue(4);var p=r.stackIntegerValue(5);var g=r.stackObjectValue(6);if(r.failed())return r.primitiveFailFor(3);
if(0!==(b=Za(r.stackValue(7),0)))return r.primitiveFailFor(b);r.isWords(g)?(b=a(g),b=b!==3*p&&b!==6*p?!1:!0):b=!1;if(b){b:{var q;if(r.isWords(c)){var x=a(c);var u=c.wordsAsInt32Array();for(q=0;q<=x-1;q++)if(b=u[q],!Ca(b)){b=!1;break b}b=!0}else b=!1}if(b)if(b=a(c),M(m,b,p)&&M(f,b,p)&&M(d,b,p)){u=a(e);x=e.wordsAsInt32Array();for(b=q=0;b<=u-1;b++){var t=(x[b]|0)>>>16;q+=t}b=q===p?!0:!1}else b=!1;else b=!1}else b=!1;if(!b)return r.primitiveFailFor(120);if(!za(Math.max(16,16)*p))return r.primitiveFailFor(111);
b=a(g)===3*p;a:{g=g.wordsAsInt32Array();m=m.wordsAsInt32Array();f=f.wordsAsInt32Array();e=e.wordsAsInt32Array();d=d.wordsAsInt32Array();c=c.wordsAsInt32Array();var h,A,l,k,v,N,n,I,G;if(0!==p)for(x=v=I=A=-1,q=k=n=h=1,t=N=G=l=0,u=1;u<=p;u++){if(0>=--q&&(++x,q=(m[x]|0)>>>16,t=(m[x]|0)&65535,0!==t&&(t=c[t-1],t=ka(t),X)))break a;0>=--k&&(++v,k=(f[v]|0)>>>16,N=(f[v]|0)&65535,0!==N&&(N=c[N-1],N=ka(N)));0>=--n&&(++I,n=(e[I]|0)>>>16,G=(e[I]|0)&65535,0!==G&&(G=tb(G)));0>=--h&&(++A,h=(d[A]|0)>>>16,l=(d[A]|0)&
65535,0!==l&&(l=c[l-1]));oc(u-1,g,b,t,N,G,l);if(X)break a}}if(X)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);z[63]=1;ya(V);r.pop(7)},primitiveSetColorTransform:function(){var a;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(1),0)))return r.primitiveFailFor(a);a=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);var b=g(z,24);z[17]=0;cc(a,b,8)&&(z[17]=1,b[1]*=256,b[3]*=256,b[5]*=256,b[7]*=256);if(r.failed())return r.primitiveFailFor(119);
ya(V);r.pop(1)},primitiveAddOval:function(){var a;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);var b=r.positive32BitValueOf(r.stackValue(0));var c=r.stackIntegerValue(1);var d=r.positive32BitValueOf(r.stackValue(2));var e=r.stackObjectValue(3);var f=r.stackObjectValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(a=Za(r.stackValue(5),0)))return r.primitiveFailFor(a);if(!Ca(b)||!Ca(d))return r.primitiveFailFor(117);d=ka(d);b=ka(b);if(X)return r.primitiveFailFor(104);if(0===d&&
(0===b||0>=c))return r.pop(5);if(!za(256))return r.primitiveFailFor(111);c=0<c&&0!==b?tb(c):0;Va(fa(),f);Va(pa(),e);if(r.failed())return r.primitiveFailFor(121);a:{var m;var p=pa()[0]-fa()[0]>>1;f=pa()[1]-fa()[1]>>1;e=pa()[0]+fa()[0]>>1;a=pa()[1]+fa()[1]>>1;for(m=0;15>=m;m++){var g=m;var q=p;var x=f,u=e,t=a;var A=v()[2*g+0]*q+u|0;var h=N()[2*g+0]*x+t|0;fa()[0]=A;fa()[1]=h;var l=v()[2*g+2]*q+u|0;var k=N()[2*g+2]*x+t|0;Fa()[0]=l;Fa()[1]=k;q=v()[2*g+1]*q+u|0;g=N()[2*g+1]*x+t|0;q=2*q-(A+l>>1);g=2*g-(h+
k>>1);pa()[0]=q;pa()[1]=g;Ra(3);k=Ya(fa(),pa(),Fa(),0!==c&&0!==b);if(X)break a;Xb(c,b,0,d,k);if(X)break a}}if(X)return Ga(),r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);z[63]=1;ya(V);r.pop(5)},primitiveRegisterExternalFill:function(){var a;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Za(r.stackValue(1),0)))return r.primitiveFailFor(a);var b=r.stackIntegerValue(0);if(r.failed())return r.primitiveFailFor(3);for(a=0;0===a;){if(!w(10))return r.primitiveFailFor(111);
a=V;V=a+4;mb(a,256);E[a+1]=4;E[a+2]=b}r.failed()||(ya(V),r.pop(2),r.pushInteger(a))},primitiveAddPolygon:function(){var b;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);var c=r.positive32BitValueOf(r.stackValue(0));var d=r.stackIntegerValue(1);var e=r.positive32BitValueOf(r.stackValue(2));var f=r.stackIntegerValue(3);var m=r.stackObjectValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(b=Za(r.stackValue(5),0)))return r.primitiveFailFor(b);b=a(m);if(r.isWords(m)){var p=!1;if(b!==
f&&2*f!==b)return r.primitiveFailFor(3)}else{if(!r.isArray(m)||b!==f)return r.primitiveFailFor(3);p=!0}if(!za((0===d||0===c?16:21)*f))return r.primitiveFail();if(!Ca(c)||!Ca(e))return r.primitiveFailFor(117);c=ka(c);e=ka(e);if(X)return r.primitiveFailFor(104);if((0===c||0===d)&&0===e)return r.pop(5);0!==d&&(d=tb(d));if(p)a:{if(Va(fa(),r.fetchPointerofObject(0,m)),!r.failed()){p=fa()[0];var g=fa()[1];for(b=1;b<=f-1;b++){Va(fa(),r.fetchPointerofObject(b,m));if(r.failed())break a;var q=fa()[0];var x=
fa()[1];fa()[0]=p;fa()[1]=g;pa()[0]=q;pa()[1]=x;Ra(2);Ob(d,fa(),pa(),c,e,0);if(X)break a;p=q;g=x}}}else a:for(m=m.wordsAsInt32Array(),b=f===b,b?(q=(m.int16Array||(m.int16Array=new Int16Array(m.buffer,m.byteOffset)))[0],x=(m.int16Array||(m.int16Array=new Int16Array(m.buffer,m.byteOffset)))[1]):(q=m[0]|0,x=m[1]|0),p=1;p<=f-1;p++){if(b){g=(m.int16Array||(m.int16Array=new Int16Array(m.buffer,m.byteOffset)))[2*p];var u=(m.int16Array||(m.int16Array=new Int16Array(m.buffer,m.byteOffset)))[2*p+1]}else g=
m[2*p]|0,u=m[2*p+1]|0;fa()[0]=q;fa()[1]=x;pa()[0]=g;pa()[1]=u;Ra(2);Ob(d,fa(),pa(),c,e,0);if(X)break a;q=g;x=u}if(X)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);z[63]=1;ya(V);r.pop(5)},primitiveGetAALevel:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=zb(r.stackValue(0))))return r.primitiveFailFor(a);r.pop(1);r.pushInteger(z[48])}})});module("users.bert.SqueakJS.plugins.BitBltPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return"number"===typeof a?J.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function c(a,b){return Math.floor(a/b)|0}function e(a,b){return 31<b?0:a<<b}function g(a,b){return 31<b?0:a>>>b}function h(a,b){return 0>b?-31>b?0:a>>>0-b:31<
b?0:a<<b}function f(a,b){if(16>S){var c=a^b;for(a=V[S];0!==c;)0!==(c&a)&&++xb,c=g(c,S);return b}16===S?(c=Nb(a,b,5,3),xb=xb+(c&31)+(c>>>5&31)+(c>>>10&31),c=Nb(a>>>16,b>>>16,5,3),xb=xb+(c&31)+(c>>>5&31)+(c>>>10&31)):(c=Nb(a,b,8,3),xb=xb+(c&255)+(c>>>8&255)+(c>>>16&255));return b}function d(a,b){var c;if(5!==(La&5))return b;if(16>S){a=V[S]&gb;var d=b;for(c=1;c<=Z;c++){var e=d&a;Xa[e&gb]+=1;d=g(d,S)}return b}16===S?(e=za(b&65535,5,qb),Xa[e&gb]+=1,e=za(b>>>16,5,qb)):e=za(b,8,qb);Xa[e&gb]+=1;return b}
function n(a,b){return a+b}function k(a,b){var c=a>>>24;if(0===c)return b;if(255===c)return a;var d=255-c;var e=(a&16711935)*c+(b&16711935)*d+16711935;a=((a>>>8|16711680)&16711935)*c+(b>>>8&16711935)*d+16711935;return e+(e-65537>>>8&16711935)>>>8&16711935|(a+(a-65537>>>8&16711935)>>>8&16711935)<<8}function y(a,b){return w(a,b,!1)}function w(a,b,d){var f,m;if(16>S)return b;var p=255-lc;var q=b;if(1===Z)d&&0===a||(d=(a&16711935)*lc+(b&16711935)*p+16711935,p=(a>>>8&16711935)*lc+(b>>>8&16711935)*p+16711935,
q=d+(d-65537>>>8&16711935)>>>8&16711935|(p+(p-65537>>>8&16711935)>>>8&16711935)<<8);else{var x=V[S];var u=ka;var t=a;for(f=1;f<=Z;f++){var A=t&x;if(!(0===(u&x)||d&&0===A)){var h=b&x;a=0;for(m=1;3>=m;m++){var l=5*(m-1);var k=c((g(A,l)&31)*lc+(g(h,l)&31)*p+254,255)&31;a|=e(k,l)}q=q&~e(x,16*(f-1))|e(a,16*(f-1))}u=g(u,S);t=g(t,S);b=g(b,S)}}return q}function t(a,b){var c=255-(a>>>24);var d=((b&16711935)*c>>>8&16711935)+(a&16711935);a=((b>>>8&16711935)*c>>>8&16711935)+(a>>>8&16711935);return(a&16711935)<<
8|255*(a&16777472)|d&16711935|255*(d&16777472)>>>8}function p(a,b){return 0===a?b:w(a,b,!0)}function m(a,b){return a&b}function x(a,b){return a&~b}function q(a,b){return~a&b}function u(a,b){return~a&~b}function A(a,b){return~b}function B(a,b){return~a|b}function D(a,b){return~a|~b}function P(a,b){return~a}function O(a,b){return~a^b}function F(a,b){return a|b}function C(a,b){return a|~b}function H(a,b){return a^b}function I(a,b){return 0}function M(){pb>=Sa?(Ha=mc,U=pb,W=$b):(Ha=mc+(Sa-pb),W=$b-(Sa-
pb),U=Sa);U+W>Sa+Vb&&(W-=U+W-(Sa+Vb));Ga>=jb?(Ma=wc,ea=Ga,ia=Bb):(Ma=wc+jb-Ga,ia=Bb-(jb-Ga),ea=jb);ea+ia>jb+sa&&(ia-=ea+ia-(jb+sa));if(xa)return null;0>Ha&&(U-=Ha,W+=Ha,Ha=0);Ha+W>hc&&(W-=Ha+W-hc);0>Ma&&(ea-=Ma,ia+=Ma,Ma=0);Ma+ia>ec&&(ia-=Ma+ia-ec)}function v(){M();if(0>=W||0>=ia)return Ua=cb=Ta=Pa=0,null;if(!ib())return J.primitiveFail();N();Wb()}function N(){G();if(J.failed())return J.primitiveFail();if(gc())return null;if(30===Ja||31===Ja)if(1===J.methodArgumentCount()){if(lc=J.stackIntegerValue(0),
J.failed()||!(0<=lc&&255>=lc))return J.primitiveFail()}else return J.primitiveFail();xb=0;ha();if(xa){var a,b;var d=ra[Ja+1];d;for(b=1;b<=ia;b++){var f=z?4294967295:Ka(ea+b-1);ka=Ia;var m=ja[ma>>>2];var p=d(f,m);m=ka&p|m&~ka;ja[ma>>>2]=m;ma+=4;ka=4294967295;if(3===Ja)for(m=f,a=2;a<=da-1;a++)ja[ma>>>2]=m,ma+=4;else for(a=2;a<=da-1;a++)m=ja[ma>>>2],p=d(f,m),ja[ma>>>2]=p,ma+=4;1<da&&(ka=E,m=ja[ma>>>2],p=d(f,m),m=ka&p|m&~ka,ja[ma>>>2]=m,ma+=4);ma+=Ib}}else if(Jb===yb&&ea>=Ma&&(ea>Ma?(jc=-1,Ma=Ma+ia-1,
ea=ea+ia-1):ea===Ma&&U>Ha&&(ab=-1,Ha=Ha+W-1,U=U+W-1,1<da&&(p=Ia,Ia=E,E=p)),ma=ea*Ra+4*c(U,Z),Ib=Ra*jc-4*da*ab),db!==S||0!==La||fc!==Na)K();else{m=Z-1;f=Ha&m;p=U&m;0<ab?(d=Math.min(W,Z-p),ic=f+d>m):(d=Math.min(W,p+1),ic=0>f-d+1);Ab=fc?(f-p)*S:(p-f)*S;ic&&(Ab=0>Ab?Ab+32:Ab-32);rb=Ma*vb+4*c(Ha,c(32,db));sc=vb*jc-4*da*ab;ic&&(sc-=4*ab);var q;m=ra[Ja+1];m;a=4*ab;-32===Ab?Ab=d=p=0:0>Ab?(d=Ab+32,p=e(4294967295,0-Ab)):0===Ab?(d=0,p=4294967295):(d=Ab-32,p=g(4294967295,Ab));var x=~p;z?(f=4294967295,Da=0):f=
Ka(0);var u=ea;for(q=1;q<=ia;q++){1<Da&&(f=Ka(u),u+=jc);ic?(b=Ea[rb>>>2],rb+=a):b=0;ka=Ia;var t=Ea[rb>>>2];rb+=a;var A=h(b&x,d)|h(t&p,Ab);b=t;var l=ja[ma>>>2];A=m(A&f,l);l=ka&A|l&~ka;ja[ma>>>2]=l;ma+=a;ka=4294967295;if(3===Ja)if(0===Ab&&4294967295===f)if(-1===ab)for(l=2;l<=da-1;l++)t=Ea[rb>>>2],rb+=a,ja[ma>>>2]=t,ma+=a;else for(l=2;l<=da-1;l++)ja[ma>>>2]=b,ma+=a,b=Ea[rb>>>2],rb+=a;else for(l=2;l<=da-1;l++)t=Ea[rb>>>2],rb+=a,A=h(b&x,d)|h(t&p,Ab),b=t,ja[ma>>>2]=A&f,ma+=a;else for(l=2;l<=da-1;l++)t=
Ea[rb>>>2],rb+=a,A=h(b&x,d)|h(t&p,Ab),b=t,A=m(A&f,ja[ma>>>2]),ja[ma>>>2]=A,ma+=a;1<da&&(ka=E,t=Ea[rb>>>2],rb+=a,A=h(b&x,d)|h(t&p,Ab),l=ja[ma>>>2],A=m(A&f,l),l=ka&A|l&~ka,ja[ma>>>2]=l,ma+=a);rb+=sc;ma+=Ib}}if(22===Ja||32===Ja)Ua=cb=Ta=Pa=0;0<ab?(Ua=U,cb=U+W):(Ua=U-W+1,cb=U+1);0<jc?(Ta=ea,Pa=ea+ia):(Ta=ea-ia+1,Pa=ea+1)}function G(){if(41===Ja)if(Yb=255,Rb=16777215,Tb=kb=null,2<=J.methodArgumentCount()){Yb=J.stackIntegerValue(J.methodArgumentCount()-2);if(J.failed())return J.primitiveFail();Rb=J.stackIntegerValue(J.methodArgumentCount()-
1);if(J.failed())return J.primitiveFail();if(4===J.methodArgumentCount()){var a=J.stackObjectValue(1);J.isBytes(a)&&(kb=a.bytes);a=J.stackObjectValue(0);J.isBytes(a)&&(Tb=a.bytes)}}else if(1===J.methodArgumentCount()){if(Rb=J.stackIntegerValue(0),J.failed())return J.primitiveFail()}else return J.primitiveFail()}function K(){var a;var b=ra[Ja+1];b;Zb=c(32,db);var d=V[db];var f=V[S];var m=La&-9;rb=Ma*vb+4*c(Ha,Zb);var p=Zb-(Ha&Zb-1);p=W<p?0:c(W-p,Zb)+1;sc=vb-4*p;var q=Z-(U&Z-1);var x=(U+W-1&Z-1)+1;
W<q&&(q=W);var t=(Ha&Zb-1)*db;var u=(U&Z-1)*S;p=db;var A=S;var h=0;fc&&(t=32-db-t,p=0-p);Na&&(u=32-S-u,A=0-A,h=32-S);for(a=1;a<=ia;a++){var l=z?4294967295:Ka(ea+a-1);tc=t;$a=u;ka=Ia;var k=q;var v=da;do{var N=m,n=d,I=f,G=p,w=A;var r=Ea[rb>>>2];var F=0;var y=tc;var L=$a;if(5===N){do{var B=g(r,y)&n;B=Xa[B&gb];F|=e(B&I,L);L+=w;0!==((y+=G)&4294967264)&&(y=fc?y+32:y-32,r=Ea[(rb+=4)>>>2])}while(0!==--k)}else{do B=g(r,y)&n,B=Oa(B,N),F|=e(B&I,L),L+=w,0!==((y+=G)&4294967264)&&(y=fc?y+32:y-32,r=Ea[(rb+=4)>>>
2]);while(0!==--k)}tc=y;L=F;$a=h;4294967295===ka?(L=b(L&l,ja[ma>>>2]),ja[ma>>>2]=ka&L):(F=ja[ma>>>2],L=b(L&l,F&ka),F=ka&L|F&~ka,ja[ma>>>2]=F);ma+=4;2===v?(ka=E,k=x):(ka=4294967295,k=Z)}while(0!==--v);rb+=sc;ma+=Ib}}function ba(){return[0,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,
4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,
4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,
4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,
4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,
4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,
4294967295]}function aa(a,b,d){return b>a?c(b-a+16384,d+1)+1:b===a?0:0-(c(a-b+16384,d+1)+1)}function ha(){var a=Z-1;var b=Z-(U&a);Ia=Na?g(4294967295,32-b*S):e(4294967295,32-b*S);var d=(U+W-1&a)+1;E=Na?e(4294967295,32-d*S):g(4294967295,32-d*S);W<b?(Ia&=E,E=0,da=1):da=c(W-b+a,Z)+1;ab=jc=1;ma=ea*Ra+4*c(U,Z);Ib=Ra*jc-4*da*ab}function Q(a,b){return b}function L(a,b){b<<=8;return(Cb[b+(a>>>16&255)]<<10)+(Cb[b+(a>>>8&255)]<<5)+Cb[b+(a&255)]}function T(a,b,c){var d=ja[a>>>2];ja[a>>>2]=d&c|b}function R(a,
b){a=J.fetchPointerofObject(a,b);if("number"===typeof a)return a;a=J.floatValueOf(a);return-2147483648<=a&&2147483647>=a?a|0:(J.primitiveFail(),0)}function ca(a,b,c){a=J.fetchPointerofObject(a,b);if("number"===typeof a)return a;if(a.isNil)return c;c=J.floatValueOf(a);return-2147483648<=c&&2147483647>=c?c|0:(J.primitiveFail(),0)}function ua(a,b){return 32!==S?b:0===b?0:0!==(b&4278190080)?b:b|a&4278190080}function Ka(a){var b=Mb,d=Da;a=a-c(a,d)*d|0;return b[a]}function oa(a){return a.isNil||0===Ja||
5===Ja||10===Ja||15===Ja?!0:!1}function va(){ja=J.fetchPointerofObject(0,yb);tb=J.fetchIntegerofObject(1,yb);Fb=J.fetchIntegerofObject(2,yb);if(!(0<=tb&&0<=Fb))return!1;S=J.fetchIntegerofObject(3,yb);Na=0<S;0>S&&(S=0-S);if("number"===typeof ja){if(!Va(ja))return!1;Z=c(32,S);ja=Ra=0}else{Z=c(32,S);Ra=4*c(tb+(Z-1),Z);var a=b(ja);if(!J.isWordsOrBytes(ja)||a!==Ra*Fb)return!1;ja=ja.wordsOrBytes()}return!0}function wa(a){return Ba(a,!1)}function Ba(b,c){la=b;Wa=c;Ja=J.fetchIntegerofObject(3,la);if(J.failed()||
0>Ja||41<Ja||16<=Ja&&17>=Ja)return!1;Jb=J.fetchPointerofObject(1,la);xa=oa(Jb);qa=J.fetchPointerofObject(2,la);z=oa(qa);yb=J.fetchPointerofObject(0,b);if(!(J.isPointers(yb)&&4<=a(yb)))return!1;b=va();if(!b)return!1;pb=ca(4,la,0);Ga=ca(5,la,0);$b=ca(6,la,tb);Bb=ca(7,la,Fb);if(J.failed())return!1;if(xa)mc=wc=0;else{if(!(J.isPointers(Jb)&&4<=a(Jb)))return!1;b=ta();if(!b)return!1;b=bb();if(!b)return!1;0===(La&8)&&Fa();mc=ca(8,la,0);wc=ca(9,la,0)}b=fb();if(!b)return!1;Sa=ca(10,la,0);jb=ca(11,la,0);Vb=
ca(12,la,tb);sa=ca(13,la,Fb);if(J.failed())return!1;0>Sa&&(Vb+=Sa,Sa=0);0>jb&&(sa+=jb,jb=0);Sa+Vb>tb&&(Vb=tb-Sa);jb+sa>Fb&&(sa=Fb-jb);return!0}function ta(){Ea=J.fetchPointerofObject(0,Jb);hc=R(1,Jb);ec=R(2,Jb);if(!(0<=hc&&0<=ec))return!1;db=J.fetchIntegerofObject(3,Jb);fc=0<db;0>db&&(db=0-db);if("number"===typeof Ea){if(!yc(Ea))return!1;Zb=c(32,db);Ea=vb=0}else{Zb=c(32,db);vb=4*c(hc+(Zb-1),Zb);var a=b(Ea);if(!J.isWordsOrBytes(Ea)||a!==vb*ec)return!1;Ea=Ea.wordsOrBytes()}return!0}function bb(){La=
gb=qb=0;Xa=ob=sb=null;var b=J.fetchPointerofObject(14,la);if(b.isNil)return!0;La=1;var c=!1;if(J.isWords(b)){var d=a(b);Xa=b.words;c=!0}else{if(!(J.isPointers(b)&&3<=a(b)))return!1;sb=Qa(J.fetchPointerofObject(0,b));ob=Qa(J.fetchPointerofObject(1,b));b=J.fetchPointerofObject(2,b);if(b.isNil)d=0;else{if(!J.isWords(b))return!1;d=a(b);Xa=b.words}La|=8}if(0!==(d&d-1))return!1;gb=d-1;qb=0;512===d&&(qb=3);4096===d&&(qb=4);32768===d&&(qb=5);0===d?(Xa=null,gb=0):La|=4;c&&Fa();d=sb&&ob?0===sb[0]&&0===sb[1]&&
0===sb[2]&&0===sb[3]&&16711680===ob[0]&&65280===ob[1]&&255===ob[2]&&4278190080===ob[3]?!0:!1:!0;d?sb=ob=null:La|=2;return!0}function Qa(b){return b.isNil?null:"number"!==typeof b&&J.isWords(b)&&4===a(b)?b.words:(J.primitiveFail(),null)}function fb(){if(z)return Mb=null,!0;if(J.isPointers(qa)&&4<=a(qa)){var b=J.fetchPointerofObject(0,qa);Da=J.fetchIntegerofObject(2,qa);J.isWords(b)||(z=!0)}else{if(J.isPointers(qa)||!J.isWords(qa))return!1;b=qa;Da=a(b)}Mb=b.wordsOrBytes();return!0}function Y(){kc=J.ioLoadFunctionFrom("ioGetSurfaceFormat",
"SurfacePlugin");r=J.ioLoadFunctionFrom("ioLockSurface","SurfacePlugin");uc=J.ioLoadFunctionFrom("ioUnlockSurface","SurfacePlugin");return!!kc&&!!r&&!!uc}function ib(){X=!1;if(0===ja){if(!r&&!Y())return null;var a=r;var b=J.fetchIntegerofObject(0,yb);if(0===Ea&&!xa){var c=J.fetchIntegerofObject(0,Jb);if(c===b){if(Wa){var d=Math.min(Ha,U);var e=Math.max(Ha,U)+W;b=Math.min(Ma,ea);var f=Math.max(Ma,ea)+ia;Ea=a(c,function(a){vb=a},d,b,e-d,f-b)}else Ea=a(c,function(a){vb=a},0,0,hc,ec);ja=Ea;Ra=vb;X=!0;
return 0!==ja}}ja=a(b,function(a){Ra=a},U,ea,W,ia);X=!0}if(0===Ea&&!xa){c=J.fetchIntegerofObject(0,Jb);if(!r&&!Y())return null;a=r;Ea=Wa?a(c,function(a){vb=a},0,0,hc,ec):a(c,function(a){vb=a},Ha,Ma,W,ia);X=!0}return 0!==ja&&(0!==Ea||xa)}function Oa(a,b){var c=a;0!==(b&1)&&(0!==(b&2)&&(c=h(a&ob[0],sb[0]),c|=h(a&ob[1],sb[1]),c|=h(a&ob[2],sb[2]),c|=h(a&ob[3],sb[3]),0===c&&0!==a&&(c=1)),0!==(b&4)&&(c=Xa[c&gb]));return c}function nb(a,b,c,d){var f;var m=V[c];var p=0;for(f=1;f<=d;f++)(a&m)===m&&(p|=b&m),
m=e(m,c);return p}function Ca(a,b,c,d,e){var f=a&e;e&=b;a=(a^f)+(b^e);return a^f^e|g(f&e|(f|e)&a,c-1)*d}function eb(a,b,c,d){var f;var m=V[c];var p=0;for(f=1;f<=d;f++)p|=Math.max(b&m,a&m),m=e(m,c);return p}function Ya(a,b,c,d){var f;var m=V[c];var p=0;for(f=1;f<=d;f++)p|=Math.min(b&m,a&m),m=e(m,c);return p}function Gb(a,b,c,d){var f=V[c];var m=e(f,c);var p=g(((a&f)+1)*((b&f)+1)-1&m,c);if(1===d)return p;var q=((g(a,c)&f)+1)*((g(b,c)&f)+1)-1&m;p|=q;if(2===d)return p;q=((g(a,2*c)&f)+1)*((g(b,2*c)&f)+
1)-1&m;p|=e(q,c);if(3===d)return p;q=((g(a,3*c)&f)+1)*((g(b,3*c)&f)+1)-1&m;return p|=e(q,2*c)}function Nb(a,b,c,d){var f;var m=V[c];var p=0;for(f=1;f<=d;f++){var g=a&m;var q=b&m;p=g<q?p|q-g:p|g-q;m=e(m,c)}return p}function pc(a,b){var c,d;if(0>a||0>b||(c=a>>>14)>=hc||(d=b>>>14)>=ec)return 0;a=d*vb+4*g(c,Bc);a=Ea[a>>>2];tc=Cc[c&Ac];return g(a,tc)&Dc}function oc(a,b){var c;if(32===S)return a===b?0:b;var d=S;var f=V[d];var m=0;for(c=1;c<=Z;c++){var p=b&f;(a&f)===p&&(p=0);m|=p;f=e(f,d)}return m}function ac(a,
b){return nb(~a,b,S,Z)}function nc(a,b){return 0===a?b:a|nb(~a,b,S,Z)}function rc(a,b){var c;if(1===Z)return b;a=0;var d=e(1,S)-1;var f=e(d,(Z-1)*S);var m=32-S;a|=e(b&d,m)|g(b&f,m);if(2>=Z)return a;for(c=2;c<=Z>>1;c++)d=e(d,S),f=g(f,S),m-=2*S,a|=e(b&d,m)|g(b&f,m);return a}function Va(a){return kc||Y()?kc(a,function(a,b,c,d){tb=a;Fb=b;S=c;Na=d}):!1}function yc(a){return kc||Y()?kc(a,function(a,b,c,d){hc=a;ec=b;db=c;fc=d}):!1}function bc(a,b){if(16>S){var d=e(1,S)-1;var f=e(c(4294967295,d),S-1);return Ca(a,
b,S,d,f)}return 16===S?Ca(a&2147450879,b&2147450879,5,31,1108361744):Ca(a,b,8,255,2155905152)}function cc(a,b){var c=a;if(0===c)return b;a=Rb;var d=Yb&255;var e=c&255;c>>>=8;var f=c&255;c>>>=8;var m=c&255;c=c>>>8&255;255!==d&&(c=c*d>>>8,m=m*d>>>8,f=f*d>>>8,e=e*d>>>8);d=b&255;var p=a&255;Tb&&(d=Tb[d],p=Tb[p]);e=(d*(255-e)>>>8)+(p*e>>>8);255<e&&(e=255);kb&&(e=kb[e]);b>>>=8;a>>>=8;d=b&255;p=a&255;Tb&&(d=Tb[d],p=Tb[p]);f=(d*(255-f)>>>8)+(p*f>>>8);255<f&&(f=255);kb&&(f=kb[f]);b>>>=8;d=b&255;p=a>>>8&255;
Tb&&(d=Tb[d],p=Tb[p]);a=(d*(255-m)>>>8)+(p*m>>>8);255<a&&(a=255);kb&&(a=kb[a]);c=((b>>>8&255)*(255-c)>>>8)+c;255<c&&(c=255);return(((c<<8)+a<<8)+f<<8)+e}function Xb(a,b){if(0===a)return b;var c=S,d=Z,f;var m=V[c];var p=0;for(f=1;f<=d;f++){var q=g(a&m,(f-1)*c);var x=g(b&m,(f-1)*c);32!==c&&(16===c?(q=Sb(q)|4278190080,x=Sb(x)|4278190080):(q=za(q,c,32)|4278190080,x=za(x,c,32)|4278190080));x=cc(q,x);32!==c&&(x=za(x,32,c));p|=e(x,(f-1)*c);m=e(m,c)}return p}function Ob(a,b){var c;var d=V[S];if(16===S){var e=
5;var f=31}else e=8,f=255;var m=ka;var p=b;for(c=1;c<=Z;c++){if(0<(m&d)){var q=p&d;var x=a&d;16>S?x=x===q?0:1:(x=Nb(x,q,e,3),x=(x&f)+(g(x,e)&f)+(g(g(x,e),e)&f));xb+=x}m=g(m,S);a=g(a,S);p=g(p,S)}return b}function Sb(a){return(a&31)<<3|(a&992)<<6|(a&31744)<<9}function za(a,b,c){var d;if(0<(d=c-b)){b=e(1,b)-1;var f=e(a,d);b=e(b,d);a=f&b;b=e(b,c);f=e(f,d);return a+(f&b)+(e(f,d)&e(b,c))}if(0===d)return 5===b?a&32767:8===b?a&16777215:a;if(0===a)return a;d=b-c;b=e(1,c)-1;f=g(a,d);a=f&b;b=e(b,c);f=g(f,d);
a=a+(f&b)+(g(f,d)&e(b,c));return 0===a?1:a}function ya(a,b){return 16>S?eb(a,b,S,Z):16===S?eb(a,b,5,3)+(eb(a>>>16,b>>>16,5,3)<<16):eb(a,b,8,4)}function ub(a,b){return 16>S?Ya(a,b,S,Z):16===S?Ya(a,b,5,3)+(Ya(a>>>16,b>>>16,5,3)<<16):Ya(a,b,8,4)}function mb(a,b){a=~a;return 16>S?Ya(a,b,S,Z):16===S?Ya(a,b,5,3)+(Ya(a>>>16,b>>>16,5,3)<<16):Ya(a,b,8,4)}function fa(a,b){return 16>S?Gb(a,b,S,Z):16===S?Gb(a,b,5,3)+(Gb(a>>>16,b>>>16,5,3)<<16):Gb(a,b,8,4)}function pa(a,b){return 16>S?Nb(a,b,S,Z):16===S?Nb(a,
b,5,3)+(Nb(a>>>16,b>>>16,5,3)<<16):Nb(a,b,8,4)}function Fa(){var a;var b=a=0;if(8>=db)return null;16===db&&(b=5);32===db&&(b=8);if(0===qb){if(8>=S)return null;16===S&&(a=5);32===S&&(a=8)}else a=qb;dc(b,a)}function dc(a,b){var c=[0,0,0,0],d=[0,0,0,0];var f=b-a;if(0===f)return 0;0>=f?(b=e(1,b)-1,d[0]=e(b,2*a-f),d[1]=e(b,a-f),d[2]=e(b,0-f),d[3]=0):(b=e(1,a)-1,d[0]=e(b,2*a),d[1]=e(b,a),d[2]=b);c[0]=3*f;c[1]=2*f;c[2]=f;c[3]=0;sb=c;ob=d;La|=3}function Hb(){J.showDisplayBitsLeftTopRightBottom(yb,Ua,Ta,cb,
Pa)}function zc(a,b){return a}function zb(a,b){return a-b}function Za(a,b){var c;if(5!==(La&5))return b;a=V[S];var d=b;var e=ka;for(c=1;c<=Z;c++){if(0!==(e&a)){var f=d&a;f=16>S?f:16===S?za(f,5,qb):za(f,8,qb);Xa[f&gb]+=1}e=g(e,S);d=g(d,S)}return b}function gc(){if(xa||34!==Ja&&41!==Ja||32!==db||Jb===yb)return!1;if(41===Ja){if(32===S){var a,b;var d=ia+1;var f=Ma;for(b=ea;0!==--d;){var m=f*vb+4*Ha;var p=b*Ra+4*U;for(a=W+1;0!==--a;){var q=Ea[m>>>2];var x=q&16777215;if(0===x){m+=4;for(p+=4;0!==--a&&0===
(Ea[m>>>2]&16777215);)m+=4,p+=4;++a}else x=ja[p>>>2],x=cc(q,x),ja[p>>>2]=x,m+=4,p+=4}++f;++b}Ua=U;cb=U+W;Ta=ea;Pa=ea+ia;return!0}if(16===S){var u=ia+1;var A=Ma;var h=ea;a=16*(U&1);Na&&(a=16-a);for(Ia=e(65535,16-a);0!==--u;){d=A*vb+4*Ha;b=h*Ra+4*(U>>1);q=4*(h&3);var l=(Ha&3)-1;f=W+1;x=Ia;for(a=65535===x?16:0;0!==--f;){m=na[q+(l=l+1&3)];p=Ea[d>>>2];var k=p&16777215;0!==k&&(k=ja[b>>>2],k&=~x,k=g(k,a),k=(k&31744)<<9|(k&992)<<6|(k&31)<<3|4278190080,p=cc(p,k),p=L(p,m),p=0===p?e(1,a):e(p,a),T(b,p,x));d+=
4;Na?0===a&&(b+=4):0!==a&&(b+=4);a^=16;x=~x}++A;++h}Ua=U;cb=U+W;Ta=ea;Pa=ea+ia;return!0}if(8===S){d=ba();x=La&-9;A=ia+1;h=Ma;l=ea;Ia=8*(U&3);Na&&(Ia=24-Ia);E=4294967295^e(255,Ia);b=0===(U&1)?0:522133279;for(0===(ea&1)&&(b^=522133279);0!==--A;){b^=522133279;a=h*vb+4*Ha;f=l*Ra+4*(U>>2);p=W+1;q=Ia;for(u=E;0!==--p;)m=(Ea[a>>>2]&~b)+b,k=m&16777215,k=c((k>>>16)+(k>>>8&255)+(k&255),3),31<k&&(224<k&&(m=4294967295),k=ja[f>>>2],k&=~u,k=g(k,q),k=d[k],m=cc(m,k),m=Oa(m,x),m=e(m,q),T(f,m,u)),a+=4,Na?0===q?(f+=
4,q=24,u=16777215):(q-=8,u=u>>>8|4278190080):32===q?(f+=4,q=0,u=4294967040):(q+=8,u=u<<8|255),b^=522133279;++h;++l}Ua=U;cb=U+W;Ta=ea;Pa=ea+ia;return!0}return!1}if(8>S||8===S&&0===(La&1))return!1;if(32===S)for(d=ia+1,f=Ma,b=ea;0!==--d;){m=f*vb+4*Ha;p=b*Ra+4*U;for(a=W+1;0!==--a;)if(q=Ea[m>>>2],x=q>>>24,255===x){ja[p>>>2]=q;m+=4;for(p+=4;0!==--a&&255===(q=Ea[m>>>2])>>>24;)ja[p>>>2]=q,m+=4,p+=4;++a}else if(0===x){m+=4;for(p+=4;0!==--a&&0===Ea[m>>>2]>>>24;)m+=4,p+=4;++a}else x=ja[p>>>2],x=t(q,x),ja[p>>>
2]=x,m+=4,p+=4;++f;++b}if(16===S)for(u=ia+1,A=Ma,h=ea,a=16*(U&1),Na&&(a=16-a),Ia=e(65535,16-a);0!==--u;){d=A*vb+4*Ha;b=h*Ra+4*(U>>1);q=4*(h&3);l=(Ha&3)-1;f=W+1;x=Ia;for(a=65535===x?16:0;0!==--f;)m=na[q+(l=l+1&3)],p=Ea[d>>>2],k=p>>>24,255===k?(p=L(p,m),p=0===p?e(1,a):e(p,a),T(b,p,x)):0!==k&&(k=ja[b>>>2],k&=~x,k=g(k,a),k=(k&31744)<<9|(k&992)<<6|(k&31)<<3|4278190080,p=t(p,k),p=L(p,m),p=0===p?e(1,a):e(p,a),T(b,p,x)),d+=4,Na?0===a&&(b+=4):0!==a&&(b+=4),a^=16,x=~x;++A;++h}if(8===S)for(d=ba(),x=La&-9,A=
ia+1,h=Ma,l=ea,Ia=8*(U&3),Na&&(Ia=24-Ia),E=4294967295^e(255,Ia),b=0===(U&1)?0:522133279,0===(ea&1)&&(b^=522133279);0!==--A;){b^=522133279;a=h*vb+4*Ha;f=l*Ra+4*(U>>2);p=W+1;q=Ia;for(u=E;0!==--p;)m=(Ea[a>>>2]&~b)+b,k=m>>>24,31<k&&(224>k&&(k=ja[f>>>2],k&=~u,k=g(k,q),k=d[k],m=t(m,k)),m=Oa(m,x),m=e(m,q),T(f,m,u)),a+=4,Na?0===q?(f+=4,q=24,u=16777215):(q-=8,u=u>>>8|4278190080):24===q?(f+=4,q=0,u=4294967040):(q+=8,u=u<<8|255),b^=522133279;++h;++l}Ua=U;cb=U+W;Ta=ea;Pa=ea+ia;return!0}function Wb(){if(X){if(!uc&&
!Y())return null;var a=uc;var b=!1;var c=J.fetchPointerofObject(0,yb);"number"===typeof c&&(a(c,Ua,Ta,cb-Ua,Pa-Ta),ja=Ra=0,b=!0);if(!xa){var d=J.fetchPointerofObject(0,Jb);"number"===typeof d&&(b&&d===c||a(d,0,0,0,0),Ea=vb=0)}X=!1}}function qc(){var b,d;var f=ra[Ja+1];f;if(!(27<=a(la)))return J.primitiveFail();var m=Bb-1;0>=m&&(m=1);var p=R(15,la);var q=R(18,la);var g=aa(p,q,m);0>g&&(p=q-m*g);var x=R(16,la);q=R(19,la);var u=aa(x,q,m);0>u&&(x=q-m*u);var t=R(24,la);q=R(21,la);var A=aa(t,q,m);0>A&&(t=
q-m*A);var h=R(25,la);q=R(22,la);var l=aa(h,q,m);0>l&&(h=q-m*l);if(J.failed())return!1;if(2===J.methodArgumentCount()){var k=J.stackIntegerValue(1);var v=J.stackValue(0);if(v.isNil){if(16>db)return J.primitiveFail()}else{if(a(v)<e(1,db))return J.primitiveFail();v=v.wordsOrBytes()}}else k=1,v=J.nilObject();m=$b-1;0>=m&&(m=1);var N=Z-(U&Z-1);var n=(U+W-1&Z-1)+1;W<N&&(N=W);Ga<jb&&(p+=(jb-Ga)*g,x+=(jb-Ga)*u,t+=(jb-Ga)*A,h+=(jb-Ga)*l);vc=0;for(b=db;1!==b;)++vc,b>>>=1;Dc=V[db];Bc=5-vc;Ac=e(1,Bc)-1;for(b=
0;b<=Ac;b++)Cc[b]=fc?32-e(b+1,vc):e(b,vc);1<k&&0===(La&8)&&(Xa?dc(8,qb):16===S&&dc(8,5));b=La&-9;if(Na){var I=0-S;var G=32-S}else I=S,G=0;for(d=1;d<=ia;d++){var w=aa(p,t,m);Ha=0<=w?p:t-m*w;var r=aa(x,h,m);Ma=0<=r?x:h-m*r;$a=Na?32-((U&Z-1)+1)*S:(U&Z-1)*S;pb<Sa&&(Ha+=(Sa-pb)*w,Ma+=(Sa-pb)*r);var F=z?4294967295:Ka(ea+d-1);ka=Ia;var y=N;q=da;do{if(1===k){var L=w,B=r,K=I,D=b;var P=V[S];var M=0;if(5===D){do{var O=pc(Ha,Ma);O=Xa[O&gb];M|=e(O&P,$a);$a+=K;Ha+=L;Ma+=B}while(0!==--y)}else{do O=pc(Ha,Ma),O=Oa(O,
D),M|=e(O&P,$a),$a+=K,Ha+=L,Ma+=B;while(0!==--y)}P=M}else{var ba,C,T,Q;var oa=y;K=w;D=r;var bb=g;var H=u;y=v;O=k;var ca=I;M=V[S];B=0;2===O?(L=K>>1,P=D>>1,bb>>=1,H>>=1):(L=c(K,O),P=c(D,O),bb=c(bb,O),H=c(H,O));var ha=oa;do{var Qa=Ha;var wa=Ma;var va=C=ba=T=Q=0;var Y=O;do{oa=Qa;var Ba=wa;var fb=O;do{var ua=pc(oa,Ba);if(25!==Ja||0!==ua)++va,ua=16>db?y[ua]:16===db?Sb(ua):ua,Q+=ua&255,T+=ua>>>8&255,ba+=ua>>>16&255,C+=ua>>>24;oa+=L;Ba+=P}while(0!==--fb);Qa+=bb;wa+=H}while(0!==--Y);0===va||25===Ja&&va<O*
O>>1?ua=0:(4===va?(ba>>>=2,T>>>=2,Q>>>=2,C>>>=2):(ba=c(ba,va),T=c(T,va),Q=c(Q,va),C=c(C,va)),ua=(C<<24)+(ba<<16)+(T<<8)+Q,0===ua&&0<ba+T+Q+C&&(ua=1),ua=Oa(ua,La));B|=e(ua&M,$a);$a+=ca;Ha+=K;Ma+=D}while(0!==--ha);P=B}$a=G;4294967295===ka?(P=f(P&F,ja[ma>>>2]),ja[ma>>>2]=ka&P):(M=ja[ma>>>2],P=f(P&F,M&ka),M=ka&P|M&~ka,ja[ma>>>2]=M);ma+=4;2===q?(ka=E,y=n):(ka=4294967295,y=Z)}while(0!==--q);p+=g;x+=u;t+=A;h+=l;ma+=Ib}}var Pa=0,Ua=0,cb=0,Ta=0,ia=0,W=0,la=0,xb=0,sa=0,Vb=0,Sa=0,jb=0,qb=0,La=0,Xa=null,gb=0,
ob=null,sb=null,Ja=0,Yb=0,Rb=0,ja=0,Ib=0,S=0,yb=0,Fb=0,ma=0,Na=0,ka=0,Z=0,Ra=0,tb=0,pb=0,Ga=0,Cb=Array(4096),na=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],Aa=[0,2,4,6,8,12,14,16],hb=[0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],$a=0,U=0,ea=0,kb=null,ab=0,Mb=0,qa=0,Da=0,X=0,Bb=0,J=null,Wa=0,r=null,Ia=0,E=0,V=[0,1,3,0,15,31,0,0,255,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],da=0,z=0,xa=0,ra=Array(43),ic=0,kc=null,Ab=0,lc=0,Ea=0,sc=0,db=0,Jb=0,ec=0,rb=
0,fc=0,Zb=0,vb=0,hc=0,mc=0,wc=0,tc=0,Ha=0,Ma=0,Tb=null,uc=null,jc=0,Ac=0,Bc=0,Cc=Array(32),Dc=0,vc=0,$b=0;Squeak.registerExternalModule("BitBltPlugin",{primitiveCopyBits:function(){var a=J.stackValue(J.methodArgumentCount());if(!wa(a))return J.primitiveFail();v();if(J.failed())return null;Hb();if(J.failed())return null;J.pop(J.methodArgumentCount());if(22===Ja||32===Ja)return J.pop(1),J.pushInteger(xb)},copyBits:v,moduleUnloaded:function(a){0===strcmp(a,"SurfacePlugin")&&(kc=r=uc=0)},primitiveDrawLoop:function(){var a=
J.stackValue(2);var b=J.stackIntegerValue(1);var c=J.stackIntegerValue(0);if(!wa(a))return J.primitiveFail();if(!J.failed()){a:{var d,f,e;a=0<b?1:0===b?0:-1;var m=0<c?1:0===c?0:-1;c=Math.abs(c);var p=Math.abs(b);var q=d=9999;var g=e=-9999;if(p>c)for(b=p>>1,f=1;f<=p;f++){if(pb+=a,0>(b-=c)&&(Ga+=m,b+=p),f<p){v();if(J.failed())break a;Ua<cb&&Ta<Pa&&(q=Math.min(q,Ua),g=Math.max(g,cb),d=Math.min(d,Ta),e=Math.max(e,Pa),4E3<(g-q)*(e-d)&&(Ua=q,cb=g,Ta=d,Pa=e,Hb(),q=d=9999,g=e=-9999))}}else for(b=c>>1,f=1;f<=
c;f++)if(Ga+=m,0>(b-=p)&&(pb+=a,b+=c),f<c){v();if(J.failed())break a;Ua<cb&&Ta<Pa&&(q=Math.min(q,Ua),g=Math.max(g,cb),d=Math.min(d,Ta),e=Math.max(e,Pa),4E3<(g-q)*(e-d)&&(Ua=q,cb=g,Ta=d,Pa=e,Hb(),q=d=9999,g=e=-9999))}Ua=q;cb=g;Ta=d;Pa=e;J.storeIntegerofObjectwithValue(4,la,pb);J.storeIntegerofObjectwithValue(5,la,Ga)}Hb()}J.failed()||J.pop(2)},primitiveDisplayString:function(){if(6!==J.methodArgumentCount())return J.primitiveFail();var c=J.stackIntegerValue(0);var d=J.stackObjectValue(1);var f=J.stackObjectValue(2);
if(l(d)!==J.classArray()||l(f)!==J.classArray()||256!==a(f))return J.primitiveFail();if(J.failed())return null;var e=a(d)-2;var m=J.stackIntegerValue(3);var p=J.stackIntegerValue(4);var q=J.stackObjectValue(5);if(!(J.isBytes(q)&&0<p&&0<m&&m<=b(q)))return J.primitiveFail();var g=J.stackObjectValue(6);if(!wa(g)||30===Ja||31===Ja)return J.primitiveFail();var x=0!==ja&&0!==Ea&&!1===xa&&Jb!==yb&&(0!==La||fc!==Na||db!==S);var u=pb;for(q=q.bytes;p<=m;p++){var t=q[p-1];t=J.fetchIntegerofObject(t,f);if(0>
t||t>e)return J.primitiveFail();mc=J.fetchIntegerofObject(t,d);$b=J.fetchIntegerofObject(t+1,d)-mc;if(J.failed())return null;M();0<W&&0<ia&&(x?(ha(),K(),Ua=U,cb=U+W,Ta=ea,Pa=ea+ia):v());if(J.failed())return null;pb=pb+$b+c}Ua=u;Hb();J.storeIntegerofObjectwithValue(4,g,pb);J.pop(6)},initialiseModule:function(){ra[1]=I;ra[2]=m;ra[3]=x;ra[4]=zc;ra[5]=q;ra[6]=Q;ra[7]=H;ra[8]=F;ra[9]=u;ra[10]=O;ra[11]=A;ra[12]=C;ra[13]=P;ra[14]=B;ra[15]=D;ra[16]=Q;ra[17]=Q;ra[18]=Q;ra[19]=n;ra[20]=zb;ra[21]=bc;ra[22]=
pa;ra[23]=f;ra[24]=d;ra[25]=k;ra[26]=nc;ra[27]=ac;ra[28]=ya;ra[29]=ub;ra[30]=mb;ra[31]=y;ra[32]=p;ra[33]=Ob;ra[34]=Za;ra[35]=t;ra[36]=t;ra[37]=t;ra[38]=fa;ra[39]=rc;ra[40]=oc;ra[41]=ua;ra[42]=Xb;var a,b;for(b=0;255>=b;b++)for(a=0;15>=a;a++){var c=b&255;var e=Aa[c&7];c=hb[c>>>3];var g=a<e?c+1:c;c=b>>>8&255;e=Aa[c&7];c=hb[c>>>3];g=a<e?g|c+1<<5:g|c<<5;c=b>>>16&255;e=Aa[c&7];c=hb[c>>>3];g=a<e?g|c+1<<10:g|c<<10;Cb[(a<<8)+b]=g}return!0},loadBitBltFrom:wa,setInterpreter:function(a){J=a;a=1==J.majorVersion();
return!1===a?!1:a=11<=J.minorVersion()},primitiveWarpBits:function(){var a=J.stackValue(J.methodArgumentCount());if(!Ba(a,!0))return J.primitiveFail();a=xa;xa=!0;M();(xa=a)||0>=W||0>=ia?Ua=cb=Ta=Pa=0:ib()?(ha(),qc(),0<ab?(Ua=U,cb=U+W):(Ua=U-W+1,cb=U+1),0<jc?(Ta=ea,Pa=ea+ia):(Ta=ea-ia+1,Pa=ea+1),Wb()):J.primitiveFail();if(J.failed())return null;Hb();if(J.failed())return null;J.pop(J.methodArgumentCount())},getModuleName:function(){return"BitBltPlugin 3 November 2014 (e)"},primitivePixelValueAt:function(){var d=
J.stackIntegerValue(1);var f=J.stackIntegerValue(0);J.stackValue(2);if(J.failed())return null;if(0>d||0>f){d=0;if(J.failed())return null;J.popthenPush(3,d);return null}var e=J.stackValue(J.methodArgumentCount());if(!(J.isPointers(e)&&4<=a(e)))return J.primitiveFail(),null;var m=J.fetchPointerofObject(0,e);if(!J.isWordsOrBytes(m))return J.primitiveFail(),null;$b=J.fetchIntegerofObject(1,e);Bb=J.fetchIntegerofObject(2,e);e=J.fetchIntegerofObject(3,e);if(J.failed())return null;if(d>=$b||f>=Bb){d=0;if(J.failed())return null;
J.popthenPush(3,d);return null}if(0>e)return J.primitiveFail(),null;var p=c(32,e);var q=c($b+(p-1),p);if(b(m)!==q*Bb*4)return J.primitiveFail(),null;m=J.fetchLong32ofObject(f*q+c(d,p),m);f=g(4294967295,32-e);d=g(m,32-((d&p-1)+1)*e)&f;d=J.positive32BitIntegerFor(d);if(J.failed())return null;J.popthenPush(3,d);return null},copyBitsFromtoat:function(a,b,c){pb=a;Ga=c;mc=a;$b=b-a;v();Hb()}})});module("users.bert.SqueakJS.plugins.FFTPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a){d.success(d.isWords(a));return d.failed()?0:a.wordsAsFloat32Array()}function b(b){d.success(6<=l(b));if(d.failed())return!1;n=d.fetchIntegerofObject(0,b);g=d.fetchIntegerofObject(1,b);var c=d.fetchPointerofObject(2,b);m=l(c);p=a(c);c=d.fetchPointerofObject(3,b);y=l(c);d.success(d.isWords(c));
k=c.words;c=d.fetchPointerofObject(4,b);t=l(c);w=a(c);c=d.fetchPointerofObject(5,b);f=l(c);h=a(c);d.success((31<n?0:1<<n)===g&&(g>>2)+1===m&&g===t&&g===f&&t===f);return!1===d.failed()}function c(){var a;var b=0;for(a=y;b<a;){var c=k[b]-1;var e=k[b+1]-1;if(!(c<t&&e<t))return d.success(!1);var f=w[c];w[c]=w[e];w[e]=f;f=h[c];h[c]=h[e];h[e]=f;b+=2}}function e(){var a;if(1>=g)return null;var b=1/g;for(a=0;a<=g-1;a++)w[a]*=b,h[a]*=b}var g=0,h=null,f=0,d=null,n=0,k=null,y=0,w=null,t=0,p=null,m=0;Squeak.registerExternalModule("FFTPlugin",
{primitiveFFTTransformData:function(){var a=d.booleanValueOf(d.stackValue(0));var f=d.stackObjectValue(1);if(!b(f))return null;c();if(d.failed())c();else{var u,t;var l=g>>1;var k=g>>2;for(t=1;t<=n;t++){var y=31<t?0:1<<t;var O=y>>1;f=Math.floor(g/y)|0;for(u=1;u<=O;u++){var F=(u-1)*f;if(F<k){var C=p[m-F-1];var H=p[F]}else C=0-p[F-k],H=p[l-F];a||(H=0-H);for(F=u;F<=g;){var I=F+O-1;var M=F-1;var v=w[I]*C-h[I]*H;var N=w[I]*H+h[I]*C;w[I]=w[M]-v;h[I]=h[M]-N;w[M]+=v;h[M]+=N;F+=y}}}a||e()}d.failed()||d.pop(1)},
setInterpreter:function(a){d=a;a=1==d.majorVersion();return!1===a?!1:a=11<=d.minorVersion()},primitiveFFTPermuteData:function(){var a=d.stackObjectValue(0);if(!b(a))return null;c();d.failed()&&c()},primitiveFFTScaleData:function(){var a=d.stackObjectValue(0);if(!b(a))return null;e()},getModuleName:function(){return"FFTPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.FloatArrayPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}var a=null;Squeak.registerExternalModule("FloatArrayPlugin",{primitiveMulFloatArray:function(){var b;var c=a.stackObjectValue(0);var e=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));a.success(a.isWords(e));if(a.failed())return null;var g=l(c);a.success(g===l(e));if(a.failed())return null;
e=e.wordsAsFloat32Array();c=c.wordsAsFloat32Array();for(b=0;b<=g-1;b++)e[b]*=c[b];a.pop(1)},primitiveEqual:function(){var b;var c=a.stackObjectValue(0);var e=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));a.success(a.isWords(e));if(a.failed())return null;a.pop(2);var g=l(c);if(g!==l(e))return a.pushBool(!1);e=e.wordsAsFloat32Array();c=c.wordsAsFloat32Array();for(b=0;b<=g-1;b++)if(e[b]!==c[b])return a.pushBool(!1);return a.pushBool(!0)},primitiveAtPut:function(){var b=a.stackValue(0);
var c="number"===typeof b?b:a.floatValueOf(b);var e=a.stackIntegerValue(1);var g=a.stackObjectValue(2);if(a.failed())return null;a.success(a.isWords(g));a.success(0<e&&e<=l(g));if(a.failed())return null;g.wordsAsFloat32Array()[e-1]=c;a.failed()||a.popthenPush(3,b)},primitiveAt:function(){var b=a.stackIntegerValue(0);var c=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));a.success(0<b&&b<=l(c));if(a.failed())return null;b=c.wordsAsFloat32Array()[b-1];a.pop(2);a.pushFloat(b)},
primitiveNormalize:function(){var b;var c=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(c));if(a.failed())return null;var e=l(c);a.success(!0);var g=c.wordsAsFloat32Array();for(c=b=0;c<=e-1;c++)b+=g[c]*g[c];a.success(0<b);if(a.failed())return null;b=Math.sqrt(b);for(c=0;c<=e-1;c++)g[c]/=b},primitiveSubFloatArray:function(){var b;var c=a.stackObjectValue(0);var e=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));a.success(a.isWords(e));if(a.failed())return null;
var g=l(c);a.success(g===l(e));if(a.failed())return null;e=e.wordsAsFloat32Array();c=c.wordsAsFloat32Array();for(b=0;b<=g-1;b++)e[b]-=c[b];a.pop(1)},primitiveDivFloatArray:function(){var b;var c=a.stackObjectValue(0);var e=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));a.success(a.isWords(e));if(a.failed())return null;var g=l(c);a.success(g===l(e));if(a.failed())return null;e=e.wordsAsFloat32Array();c=c.wordsAsFloat32Array();for(b=0;b<=g-1;b++)if(0===c[b])return a.primitiveFail();
for(b=0;b<=g-1;b++)e[b]/=c[b];a.pop(1)},primitiveAddScalar:function(){var b=a.stackFloatValue(0);var c=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));if(a.failed())return null;var e=l(c);var g=c.wordsAsFloat32Array();for(c=0;c<=e-1;c++)g[c]+=b;a.pop(1)},primitiveDotProduct:function(){var b,c;var e=a.stackObjectValue(0);var g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(e));a.success(a.isWords(g));if(a.failed())return null;var h=l(e);a.success(h===l(g));
if(a.failed())return null;g=g.wordsAsFloat32Array();e=e.wordsAsFloat32Array();for(b=c=0;b<=h-1;b++)c+=g[b]*e[b];a.pop(2);a.pushFloat(c)},primitiveSubScalar:function(){var b=a.stackFloatValue(0);var c=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));if(a.failed())return null;var e=l(c);var g=c.wordsAsFloat32Array();for(c=0;c<=e-1;c++)g[c]-=b;a.pop(1)},setInterpreter:function(b){a=b;b=1==a.majorVersion();return!1===b?!1:b=11<=a.minorVersion()},primitiveSum:function(){var b;var c=
a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(c));if(a.failed())return null;var e=l(c);var g=c.wordsAsFloat32Array();for(c=b=0;c<=e-1;c++)b+=g[c];a.popthenPush(1,a.floatObjectOf(b))},getModuleName:function(){return"FloatArrayPlugin 3 November 2014 (e)"},primitiveHashArray:function(){var b;var c=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(c));if(a.failed())return null;var e=l(c);var g=c.wordsAsInt32Array();for(c=b=0;c<=e-1;c++)b+=g[c];a.pop(1);return a.pushInteger(b&
536870911)},primitiveMulScalar:function(){var b=a.stackFloatValue(0);var c=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));if(a.failed())return null;var e=l(c);var g=c.wordsAsFloat32Array();for(c=0;c<=e-1;c++)g[c]*=b;a.pop(1)},primitiveLength:function(){var b;var c=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(c));if(a.failed())return null;var e=l(c);a.success(!0);var g=c.wordsAsFloat32Array();for(c=b=0;c<=e-1;c++)b+=g[c]*g[c];b=Math.sqrt(b);a.popthenPush(1,
a.floatObjectOf(b))},primitiveAddFloatArray:function(){var b;var c=a.stackObjectValue(0);var e=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));a.success(a.isWords(e));if(a.failed())return null;var g=l(c);a.success(g===l(e));if(a.failed())return null;e=e.wordsAsFloat32Array();c=c.wordsAsFloat32Array();for(b=0;b<=g-1;b++)e[b]+=c[b];a.pop(1)},primitiveDivScalar:function(){var b=a.stackFloatValue(0);var c=a.stackObjectValue(1);if(a.failed())return null;if(0===b)return a.primitiveFail();
a.success(a.isWords(c));if(a.failed())return null;var e=l(c);c=c.wordsAsFloat32Array();var g=1/b;for(b=0;b<=e-1;b++)c[b]*=g;a.pop(1)}})});module("users.bert.SqueakJS.plugins.GeniePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){return new Int32Array(a.buffer,a.byteOffset+4*b)}function b(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];c=d-c;a=b-a;return c*c+a*a}function c(a){console.log("GeniePlugin v2.0 14 November 2014 (e): "+a)}var e=null;Squeak.registerExternalModule("GeniePlugin",{primVersionNO:function(){if(e.failed())return null;
e.popthenPush(1,2E3);return null},setInterpreter:function(a){e=a;a=1==e.majorVersion();return!1===a?!1:a=11<=e.minorVersion()},primSameClassAbsoluteStrokeDistanceMyPoints_otherPoints_myVectors_otherVectors_mySquaredLengths_otherSquaredLengths_myAngles_otherAngles_maxSizeAndReferenceFlag_rowBase_rowInsertRemove_rowInsertRemoveCount:function(){var g=e.stackValue(11);var h=e.stackValue(10);var f=e.stackValue(9);var d=e.stackValue(8);var n=e.stackValue(7);var k=e.stackValue(6);var y=e.stackValue(5);var w=
e.stackValue(4);var t=e.stackIntegerValue(3);var p=e.stackValue(2);var m=e.stackValue(1);var x=e.stackValue(0);if(e.failed())return null;if(e.failed())return c("failed 1"),null;e.success(e.isWords(g)&&e.isWords(h)&&e.isWords(f)&&e.isWords(d)&&e.isWords(n)&&e.isWords(k)&&e.isWords(y)&&e.isWords(w)&&e.isWords(p)&&e.isWords(m)&&e.isWords(x));if(e.failed())return c("failed 2"),null;e.success(e.isMemberOf(g,"PointArray")&&e.isMemberOf(h,"PointArray"));if(e.failed())return c("failed 3"),null;var q=g.wordsAsInt32Array();
var u=h.wordsAsInt32Array();var A=f.wordsAsInt32Array();var B=d.wordsAsInt32Array();var D=n.wordsAsInt32Array();var P=k.wordsAsInt32Array();var O=y.wordsAsInt32Array();var F=w.wordsAsInt32Array();var C=p.wordsAsInt32Array();var H=m.wordsAsInt32Array();var I=x.wordsAsInt32Array();h=l(h)>>>1;f=l(f)>>>1;d=l(d)>>>1;k=l(k);p=l(p);e.success(p===l(m)&&p===l(x)&&p>d);if(e.failed())return c("failed 4"),null;e.success(l(n)>=f-1&&l(g)>>>1>=f&&k>=d-1&&h>=d&&l(y)>=f-1&&l(w)>=d-1);if(e.failed())return c("failed 5"),
null;g=t&1;t>>>=1;n=g?0:t*t>>>10;C[0]=0;H[0]=0;I[0]=2;var M=0-n;t=d;if(!(h>=t-1&&k>=t-1))return e.primitiveFail(),null;for(y=1;y<=t;y++)x=y-1,M=M+(P[x]+b(a(u,x<<1),q)>>>7)+n,H[y]=M,C[y]=M*y,I[y]=y+1;M=H[0]-n;for(w=1;w<=f;w++){h=w-1;k=h<<1;m=C[0];M=M+(D[h]+b(a(q,k),u)>>>7)+n;H[0]=M;C[0]=M*w;I[0]=w+1;t=d;for(y=1;y<=t;y++){x=y-1;var v=x<<1;var N=C[y];var G=C[x];var K=D[h]+b(a(q,k),a(u,y<<1))>>>7;0===(M=H[y])?N+=K:(N=N+M+K*I[y],K+=M);p=P[x]+b(a(u,v),a(q,w<<1))>>>7;0===(M=H[x])?G+=p:(G=G+M+p*I[x],p+=M);
g?m=536870912:(M=b(a(B,v),a(A,k))+b(a(u,v),a(q,k)),v=Math.abs(O[h]-F[x]),180<v&&(v=360-v),M=M*(16+(v*v>>>6))>>>11,m+=M);m<=N&&m<=G?(N=m,M=0,x=1):N<=G?(M=K+n,x=I[y]+1):(N=G,M=p+n,x=I[x]+1);m=C[y];C[y]=Math.min(N,536870912);H[y]=Math.min(M,536870912);I[y]=x}M=H[0]}F=N;if(e.failed())return null;e.popthenPush(13,F);return null},getModuleName:function(){return"GeniePlugin v2.0 14 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.JPEGReaderPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){if("number"===typeof b||!u.isPointers(b)||11>l(b))return!1;a[0]=u.fetchIntegerofObject(0,b);a[1]=u.fetchIntegerofObject(1,b);a[2]=u.fetchIntegerofObject(2,b);a[3]=u.fetchIntegerofObject(3,b);a[5]=u.fetchIntegerofObject(5,b);a[8]=u.fetchIntegerofObject(8,b);a[10]=u.fetchIntegerofObject(10,
b);return!u.failed()}function b(a,b){var c;if("number"===typeof b||!u.isPointers(b)||11>l(b))return!1;b=u.fetchPointerofObject(4,b);if("number"===typeof b||!u.isPointers(b))return!1;var d=l(b);if(128<d)return!1;for(c=0;c<=d-1;c++){var e=u.fetchPointerofObject(c,b);if("number"===typeof e||!u.isWords(e)||64!==l(e))return!1;a[c]=e.wordsAsInt32Array()}return!u.failed()}function c(a,b){var c=g(m,x);if(0>c)return u.primitiveFail();if(0!==c){var d=e(c);c=f(d,c)}c=b[10]+=c;a[0]=c;for(c=1;63>=c;c++)a[c]=0;
for(b=1;64>b;){c=g(n,k);if(0>c)return u.primitiveFail();d=c>>>4;c&=15;if(0!==c){b+=d;d=e(c);c=f(d,c);if(0>b||64<=b)return u.primitiveFail();a[D[b]]=c}else if(15===d)b+=d;else return null;++b}}function e(a){if(a>O){for(var b;16>=O&&C<H;){b=F[C];++C;if(255===b){if(!(C<H&&0===F[C])){--C;break}++C}P=P<<8|b;O+=8}if(a>O)return-1}O-=a;a=31<O?0:P>>>O;P&=(31<O?0:1<<O)-1;return a}function g(a,b){var c;var d=a[0]>>>24;if(16<d)return-1;for(c=2;;){d=e(d);if(0>d)break;c=c+d-1;if(c>=b)break;d=a[c];if(0===(d&1056964608))return d;
c=d&65535;d=d>>>24&255;if(16<d)break}return-1}function h(){var a;var b=a=v[0];var c=v[1];var d=v[2];var e=v[3];0!==d&&0!==e&&(b=Math.floor(b/d)|0,c=Math.floor(c/e)|0);b=M[(c>>>3)*v[5]+(b>>>3)][((c&7)<<3)+(b&7)];++a;a<8*v[8]?v[0]=a:(v[0]=0,v[1]++);return b}function f(a,b){var c=b-1;return a<(31<c?0:1<<c)?a-(31<b?0:1<<b)+1:a}function d(c){return a(v,c)&&b(M,c)}var n=null,k=0,y=Array(128),w=Array(11),t=Array(128),p=Array(11),m=null,x=0,q=0,u=null,A=null,B=0,D=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,
12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],P=0,O=0,F=null,C=0,H=0,I=null,M=Array(128),v=Array(11);Squeak.registerExternalModule("JPEGReaderPlugin",{setInterpreter:function(a){u=a;a=1==u.majorVersion();return!1===a?!1:a=11<=u.minorVersion()},primitiveIdctInt:function(){if(2!==u.methodArgumentCount())return u.primitiveFail();var a=u.stackObjectValue(0);if(u.failed())return null;if(!u.isWords(a)||64!==
l(a))return u.primitiveFail();var b=a.wordsAsInt32Array();a=u.stackObjectValue(1);if(u.failed())return null;if(!u.isWords(a)||64!==l(a))return u.primitiveFail();a=a.wordsAsInt32Array();var c,d,e=Array(64);for(c=0;7>=c;c++){var f=-1;for(d=1;7>=d;d++)-1===f&&0!==a[8*d+c]&&(f=d);if(-1===f)for(f=a[c]*b[0]<<2,d=0;7>=d;d++)e[8*d+c]=f;else{var m=a[16+c]*b[16+c];var p=a[48+c]*b[48+c];var q=4433*(m+p);var g=q+-15137*p;var x=q+6270*m;m=a[c]*b[c];p=a[32+c]*b[32+c];f=m+p<<13;d=m-p<<13;var t=f+x;var A=f-x;var h=
d+g;var k=d-g;f=a[56+c]*b[56+c];d=a[40+c]*b[40+c];g=a[24+c]*b[24+c];x=a[8+c]*b[8+c];q=f+x;m=d+g;p=f+g;var v=d+x;var n=9633*(p+v);f*=2446;d*=16819;g*=25172;x*=12299;q*=-7373;m*=-20995;p*=-16069;v*=-3196;p+=n;v+=n;f=f+q+p;d=d+m+v;g=g+m+p;x=x+q+v;e[c]=t+x>>11;e[56+c]=t-x>>11;e[8+c]=h+g>>11;e[48+c]=h-g>>11;e[16+c]=k+d>>11;e[40+c]=k-d>>11;e[24+c]=A+f>>11;e[32+c]=A-f>>11}}for(c=0;56>=c;c+=8)m=e[c+2],p=e[c+6],q=4433*(m+p),g=q+-15137*p,x=q+6270*m,f=e[c]+e[c+4]<<13,d=e[c]-e[c+4]<<13,t=f+x,A=f-x,h=d+g,k=d-
g,f=e[c+7],d=e[c+5],g=e[c+3],x=e[c+1],q=f+x,m=d+g,p=f+g,v=d+x,n=9633*(p+v),f*=2446,d*=16819,g*=25172,x*=12299,q*=-7373,m*=-20995,p*=-16069,v*=-3196,p+=n,v+=n,f=f+q+p,d=d+m+v,g=g+m+p,x=x+q+v,b=(t+x>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c]=b,b=(t-x>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+7]=b,b=(h+g>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+1]=b,b=(h-g>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+6]=b,b=(k+d>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+2]=b,b=(k-d>>18)+127,b=
Math.min(b,255),b=Math.max(b,0),a[c+5]=b,b=(A+f>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+3]=b,b=(A-f>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+4]=b;u.pop(2)},primitiveColorConvertMCU:function(){if(4!==u.methodArgumentCount())return u.primitiveFail();q=u.stackIntegerValue(0);var c=u.stackObjectValue(1);if(u.failed())return null;if(!u.isWords(c)||3!==l(c))return u.primitiveFail();I=c.wordsAsInt32Array();c=u.stackObjectValue(2);if(u.failed())return null;if(!u.isWords(c))return u.primitiveFail();
B=l(c);A=c.wordsAsInt32Array();c=u.stackObjectValue(3);if(u.failed())return null;if(!u.isPointers(c)||3!==l(c)||!d(u.fetchPointerofObject(0,c)))return u.primitiveFail();var e=u.fetchPointerofObject(1,c);if(!a(w,e)||!b(y,e))return u.primitiveFail();c=u.fetchPointerofObject(2,c);if(!a(p,c)||!b(t,c))return u.primitiveFail();var f;v[0]=0;v[1]=0;w[0]=0;w[1]=0;p[0]=0;for(c=p[1]=0;c<=B-1;c++){e=h();var m=f=w[0];var g=w[1];var x=w[2];var k=w[3];0!==x&&0!==k&&(m=Math.floor(m/x)|0,g=Math.floor(g/k)|0);k=y[(g>>>
3)*w[5]+(m>>>3)][((g&7)<<3)+(m&7)];++f;f<8*w[8]?w[0]=f:(w[0]=0,w[1]++);f=k;f-=127;var n=k=p[0];m=p[1];g=p[2];x=p[3];0!==g&&0!==x&&(n=Math.floor(n/g)|0,m=Math.floor(m/x)|0);x=t[(m>>>3)*p[5]+(n>>>3)][((m&7)<<3)+(n&7)];++k;k<8*p[8]?p[0]=k:(p[0]=0,p[1]++);x-=127;k=e+(91881*x>>16)+I[0];k=Math.min(k,255);k=Math.max(k,0);I[0]=k&q;k&=255-q;k=Math.max(k,1);x=e-(22554*f>>16)-(46802*x>>16)+I[1];x=Math.min(x,255);x=Math.max(x,0);I[1]=x&q;x&=255-q;x=Math.max(x,1);e=e+(116130*f>>16)+I[2];e=Math.min(e,255);e=Math.max(e,
0);I[2]=e&q;e&=255-q;e=Math.max(e,1);A[c]=4278190080+(k<<16)+(x<<8)+e}u.pop(4)},primitiveColorConvertGrayscaleMCU:function(){if(4!==u.methodArgumentCount())return u.primitiveFail();q=u.stackIntegerValue(0);var a=u.stackObjectValue(1);if(u.failed())return null;if(!u.isWords(a)||3!==l(a))return u.primitiveFail();I=a.wordsAsInt32Array();a=u.stackObjectValue(2);if(u.failed())return null;if(!u.isWords(a))return u.primitiveFail();B=l(a);A=a.wordsAsInt32Array();a=u.stackObjectValue(3);if(u.failed())return null;
if(!d(a))return u.primitiveFail();v[0]=0;for(a=v[1]=0;a<=B-1;a++){var b=h();b+=I[1];b=Math.min(b,255);I[1]=b&q;b&=255-q;b=Math.max(b,1);A[a]=4278190080+(b<<16)+(b<<8)+b}u.pop(4)},primitiveDecodeMCU:function(){if(5!==u.methodArgumentCount())return u.primitiveFail();var b=u.stackObjectValue(0);if(u.failed())return null;if(5>l(b)||!u.isPointers(b))b=!1;else{var d=u.fetchPointerofObject(0,b);"number"!==typeof d&&u.isBytes(d)?(d=(F=d.bytes)?d.bytes.length:d.words?4*d.words.length:0,C=u.fetchIntegerofObject(1,
b),H=u.fetchIntegerofObject(2,b),P=u.fetchIntegerofObject(3,b),O=u.fetchIntegerofObject(4,b),b=u.failed()||d<H||0>C||C>=H?!1:!0):b=!1}if(!b)return u.primitiveFail();b=u.stackObjectValue(1);if(u.failed())return null;if(!u.isWords(b))return u.primitiveFail();k=l(b);n=b.wordsAsInt32Array();b=u.stackObjectValue(2);if(u.failed())return null;if(!u.isWords(b))return u.primitiveFail();x=l(b);m=b.wordsAsInt32Array();b=u.stackObjectValue(3);if(u.failed())return null;if(!a(v,b))return u.primitiveFail();b=u.stackObjectValue(4);
if(u.failed())return null;if(!u.isWords(b)||64!==l(b))return u.primitiveFail();b=b.wordsAsInt32Array();if(u.failed())return null;c(b,v);if(u.failed())return null;b=u.stackValue(0);u.storeIntegerofObjectwithValue(1,b,C);u.storeIntegerofObjectwithValue(3,b,P);u.storeIntegerofObjectwithValue(4,b,O);u.storeIntegerofObjectwithValue(10,u.stackValue(3),v[10]);u.pop(5)},getModuleName:function(){return"JPEGReaderPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.KedamaPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){if(0===a)return 0<=b?90:270;var c=Math.atan(b/a);return 0<=a?0<=b?c/.0174532925199433:360+c/.0174532925199433:180+c/.0174532925199433}function b(a){a=90-a;var b=a/360|0;0>a&&--b;return.0174532925199433*(a-360*b)}function c(a){var b=y;d=n*(d-(Math.floor(d/b)|0)*b|0)-w*(Math.floor(d/y)|
0);b=(d&65535)*((0>a?0-a:a)+1)>>>16;return 0>a?0-b:b}function e(a){a=90-a/.0174532925199433;0<a||(a+=360);return a}function g(a,b,c,d,e,f,g){0>d&&(1===f&&(d+=e),2===f&&(d=0),3===f&&(d=0-d,f=c[a],c[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));d>=e&&(1===g&&(d-=e),2===g&&(d=e-1E-6),3===g&&(d=e-1E-6-(d-e),f=c[a],c[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));b[a]=d}function h(a,b,c,d,e,f,g){0>d&&(1===f&&(d+=e),2===f&&(d=0),3===f&&(d=0-d,c[a]=6.283185307179586-c[a]));
d>=e&&(1===g&&(d-=e),2===g&&(d=e-1E-6),3===g&&(d=e-1E-6-(d-e),c[a]=6.283185307179586-c[a]));b[a]=d}var f=null,d=0,n=0,k=0,y=0,w=0;Squeak.registerExternalModule("KedamaPlugin",{makeMaskLog:function(){var a=f.stackValue(0);var b=f.stackIntegerValue(1);var c=f.stackValue(2);var d=f.stackValue(3);if(f.failed())return null;a=a.words[0];if(f.failed())return null;var e=Math.log(a);a=l(d);var g=l(c);if(a!==g)return f.primitiveFail(),null;d=d.words;g=c.words;for(c=0;c<=a-1;c++){var h=d[c];h=0===h?0:255/e*
Math.log(h)|0;255<h&&(h=255);g[c]=h<<24&4278190080|b}f.pop(4)},vectorGetDistanceTo:function(){var a=f.stackValue(0);var b=f.stackValue(1);var c=f.stackValue(2);var d=f.stackValue(3);var e=f.stackValue(4);if(f.failed())return null;if(!f.isWords(a)||!f.isWords(c)||!f.isWords(b))return f.primitiveFail(),null;var g=l(a);if(0>g||l(c)!==g||l(b)!==g)return f.primitiveFail(),null;if(e.isFloat)if(d.isFloat)var h=!1;else return f.primitiveFail(),null;else{if(d.isFloat)return f.primitiveFail(),null;h=!0}if(h&&
(l(e)!==g||l(d)!==g))return f.primitiveFail(),null;var k=a.wordsAsFloat32Array();c=c.wordsAsFloat32Array();b=b.wordsAsFloat32Array();if(h){var n=e.wordsAsFloat32Array();var w=d.wordsAsFloat32Array()}if(!h){var y=f.floatValueOf(e);var F=f.floatValueOf(d)}for(e=0;e<=g-1;e++){h&&(y=n[e],F=w[e]);d=y-c[e];var C=F-b[e];k[e]=Math.sqrt(d*d+C*C)}if(f.failed())return null;f.pop(6);f.push(a)},getScalarHeading:function(){var a=f.stackValue(0);var b=f.stackIntegerValue(1);if(f.failed())return null;if(!f.isWords(a)||
l(a)<b)return f.primitiveFail(),null;a=a.wordsAsFloat32Array()[b-1];a=e(a);if(f.failed())return null;f.pop(3);f.pushFloat(a)},shutdownModule:function(){return!0},primitiveAddScalar:function(){var a=f.stackObjectValue(0);var b=f.stackValue(1);var c=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(c));f.success(f.isWords(a));if(f.failed())return null;var d=l(c);f.success(d===l(a));if(f.failed())return null;var e="number"===typeof b;var g=f.isMemberOf(c,"WordArray");if(e&&g){if(!f.isMemberOf(a,
"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(a,"KedamaFloatArray"))return f.primitiveFail(),null;g?e?(e=c.words,c=b,g=a.words):(e=c.words,c=f.floatValueOf(b),g=a.wordsAsFloat32Array()):(e?(e=c.wordsAsFloat32Array(),c=b):(e=c.wordsAsFloat32Array(),c=f.floatValueOf(b)),g=a.wordsAsFloat32Array());for(b=0;b<=d-1;b++)g[b]=e[b]+c;f.pop(4);f.push(a)},primSetPixelsAtXY:function(){var a,b,c;var d=f.stackValue(0);var e=f.stackIntegerValue(1);var g=f.stackIntegerValue(2);var h=f.stackValue(3);
var k=f.stackValue(4);var n=f.stackValue(5);if(f.failed())return null;if(!f.isWords(n)||!f.isWords(k)||!f.isWords(h)||e*g!==l(h))return f.primitiveFail(),null;var w=l(n);if(l(k)!==w)return f.primitiveFail(),null;(b="number"===typeof d)&&(a=d);if(!(b||f.isMemberOf(d,"WordArray")&&l(d)===w))return f.primitiveFail(),null;n=n.wordsAsFloat32Array();k=k.wordsAsFloat32Array();if(!b)var y=d.words;h=h.words;b&&(c=a);for(a=0;a<=w-1;a++){d=n[a]|0;var F=k[a]|0;0<=d&&0<=F&&d<g&&F<e&&(d=F*g+d,b||(c=y[a]),h[d]=
c)}if(f.failed())return null;f.pop(6)},turtleScalarSetX:function(){var a=f.stackIntegerValue(0);var b=f.stackIntegerValue(1);var c=f.stackFloatValue(2);var d=f.stackFloatValue(3);var e=f.stackValue(4);var u=f.stackIntegerValue(5);var h=f.stackValue(6);if(f.failed())return null;if(!f.isWords(h)||!f.isWords(e))return f.primitiveFail(),null;var k=l(h);if(l(e)!==k)return f.primitiveFail(),null;k=h.wordsAsFloat32Array();e=e.wordsAsFloat32Array();g(u-1,k,e,d,c,b,a);if(f.failed())return null;f.pop(7)},primPixelAtXY:function(){var a=
f.stackIntegerValue(0);var b=f.stackIntegerValue(1);var c=f.stackFloatValue(2);var d=f.stackFloatValue(3);var e=f.stackValue(4);if(f.failed())return null;if(!f.isWords(e)||l(e)!==a*b)return f.primitiveFail(),null;d|=0;c|=0;e=e.words;a=0<=d&&d<b&&0<=c&&c<a?e[c*b+d]:0;if(f.failed())return null;f.pop(6);f.pushInteger(a)},primUpHill:function(){var b,c;var d=f.stackIntegerValue(0);var g=f.stackIntegerValue(1);var q=f.stackIntegerValue(2);var u=f.stackValue(3);var h=f.stackFloatValue(4);var k=f.stackFloatValue(5);
var n=f.stackFloatValue(6);if(f.failed())return null;if(!f.isWords(u)||l(u)!==g*q)return f.primitiveFail(),null;u=u.words;n=Math.max(n,0);var w=Math.max(k,0);n=Math.min(n,q-1);w=Math.min(w,g-1);var y=Math.max(n-d,0);k=Math.min(n+d,q-1);var F=Math.max(w-d,0);g=Math.min(w+d,g-1);d=u[w*q+n];var C=-1;for(c=F;c<=g;c++)for(F=c*q,b=y;b<=k;b++){var H=u[F+b];if(H>d){C=b;var I=c;d=H}}I=-1===C?e(h):a(C-n,I-w)+90|0;if(f.failed())return null;f.pop(8);f.pushFloat(I)},primScalarForward:function(){var a=f.stackIntegerValue(0);
var b=f.stackIntegerValue(1);var c=f.stackIntegerValue(2);var d=f.stackIntegerValue(3);var e=f.stackFloatValue(4);var u=f.stackFloatValue(5);var A=f.stackFloatValue(6);var k=f.stackValue(7);var n=f.stackValue(8);var w=f.stackValue(9);var y=f.stackIntegerValue(10);if(f.failed())return null;if(!f.isWords(w)||!f.isWords(n)||!f.isWords(k))return f.primitiveFail(),null;var F=l(w);if(l(n)!==F||l(k)!==F)return f.primitiveFail(),null;F=w.wordsAsFloat32Array();n=n.wordsAsFloat32Array();k=k.wordsAsFloat32Array();
--y;w=F[y]+A*Math.cos(k[y]);A=n[y]-A*Math.sin(k[y]);g(y,F,k,w,u,d,c);h(y,n,k,A,e,b,a);if(f.failed())return null;f.pop(11)},primitiveDivArrays:function(){var a=f.stackObjectValue(0);var b=f.stackObjectValue(1);var c=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(c));f.success(f.isWords(a));if(f.failed())return null;var d=l(b);f.success(d===l(c));f.success(d===l(a));if(f.failed())return null;var e=f.isMemberOf(b,"WordArray");var g=f.isMemberOf(c,"WordArray");
if(e&&g){if(!f.isMemberOf(a,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(a,"KedamaFloatArray"))return f.primitiveFail(),null;g?e?(e=c.words,c=b.words,g=a.words):(e=c.words,c=b.wordsAsFloat32Array(),g=a.wordsAsFloat32Array()):(e?(e=c.wordsAsFloat32Array(),c=b.words):(e=c.wordsAsFloat32Array(),c=b.wordsAsFloat32Array()),g=a.wordsAsFloat32Array());for(b=0;b<=d-1;b++)g[b]=e[b]/c[b];f.pop(4);f.push(a)},getModuleName:function(){return"KedamaPlugin 3 November 2014 (e)"},primitiveSubArrays:function(){var a=
f.stackObjectValue(0);var b=f.stackObjectValue(1);var c=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(c));f.success(f.isWords(a));if(f.failed())return null;var d=l(b);f.success(d===l(c));f.success(d===l(a));if(f.failed())return null;var e=f.isMemberOf(b,"WordArray");var g=f.isMemberOf(c,"WordArray");if(e&&g){if(!f.isMemberOf(a,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(a,"KedamaFloatArray"))return f.primitiveFail(),null;g?e?(e=c.words,
c=b.words,g=a.words):(e=c.words,c=b.wordsAsFloat32Array(),g=a.wordsAsFloat32Array()):(e?(e=c.wordsAsFloat32Array(),c=b.words):(e=c.wordsAsFloat32Array(),c=b.wordsAsFloat32Array()),g=a.wordsAsFloat32Array());for(b=0;b<=d-1;b++)g[b]=e[b]-c[b];f.pop(4);f.push(a)},scalarGetAngleTo:function(){var b=f.stackFloatValue(0);var c=f.stackFloatValue(1);var d=f.stackFloatValue(2);var e=f.stackFloatValue(3);if(f.failed())return null;c=a(e-c,d-b);c+=90;360<c&&(c-=360);if(f.failed())return null;f.pop(5);f.pushFloat(c)},
randomRange:function(){var a=f.stackIntegerValue(0);if(f.failed())return null;a=c(a);if(f.failed())return null;f.pop(2);f.pushInteger(a)},setInterpreter:function(a){f=a;a=1==f.majorVersion();return!1===a?!1:a=11<=f.minorVersion()},kedamaSetRandomSeed:function(){var a=f.stackIntegerValue(0);if(f.failed())return null;d=a&65536;f.pop(1)},drawTurtlesInArray:function(){var a;var b=f.stackValue(0);var c=f.stackValue(1);var d=f.stackValue(2);var e=f.stackValue(3);var g=f.stackIntegerValue(4);var h=f.stackIntegerValue(5);
var k=f.stackValue(6);if(f.failed())return null;if(!(f.isWords(k)&&f.isWords(e)&&f.isWords(d)&&f.isWords(c)&&f.isBytes(b))||g*h!==l(k))return f.primitiveFail(),null;var n=l(e);if(l(d)!==n||l(c)!==n||l(b)!==n)return f.primitiveFail(),null;e=e.wordsAsFloat32Array();d=d.wordsAsFloat32Array();c=c.words;b=b.bytes;k=k.words;for(a=0;a<=n-1;a++){var w=e[a]|0;var y=d[a]|0;var F=b[a];0!==F&&0<=w&&0<=y&&w<h&&y<g&&(F=y*h+w,k[F]=c[a])}if(f.failed())return null;f.pop(7)},turtleScalarSetY:function(){var a=f.stackIntegerValue(0);
var b=f.stackIntegerValue(1);var c=f.stackFloatValue(2);var d=f.stackFloatValue(3);var e=f.stackValue(4);var g=f.stackIntegerValue(5);var k=f.stackValue(6);if(f.failed())return null;if(!f.isWords(k)||!f.isWords(e))return f.primitiveFail(),null;var n=l(k);if(l(e)!==n)return f.primitiveFail(),null;n=k.wordsAsFloat32Array();e=e.wordsAsFloat32Array();h(g-1,n,e,d,c,b,a);if(f.failed())return null;f.pop(7)},randomIntoIntegerArray:function(){var a=f.stackFloatValue(0);var b=f.stackValue(1);var d=f.stackIntegerValue(2);
var e=f.stackIntegerValue(3);var g=f.stackIntegerValue(4);if(f.failed())return null;if(!(f.isWords(b)&&l(b)>=d&&1<=e&&d>=e))return f.primitiveFail(),null;b=b.words;if(f.failed())return null;for(;e<=d;e++)b[e-1]=c(g)*a|0;f.pop(5)},getHeadingArrayInto:function(){var a;var b=f.stackValue(0);var c=f.stackValue(1);if(f.failed())return null;if(!f.isWords(c)||!f.isWords(b))return f.primitiveFail(),null;var d=l(c);if(l(b)!==d)return f.primitiveFail(),null;c=c.wordsAsFloat32Array();var e=b.wordsAsFloat32Array();
for(a=0;a<=d-1;a++)b=c[a],b/=.0174532925199433,b=90-b,0<b||(b+=360),e[a]=b;if(f.failed())return null;f.pop(2)},makeTurtlesMap:function(){var a=f.stackIntegerValue(0);var b=f.stackIntegerValue(1);var c=f.stackValue(2);var d=f.stackValue(3);var e=f.stackValue(4);var g=f.stackValue(5);if(!(f.isWords(c)&&f.isWords(d)&&f.isWords(e)&&f.isWords(g)))return f.primitiveFail(),null;var h=l(e);if(l(d)!==h||l(c)!==h||l(g)!==a*b)return f.primitiveFail(),null;d=d.wordsAsFloat32Array();c=c.wordsAsFloat32Array();
e=e.words;var k=g.words;for(g=0;g<=a*b-1;g++)k[g]=0;for(g=0;g<=h-1;g++){var n=d[g];var w=c[g];n=b*w+n;0<=n&&n<a*b&&(k[n]=e[g])}if(f.failed())return null;f.pop(6)},setHeadingArrayFrom:function(){var a=f.stackValue(0);var c=f.stackValue(1);if(f.failed())return null;if(!f.isWords(c))return f.primitiveFail(),null;var d=l(c);if(a.isFloat)var e=!1;else if(f.isWords(a)){if(l(a)!==d)return f.primitiveFail(),null;e=!0}else return f.primitiveFail(),null;c=c.wordsAsFloat32Array();if(e)var g=a.wordsAsFloat32Array();
else{var u=f.floatValueOf(a);u=b(u)}for(a=0;a<=d-1;a++)e&&(u=g[a],u=b(u)),c[a]=u;if(f.failed())return null;f.pop(2)},turtlesSetX:function(){var a,b;var c=f.stackIntegerValue(0);var d=f.stackIntegerValue(1);var e=f.stackFloatValue(2);var u=f.stackValue(3);var h=f.stackValue(4);var k=f.stackValue(5);if(f.failed())return null;if(!f.isWords(k)||!f.isWords(h))return f.primitiveFail(),null;if(u.isFloat)var n=!1;else if(f.isWords(u))n=!0;else return f.primitiveFail(),null;var w=l(k);if(l(h)!==w||n&&l(u)!==
w)return f.primitiveFail(),null;k=k.wordsAsFloat32Array();h=h.wordsAsFloat32Array();n?b=u.wordsAsFloat32Array():a=f.floatValueOf(u);for(u=0;u<=w-1;u++){var y=n?b[u]:a;g(u,k,h,y,e,d,c)}if(f.failed())return null;f.pop(6)},setScalarHeading:function(){var a=f.stackFloatValue(0);var c=f.stackValue(1);var d=f.stackIntegerValue(2);if(f.failed())return null;if(!f.isWords(c)||l(c)<d)return f.primitiveFail(),null;c.wordsAsFloat32Array()[d-1]=b(a);if(f.failed())return null;f.pop(3)},makeMask:function(){var a=
f.stackIntegerValue(0);var b=f.stackIntegerValue(1);var c=f.stackValue(2);var d=f.stackValue(3);if(f.failed())return null;var e=l(d);var g=l(c);if(e!==g||-32>a||8<a)return f.primitiveFail(),null;d=d.words;g=c.words;for(c=0;c<=e-1;c++){var h=d[c];h=0>a?-31>a?0:h>>>0-a:31<a?0:h<<a;255<h&&(h=255);0>h&&(h=0);g[c]=h<<24&4278190080|b}f.pop(4)},primitiveDivScalar:function(){var a=f.stackObjectValue(0);var b=f.stackValue(1);var c=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(c));f.success(f.isWords(a));
if(f.failed())return null;var d=l(c);f.success(d===l(a));if(f.failed())return null;var e="number"===typeof b;var g=f.isMemberOf(c,"WordArray");if(e&&g){if(!f.isMemberOf(a,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(a,"KedamaFloatArray"))return f.primitiveFail(),null;if(g)if(e)for(e=c.words,c=b,g=a.words,b=0;b<=d-1;b++)g[b]=Math.floor(e[b]/c)|0;else for(e=c.words,c=f.floatValueOf(b),g=a.wordsAsFloat32Array(),b=0;b<=d-1;b++)g[b]=e[b]/c;else for(e?(e=c.wordsAsFloat32Array(),c=b):
(e=c.wordsAsFloat32Array(),c=f.floatValueOf(b)),g=a.wordsAsFloat32Array(),b=0;b<=d-1;b++)g[b]=e[b]/c;f.pop(4);f.push(a)},primitiveSubScalar:function(){var a=f.stackObjectValue(0);var b=f.stackValue(1);var c=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(c));f.success(f.isWords(a));if(f.failed())return null;var d=l(c);f.success(d===l(a));if(f.failed())return null;var e="number"===typeof b;var g=f.isMemberOf(c,"WordArray");if(e&&g){if(!f.isMemberOf(a,"WordArray"))return f.primitiveFail(),
null}else if(!f.isMemberOf(a,"KedamaFloatArray"))return f.primitiveFail(),null;g?e?(e=c.words,c=b,g=a.words):(e=c.words,c=f.floatValueOf(b),g=a.wordsAsFloat32Array()):(e?(e=c.wordsAsFloat32Array(),c=b):(e=c.wordsAsFloat32Array(),c=f.floatValueOf(b)),g=a.wordsAsFloat32Array());for(b=0;b<=d-1;b++)g[b]=e[b]-c;f.pop(4);f.push(a)},primPixelsAtXY:function(){var a;var b=f.stackValue(0);var c=f.stackIntegerValue(1);var d=f.stackIntegerValue(2);var e=f.stackValue(3);var g=f.stackValue(4);var h=f.stackValue(5);
if(f.failed())return null;if(!(f.isWords(b)&&f.isWords(h)&&f.isWords(g)&&f.isWords(e))||c*d!==l(e))return f.primitiveFail(),null;var k=l(h);if(l(g)!==k||l(b)!==k)return f.primitiveFail(),null;h=h.wordsAsFloat32Array();g=g.wordsAsFloat32Array();b=b.words;e=e.words;for(a=0;a<=k-1;a++){var n=h[a]|0;var w=g[a]|0;0<=n&&0<=w&&n<d&&w<c&&(n=w*d+n,b[a]=e[n])}if(f.failed())return null;f.pop(6)},vectorGetAngleTo:function(){var b=f.stackValue(0);var c=f.stackValue(1);var d=f.stackValue(2);var e=f.stackValue(3);
var g=f.stackValue(4);if(f.failed())return null;if(!f.isWords(b)||!f.isWords(d)||!f.isWords(c))return f.primitiveFail(),null;var u=l(b);if(0>u||l(d)!==u||l(c)!==u)return f.primitiveFail(),null;if(g.isFloat)if(e.isFloat)var h=!1;else return f.primitiveFail(),null;else{if(e.isFloat)return f.primitiveFail(),null;h=!0}if(h&&(l(g)!==u||l(e)!==u))return f.primitiveFail(),null;var k=b.wordsAsFloat32Array();d=d.wordsAsFloat32Array();c=c.wordsAsFloat32Array();if(h){var n=g.wordsAsFloat32Array();var w=e.wordsAsFloat32Array()}if(!h){var y=
f.floatValueOf(g);var F=f.floatValueOf(e)}for(g=0;g<=u-1;g++){h&&(y=n[g],F=w[g]);e=y-d[g];var C=F-c[g];e=a(e,C);e+=90;360<e&&(e-=360);k[g]=e}if(f.failed())return null;f.pop(6);f.push(b)},primitiveMulArrays:function(){var a=f.stackObjectValue(0);var b=f.stackObjectValue(1);var c=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(c));f.success(f.isWords(a));if(f.failed())return null;var d=l(b);f.success(d===l(c));f.success(d===l(a));if(f.failed())return null;
var e=f.isMemberOf(b,"WordArray");var g=f.isMemberOf(c,"WordArray");if(e&&g){if(!f.isMemberOf(a,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(a,"KedamaFloatArray"))return f.primitiveFail(),null;g?e?(e=c.words,c=b.words,g=a.words):(e=c.words,c=b.wordsAsFloat32Array(),g=a.wordsAsFloat32Array()):(e?(e=c.wordsAsFloat32Array(),c=b.words):(e=c.wordsAsFloat32Array(),c=b.wordsAsFloat32Array()),g=a.wordsAsFloat32Array());for(b=0;b<=d-1;b++)g[b]=e[b]*c[b];f.pop(4);f.push(a)},primPixelAtXYPut:function(){var a=
f.stackIntegerValue(0);var b=f.stackIntegerValue(1);var c=f.stackIntegerValue(2);var d=f.stackFloatValue(3);var e=f.stackFloatValue(4);var g=f.stackValue(5);if(f.failed())return null;if(!f.isWords(g)||l(g)!==a*b)return f.primitiveFail(),null;e|=0;d|=0;1073741823<c&&(c=1073741823);0>c&&(c=0);g=g.words;0<=e&&e<b&&0<=d&&d<a&&(g[d*b+e]=c);if(f.failed())return null;f.pop(6)},zoomBitmap:function(){var a,b,c,d,e,g;var h=f.stackIntegerValue(0);var k=f.stackIntegerValue(1);var n=f.stackIntegerValue(2);var w=
f.stackIntegerValue(3);var y=f.stackValue(4);var F=f.stackValue(5);if(f.failed())return null;var C=l(F);var H=l(y);if(w*n!==C||C*k*h!==H)return f.primitiveFail(),null;H=F.words;F=y.words;for(e=C=c=b=0;e<=n-1;e++){for(g=0;g<=h-1;g++){for(d=0;d<=w-1;d++)for(y=H[b],++b,a=0;a<=k-1;a++)F[C]=y,++C;b=c}b=c+=w}f.pop(6)},initialiseModule:function(){d=17;n=16807;k=2147483647;y=Math.floor(k/n)|0;var a=n;w=k-(Math.floor(k/a)|0)*a|0},primitiveAddArrays:function(){var a=f.stackObjectValue(0);var b=f.stackObjectValue(1);
var c=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(c));f.success(f.isWords(a));if(f.failed())return null;var d=l(b);f.success(d===l(c));f.success(d===l(a));if(f.failed())return null;var e=f.isMemberOf(b,"WordArray");var g=f.isMemberOf(c,"WordArray");if(e&&g){if(!f.isMemberOf(a,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(a,"KedamaFloatArray"))return f.primitiveFail(),null;g?e?(e=c.words,c=b.words,g=a.words):(e=c.words,c=b.wordsAsFloat32Array(),
g=a.wordsAsFloat32Array()):(e?(e=c.wordsAsFloat32Array(),c=b.words):(e=c.wordsAsFloat32Array(),c=b.wordsAsFloat32Array()),g=a.wordsAsFloat32Array());for(b=0;b<=d-1;b++)g[b]=e[b]+c[b];f.pop(4);f.push(a)},scalarGetDistanceTo:function(){var a=f.stackFloatValue(0);var b=f.stackFloatValue(1);var c=f.stackFloatValue(2);var d=f.stackFloatValue(3);if(f.failed())return null;b-=d;a-=c;a=Math.sqrt(b*b+a*a);if(f.failed())return null;f.pop(5);f.pushFloat(a)},turtlesSetY:function(){var a,b;var c=f.stackIntegerValue(0);
var d=f.stackIntegerValue(1);var e=f.stackFloatValue(2);var g=f.stackValue(3);var k=f.stackValue(4);var n=f.stackValue(5);if(f.failed())return null;if(!f.isWords(n)||!f.isWords(k))return f.primitiveFail(),null;if(g.isFloat)var w=!1;else if(f.isWords(g))w=!0;else return f.primitiveFail(),null;var y=l(n);if(l(k)!==y||w&&l(g)!==y)return f.primitiveFail(),null;n=n.wordsAsFloat32Array();k=k.wordsAsFloat32Array();w?b=g.wordsAsFloat32Array():a=f.floatValueOf(g);for(g=0;g<=y-1;g++){var O=w?b[g]:a;h(g,n,k,
O,e,d,c)}if(f.failed())return null;f.pop(6)},randomIntoFloatArray:function(){var a=f.stackFloatValue(0);var b=f.stackValue(1);var d=f.stackIntegerValue(2);var e=f.stackIntegerValue(3);var g=f.stackIntegerValue(4);if(f.failed())return null;if(!(f.isWords(b)&&l(b)>=d&&1<=e&&d>=e))return f.primitiveFail(),null;b=b.wordsAsFloat32Array();if(f.failed())return null;for(;e<=d;e++)b[e-1]=c(g)*a;f.pop(5)},primTurtlesForward:function(){var a,b;var c=f.stackIntegerValue(0);var d=f.stackIntegerValue(1);var e=
f.stackIntegerValue(2);var u=f.stackIntegerValue(3);var k=f.stackFloatValue(4);var n=f.stackFloatValue(5);var w=f.stackValue(6);var y=f.stackValue(7);var O=f.stackValue(8);var F=f.stackValue(9);if(f.failed())return null;if(!f.isWords(F)||!f.isWords(O)||!f.isWords(y))return f.primitiveFail(),null;if(w.isFloat)var C=!1;else if(f.isWords(w))C=!0;else return f.primitiveFail(),null;var H=l(F);if(l(O)!==H||l(y)!==H||C&&l(w)!==H)return f.primitiveFail(),null;F=F.wordsAsFloat32Array();O=O.wordsAsFloat32Array();
y=y.wordsAsFloat32Array();C?b=w.wordsAsFloat32Array():a=f.floatValueOf(w);for(w=0;w<=H-1;w++){var I=C?b[w]:a;var M=F[w]+I*Math.cos(y[w]);I=O[w]-I*Math.sin(y[w]);g(w,F,y,M,n,u,e);h(w,O,y,I,k,d,c)}if(f.failed())return null;f.pop(10)},primitiveMulScalar:function(){var a=f.stackObjectValue(0);var b=f.stackValue(1);var c=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(c));f.success(f.isWords(a));if(f.failed())return null;var d=l(c);f.success(d===l(a));if(f.failed())return null;var e=
"number"===typeof b;var g=f.isMemberOf(c,"WordArray");if(e&&g){if(!f.isMemberOf(a,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(a,"KedamaFloatArray"))return f.primitiveFail(),null;g?e?(e=c.words,c=b,g=a.words):(e=c.words,c=f.floatValueOf(b),g=a.wordsAsFloat32Array()):(e?(e=c.wordsAsFloat32Array(),c=b):(e=c.wordsAsFloat32Array(),c=f.floatValueOf(b)),g=a.wordsAsFloat32Array());for(b=0;b<=d-1;b++)g[b]=e[b]*c;f.pop(4);f.push(a)}})});module("users.bert.SqueakJS.plugins.KedamaPlugin2").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){return a-(Math.floor(a/b)|0)*b|0}function b(a,b){if(0===a)return 0<=b?90:270;var c=Math.atan(b/a);return 0<=a?0<=b?c/.0174532925199433:360+c/.0174532925199433:180+c/.0174532925199433}function c(a){a=90-a;var b=a/360|0;0>a&&--b;return.0174532925199433*(a-360*b)}function e(b){var c=0>
b?0-b:b;var d=Math.floor(n/w)|0;var e=a(n,w);n=k*e-t*d;d=(n&65535)*(c+1)>>>16;return 0>b?0-d:d}function g(a){a=90-a/.0174532925199433;0<a||(a+=360);return a}function h(a,b,c,d,e,f,g){0>d&&(1===f&&(d+=e),2===f&&(d=0),3===f&&(d=0-d,f=c[a],c[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));d>=e&&(1===g&&(d-=e),2===g&&(d=e-1E-6),3===g&&(d=e-1E-6-(d-e),f=c[a],c[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));b[a]=d}function f(a,b,c,d,e,f,g){0>d&&(1===f&&(d+=e),2===f&&(d=
0),3===f&&(d=0-d,c[a]=6.283185307179586-c[a]));d>=e&&(1===g&&(d-=e),2===g&&(d=e-1E-6),3===g&&(d=e-1E-6-(d-e),c[a]=6.283185307179586-c[a]));b[a]=d}var d=null,n=0,k=0,y=0,w=0,t=0;Squeak.registerExternalModule("KedamaPlugin2",{primitiveAddArrays:function(){var a=d.stackObjectValue(0);var b=d.stackObjectValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isWords(a));if(d.failed())return null;var e=l(b);d.success(e===l(c));d.success(e===
l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");var g=d.isMemberOf(c,"WordArray");if(f&&g){if(!d.isMemberOf(a,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(a,"KedamaFloatArray"))return d.primitiveFail(),null;g?f?(f=c.words,c=b.words,g=a.words):(f=c.words,c=b.wordsAsFloat32Array(),g=a.wordsAsFloat32Array()):(f?(f=c.wordsAsFloat32Array(),c=b.words):(f=c.wordsAsFloat32Array(),c=b.wordsAsFloat32Array()),g=a.wordsAsFloat32Array());for(b=0;b<=e-1;b++)g[b]=f[b]+c[b];
d.pop(4);d.push(a)},getModuleName:function(){return"KedamaPlugin2 13 November 2014 (e)"},primitiveMulArrays:function(){var a=d.stackObjectValue(0);var b=d.stackObjectValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isWords(a));if(d.failed())return null;var e=l(b);d.success(e===l(c));d.success(e===l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");var g=d.isMemberOf(c,"WordArray");if(f&&g){if(!d.isMemberOf(a,"WordArray"))return d.primitiveFail(),
null}else if(!d.isMemberOf(a,"KedamaFloatArray"))return d.primitiveFail(),null;g?f?(f=c.words,c=b.words,g=a.words):(f=c.words,c=b.wordsAsFloat32Array(),g=a.wordsAsFloat32Array()):(f?(f=c.wordsAsFloat32Array(),c=b.words):(f=c.wordsAsFloat32Array(),c=b.wordsAsFloat32Array()),g=a.wordsAsFloat32Array());for(b=0;b<=e-1;b++)g[b]=f[b]*c[b];d.pop(4);d.push(a)},drawTurtlesInArray:function(){var a;var b=d.stackValue(0);var c=d.stackValue(1);var e=d.stackValue(2);var f=d.stackValue(3);var g=d.stackIntegerValue(4);
var h=d.stackIntegerValue(5);var k=d.stackValue(6);if(d.failed())return null;if(!(d.isWords(k)&&d.isWords(f)&&d.isWords(e)&&d.isWords(c)&&d.isBytes(b))||g*h!==l(k))return d.primitiveFail(),null;var t=l(f);if(l(e)!==t||l(c)!==t||l(b)!==t)return d.primitiveFail(),null;f=f.wordsAsFloat32Array();e=e.wordsAsFloat32Array();c=c.words;b=b.bytes;k=k.words;for(a=0;a<=t-1;a++){var n=f[a]|0;var w=e[a]|0;var y=b[a];0!==y&&0<=n&&0<=w&&n<h&&w<g&&(y=w*h+n,k[y]=c[a])}if(d.failed())return null;d.pop(7)},primitiveGTScalar:function(){var a=
d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(c);d.success(e===l(a));if(d.failed())return null;var f="number"===typeof b;if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b}else f=c.words,g=d.floatValueOf(b);else f?(f=c.wordsAsFloat32Array(),g=b):(f=c.wordsAsFloat32Array(),g=d.floatValueOf(b));b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]>g;d.pop(4);d.push(a)},setScalarHeading:function(){var a=
d.stackFloatValue(0);var b=d.stackValue(1);var e=d.stackIntegerValue(2);if(d.failed())return null;if(!d.isWords(b)||l(b)<e)return d.primitiveFail(),null;b.wordsAsFloat32Array()[e-1]=c(a);if(d.failed())return null;d.pop(3)},primitiveSubScalar:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));d.success(d.isWords(a));if(d.failed())return null;var e=l(c);d.success(e===l(a));if(d.failed())return null;var f="number"===
typeof b;var g=d.isMemberOf(c,"WordArray");if(f&&g){if(!d.isMemberOf(a,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(a,"KedamaFloatArray"))return d.primitiveFail(),null;g?f?(f=c.words,c=b,g=a.words):(f=c.words,c=d.floatValueOf(b),g=a.wordsAsFloat32Array()):(f?(f=c.wordsAsFloat32Array(),c=b):(f=c.wordsAsFloat32Array(),c=d.floatValueOf(b)),g=a.wordsAsFloat32Array());for(b=0;b<=e-1;b++)g[b]=f[b]-c;d.pop(4);d.push(a)},turtleScalarSetY:function(){var a=d.stackIntegerValue(0);var b=d.stackIntegerValue(1);
var c=d.stackFloatValue(2);var e=d.stackFloatValue(3);var g=d.stackValue(4);var h=d.stackIntegerValue(5);var k=d.stackValue(6);if(d.failed())return null;if(!d.isWords(k)||!d.isWords(g))return d.primitiveFail(),null;var t=l(k);if(l(g)!==t)return d.primitiveFail(),null;t=k.wordsAsFloat32Array();g=g.wordsAsFloat32Array();f(h-1,t,g,e,c,b,a);if(d.failed())return null;d.pop(7)},vectorGetAngleTo:function(){var a=d.stackValue(0);var c=d.stackValue(1);var e=d.stackValue(2);var f=d.stackValue(3);var g=d.stackValue(4);
if(d.failed())return null;if(!d.isWords(a)||!d.isWords(e)||!d.isWords(c))return d.primitiveFail(),null;var h=l(a);if(0>h||l(e)!==h||l(c)!==h)return d.primitiveFail(),null;if(g.isFloat)if(f.isFloat)var k=!1;else return d.primitiveFail(),null;else{if(f.isFloat)return d.primitiveFail(),null;k=!0}if(k&&(l(g)!==h||l(f)!==h))return d.primitiveFail(),null;var t=a.wordsAsFloat32Array();e=e.wordsAsFloat32Array();c=c.wordsAsFloat32Array();if(k){var n=g.wordsAsFloat32Array();var w=f.wordsAsFloat32Array()}if(!k){var y=
d.floatValueOf(g);var C=d.floatValueOf(f)}for(g=0;g<=h-1;g++){k&&(y=n[g],C=w[g]);f=y-e[g];var H=C-c[g];f=b(f,H);f+=90;360<f&&(f-=360);t[g]=f}if(d.failed())return null;d.pop(6);d.push(a)},primitiveRemArrays:function(){var b=d.stackObjectValue(0);var c=d.stackObjectValue(1);var e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));d.success(d.isWords(e));d.success(d.isWords(b));if(d.failed())return null;var f=l(c);d.success(f===l(e));d.success(f===l(b));if(d.failed())return null;
var g=d.isMemberOf(c,"WordArray");var h=d.isMemberOf(e,"WordArray");if(g&&h){if(!d.isMemberOf(b,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(b,"KedamaFloatArray"))return d.primitiveFail(),null;if(h)if(g){g=e.words;var k=c.words;h=b.words;for(c=0;c<=f-1;c++){var t=g[c];var n=k[c];e=a(t,n);h[c]=e}}else for(g=e.words,n=c.wordsAsFloat32Array(),e=b.wordsAsFloat32Array(),c=0;c<=f-1;c++)t=g[c],k=n[c],h=t/k,h=Math.floor(h),e[c]=t-h*k;else if(g)for(g=e.wordsAsFloat32Array(),k=c.words,e=
b.wordsAsFloat32Array(),c=0;c<=f-1;c++)t=g[c],n=k[c],h=t/n,h=Math.floor(h),e[c]=t-h*n;else for(g=e.wordsAsFloat32Array(),n=c.wordsAsFloat32Array(),e=b.wordsAsFloat32Array(),c=0;c<=f-1;c++)t=g[c],k=n[c],h=t/k,h=Math.floor(h),e[c]=t-h*k;d.pop(4);d.push(b)},primitiveLTArrays:function(){var a=d.stackObjectValue(0);var b=d.stackObjectValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(b);
d.success(e===l(c));d.success(e===l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b.words}else f=c.words,g=b.wordsAsFloat32Array();else f?(f=c.wordsAsFloat32Array(),g=b.words):(f=c.wordsAsFloat32Array(),g=b.wordsAsFloat32Array());b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]<g[c];d.pop(4);d.push(a)},primitiveAddScalar:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));
d.success(d.isWords(a));if(d.failed())return null;var e=l(c);d.success(e===l(a));if(d.failed())return null;var f="number"===typeof b;var g=d.isMemberOf(c,"WordArray");if(f&&g){if(!d.isMemberOf(a,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(a,"KedamaFloatArray"))return d.primitiveFail(),null;g?f?(f=c.words,c=b,g=a.words):(f=c.words,c=d.floatValueOf(b),g=a.wordsAsFloat32Array()):(f?(f=c.wordsAsFloat32Array(),c=b):(f=c.wordsAsFloat32Array(),c=d.floatValueOf(b)),g=a.wordsAsFloat32Array());
for(b=0;b<=e-1;b++)g[b]=f[b]+c;d.pop(4);d.push(a)},primPixelsAtXY:function(){var a;var b=d.stackValue(0);var c=d.stackIntegerValue(1);var e=d.stackIntegerValue(2);var f=d.stackValue(3);var g=d.stackValue(4);var h=d.stackValue(5);if(d.failed())return null;if(!(d.isWords(b)&&d.isWords(h)&&d.isWords(g)&&d.isWords(f))||c*e!==l(f))return d.primitiveFail(),null;var k=l(h);if(l(g)!==k||l(b)!==k)return d.primitiveFail(),null;h=h.wordsAsFloat32Array();g=g.wordsAsFloat32Array();b=b.words;f=f.words;for(a=0;a<=
k-1;a++){var t=h[a]|0;var n=g[a]|0;0<=t&&0<=n&&t<e&&n<c&&(t=n*e+t,b[a]=f[t])}if(d.failed())return null;d.pop(6)},primitiveMulScalar:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));d.success(d.isWords(a));if(d.failed())return null;var e=l(c);d.success(e===l(a));if(d.failed())return null;var f="number"===typeof b;var g=d.isMemberOf(c,"WordArray");if(f&&g){if(!d.isMemberOf(a,"WordArray"))return d.primitiveFail(),
null}else if(!d.isMemberOf(a,"KedamaFloatArray"))return d.primitiveFail(),null;g?f?(f=c.words,c=b,g=a.words):(f=c.words,c=d.floatValueOf(b),g=a.wordsAsFloat32Array()):(f?(f=c.wordsAsFloat32Array(),c=b):(f=c.wordsAsFloat32Array(),c=d.floatValueOf(b)),g=a.wordsAsFloat32Array());for(b=0;b<=e-1;b++)g[b]=f[b]*c;d.pop(4);d.push(a)},primSetPixelsAtXY:function(){var a,b,c;var e=d.stackValue(0);var f=d.stackIntegerValue(1);var g=d.stackIntegerValue(2);var h=d.stackValue(3);var k=d.stackValue(4);var t=d.stackValue(5);
var n=d.stackValue(6);if(d.failed())return null;if(!(d.isBytes(n)&&d.isWords(t)&&d.isWords(k)&&d.isWords(h))||f*g!==l(h))return d.primitiveFail(),null;var w=l(t);if(l(n)!==w||l(k)!==w)return d.primitiveFail(),null;n=n.bytes;t=t.wordsAsFloat32Array();var y=k.wordsAsFloat32Array();if(k="number"===typeof e)var H=e;else{if(l(e)!==w)return d.primitiveFail(),null;(b=d.isMemberOf(e,"WordArray"))?c=e.words:a=e.wordsAsFloat32Array()}h=h.words;for(e=0;e<=w-1;e++)if(1===n[e]){var I=t[e]|0;var M=y[e]|0;0<=I&&
0<=M&&I<g&&M<f&&(I=M*g+I,k?h[I]=H:b?h[I]=c[e]:(M=a[e],h[I]=M))}if(d.failed())return null;d.pop(7)},setHeadingArrayFrom:function(){var a=d.stackValue(0);var b=d.stackValue(1);var e=d.stackValue(2);if(d.failed())return null;if(!d.isBytes(e)||!d.isWords(b))return d.primitiveFail(),null;var f=l(b);if(a.isFloat)var g=!1;else if(d.isWords(a)){if(l(a)!==f)return d.primitiveFail(),null;g=!0}else return d.primitiveFail(),null;e=e.bytes;b=b.wordsAsFloat32Array();if(g)var h=a.wordsAsFloat32Array();else{var k=
d.floatValueOf(a);k=c(k)}for(a=0;a<=f-1;a++)1===e[a]&&(g&&(k=h[a],k=c(k)),b[a]=k);if(d.failed())return null;d.pop(3)},primPixelAtXYPut:function(){var a=d.stackIntegerValue(0);var b=d.stackIntegerValue(1);var c=d.stackIntegerValue(2);var e=d.stackFloatValue(3);var f=d.stackFloatValue(4);var g=d.stackValue(5);if(d.failed())return null;if(!d.isWords(g)||l(g)!==a*b)return d.primitiveFail(),null;f|=0;e|=0;1073741823<c&&(c=1073741823);0>c&&(c=0);g=g.words;0<=f&&f<b&&0<=e&&e<a&&(g[e*b+f]=c);if(d.failed())return null;
d.pop(6)},makeMaskLog:function(){var a=d.stackValue(0);var b=d.stackIntegerValue(1);var c=d.stackValue(2);var e=d.stackValue(3);if(d.failed())return null;a=a.words[0];if(d.failed())return null;var f=Math.log(a);a=l(e);var g=l(c);if(a!==g)return d.primitiveFail(),null;e=e.words;g=c.words;for(c=0;c<=a-1;c++){var h=e[c];h=0===h?0:255/f*Math.log(h)|0;255<h&&(h=255);g[c]=h<<24&4278190080|b}d.pop(4)},primitiveLTScalar:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);
if(d.failed())return null;d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(c);d.success(e===l(a));if(d.failed())return null;var f="number"===typeof b;if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b}else f=c.words,g=d.floatValueOf(b);else f?(f=c.wordsAsFloat32Array(),g=b):(f=c.wordsAsFloat32Array(),g=d.floatValueOf(b));b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]<g;d.pop(4);d.push(a)},scalarGetAngleTo:function(){var a=d.stackFloatValue(0);var c=d.stackFloatValue(1);
var e=d.stackFloatValue(2);var f=d.stackFloatValue(3);if(d.failed())return null;c=b(f-c,e-a);c+=90;360<c&&(c-=360);if(d.failed())return null;d.pop(5);d.pushFloat(c)},primitiveOrByteArray:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);if(d.failed())return null;d.success(d.isBytes(b));d.success(d.isBytes(a));if(d.failed())return null;var c=l(b);var e=l(a);if(d.failed())return null;var f=c;c>e&&(f=e);c=a.bytes;e=b.bytes;for(b=0;b<=f-1;b++)e[b]=0<e[b]+c[b];d.pop(1)},primitiveLEArrays:function(){var a=
d.stackObjectValue(0);var b=d.stackObjectValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(b);d.success(e===l(c));d.success(e===l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b.words}else f=c.words,g=b.wordsAsFloat32Array();else f?(f=c.wordsAsFloat32Array(),g=b.words):(f=c.wordsAsFloat32Array(),g=b.wordsAsFloat32Array());
b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]<=g[c];d.pop(4);d.push(a)},primitiveRemScalar:function(){var b=d.stackObjectValue(0);var c=d.stackValue(1);var e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isWords(b));if(d.failed())return null;var f=l(e);d.success(f===l(b));if(d.failed())return null;var g="number"===typeof c;var h=d.isMemberOf(e,"WordArray");if(g&&h){if(!d.isMemberOf(b,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(b,"KedamaFloatArray"))return d.primitiveFail(),
null;if(h)if(g){e=e.words;var k=c;g=b.words;for(c=0;c<=f-1;c++)g[c]=a(e[c],k)}else for(e=e.words,k=d.floatValueOf(c),h=b.wordsAsFloat32Array(),c=0;c<=f-1;c++){var t=e[c];g=t/k;g=Math.floor(g);h[c]=t-g*k}else for(g?(e=e.wordsAsFloat32Array(),k=c):(e=e.wordsAsFloat32Array(),k=d.floatValueOf(c)),h=b.wordsAsFloat32Array(),c=0;c<=f-1;c++)t=e[c],g=t/k,g=Math.floor(g),h[c]=t-g*k;d.pop(4);d.push(b)},getHeadingArrayInto:function(){var a;var b=d.stackValue(0);var c=d.stackValue(1);if(d.failed())return null;
if(!d.isWords(c)||!d.isWords(b))return d.primitiveFail(),null;var e=l(c);if(l(b)!==e)return d.primitiveFail(),null;c=c.wordsAsFloat32Array();var f=b.wordsAsFloat32Array();for(a=0;a<=e-1;a++)b=c[a],b/=.0174532925199433,b=90-b,0<b||(b+=360),f[a]=b;if(d.failed())return null;d.pop(2)},turtlesSetX:function(){var a,b,c;var e=d.stackIntegerValue(0);var f=d.stackIntegerValue(1);var g=d.stackFloatValue(2);var k=d.stackValue(3);var t=d.stackValue(4);var n=d.stackValue(5);var w=d.stackValue(6);if(d.failed())return null;
if(!d.isBytes(w)||!d.isWords(n)||!d.isWords(t))return d.primitiveFail(),null;if(k.isFloat)var y=!1;else if(d.isWords(k)){y=!0;var C=d.isMemberOf(k,"WordArray")}else return d.primitiveFail(),null;var H=l(n);if(l(w)!==H||l(t)!==H||y&&l(k)!==H)return d.primitiveFail(),null;w=w.bytes;n=n.wordsAsFloat32Array();t=t.wordsAsFloat32Array();y?C?c=k.words:b=k.wordsAsFloat32Array():a=d.floatValueOf(k);for(k=0;k<=H-1;k++)if(1===w[k]){var I=y?C?c[k]:b[k]:a;h(k,n,t,I,g,f,e)}if(d.failed())return null;d.pop(7)},primitivePredicateReplaceBytes:function(){var a=
d.stackIntegerValue(0);var b=d.stackObjectValue(1);var c=d.stackIntegerValue(2);var e=d.stackIntegerValue(3);var f=d.stackObjectValue(4);if(d.failed())return null;var g=d.fetchPointerofObject(1,f);var h=d.fetchPointerofObject(0,f);if(d.failed())return null;if(!d.isBytes(h)||!d.isBytes(g)||!d.isBytes(b))return d.primitiveFail(),null;var k=g.bytes;f=h.bytes;var t=b.bytes;g=l(g);h=l(h);b=l(b);if(e>c||1>e||e>g||e>h||c>g||c>h||1>a||a>b||b-a+1<c-e+1)return d.primitiveFail(),null;for(b=e-1;b<=c-1;b++)1===
f[b]&&(k[b]=t[a+b-e]);d.pop(4)},primitiveDivArrays:function(){var a=d.stackObjectValue(0);var b=d.stackObjectValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isWords(a));if(d.failed())return null;var e=l(b);d.success(e===l(c));d.success(e===l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");var g=d.isMemberOf(c,"WordArray");if(f&&g){if(!d.isMemberOf(a,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(a,
"KedamaFloatArray"))return d.primitiveFail(),null;g?f?(f=c.words,c=b.words,g=a.words):(f=c.words,c=b.wordsAsFloat32Array(),g=a.wordsAsFloat32Array()):(f?(f=c.wordsAsFloat32Array(),c=b.words):(f=c.wordsAsFloat32Array(),c=b.wordsAsFloat32Array()),g=a.wordsAsFloat32Array());for(b=0;b<=e-1;b++)g[b]=f[b]/c[b];d.pop(4);d.push(a)},makeMask:function(){var a=d.stackIntegerValue(0);var b=d.stackIntegerValue(1);var c=d.stackValue(2);var e=d.stackValue(3);if(d.failed())return null;var f=l(e);var g=l(c);if(f!==
g||-32>a||8<a)return d.primitiveFail(),null;e=e.words;g=c.words;for(c=0;c<=f-1;c++){var h=e[c];h=0>a?-31>a?0:h>>>0-a:31<a?0:h<<a;255<h&&(h=255);0>h&&(h=0);g[c]=h<<24&4278190080|b}d.pop(4)},primitiveLEScalar:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(c);d.success(e===l(a));if(d.failed())return null;var f="number"===typeof b;if(d.isMemberOf(c,"WordArray"))if(f){f=
c.words;var g=b}else f=c.words,g=d.floatValueOf(b);else f?(f=c.wordsAsFloat32Array(),g=b):(f=c.wordsAsFloat32Array(),g=d.floatValueOf(b));b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]<=g;d.pop(4);d.push(a)},kedamaSetRandomSeed:function(){var a=d.stackIntegerValue(0);if(d.failed())return null;n=a&65536;d.pop(1)},randomIntoIntegerArray:function(){var a=d.stackFloatValue(0);var b=d.stackValue(1);var c=d.stackIntegerValue(2);var f=d.stackIntegerValue(3);var g=d.stackIntegerValue(4);if(d.failed())return null;
if(!(d.isWords(b)&&l(b)>=c&&1<=f&&c>=f))return d.primitiveFail(),null;b=b.words;if(d.failed())return null;for(;f<=c;f++)b[f-1]=e(g)*a|0;d.pop(5)},setInterpreter:function(a){d=a;a=1==d.majorVersion();return!1===a?!1:a=11<=d.minorVersion()},primitivePredicateAtAllPutColor:function(){var a=d.stackIntegerValue(0);var b=d.stackObjectValue(1);if(d.failed())return null;a|=4278190080;var c=d.fetchPointerofObject(1,b);var e=d.fetchPointerofObject(0,b);if(d.failed())return null;if(!d.isBytes(e)||!d.isWords(c))return d.primitiveFail(),
null;b=c.words;var f=e.bytes;for(e=0;e<=l(c)-1;e++)1===f[e]&&(b[e]=a);d.pop(1)},makeTurtlesMap:function(){var a=d.stackIntegerValue(0);var b=d.stackIntegerValue(1);var c=d.stackValue(2);var e=d.stackValue(3);var f=d.stackValue(4);var g=d.stackValue(5);if(!(d.isWords(c)&&d.isWords(e)&&d.isWords(f)&&d.isWords(g)))return d.primitiveFail(),null;var h=l(f);if(l(e)!==h||l(c)!==h||l(g)!==a*b)return d.primitiveFail(),null;e=e.wordsAsFloat32Array();c=c.wordsAsFloat32Array();f=f.words;var k=g.words;for(g=0;g<=
a*b-1;g++)k[g]=0;for(g=0;g<=h-1;g++){var t=e[g];var n=c[g];t=b*n+t;0<=t&&t<a*b&&(k[t]=f[g])}if(d.failed())return null;d.pop(6)},randomIntoFloatArray:function(){var a=d.stackFloatValue(0);var b=d.stackValue(1);var c=d.stackIntegerValue(2);var f=d.stackIntegerValue(3);var g=d.stackIntegerValue(4);if(d.failed())return null;if(!(d.isWords(b)&&l(b)>=c&&1<=f&&c>=f))return d.primitiveFail(),null;b=b.wordsAsFloat32Array();if(d.failed())return null;for(;f<=c;f++)b[f-1]=e(g)*a;d.pop(5)},primUpHill:function(){var a,
c;var e=d.stackIntegerValue(0);var f=d.stackIntegerValue(1);var h=d.stackIntegerValue(2);var k=d.stackValue(3);var t=d.stackFloatValue(4);var n=d.stackFloatValue(5);var w=d.stackFloatValue(6);if(d.failed())return null;if(!d.isWords(k)||l(k)!==f*h)return d.primitiveFail(),null;k=k.words;w=Math.max(w,0);var y=Math.max(n,0);w=Math.min(w,h-1);y=Math.min(y,f-1);var F=Math.max(w-e,0);n=Math.min(w+e,h-1);var C=Math.max(y-e,0);f=Math.min(y+e,f-1);e=k[y*h+w];var H=-1;for(c=C;c<=f;c++)for(C=c*h,a=F;a<=n;a++){var I=
k[C+a];if(I>e){H=a;var M=c;e=I}}M=-1===H?g(t):b(H-w,M-y)+90|0;if(d.failed())return null;d.pop(8);d.pushFloat(M)},shutdownModule:function(){return!0},primitiveDivScalar:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));d.success(d.isWords(a));if(d.failed())return null;var e=l(c);d.success(e===l(a));if(d.failed())return null;var f="number"===typeof b;var g=d.isMemberOf(c,"WordArray");if(f&&g){if(!d.isMemberOf(a,
"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(a,"KedamaFloatArray"))return d.primitiveFail(),null;if(g)if(f)for(f=c.words,c=b,g=a.words,b=0;b<=e-1;b++)g[b]=Math.floor(f[b]/c)|0;else for(f=c.words,c=d.floatValueOf(b),g=a.wordsAsFloat32Array(),b=0;b<=e-1;b++)g[b]=f[b]/c;else for(f?(f=c.wordsAsFloat32Array(),c=b):(f=c.wordsAsFloat32Array(),c=d.floatValueOf(b)),g=a.wordsAsFloat32Array(),b=0;b<=e-1;b++)g[b]=f[b]/c;d.pop(4);d.push(a)},primitiveGEArrays:function(){var a=d.stackObjectValue(0);
var b=d.stackObjectValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(b);d.success(e===l(c));d.success(e===l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b.words}else f=c.words,g=b.wordsAsFloat32Array();else f?(f=c.wordsAsFloat32Array(),g=b.words):(f=c.wordsAsFloat32Array(),g=b.wordsAsFloat32Array());b=a.bytes;
for(c=0;c<=e-1;c++)b[c]=f[c]>=g[c];d.pop(4);d.push(a)},primitiveNotByteArray:function(){var a=d.stackValue(0);if(d.failed())return null;d.success(d.isBytes(a));if(d.failed())return null;var b=l(a);if(d.failed())return null;var c=a.bytes;for(a=0;a<=b-1;a++)c[a]=0===c[a]?1:0},randomRange:function(){var a=d.stackIntegerValue(0);if(d.failed())return null;a=e(a);if(d.failed())return null;d.pop(2);d.pushInteger(a)},initialiseModule:function(){n=17;k=16807;y=2147483647;w=Math.floor(y/k)|0;t=a(y,k)},getScalarHeading:function(){var a=
d.stackValue(0);var b=d.stackIntegerValue(1);if(d.failed())return null;if(!d.isWords(a)||l(a)<b)return d.primitiveFail(),null;a=a.wordsAsFloat32Array()[b-1];a=g(a);if(d.failed())return null;d.pop(3);d.pushFloat(a)},primPixelAtXY:function(){var a=d.stackIntegerValue(0);var b=d.stackIntegerValue(1);var c=d.stackFloatValue(2);var e=d.stackFloatValue(3);var f=d.stackValue(4);if(d.failed())return null;if(!d.isWords(f)||l(f)!==a*b)return d.primitiveFail(),null;e|=0;c|=0;f=f.words;a=0<=e&&e<b&&0<=c&&c<a?
f[c*b+e]:0;if(d.failed())return null;d.pop(6);d.pushInteger(a)},primitivePredicateAtAllPutNumber:function(){var a=d.stackFloatValue(0);var b=d.stackObjectValue(1);if(d.failed())return null;var c=d.fetchPointerofObject(1,b);var e=d.fetchPointerofObject(0,b);if(d.failed())return null;if(!d.isBytes(e)||!d.isWords(c))return d.primitiveFail(),null;b=c.wordsAsFloat32Array();var f=e.bytes;for(e=0;e<=l(c)-1;e++)1===f[e]&&(b[e]=a);d.pop(1)},primitiveEQArrays:function(){var a=d.stackObjectValue(0);var b=d.stackObjectValue(1);
var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(b);d.success(e===l(c));d.success(e===l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b.words}else f=c.words,g=b.wordsAsFloat32Array();else f?(f=c.wordsAsFloat32Array(),g=b.words):(f=c.wordsAsFloat32Array(),g=b.wordsAsFloat32Array());b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]===
g[c];d.pop(4);d.push(a)},primitiveNEArrays:function(){var a=d.stackObjectValue(0);var b=d.stackObjectValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(b);d.success(e===l(c));d.success(e===l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b.words}else f=c.words,g=b.wordsAsFloat32Array();else f?(f=c.wordsAsFloat32Array(),
g=b.words):(f=c.wordsAsFloat32Array(),g=b.wordsAsFloat32Array());b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]!==g[c];d.pop(4);d.push(a)},primScalarForward:function(){var a=d.stackIntegerValue(0);var b=d.stackIntegerValue(1);var c=d.stackIntegerValue(2);var e=d.stackIntegerValue(3);var g=d.stackFloatValue(4);var k=d.stackFloatValue(5);var t=d.stackFloatValue(6);var n=d.stackValue(7);var w=d.stackValue(8);var y=d.stackValue(9);var F=d.stackIntegerValue(10);if(d.failed())return null;if(!d.isWords(y)||!d.isWords(w)||
!d.isWords(n))return d.primitiveFail(),null;var C=l(y);if(l(w)!==C||l(n)!==C)return d.primitiveFail(),null;C=y.wordsAsFloat32Array();w=w.wordsAsFloat32Array();n=n.wordsAsFloat32Array();--F;y=C[F]+t*Math.cos(n[F]);t=w[F]-t*Math.sin(n[F]);h(F,C,n,y,k,e,c);f(F,w,n,t,g,b,a);if(d.failed())return null;d.pop(11)},vectorGetDistanceTo:function(){var a=d.stackValue(0);var b=d.stackValue(1);var c=d.stackValue(2);var e=d.stackValue(3);var f=d.stackValue(4);if(d.failed())return null;if(!d.isWords(a)||!d.isWords(c)||
!d.isWords(b))return d.primitiveFail(),null;var g=l(a);if(0>g||l(c)!==g||l(b)!==g)return d.primitiveFail(),null;if(f.isFloat)if(e.isFloat)var h=!1;else return d.primitiveFail(),null;else{if(e.isFloat)return d.primitiveFail(),null;h=!0}if(h&&(l(f)!==g||l(e)!==g))return d.primitiveFail(),null;var k=a.wordsAsFloat32Array();c=c.wordsAsFloat32Array();b=b.wordsAsFloat32Array();if(h){var t=f.wordsAsFloat32Array();var n=e.wordsAsFloat32Array()}if(!h){var w=d.floatValueOf(f);var y=d.floatValueOf(e)}for(f=
0;f<=g-1;f++){h&&(w=t[f],y=n[f]);e=w-c[f];var H=y-b[f];k[f]=Math.sqrt(e*e+H*H)}if(d.failed())return null;d.pop(6);d.push(a)},turtlesSetY:function(){var a,b,c;var e=d.stackIntegerValue(0);var g=d.stackIntegerValue(1);var h=d.stackFloatValue(2);var k=d.stackValue(3);var t=d.stackValue(4);var n=d.stackValue(5);var w=d.stackValue(6);if(d.failed())return null;if(!d.isBytes(w)||!d.isWords(n)||!d.isWords(t))return d.primitiveFail(),null;if(k.isFloat)var y=!1;else if(d.isWords(k)){y=!0;var C=d.isMemberOf(k,
"WordArray")}else return d.primitiveFail(),null;var H=l(n);if(l(w)!==H||l(t)!==H||y&&l(k)!==H)return d.primitiveFail(),null;w=w.bytes;n=n.wordsAsFloat32Array();t=t.wordsAsFloat32Array();y?C?c=k.words:b=k.wordsAsFloat32Array():a=d.floatValueOf(k);for(k=0;k<=H-1;k++)if(1===w[k]){var I=y?C?c[k]:b[k]:a;f(k,n,t,I,h,g,e)}if(d.failed())return null;d.pop(7)},turtleScalarSetX:function(){var a=d.stackIntegerValue(0);var b=d.stackIntegerValue(1);var c=d.stackFloatValue(2);var e=d.stackFloatValue(3);var f=d.stackValue(4);
var g=d.stackIntegerValue(5);var k=d.stackValue(6);if(d.failed())return null;if(!d.isWords(k)||!d.isWords(f))return d.primitiveFail(),null;var t=l(k);if(l(f)!==t)return d.primitiveFail(),null;t=k.wordsAsFloat32Array();f=f.wordsAsFloat32Array();h(g-1,t,f,e,c,b,a);if(d.failed())return null;d.pop(7)},primTurtlesForward:function(){var a,b;var c=d.stackIntegerValue(0);var e=d.stackIntegerValue(1);var g=d.stackIntegerValue(2);var k=d.stackIntegerValue(3);var t=d.stackFloatValue(4);var n=d.stackFloatValue(5);
var w=d.stackValue(6);var y=d.stackValue(7);var F=d.stackValue(8);var C=d.stackValue(9);var H=d.stackValue(10);if(d.failed())return null;if(!(d.isBytes(H)&&d.isWords(C)&&d.isWords(F)&&d.isWords(y)))return d.primitiveFail(),null;if(w.isFloat)var I=!1;else if(d.isWords(w))I=!0;else return d.primitiveFail(),null;var M=l(C);if(l(F)!==M||l(y)!==M||l(H)!==M||I&&l(w)!==M)return d.primitiveFail(),null;H=H.bytes;C=C.wordsAsFloat32Array();F=F.wordsAsFloat32Array();y=y.wordsAsFloat32Array();I?b=w.wordsAsFloat32Array():
a=d.floatValueOf(w);for(w=0;w<=M-1;w++)if(1===H[w]){var v=I?b[w]:a;var N=C[w]+v*Math.cos(y[w]);v=F[w]-v*Math.sin(y[w]);h(w,C,y,N,n,k,g);f(w,F,y,v,t,e,c)}if(d.failed())return null;d.pop(11)},primitiveGEScalar:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(c);d.success(e===l(a));if(d.failed())return null;var f="number"===typeof b;if(d.isMemberOf(c,"WordArray"))if(f){f=
c.words;var g=b}else f=c.words,g=d.floatValueOf(b);else f?(f=c.wordsAsFloat32Array(),g=b):(f=c.wordsAsFloat32Array(),g=d.floatValueOf(b));b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]>=g;d.pop(4);d.push(a)},primitiveAndByteArray:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);if(d.failed())return null;d.success(d.isBytes(b));d.success(d.isBytes(a));if(d.failed())return null;var c=l(b);var e=l(a);if(d.failed())return null;var f=c;c>e&&(f=e);c=a.bytes;e=b.bytes;for(b=0;b<=f-1;b++)e[b]=2===e[b]+
c[b];d.pop(1)},primitivePredicateReplaceWords:function(){var a=d.stackIntegerValue(0);var b=d.stackObjectValue(1);var c=d.stackIntegerValue(2);var e=d.stackIntegerValue(3);var f=d.stackObjectValue(4);if(d.failed())return null;var g=d.fetchPointerofObject(1,f);var h=d.fetchPointerofObject(0,f);if(d.failed())return null;if(!d.isBytes(h)||!(d.isWords(g)&&d.isWords(b)||d.isPointers(g)&&d.isPointers(b)))return d.primitiveFail(),null;f=h.bytes;var k=l(g);h=l(h);var t=l(b);if(e>c||1>e||e>k||e>h||c>k||c>
h||1>a||a>t||t-a+1<c-e+1)return d.primitiveFail(),null;t=d.isMemberOf(g,"KedamaFloatArray");h=d.isMemberOf(b,"KedamaFloatArray");if(t&&h){var n=g.wordsAsFloat32Array();var w=b.wordsAsFloat32Array();for(k=e-1;k<=c-1;k++)1===f[k]&&(n[k]=w[a+k-e])}if(t&&!h)for(n=g.wordsAsFloat32Array(),w=b.words,k=e-1;k<=c-1;k++)1===f[k]&&(n[k]=w[a+k-e]);if(!t&&h)for(n=g.words,w=b.wordsAsFloat32Array(),k=e-1;k<=c-1;k++)if(1===f[k]){var y=w[a+k-e]>>>0;n[k]=y}if(!t&&!h)for(n=g.words,w=b.words,k=e-1;k<=c-1;k++)1===f[k]&&
(n[k]=w[a+k-e]);d.pop(4)},primitiveGTArrays:function(){var a=d.stackObjectValue(0);var b=d.stackObjectValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(b);d.success(e===l(c));d.success(e===l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b.words}else f=c.words,g=b.wordsAsFloat32Array();else f?(f=c.wordsAsFloat32Array(),
g=b.words):(f=c.wordsAsFloat32Array(),g=b.wordsAsFloat32Array());b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]>g[c];d.pop(4);d.push(a)},primitivePredicateAtAllPutObject:function(){var a=d.stackValue(0);var b=d.stackObjectValue(1);if(d.failed())return null;var c=d.fetchPointerofObject(1,b);var e=d.fetchPointerofObject(0,b);if(d.failed())return null;if(!d.isBytes(e)||!d.isPointers(c))return d.primitiveFail(),null;b=c.wordsAsInt32Array();var f=e.bytes;for(e=0;e<=l(c)-1;e++)1===f[e]&&(b[e]=a);d.pop(1)},primitiveEQScalar:function(){var a=
d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(c);d.success(e===l(a));if(d.failed())return null;var f="number"===typeof b;if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b}else f=c.words,g=d.floatValueOf(b);else f?(f=c.wordsAsFloat32Array(),g=b):(f=c.wordsAsFloat32Array(),g=d.floatValueOf(b));b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]===g;d.pop(4);d.push(a)},primitivePredicateAtAllPutBoolean:function(){var a=
d.stackValue(0);var b=d.stackObjectValue(1);if(d.failed())return null;a=d.isIntegerValue(a)?a:d.booleanValueOf(a);var c=d.fetchPointerofObject(1,b);var e=d.fetchPointerofObject(0,b);if(d.failed())return null;if(!d.isBytes(e)||!d.isBytes(c))return d.primitiveFail(),null;b=c.bytes;var f=e.bytes;for(e=0;e<=l(c)-1;e++)1===f[e]&&(b[e]=a);d.pop(1)},zoomBitmap:function(){var a,b,c,e,f,g;var h=d.stackIntegerValue(0);var k=d.stackIntegerValue(1);var t=d.stackIntegerValue(2);var n=d.stackIntegerValue(3);var w=
d.stackValue(4);var y=d.stackValue(5);if(d.failed())return null;var H=l(y);var I=l(w);if(n*t!==H||H*k*h!==I)return d.primitiveFail(),null;I=y.words;y=w.words;for(f=H=c=b=0;f<=t-1;f++){for(g=0;g<=h-1;g++){for(e=0;e<=n-1;e++)for(w=I[b],++b,a=0;a<=k-1;a++)y[H]=w,++H;b=c}b=c+=n}d.pop(6)},primitiveNEScalar:function(){var a=d.stackObjectValue(0);var b=d.stackValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(c));d.success(d.isBytes(a));if(d.failed())return null;var e=l(c);
d.success(e===l(a));if(d.failed())return null;var f="number"===typeof b;if(d.isMemberOf(c,"WordArray"))if(f){f=c.words;var g=b}else f=c.words,g=d.floatValueOf(b);else f?(f=c.wordsAsFloat32Array(),g=b):(f=c.wordsAsFloat32Array(),g=d.floatValueOf(b));b=a.bytes;for(c=0;c<=e-1;c++)b[c]=f[c]!==g;d.pop(4);d.push(a)},scalarGetDistanceTo:function(){var a=d.stackFloatValue(0);var b=d.stackFloatValue(1);var c=d.stackFloatValue(2);var e=d.stackFloatValue(3);if(d.failed())return null;b-=e;a-=c;a=Math.sqrt(b*
b+a*a);if(d.failed())return null;d.pop(5);d.pushFloat(a)},primitiveSubArrays:function(){var a=d.stackObjectValue(0);var b=d.stackObjectValue(1);var c=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(c));d.success(d.isWords(a));if(d.failed())return null;var e=l(b);d.success(e===l(c));d.success(e===l(a));if(d.failed())return null;var f=d.isMemberOf(b,"WordArray");var g=d.isMemberOf(c,"WordArray");if(f&&g){if(!d.isMemberOf(a,"WordArray"))return d.primitiveFail(),
null}else if(!d.isMemberOf(a,"KedamaFloatArray"))return d.primitiveFail(),null;g?f?(f=c.words,c=b.words,g=a.words):(f=c.words,c=b.wordsAsFloat32Array(),g=a.wordsAsFloat32Array()):(f?(f=c.wordsAsFloat32Array(),c=b.words):(f=c.wordsAsFloat32Array(),c=b.wordsAsFloat32Array()),g=a.wordsAsFloat32Array());for(b=0;b<=e-1;b++)g[b]=f[b]-c[b];d.pop(4);d.push(a)}})});module("users.bert.SqueakJS.plugins.Klatt").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b,c){var d=-3.141592653589793/I*c;var e=Math.exp(d);c=0-e*e;d=6.283185307179586/I*b;d=e*Math.cos(d)*2;b=1/(1-d-c);F[5*a-5]=b;F[5*a-4]=(0-d)*b;F[5*a-3]=(0-c)*b}function b(a,b){var c;var d=F[5*a-5]*b+F[5*a-4]*(c=F[5*a-2])+F[5*a-3]*F[5*a-1];F[5*a-1]=c;F[5*a-2]=b;return d}function c(a){q.success(q.isWords(a));
return q.failed()?0:a.wordsAsFloat32Array()}function e(a){return 32.767*Math.pow(2,(a-87)/6)}function g(){return M=1309*M+13849&65535}function h(a,b,c,d,e){return Math.exp(a*b)*((e*(a*a+1)+a)*d-c)+1}function f(a,b,c){var d=-3.141592653589793/I*c;var e=Math.exp(d);c=0-e*e;d=6.283185307179586/I*b;b=e*Math.cos(d)*2;F[5*a-5]=1-b-c;F[5*a-4]=b;F[5*a-3]=c}function d(a,b,c,d){f(a,b,c);F[5*a-5]*=d}function n(a,b){var c;b=F[5*a-5]*b+F[5*a-4]*(c=F[5*a-2])+F[5*a-3]*F[5*a-1];F[5*a-1]=c;return F[5*a-2]=b}var k=
0,y=0,w=0,t=0,p=0,m=null,x=0,q=null,u=0,A=0,B=0,D=0,P=0,O=0,F=null,C=0,H=0,I=0,M=0,v=0,N=0,G=0,K=0;Squeak.registerExternalModule("Klatt",{setInterpreter:function(a){q=a;a=1==q.majorVersion();return!1===a?!1:a=11<=q.minorVersion()},primitiveSynthesizeFrameIntoStartingAt:function(){var ba;var aa=c(q.stackValue(2));var ha=ba=q.stackValue(1);q.success(q.isWords(ha));ha=q.failed()?0:ha.wordsAsInt16Array();var Q=q.stackIntegerValue(0);if(q.failed())return null;var L=q.stackObjectValue(3);q.success(22===
l(L));if(q.failed())var T=!1;else T=q.fetchPointerofObject(0,L),F=c(T),O=q.fetchFloatofObject(2,L),v=q.fetchIntegerofObject(3,L),D=q.fetchIntegerofObject(4,L),B=q.fetchIntegerofObject(5,L),A=q.fetchIntegerofObject(6,L),k=q.fetchFloatofObject(7,L),y=q.fetchFloatofObject(8,L),G=q.fetchFloatofObject(9,L),K=q.fetchFloatofObject(10,L),w=q.fetchFloatofObject(11,L),t=q.fetchFloatofObject(12,L),x=q.fetchFloatofObject(13,L),N=q.fetchFloatofObject(14,L),u=q.fetchFloatofObject(15,L),P=q.fetchIntegerofObject(16,
L),C=q.fetchIntegerofObject(17,L),M=q.fetchIntegerofObject(18,L),p=q.fetchIntegerofObject(19,L),H=q.fetchIntegerofObject(20,L),I=q.fetchIntegerofObject(21,L),T=!1===q.failed();if(!T)return null;q.success(2*l(ba)>=H);if(q.failed())return null;m=aa;var R=.6*e(m[45]);var ca=.6*e(m[50]);aa=.4*e(m[46]);T=.15*e(m[47]);var ua=.06*e(m[48]);var Ka=.04*e(m[49]);ba=.15*e(m[34]);var oa=.06*e(m[35]);var va=.04*e(m[36]);var wa=.022*e(m[37]);var Ba=.03*e(m[38]);8<=p&&(16E3<=I?f(19,7500,600):p=6);7<=p&&(16E3<=I?
f(18,6500,500):p=6);6<=p&&f(17,m[24],m[25]);5<=p&&f(16,m[22],m[23]);f(15,m[20],m[21]);f(14,m[18],m[19]);f(13,m[16],m[17]);f(12,m[12],m[13]);f(20,m[26],m[27]);f(22,m[30],m[31]);a(21,m[28],m[29]);a(23,m[32],m[33]);d(1,m[26],m[27],R);d(2,m[30],m[31],ca);d(3,m[12],m[13],aa);d(4,m[16],m[17],T);d(5,m[18],m[19],ua);d(6,m[20],m[21],Ka);d(7,m[16],m[40],ba);d(8,m[18],m[41],oa);d(9,m[20],m[42],va);d(10,m[22],m[43],wa);d(11,m[24],m[44],Ba);0<O?(va=e(m[5]-7),oa=e(m[5]),ua=.1*e(m[11])):va=oa=ua=0;T=.25*e(m[10]);
aa=.05*e(m[9]);ba=.05*e(m[39]);Ka=m[51]-3;0>=Ka&&(Ka=57);Ka=e(Ka);d(24,0,I,Ka);wa=Q;for(Q=H+Q-1;wa<=Q;){R=(g()-32768)/4;u=R+=.75*u;D>A&&(R*=.5);Ba=T*R;if(0===v)ca=0;else{D<B?(ca=k*G+y*K,K=G):ca=w*G-t;G=ca;if(D>=v)if(D=0,0<m[0]){O=m[0];var ta=C/I;var bb=Math.sin(79.79645340118074*ta);O+=2*m[1]*m[0]/100*(bb+Math.sin(44.61061568097506*ta)+Math.sin(29.530970943744055*ta));O+=(g()-32767)*m[2]/32768*m[0];O=0===(P-2*(Math.floor(P/2)|0)|0)?O+m[4]*m[0]*(1-m[6]):O-m[4]*m[0]*(1-m[6]);0>O&&(O=0);A=v=I/O|0;0<
m[5]&&(A>>=1);B=v*m[6]|0;bb=m[7];ta=v*m[6]|0;var Qa=ta/v;if(0>=bb)var fb=1;else{var Y=(1-Qa)/bb;fb=1-Y/(Math.exp(Y)-1)}Y=3.141592653589793*(m[8]+1);var ib;var Oa=Y;var nb=Math.cos(Y),Ca=Math.sin(Y),eb=bb/Qa*Y*fb;if(0<h(0,Oa,nb,Ca,eb))for(fb=0,Qa=1,ib=h(Qa,Oa,nb,Ca,eb);0<ib;)fb=Qa,Qa*=2,ib=h(Qa,Oa,nb,Ca,eb);else for(fb=-1,Qa=0,ib=h(fb,Oa,nb,Ca,eb);0>ib;)Qa=fb,fb*=2,ib=h(fb,Oa,nb,Ca,eb);for(;1E-4<Qa-fb;){ib=(Qa+fb)/2;var Ya=h(ib,Oa,nb,Ca,eb);0<Ya?fb=ib:Qa=ib}Oa=(Qa+fb)/2;Y/=ta;Oa=Math.exp(Oa*Y);k=2*
Math.cos(Y)*Oa;y=0-Oa*Oa;K=0;G=Oa*Math.sin(Y);bb=Math.exp(-1/(bb*v));ta=Math.pow(bb,v-ta);w=bb;t=(1-bb)*ta/(1-ta);Y=0;bb=G;ta=K;for(Oa=1;Oa<=B;Oa++)Y=k*bb+y*ta,ta=bb,bb=Y;0!==Y&&(G=G/Y*1E4);G+=(g()-32767)*m[3]/32768*G;0<G&&(G=0);0!==(P-2*(Math.floor(P/2)|0)|0)&&(G*=1-m[4],0<G&&(G=0));ta=P+1;P=ta-65535*(Math.floor(ta/65535)|0)|0}else A=v=1;++D}N=ca;D<B&&(ca+=ua*(g()-32768)/4);ta=va*ca;ca*=oa;R*=aa;ta+=R;ca+=R;0<p?(R=b(21,ta),R=n(20,R),R=b(23,R),R=n(22,R),8<=p&&(R=n(19,R)),7<=p&&(R=n(18,R)),6<=p&&(R=
n(17,R)),5<=p&&(R=n(16,R)),4<=p&&(R=n(15,R)),3<=p&&(R=n(14,R)),2<=p&&(R=n(13,R)),1<=p&&(R=n(12,R)),ta=R):ta=0;R=ca;R=n(3,R)+n(4,R)+n(5,R)+n(6,R)+n(1,R)+n(2,R);ta+=R;R=Ba+ca-x;x=ca;Ba=R;ta=n(7,Ba)-n(8,Ba)+n(9,Ba)-n(10,Ba)+n(11,Ba)-ta;ta=ba*R-ta;ta=n(24,ta);Ba=ta*Ka|0;-32768>Ba&&(Ba=-32768);32767<Ba&&(Ba=32767);ha[wa-1]=Ba;++wa;++C}q.pushRemappableOop(L);q.pushRemappableOop(q.floatObjectOf(O));q.pushRemappableOop(q.floatObjectOf(k));q.pushRemappableOop(q.floatObjectOf(y));q.pushRemappableOop(q.floatObjectOf(G));
q.pushRemappableOop(q.floatObjectOf(K));q.pushRemappableOop(q.floatObjectOf(w));q.pushRemappableOop(q.floatObjectOf(t));q.pushRemappableOop(q.floatObjectOf(x));q.pushRemappableOop(q.floatObjectOf(N));ua=q.floatObjectOf(u);Ka=q.popRemappableOop();T=q.popRemappableOop();ba=q.popRemappableOop();aa=q.popRemappableOop();Q=q.popRemappableOop();wa=q.popRemappableOop();L=q.popRemappableOop();ha=q.popRemappableOop();va=q.popRemappableOop();oa=q.popRemappableOop();q.failed()?ha=!1:(q.storePointerofObjectwithValue(2,
oa,va),q.storeIntegerofObjectwithValue(3,oa,v),q.storeIntegerofObjectwithValue(4,oa,D),q.storeIntegerofObjectwithValue(5,oa,B),q.storeIntegerofObjectwithValue(6,oa,A),q.storePointerofObjectwithValue(7,oa,ha),q.storePointerofObjectwithValue(8,oa,L),q.storePointerofObjectwithValue(9,oa,wa),q.storePointerofObjectwithValue(10,oa,Q),q.storePointerofObjectwithValue(11,oa,aa),q.storePointerofObjectwithValue(12,oa,ba),q.storePointerofObjectwithValue(13,oa,T),q.storePointerofObjectwithValue(14,oa,Ka),q.storePointerofObjectwithValue(15,
oa,ua),q.storeIntegerofObjectwithValue(16,oa,P),q.storeIntegerofObjectwithValue(17,oa,C),q.storeIntegerofObjectwithValue(18,oa,M),ha=!1===q.failed());if(!ha)return null;q.pop(3)},getModuleName:function(){return"Klatt 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.LargeIntegers").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return"number"===typeof a?v.classSmallInteger():a.sqClass}function a(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function b(a,b){return a-(Math.floor(a/b)|0)*b|0}function c(a,b){return 31<b?0:a>>>b}function e(d,e,f){if(1>e||1>f)return v.primitiveFail();var g=Math.min(f,n(d.bytes,a(d)));if(e>g)return!1;var h=(e-1>>3)+1;f=(g-1>>3)+1;var k=b(e-1,8);e=7-b(g-1,8);if(h===
f)return f=(31<k?0:255<<k)&c(255,e),d=O(d,h),0!==(d&f);if(0!==c(O(d,h),k))return!0;for(h+=1;h<=f-1;h++)if(0!==O(d,h))return!0;d=O(d,f);return 0!==((31<e?0:d<<e)&255)?!0:!1}function g(b,c){var e=v.instantiateClassindexableSize(l(b),c);var f=a(b);d(b.bytes,e.bytes,f<c?f:c);return e}function h(a,b){if("number"===typeof a){var c=0>a?v.classLargeNegativeInteger():v.classLargePositiveInteger();b=v.instantiateClassindexableSize(c,b);var d;c=b.bytes;var e=1;for(d=k(a);e<=d;e++)c[e-1]=y(a,e)}else b=g(a,b);
return b}function f(a,b,c){var d,e;for(e=c-1;0<=e;){if((d=b[e])!==(c=a[e]))return d<c?1:-1;--e}return 0}function d(a,b,c){var d;--c;for(d=0;d<=c;d++)b[d]=a[d];return 0}function n(a,b){var c;for(c=b;0===(b=a[c-1]);)if(0===--c)return 0;return t(b)+8*(c-1)}function k(a){return 256>a&&-256<a?1:65536>a&&-65536<a?2:16777216>a&&-16777216<a?3:4}function y(a,b){1>b&&v.primitiveFail();return 4<b?0:0>a?c(0-a,8*(b-1))&255:c(a,8*(b-1))&255}function w(a,b,c,d,e){c=c-b+1;for(var f=0;f<c;f++)a[f+b]=d[f+e];return 0}
function t(a){var b=0;65536>a||(a>>>=16,b+=16);256>a||(a>>>=8,b+=8);16>a||(a>>>=4,b+=4);4>a||(a>>>=2,b+=2);2>a||(a>>>=1,++b);return b+a}function p(a){var b;var c=0>a?v.classLargeNegativeInteger():v.classLargePositiveInteger();var d=k(a);c=v.instantiateClassindexableSize(c,d);var e=c.bytes;for(b=1;b<=d;b++)e[b-1]=y(a,b);return c}function m(d,e){var f;var g=a(d);if(0===(f=n(d.bytes,g)))return 0;f=f+e+7>>3;var h=v.instantiateClassindexableSize(l(d),f);d=d.bytes;var k=h.bytes,m;var p=e>>3;var t=b(e,8);
var q=p-1;for(m=0;m<=q;m++)k[m]=0;if(0===t)w(k,p,f-1,d,0);else{var I=8-t;e=0;q=g-1;for(m=0;m<=q;m++)g=d[m],k[m+p]=(e|(31<t?0:g<<t))&255,e=c(g,I);0!==e&&(k[f-1]=e)}return h}function x(a,d,e){e=n(a.bytes,e);var f=e+7>>3;e-=d;if(0>=e)return v.instantiateClassindexableSize(l(a),0);var g=e+7>>3;e=v.instantiateClassindexableSize(l(a),g);a=a.bytes;var h=e.bytes;var k=d>>3;var m=b(d,8);if(0===m)w(h,0,g-1,a,k);else{var p=8-m;d=c(a[k],m);k+=1;var t=f-1;for(f=k;f<=t;f++){var q=a[f];h[f-k]=(d|(31<p?0:q<<p))&
255;d=c(q,m)}0!==d&&(h[g-1]=d)}return e}function q(b,c){var e=a(b);var f=a(c);var g=l(b);if(e<=f){var h=b;var k=e;b=c}else h=c,k=f,f=e;e=v.instantiateClassindexableSize(g,f);h=h.bytes;b=b.bytes;c=e.bytes;var m;var p=0;var t=k-1;for(m=0;m<=t;m++)p=(p>>>8)+h[m]+b[m],c[m]=p&255;t=f-1;for(m=k;m<=t;m++)p=(p>>>8)+b[m],c[m]=p&255;h=p>>>8;0<h&&(g=v.instantiateClassindexableSize(g,f+1),d(e.bytes,g.bytes,f),e=g,e.bytes[f]=h);return e}function u(b,c,d){if("number"===typeof b){if(0>b)return v.primitiveFail();
b=p(b)}else if(l(b)===v.classLargeNegativeInteger())return v.primitiveFail();if("number"===typeof c){if(0>c)return v.primitiveFail();var e=p(c)}else{if(l(c)===v.classLargeNegativeInteger())return v.primitiveFail();e=c}var f=a(b);var g=a(e);if(f<g){var h=f;c=b;f=g}else h=g,c=e,e=b;b=v.instantiateClassindexableSize(v.classLargePositiveInteger(),f);c=c.bytes;e=e.bytes;g=b.bytes;var k=h-1;if(0===d){for(d=0;d<=k;d++)g[d]=c[d]&e[d];k=f-1;for(d=h;d<=k;d++)g[d]=0}else if(1===d){for(d=0;d<=k;d++)g[d]=c[d]|
e[d];k=f-1;for(d=h;d<=k;d++)g[d]=e[d]}else if(2===d){for(d=0;d<=k;d++)g[d]=c[d]^e[d];k=f-1;for(d=h;d<=k;d++)g[d]=e[d]}else v.primitiveFail();return v.failed()?0:M(b)}function A(b,c){var d=a(b);var e=a(c);return e!==d?e>d?-1:1:f(b.bytes,c.bytes,d)}function B(c,d,e){var f=a(c);var g=a(d);e=e?v.classLargeNegativeInteger():v.classLargePositiveInteger();var k=f-g+1;if(0>=k)return g=v.instantiateClassindexableSize(v.classArray(),2),v.stObjectatput(g,1,0),v.stObjectatput(g,2,c),g;g=8-t(d.bytes[g-1]);d=m(d,
g);d=h(d,D(d)+1);c=m(c,g);D(c)===f&&(c=h(c,f+1));f=v.instantiateClassindexableSize(e,k);e=d.bytes;k=D(d);var p=c.bytes,l=D(c),q=f.bytes,n=D(f),w,I;var y=k-1;var u=e[y-1];var A=1===y?0:e[y-2];for(I=1;I<=n;I++){var F=l+1-I;if(p[F-1]===u)var N=255;else{N=p[F-1];N=(N<<8)+p[F-2];var G=b(N,u);N=Math.floor(N/u)|0;var M=N*A;var B=M>>>8;M&=255;for(w=3>F?0:p[F-3];;){if(G<B||G===B&&w<M){--N;M<A?(--B,M=M+256-A):M-=A;var K=B>=u}else K=!1;if(!K)break;B-=u}}G=F-y;K=0;for(w=1;w<=k;w++)B=e[w-1]*(N>>>8),M=e[w-1]*(N&
255),K=p[G-1]-K-(M&255),p[G-1]=K&255,K>>=8,K=B+(M>>>8)-K,++G;if(0<K)for(--N,G=F-y,K=0,w=1;w<=k;w++)K=(K>>>8)+p[G-1]+e[w-1],p[G-1]=K&255,++G;q[n-I]=N}c=x(c,g,D(d)-1);g=v.instantiateClassindexableSize(v.classArray(),2);v.stObjectatput(g,1,f);v.stObjectatput(g,2,c);return g}function D(b){return"number"===typeof b?k(b):a(b)}function P(b,c,d){var e=a(b);var f=a(c);if(e<=f){var g=b;var h=e;b=c;e=f}else g=c,h=f;d=d?v.classLargeNegativeInteger():v.classLargePositiveInteger();d=v.instantiateClassindexableSize(d,
e+h);g=g.bytes;b=b.bytes;f=d.bytes;var k,m,p;if(1!==h||0!==g[0])if(1!==e||0!==b[0]){--h;var t=e-1;for(p=0;p<=h;p++)if(0!==(k=g[p])){var l=p;for(c=m=0;c<=t;c++)e=b[c],e=e*k+m+f[l],m=e>>>8,f[l]=e&255,++l;f[l]=m}}return H(d)}function O(b,c){return c>a(b)?0:b.bytes[c-1]}function F(b,c){var d=l(b)===v.classLargeNegativeInteger();var e=a(b);var f=a(c);if(e===f){for(;1<e&&O(b,e)===O(c,e);)--e;f=e}if(e<f||e===f&&O(b,e)<O(c,e)){var g=c;var h=f;f=e;d=!1===d}else g=b,h=e,b=c;e=h;e=v.instantiateClassindexableSize(d?
v.classLargeNegativeInteger():v.classLargePositiveInteger(),e);b=b.bytes;g=g.bytes;c=e.bytes;var k,m;for(k=m=0;k<=f-1;k++)m=m+g[k]-b[k],c[k]=m&255,m>>=8;for(k=f;k<=h-1;k++)m+=g[k],c[k]=m&255,m>>=8;return d?I(e):M(e)}function C(a){if("number"===typeof a)return!0;var b=D(a);if(0===b||0===a.bytes[b-1])return!1;if(4<b)return!0;if(4>b)return!1;if(l(a)===v.classLargePositiveInteger())return a.bytes[3]>y(1073741823,4);if(!(a.bytes[3]<y(-1073741824,4)))for(b=1;4>=b;b++)if(a.bytes[b-1]!==y(-1073741824,b))return!0;
return!1}function H(a){return l(a)===v.classLargePositiveInteger()?M(a):I(a)}function I(a){var b,c,d;for(c=d=D(a);0!==c&&0===a.bytes[c-1];)--c;if(0===c)return 0;if(4>=c){if(4>c||O(a,4)<y(-1073741824,4)){d=0;for(b=c;1<=b;b+=-1)d=256*d-a.bytes[b-1];return d}for(b=1;4>=b;b++)if(O(a,b)!==y(-1073741824,b))return c<d?g(a,c):a;return-1073741824}return c<d?g(a,c):a}function M(a){var b,c;for(b=c=D(a);0!==b&&0===a.bytes[b-1];)--b;if(0===b)return 0;if(4>=b&&O(a,4)<=y(1073741823,4)){for(c=0;1<=b;b+=-1)c=256*
c+a.bytes[b-1];return c}return b<c?g(a,b):a}var v=null;Squeak.registerExternalModule("LargeIntegers",{primDigitAddWith:function(){v.success(v.isKindOfInteger(v.stackValue(1)));var a=v.stackValue(1);v.success(v.isKindOfInteger(v.stackValue(0)));var b=v.stackValue(0);if(v.failed())return null;a="number"===typeof a?p(a):a;b="number"===typeof b?p(b):b;a=q(a,b);if(v.failed())return null;v.popthenPush(3,a);return null},primDigitBitShiftMagnitude:function(){var b=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));
var c=v.stackValue(1);if(v.failed())return null;c="number"===typeof c?p(c):c;b=0<=b?m(c,b):H(x(c,0-b,a(c)));if(v.failed())return null;v.popthenPush(2,b);return null},primGetModuleName:function(){var a;var b=v.instantiateClassindexableSize(v.classString(),22);var c=b.bytes;for(a=0;21>=a;a++)c[a]="LargeIntegers v1.5 (e)"[a];if(v.failed())return null;v.popthenPush(1,b);return null},primDigitBitLogicWithOp:function(){v.success(v.isKindOfInteger(v.stackValue(2)));var a=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));
var b=v.stackValue(1);var c=v.stackIntegerValue(0);if(v.failed())return null;a=u(a,b,c);if(v.failed())return null;v.popthenPush(4,a);return null},primCheckIfCModuleExists:function(){var a=v.trueObject();if(v.failed())return null;v.popthenPush(1,a);return null},primDigitCompare:function(){v.success(v.isKindOfInteger(v.stackValue(0)));var a=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));var b=v.stackValue(1);if(v.failed())return null;b="number"===typeof b?"number"===typeof a?b>a?1:b<
a?-1:0:-1:"number"===typeof a?1:A(b,a);if(v.failed())return null;v.popthenPush(2,b);return null},primDigitMultiplyNegative:function(){v.success(v.isKindOfInteger(v.stackValue(1)));var a=v.stackValue(1);var b=v.booleanValueOf(v.stackValue(0));v.success(v.isKindOfInteger(v.stackValue(2)));var c=v.stackValue(2);if(v.failed())return null;c="number"===typeof c?p(c):c;a="number"===typeof a?p(a):a;b=P(c,a,b);if(v.failed())return null;v.popthenPush(3,b);return null},primDigitBitShift:function(){var b=v.stackIntegerValue(0);
v.success(v.isKindOfInteger(v.stackValue(1)));var c=v.stackValue(1);if(v.failed())return null;c="number"===typeof c?p(c):c;b=0<=b?m(c,b):H(x(c,0-b,a(c)));if(v.failed())return null;v.popthenPush(2,b);return null},primNormalizePositive:function(){v.success(v.stackValue(0).sqClass===v.classLargePositiveInteger());var a=v.stackValue(0);if(v.failed())return null;a=M(a);if(v.failed())return null;v.popthenPush(1,a);return null},primDigitSubtractWith:function(){v.success(v.isKindOfInteger(v.stackValue(1)));
var a=v.stackValue(1);v.success(v.isKindOfInteger(v.stackValue(0)));var b=v.stackValue(0);if(v.failed())return null;a="number"===typeof a?p(a):a;b="number"===typeof b?p(b):b;a=F(a,b);if(v.failed())return null;v.popthenPush(3,a);return null},_primDigitBitShift:function(){v.success(v.isKindOfInteger(v.stackValue(1)));var b=v.stackValue(1);var c=v.stackIntegerValue(0);if(v.failed())return null;b="number"===typeof b?p(b):b;c=0<=c?m(b,c):H(x(b,0-c,a(b)));if(v.failed())return null;v.popthenPush(3,c);return null},
primDigitMultiplyWithNegative:function(){v.success(v.isKindOfInteger(v.stackValue(2)));var a=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));var b=v.stackValue(1);var c=v.booleanValueOf(v.stackValue(0));if(v.failed())return null;a="number"===typeof a?p(a):a;b="number"===typeof b?p(b):b;c=P(a,b,c);if(v.failed())return null;v.popthenPush(4,c);return null},primDigitSubtract:function(){v.success(v.isKindOfInteger(v.stackValue(0)));var a=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));
var b=v.stackValue(1);if(v.failed())return null;b="number"===typeof b?p(b):b;a="number"===typeof a?p(a):a;b=F(b,a);if(v.failed())return null;v.popthenPush(2,b);return null},primDigitDivNegative:function(){v.success(v.isKindOfInteger(v.stackValue(1)));var a=v.stackValue(1);var b=v.booleanValueOf(v.stackValue(0));v.success(v.isKindOfInteger(v.stackValue(2)));var c=v.stackValue(2);if(v.failed())return null;if(!C(c)||!C(a))return v.primitiveFail(),null;c="number"===typeof c?p(c):c;if("number"===typeof a){if(0===
a)return v.primitiveFail(),null;a=p(a)}b=B(c,a,b);if(v.failed())return null;v.popthenPush(3,b);return null},primNormalizeNegative:function(){v.success(v.stackValue(0).sqClass===v.classLargeNegativeInteger());var a=v.stackValue(0);if(v.failed())return null;a=I(a);if(v.failed())return null;v.popthenPush(1,a);return null},primDigitBitOr:function(){v.success(v.isKindOfInteger(v.stackValue(0)));var a=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));var b=v.stackValue(1);if(v.failed())return null;
b=u(b,a,1);if(v.failed())return null;v.popthenPush(2,b);return null},primMontgomeryTimesModulo:function(){v.success(v.isKindOfInteger(v.stackValue(2)));var b=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));var c=v.stackValue(1);var d=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(3)));var e=v.stackValue(3);if(v.failed())return null;var g="number"===typeof e?p(e):e;var h="number"===typeof b?p(b):b;var k="number"===typeof c?p(c):c;e=a(g);var m=a(h);b=a(k);if(e<=b)if(m<=
b)if(0<=d&&255>=d){c=v.instantiateClassindexableSize(v.classLargePositiveInteger(),b);g=g.bytes;h=h.bytes;k=k.bytes;var t=c.bytes,l,q,n;var w=e-1;var I=m-1;var y=b-1;for(q=n=0;q<=w;q++){var u=t[0]+g[q]*h[0];var x=u*d&255;u+=x*k[0];for(l=1;l<=I;l++)u=(u>>>8)+t[l]+g[q]*h[l]+x*k[l],t[l-1]=u&255;for(l=m;l<=y;l++)u=(u>>>8)+t[l]+x*k[l],t[l-1]=u&255;u=(u>>>8)+n;t[y]=u&255;n=u>>>8}for(q=e;q<=y;q++){u=t[0];x=u*d&255;u+=x*k[0];for(l=1;l<=y;l++)u=(u>>>8)+t[l]+x*k[l],t[l-1]=u&255;u=(u>>>8)+n;t[y]=u&255;n=u>>>
8}if(0!==n||1!==f(k,t,b))for(q=u=0;q<=y;q++)u=u+t[q]-k[q],t[q]=u&255,u>>=8;d=M(c)}else d=v.primitiveFail();else d=v.primitiveFail();else d=v.primitiveFail();if(v.failed())return null;v.popthenPush(4,d);return null},primDigitBitAnd:function(){v.success(v.isKindOfInteger(v.stackValue(0)));var a=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));var b=v.stackValue(1);if(v.failed())return null;b=u(b,a,0);if(v.failed())return null;v.popthenPush(2,b);return null},primDigitDivWithNegative:function(){v.success(v.isKindOfInteger(v.stackValue(2)));
var a=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));var b=v.stackValue(1);var c=v.booleanValueOf(v.stackValue(0));if(v.failed())return null;a="number"===typeof a?p(a):a;if("number"===typeof b){if(0===b)return v.primitiveFail(),null;b=p(b)}c=B(a,b,c);if(v.failed())return null;v.popthenPush(4,c);return null},setInterpreter:function(a){v=a;a=1==v.majorVersion();return!1===a?!1:a=11<=v.minorVersion()},primNormalize:function(){v.success(v.isKindOfInteger(v.stackValue(0)));var a=v.stackValue(0);
if(v.failed())return null;if("number"===typeof a){if(v.failed())return null;v.popthenPush(2,a);return null}a=H(a);if(v.failed())return null;v.popthenPush(2,a);return null},primDigitBitXor:function(){v.success(v.isKindOfInteger(v.stackValue(0)));var a=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));var b=v.stackValue(1);if(v.failed())return null;b=u(b,a,2);if(v.failed())return null;v.popthenPush(2,b);return null},primDigitCompareWith:function(){v.success(v.isKindOfInteger(v.stackValue(1)));
var a=v.stackValue(1);v.success(v.isKindOfInteger(v.stackValue(0)));var b=v.stackValue(0);if(v.failed())return null;a="number"===typeof a?"number"===typeof b?a>b?1:a<b?-1:0:-1:"number"===typeof b?1:A(a,b);if(v.failed())return null;v.popthenPush(3,a);return null},primDigitAdd:function(){v.success(v.isKindOfInteger(v.stackValue(0)));var a=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));var b=v.stackValue(1);if(v.failed())return null;b="number"===typeof b?p(b):b;a="number"===typeof a?p(a):
a;b=q(b,a);if(v.failed())return null;v.popthenPush(2,b);return null},getModuleName:function(){return"LargeIntegers v1.5 (e)"},primAsLargeInteger:function(){v.success(v.isKindOfInteger(v.stackValue(0)));var a=v.stackValue(0);if(v.failed())return null;"number"===typeof a&&(a=p(a));if(v.failed())return null;v.popthenPush(2,a);return null},primAnyBitFromTo:function(){var a=v.stackIntegerValue(1);var b=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(2)));var c=v.stackValue(2);if(v.failed())return null;
c="number"===typeof c?p(c):c;a=e(c,a,b)?v.trueObject():v.falseObject();if(v.failed())return null;v.popthenPush(3,a);return null}})});module("users.bert.SqueakJS.plugins.Matrix2x3Plugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return"number"===typeof a?d.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(b){return d.failed()?null:d.isWords(b)&&6===a(b)?b.wordsAsFloat32Array():(d.primitiveFail(),null)}function c(a){if(d.failed())return null;if(l(a)!==d.classPoint())return d.primitiveFail();var b=d.fetchPointerofObject(0,
a);var c="number"===typeof b;if(!c&&!b.isFloat)return d.primitiveFail();n=c?b:d.floatValueOf(b);b=d.fetchPointerofObject(1,a);c="number"===typeof b;if(!c&&!b.isFloat)return d.primitiveFail();k=c?b:d.floatValueOf(b)}function e(a){var b=n-a[2];var c=k-a[5];var e=a[0]*a[4]-a[1]*a[3];if(0===e)return d.primitiveFail();e=1/e;var f=b*a[4]-a[1]*c;a=a[0]*c-b*a[3];y=f*e;w=a*e}function g(a){y=n*a[0]+k*a[1]+a[2];w=n*a[3]+k*a[4]+a[5]}function h(a){y+=.5;w+=.5;if(!(-1073741824<=y&&1073741823>=y&&-1073741824<=w&&
1073741823>=y))return d.primitiveFail();d.popthenPush(a,d.makePointwithxValueyValue(y|0,w|0))}function f(a,b,c,e,f){b+=.5;if(!(-1073741824<=b&&1073741823>=y))return d.primitiveFail();e+=.5;if(!(-1073741824<=e&&1073741823>=y))return d.primitiveFail();c+=.5;if(!(-1073741824<=c&&1073741823>=y))return d.primitiveFail();f+=.5;if(!(-1073741824<=f&&1073741823>=y))return d.primitiveFail();d.pushRemappableOop(a);a=d.makePointwithxValueyValue(b|0,c|0);d.pushRemappableOop(a);f=d.makePointwithxValueyValue(e|
0,f|0);a=d.popRemappableOop();e=d.popRemappableOop();d.storePointerofObjectwithValue(0,e,a);d.storePointerofObjectwithValue(1,e,f);return e}var d=null,n=0,k=0,y=0,w=0;Squeak.registerExternalModule("Matrix2x3Plugin",{primitiveInvertPoint:function(){c(d.stackObjectValue(0));var a=b(d.stackObjectValue(1));if(d.failed())return null;e(a);d.failed()||h(2)},primitiveInvertRectInto:function(){var g,h;var m=d.stackObjectValue(0);var x=d.stackObjectValue(1);var q=b(d.stackObjectValue(2));if(d.failed())return null;
if(l(x)!==l(m)||!d.isPointers(x)||2!==a(x))return d.primitiveFail();c(d.fetchPointerofObject(0,x));if(d.failed())return null;var u=n;var A=k;e(q);var B=g=y;var D=h=w;c(d.fetchPointerofObject(1,x));if(d.failed())return null;x=n;var P=k;e(q);B=Math.min(B,y);g=Math.max(g,y);D=Math.min(D,w);h=Math.max(h,w);n=x;k=A;e(q);B=Math.min(B,y);g=Math.max(g,y);D=Math.min(D,w);h=Math.max(h,w);n=u;k=P;e(q);B=Math.min(B,y);g=Math.max(g,y);D=Math.min(D,w);h=Math.max(h,w);d.failed()||(m=f(m,B,D,g,h));d.failed()||d.popthenPush(3,
m)},primitiveIsIdentity:function(){var a=b(d.stackObjectValue(0));if(d.failed())return null;d.pop(1);d.pushBool(1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&1===a[4]&&0===a[5])},primitiveComposeMatrix:function(){var a;var c=b(a=d.stackObjectValue(0));var e=b(d.stackObjectValue(1));var f=b(d.stackObjectValue(2));if(d.failed())return null;var g=f[0]*e[0]+f[1]*e[3];var h=f[0]*e[1]+f[1]*e[4];var k=f[0]*e[2]+f[1]*e[5]+f[2];var l=f[3]*e[0]+f[4]*e[3];var n=f[3]*e[1]+f[4]*e[4];f=f[3]*e[2]+f[4]*e[5]+f[5];c[0]=
g;c[1]=h;c[2]=k;c[3]=l;c[4]=n;c[5]=f;d.popthenPush(3,a)},setInterpreter:function(a){d=a;a=1==d.majorVersion();return!1===a?!1:a=11<=d.minorVersion()},primitiveTransformRectInto:function(){var e,h;var m=d.stackObjectValue(0);var x=d.stackObjectValue(1);var q=b(d.stackObjectValue(2));if(d.failed())return null;if(l(x)!==l(m)||!d.isPointers(x)||2!==a(x))return d.primitiveFail();c(d.fetchPointerofObject(0,x));if(d.failed())return null;var u=n;var A=k;g(q);var B=e=y;var D=h=w;c(d.fetchPointerofObject(1,
x));if(d.failed())return null;x=n;var P=k;g(q);B=Math.min(B,y);e=Math.max(e,y);D=Math.min(D,w);h=Math.max(h,w);n=x;k=A;g(q);B=Math.min(B,y);e=Math.max(e,y);D=Math.min(D,w);h=Math.max(h,w);n=u;k=P;g(q);B=Math.min(B,y);e=Math.max(e,y);D=Math.min(D,w);h=Math.max(h,w);m=f(m,B,D,e,h);d.failed()||d.popthenPush(3,m)},primitiveIsPureTranslation:function(){var a=b(d.stackObjectValue(0));if(d.failed())return null;d.pop(1);d.pushBool(1===a[0]&&0===a[1]&&0===a[3]&&1===a[4])},getModuleName:function(){return"Matrix2x3Plugin 3 November 2014 (e)"},
primitiveTransformPoint:function(){c(d.stackObjectValue(0));var a=b(d.stackObjectValue(1));if(d.failed())return null;g(a);h(2)}})});module("users.bert.SqueakJS.plugins.MiscPrimitivePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a,b,g){var c;for(c=0;3>=c;c++){var e=8*(3-c);b[g+c-1]=(31<e?0:a>>>e)&255}return g+4}function a(a,b,g){if(223>=a)return b[g-1]=a,g+1;if(7935>=a)return b[g-1]=(a>>8)+224,b[g]=a-256*(Math.floor(a/256)|0)|0,g+2;b[g-1]=255;return l(a,b,g+1)}var b=null;Squeak.registerExternalModule("MiscPrimitivePlugin",{primitiveConvert8BitSigned:function(){var a;b.stackValue(2);var e=b.stackBytes(1);
var g=b.stackUint16Array(0);if(b.failed())return null;var h=e.length;for(a=1;a<=h;a++){var f=e[a-1];g[a-1]=127<f?f-256<<8:f<<8}if(b.failed())return null;b.pop(2)},primitiveCompareString:function(){var a;b.stackValue(3);var e=b.stackBytes(2);var g=b.stackBytes(1);var h=b.stackBytes(0);if(b.failed())return null;var f=e.length;var d=g.length;for(a=1;a<=Math.min(f,d);a++){var l=h[e[a-1]];var k=h[g[a-1]];if(l!==k){if(l<k){if(b.failed())return null;b.popthenPush(4,1)}else{if(b.failed())return null;b.popthenPush(4,
3)}return null}}if(f===d){if(b.failed())return null;b.popthenPush(4,2);return null}if(f<d){if(b.failed())return null;b.popthenPush(4,1)}else{if(b.failed())return null;b.popthenPush(4,3)}return null},primitiveTranslateStringWithTable:function(){b.stackValue(4);var a=b.stackBytes(3);var e=b.stackIntegerValue(2);var g=b.stackIntegerValue(1);var h=b.stackBytes(0);if(b.failed())return null;for(;e<=g;e++)a[e-1]=h[a[e-1]];if(b.failed())return null;b.pop(4)},primitiveStringHash:function(){var a;b.stackValue(2);
var e=b.stackBytes(1);var g=b.stackIntegerValue(0);if(b.failed())return null;var h=e.length;g&=268435455;for(a=1;a<=h;a++){g+=e[a-1];var f=g&16383;g=9741*f+16384*(9741*(g>>>14)+101*f&16383)&268435455}if(b.failed())return null;b.popthenPush(3,g);return null},primitiveCompressToByteArray:function(){var c,e;b.stackValue(2);var g=b.stackInt32Array(1);var h=b.stackBytes(0);if(b.failed())return null;var f=g.length;var d=a(f,h,1);for(e=1;e<=f;){var n=g[e-1];var k=n&255;var y=(n>>>8&255)===k&&(n>>>16&255)===
k&&(n>>>24&255)===k;for(c=e;c<f&&n===g[c];)++c;if(c>e)y?(d=a(4*(c-e+1)+1,h,d),h[d-1]=k,++d):(d=a(4*(c-e+1)+2,h,d),d=l(n,h,d)),e=c+1;else if(y)d=a(5,h,d),h[d-1]=k,++d,++e;else{for(;c<f&&g[c-1]!==g[c];)++c;c===f&&++c;d=a(4*(c-e)+3,h,d);for(y=e;y<=c-1;y++)d=l(g[y-1],h,d);e=c}}if(b.failed())return null;b.popthenPush(3,d-1);return null},primitiveFindSubstring:function(){var a;b.stackValue(4);var e=b.stackBytes(3);var g=b.stackBytes(2);var h=b.stackIntegerValue(1);var f=b.stackBytes(0);if(b.failed())return null;
if(0===e.length){if(b.failed())return null;b.popthenPush(5,0);return null}for(a=h;a<=g.length-e.length+1;a++)for(h=1;f[g[a+h-1-1]]===f[e[h-1]];){if(h===e.length){if(b.failed())return null;b.popthenPush(5,a);return null}++h}if(b.failed())return null;b.popthenPush(5,0);return null},primitiveIndexOfAsciiInString:function(){var a;b.stackValue(3);var e=b.stackIntegerValue(2);var g=b.stackBytes(1);var h=b.stackIntegerValue(0);if(b.failed())return null;for(a=g.length;h<=a;h++)if(g[h-1]===e){if(b.failed())return null;
b.popthenPush(4,h);return null}if(b.failed())return null;b.popthenPush(4,0);return null},setInterpreter:function(a){b=a;a=1==b.majorVersion();return!1===a?!1:a=11<=b.minorVersion()},primitiveDecompressFromByteArray:function(){var a,e;b.stackValue(3);var g=b.stackInt32Array(2);var h=b.stackBytes(1);var f=b.stackIntegerValue(0);if(b.failed())return null;var d=f;f=h.length;var l=1;for(e=g.length+1;d<=f;){var k=h[d-1];++d;if(!(223>=k))if(254>=k)k=256*(k-224)+h[d-1],++d;else for(k=0,a=1;4>=a;a++)k=(k<<
8)+h[d-1],++d;var y=k>>>2;if(l+y>e)return b.primitiveFail(),null;var w=k&3;0===w&&null;if(1===w)for(k=h[d-1],++d,k|=k<<8,k|=k<<16,a=1;a<=y;a++)g[l-1]=k,++l;if(2===w){k=0;for(a=1;4>=a;a++)k=k<<8|h[d-1],++d;for(a=1;a<=y;a++)g[l-1]=k,++l}if(3===w)for(w=1;w<=y;w++){k=0;for(a=1;4>=a;a++)k=k<<8|h[d-1],++d;g[l-1]=k;++l}}if(b.failed())return null;b.pop(3)},getModuleName:function(){return"MiscPrimitivePlugin 3 November 2014 (e)"},primitiveFindFirstInString:function(){var a;b.stackValue(3);var e=b.stackBytes(2);
var g=b.stackBytes(1);var h=b.stackIntegerValue(0);if(b.failed())return null;if(256!==g.length){if(b.failed())return null;b.popthenPush(4,0);return null}for(a=e.length;h<=a&&0===g[e[h-1]];)++h;if(h>a){if(b.failed())return null;b.popthenPush(4,0);return null}if(b.failed())return null;b.popthenPush(4,h);return null}})});module("users.bert.SqueakJS.plugins.ScratchPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){return Math.floor(a/b)|0}function b(b,c){return b-a(b,c)*c|0}function c(c,d,e,f,g){var h;var k=a(e,60);var p=b(e,60);e=(1E3-f)*g;var l=(1E3-a(f*p,60))*g;f=(1E3-a(f*(60-p),60))*g;g=a(1E3*g,3922);e=a(e,3922);l=a(l,3922);f=a(f,3922);0===k&&(h=(g<<16)+(f<<8)+e);1===k&&(h=(l<<16)+(g<<8)+
e);2===k&&(h=(e<<16)+(g<<8)+f);3===k&&(h=(e<<16)+(l<<8)+g);4===k&&(h=(f<<16)+(e<<8)+g);5===k&&(h=(g<<16)+(e<<8)+l);0===h&&(h=1);c[d]=h;return 0}function e(a){n.success(n.isWordsOrBytes(a));return n.failed()?0:a.wordsAsFloat64Array()}function g(a){n.success(n.isWords(a));return n.failed()?0:a.words}function h(b,c,d,e,f){e=f-e;if(0===e)return 0;b=b===f?a(60*(c-d),e):c===f?120+a(60*(d-b),e):240+a(60*(b-c),e);return 0>b?b+360:b}function f(a,b,c){if(0===a)return b;if(0===b)return a;var d=1024-c;a=(d*(a>>>
16&255)+c*(b>>>16&255)>>10<<16)+(d*(a>>>8&255)+c*(b>>>8&255)>>10<<8)+(d*(a&255)+c*(b&255)>>10);0===a&&(a=1);return a}function d(a,b,c,d,e){var g=b>>>10;if(-1>g||g>=d)return 0;var h=c>>>10;if(-1>h||h>=e)return 0;b&=1023;-1===g&&(b=g=0);g===d-1&&(b=0);c&=1023;-1===h&&(c=h=0);h===e-1&&(c=0);e=h*d+g;var k=a[e]&16777215;0<b&&(k=f(k,a[e+1]&16777215,b));if(0===c)return k;e=(h+1)*d+g;d=a[e]&16777215;0<b&&(d=f(d,a[e+1]&16777215,b));return f(k,d,c)}var n=null;Squeak.registerExternalModule("ScratchPlugin",{primitiveCondenseSound:function(){var b,
c=0,d=0;var e=n.stackValue(2);var f=n.stackValue(1);var g=n.stackIntegerValue(0);n.success(n.isWords(e));n.success(n.isWords(f));var h=a(2*l(e),g);var q=2*l(f);n.success(q>=h);if(n.failed())return null;e=e.wordsAsInt16Array();f=f.wordsAsInt16Array();for(q=1;q<=h;q++){var u=0;for(b=1;b<=g;b++){var A=e[c++];0>A&&(A=0-A);A>u&&(u=A)}f[d++]=u}n.pop(3);return 0},getModuleName:function(){return"ScratchPlugin 3 November 2014 (e)"},primitiveFisheye:function(){var b,c;var e=n.stackValue(3);var f=n.stackValue(2);
var h=n.stackIntegerValue(1);var m=n.stackIntegerValue(0);var x=g(e);var q=g(f);e=l(e);n.success(l(f)===e);if(n.failed())return null;a(e,h);var u=a(e,h);f=h>>1;e=u>>1;m/=100;for(b=0;b<=h-1;b++)for(c=0;c<=u-1;c++){var A=(b-f)/f;var B=(c-e)/e;var D=Math.pow(Math.sqrt(A*A+B*B),m);1>=D?(B=Math.atan2(B,A),A=1024*(f+D*Math.cos(B)*f)|0,D=1024*(e+D*Math.sin(B)*e)|0):(A=1024*b,D=1024*c);D=d(x,A,D,h,u);q[c*h+b]=D}n.pop(4);return 0},primitiveWaterRipples1:function(){var c,d;var f=n.stackValue(5);var h=n.stackValue(4);
var p=n.stackIntegerValue(3);var m=g(f);var x=g(h);var q=l(f);var u=n.stackIntegerValue(2);f=n.stackValue(1);var A=n.stackValue(0);f=e(f);A=e(A);n.success(l(h)===q);if(n.failed())return null;h=a(q,p);var B=Math.random();u=b(B,u)-1;for(q=0;q<=u/2-1;q++){B=Math.random();var D=b(B,p);B=Math.random();var P=b(B,h);B=Math.random();var O=b(B,8);for(c=-4;4>=c;c++)for(d=-4;4>=d;d++)if(B=c*c+d*d,25>B&&0<B){var F=D+c|0;var C=P+d|0;0<F&&0<C&&C<h&&F<p&&(f[C*p+F]=O*(1-B/25))}}for(q=1;q<=p-2;q++)for(u=1;u<=h-2;u++)D=
u*p+q,f[D]=(A[D+1]+A[D-1]+A[D+p]+A[D-p]+A[D-1-p]/2+A[D-1+p]/2+A[D+1-p]/2+A[D+1+p]/2)/4-f[D],f[D]*=.9;for(u=0;u<=p*h;u++)q=A[u],A[u]=f[u],f[u]=q;for(u=0;u<=h-1;u++)for(A=0;A<=p-1;A++)1<A&&A<p-1&&1<u&&u<h-1?(D=u*p+A,q=64*(f[D]-f[D-1]+(f[D+1]-f[D])),D=(f[D]-f[D-p]+(f[D+p]-f[D]))/64,2>q&&(q=-2),2<q&&(q=2),2>D&&(D=-2),2<D&&(D=2),q=(u+D)*p+(A+q)|0,q=q<p*h&&0<=q?m[q]:m[A+u*p]):q=m[A+u*p],x[A+u*p]=q;n.pop(6);return 0},primitiveHalfSizeDiagonal:function(){var a,b;var c=g(n.stackValue(11));var d=n.stackIntegerValue(10);
var e=n.stackIntegerValue(9);var f=g(n.stackValue(8));var h=n.stackIntegerValue(7);var l=n.stackIntegerValue(6);var u=n.stackIntegerValue(5);var A=n.stackIntegerValue(4);var B=n.stackIntegerValue(3);var D=n.stackIntegerValue(2);var P=n.stackIntegerValue(1);var O=n.stackIntegerValue(0);n.success(0<=u&&0<=A);n.success(u+2*P<=d);n.success(A+2*O<=e);n.success(0<=B&&0<=D);n.success(B+P<=h);n.success(D+O<=l);if(n.failed())return null;for(b=0;b<=O-1;b++){var F=d*(A+2*b)+u;e=h*(D+b)+B;for(a=0;a<=P-1;a++){var C=
c[F];var H=c[F+d+1];var I=(C&16711680)+(H&16711680)>>>1&16711680;l=(C&65280)+(H&65280)>>>1&65280;C=(C&255)+(H&255)>>>1;f[e]=I|l|C;F+=2;++e}}n.pop(12);return 0},primitiveScale:function(){var b,c;var d=n.stackValue(5);var e=n.stackIntegerValue(4);var f=n.stackIntegerValue(3);var h=n.stackValue(2);var x=n.stackIntegerValue(1);var q=n.stackIntegerValue(0);n.success(l(d)===e*f);n.success(l(h)===x*q);d=g(d);var u=g(h);if(n.failed())return null;var A=0;var B=a(1024*e,x);var D=a(1024*f,q);for(c=0;c<=q-1;c++){for(b=
h=0;b<=x-1;b++){var P=(1024-(h&1023))*(1024-(A&1023));var O=(h&1023)*(1024-(A&1023));var F=(1024-(h&1023))*(A&1023);var C=(h&1023)*(A&1023);var H=(A>>>10)*e+(h>>>10);var I=d[H];var M=h>>>10<e-1?d[H+1]:I;A>>>10<f-1&&(H+=e);var v=d[H];var N=h>>>10<e-1?d[H+1]:v;H=0;0===I&&(I=M,H+=P);0===M&&(M=I,H+=O);0===v&&(v=N,H+=F);0===N&&(N=v,H+=C);0===I&&(I=v,M=N);0===v&&(v=I,N=M);var G=0;5E5>H&&(H=P*(I>>>16&255)+O*(M>>>16&255)+F*(v>>>16&255)+C*(N>>>16&255),G=(H>>>20&255)<<16,H=P*(I>>>8&255)+O*(M>>>8&255)+F*(v>>>
8&255)+C*(N>>>8&255),G|=(H>>>20&255)<<8,H=P*(I&255)+O*(M&255)+F*(v&255)+C*(N&255),G|=H>>>20&255,0===G&&(G=1));u[c*x+b]=G;h+=B}A+=D}n.pop(6);return 0},primitiveDoubleSize:function(){var a,b;var c=n.stackValue(7);var d=n.stackIntegerValue(6);var e=n.stackIntegerValue(5);var f=n.stackValue(4);var h=n.stackIntegerValue(3);var l=n.stackIntegerValue(2);var u=n.stackIntegerValue(1);var A=n.stackIntegerValue(0);c=g(c);f=g(f);n.success(u+2*d<h);n.success(A+2*e<l);if(n.failed())return null;for(b=0;b<=e-1;b++)for(l=
(A+2*b)*h+u,a=0;a<=d-1;a++){var B=c[a+b*d];var D=l+2*a;f[D]=B;f[D+1]=B;f[D+h]=B;f[D+h+1]=B}n.pop(8);return 0},setInterpreter:function(a){n=a;a=1==n.majorVersion();return!1===a?!1:a=11<=n.minorVersion()},primitiveWhirl:function(){var b,c;var e=n.stackValue(3);var f=n.stackValue(2);var h=n.stackIntegerValue(1);var m=n.stackIntegerValue(0);var x=g(e);var q=g(f);e=l(e);n.success(l(f)===e);if(n.failed())return null;var u=a(e,h);f=h>>1;e=u>>1;if(f<e){var A=f;var B=e/f;var D=1}else A=e,B=1,D=e<f?f/e:1;var P=
-3.141592653589793*m/180;m=A*A;for(b=0;b<=h-1;b++)for(c=0;c<=u-1;c++){var O=B*(b-f);var F=D*(c-e);var C=O*O+F*F;if(C<m){C=1-Math.sqrt(C)/A;var H=P*C*C;C=Math.sin(H);H=Math.cos(H);O=d(x,1024*((H*O-C*F)/B+f)|0,1024*((C*O+H*F)/D+e)|0,h,u);q[h*c+b]=O}}n.pop(4);return 0},primitiveBlur:function(){var b,c,d,e,f,h;var x=n.stackValue(2);var q=n.stackValue(1);var u=n.stackIntegerValue(0);var A=g(x);var B=g(q);x=l(x);n.success(l(q)===x);if(n.failed())return null;q=a(x,u);for(h=1;h<=q-2;h++)for(x=1;x<=u-2;x++){var D=
f=e=b=0;for(d=-1;1>=d;d++)for(c=-1;1>=c;c++){var P=A[(h+d)*u+(x+c)]&16777215;0!==P&&(f+=P>>>16&255,e+=P>>>8&255,b+=P&255,++D)}b=0===D?0:(a(f,D)<<16)+(a(e,D)<<8)+a(b,D);B[h*u+x]=b}n.pop(3);return 0},primitiveBrightnessShift:function(){var b;var d=n.stackValue(2);var e=n.stackValue(1);var f=n.stackIntegerValue(0);var p=g(d);var m=l(d);d=g(e);n.success(l(e)===m);if(n.failed())return null;for(e=0;e<=m-1;e++){var x=p[e]&16777215;if(0!==x){var q=x>>>16&255;var u=x>>>8&255;var A=x&255;x=b=q;u>x&&(x=u);A>
x&&(x=A);u<b&&(b=u);A<b&&(b=A);u=h(q,u,A,b,x);b=0===x?0:a(1E3*(x-b),x);x=a(1E3*x,255);x+=10*f;1E3<x&&(x=1E3);0>x&&(x=0);c(d,e,u,b,x)}}n.pop(3);return 0},primitiveHalfSizeAverage:function(){var a,b;var c=g(n.stackValue(11));var d=n.stackIntegerValue(10);var e=n.stackIntegerValue(9);var f=g(n.stackValue(8));var h=n.stackIntegerValue(7);var l=n.stackIntegerValue(6);var u=n.stackIntegerValue(5);var A=n.stackIntegerValue(4);var B=n.stackIntegerValue(3);var D=n.stackIntegerValue(2);var P=n.stackIntegerValue(1);
var O=n.stackIntegerValue(0);n.success(0<=u&&0<=A);n.success(u+2*P<=d);n.success(A+2*O<=e);n.success(0<=B&&0<=D);n.success(B+P<=h);n.success(D+O<=l);if(n.failed())return null;for(b=0;b<=O-1;b++){var F=d*(A+2*b)+u;l=h*(D+b)+B;for(a=0;a<=P-1;a++){var C=c[F];var H=C&16711680;var I=C&65280;e=C&255;C=c[F+1];H+=C&16711680;I+=C&65280;e+=C&255;C=c[F+d];H+=C&16711680;I+=C&65280;e+=C&255;C=c[F+d+1];H+=C&16711680;I+=C&65280;e+=C&255;f[l]=H>>>2&16711680|I>>>2&65280|e>>>2;F+=2;++l}}n.pop(12);return 0},primitiveSaturationShift:function(){var b;
var d=n.stackValue(2);var e=n.stackValue(1);var f=n.stackIntegerValue(0);var p=g(d);var m=l(d);d=g(e);n.success(l(e)===m);if(n.failed())return null;for(e=0;e<=m-1;e++){var x=p[e]&16777215;if(!(2>x)){var q=x>>>16&255;var u=x>>>8&255;var A=x&255;var B=b=q;u>B&&(B=u);A>B&&(B=A);u<b&&(b=u);A<b&&(b=A);x=a(1E3*B,255);var D=0===B?0:a(1E3*(B-b),B);0<D&&(u=h(q,u,A,b,B),D+=10*f,1E3<D&&(D=1E3),0>D&&(D=0),c(d,e,u,D,x))}}n.pop(3);return 0},primitiveHueShift:function(){var d;var e=n.stackValue(2);var f=n.stackValue(1);
var t=n.stackIntegerValue(0);var p=g(e);var m=l(e);e=g(f);n.success(l(f)===m);if(n.failed())return null;for(f=0;f<=m-1;f++){var x=p[f]&16777215;if(0!==x){var q=x>>>16&255;var u=x>>>8&255;var A=x&255;var B=d=q;u>B&&(B=u);A>B&&(B=A);u<d&&(d=u);A<d&&(d=A);x=a(1E3*B,255);var D=0===B?0:a(1E3*(B-d),B);110>x&&(x=110,D=1E3);90>D&&(D=90);u=110===x||90===D?0:h(q,u,A,d,B);u=b(u+t+36E7,360);c(e,f,u,D,x)}}n.pop(3);return 0},primitiveInterpolate:function(){var b=n.stackValue(3);var c=n.stackIntegerValue(2);var e=
n.stackIntegerValue(1);var f=n.stackIntegerValue(0);var h=g(b);b=l(b);if(n.failed())return null;h=d(h,e,f,c,a(b,c));n.pop(5);n.pushInteger(h);return 0},primitiveExtractChannel:function(){var a=0,b=0;var c=n.stackValue(2);var d=n.stackValue(1);var e=n.booleanValueOf(n.stackValue(0));n.success(n.isWords(c));n.success(n.isWords(d));var f=l(c);n.success(l(d)>=f>>1);if(n.failed())return null;c=c.wordsAsInt16Array();d=d.wordsAsInt16Array();e&&a++;for(e=1;e<=f;e++)d[b++]=c[a],a+=2;n.pop(3);return 0}})});function SocketPlugin(){return{getModuleName:function(){return"SocketPlugin (http-only)"},interpreterProxy:null,primHandler:null,handleCounter:0,needProxy:new Set,lastLookup:null,TCP_Socket_Type:0,Resolver_Uninitialized:0,Resolver_Ready:1,Resolver_Busy:2,Resolver_Error:3,Socket_InvalidSocket:-1,Socket_Unconnected:0,Socket_WaitingForConnection:1,Socket_Connected:2,Socket_OtherEndClosed:3,Socket_ThisEndClosed:4,setInterpreter:function(l){this.interpreterProxy=l;this.primHandler=this.interpreterProxy.vm.primHandler;
return!0},_newSocketHandle:function(l,a,b,c){var e=this;return{host:null,port:null,connSemaIndex:a,readSemaIndex:b,writeSemaIndex:c,sendBuffer:null,sendTimeout:null,response:null,responseReadUntil:0,responseReceived:!1,status:e.Socket_Unconnected,_signalSemaphore:function(a){0>=a||e.primHandler.signalSemaphoreWithIndex(a)},_signalConnSemaphore:function(){this._signalSemaphore(this.connSemaIndex)},_signalReadSemaphore:function(){this._signalSemaphore(this.readSemaIndex)},_signalWriteSemaphore:function(){this._signalSemaphore(this.writeSemaIndex)},
_otherEndClosed:function(){this.status=e.Socket_OtherEndClosed;this._signalConnSemaphore()},_hostAndPort:function(){return this.host+":"+this.port},_requestNeedsProxy:function(){return e.needProxy.has(this._hostAndPort())},_getURL:function(a,b){var c="";if(b||this._requestNeedsProxy())c+="object"===typeof SqueakJS&&SqueakJS.options.proxy||"https://crossorigin.me/";return c=443!==this.port?c+("http://"+this._hostAndPort()+a):c+("https://"+this.host+a)},_performRequest:function(){var a=(new TextDecoder("utf-8")).decode(this.sendBuffer).split("\r\n\r\n")[0].split("\n"),
b=a[0].split(" "),c=b[0];if("GET"!==c&&"PUT"!==c&&"POST"!==c)return this._otherEndClosed(),-1;b=b[1];for(var d=null,e=1;e<a.length;e++){var k=a[e];if(k.match(/Content-Length:/i)){d=parseInt(k.substr(16));e=this.sendBuffer.byteLength;d=this.sendBuffer.subarray(e-d,e);break}}window.fetch?this._performFetchAPIRequest(b,c,d,a):this._performXMLHTTPRequest(b,c,d,a)},_performFetchAPIRequest:function(a,b,c,d){for(var f=this,g={},h=1;h<d.length;h++){var l=d[h].split(":");2===l.length&&(g[l[0]]=l[1].trim())}"object"===
typeof SqueakJS&&SqueakJS.options.ajax&&(g["X-Requested-With"]="XMLHttpRequest");var t={method:b,headers:g,body:c,mode:"cors"};fetch(this._getURL(a),t).then(f._handleFetchAPIResponse.bind(f)).catch(function(g){var h=f._getURL(a,!0);console.warn("Retrying with CORS proxy: "+h);fetch(h,t).then(function(a){console.log("Success: "+h);f._handleFetchAPIResponse(a);e.needProxy.add(f._hostAndPort())}).catch(function(e){console.warn("Fetch API failed, retrying with XMLHttpRequest");f._performXMLHTTPRequest(a,
b,c,d)})})},_handleFetchAPIResponse:function(a){if(null===this.response){var b=["HTTP/1.0 ",a.status," ",a.statusText,"\r\n"];a.headers.forEach(function(a,c,e){b=b.concat([c,": ",a,"\r\n"])});b.push("\r\n");this.response=[(new TextEncoder("utf-8")).encode(b.join(""))]}this._readIncremental(a.body.getReader())},_readIncremental:function(a){var b=this;return a.read().then(function(c){if(c.done)b.responseReceived=!0;else return b.response.push(c.value),b._signalReadSemaphore(),b._readIncremental(a)})},
_performXMLHTTPRequest:function(a,b,c,d){for(var f=this,g,h=1;h<d.length;h++){var l=d[h];if(l.match(/Content-Type:/i)){g=encodeURIComponent(l.substr(14));break}}var t=new XMLHttpRequest;t.open(b,this._getURL(a));void 0!==g&&t.setRequestHeader("Content-type",g);"object"===typeof SqueakJS&&SqueakJS.options.ajax&&t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.responseType="arraybuffer";t.onload=function(a){f._handleXMLHTTPResponse(this)};t.onerror=function(d){var g=f._getURL(a,!0);console.warn("Retrying with CORS proxy: "+
g);d=new XMLHttpRequest;d.open(b,g);d.responseType=t.responseType;"object"===typeof SqueakJS&&SqueakJS.options.ajaxx&&d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.onload=function(a){console.log("Success: "+g);f._handleXMLHTTPResponse(this);e.needProxy.add(f._hostAndPort())};d.onerror=function(){f._otherEndClosed();console.error("Failed to download:\n"+g)};d.send(c)};t.send(c)},_handleXMLHTTPResponse:function(a){this.responseReceived=!0;var b=a.response;if(b){a=(new TextEncoder("utf-8")).encode("HTTP/1.0 "+
a.status+" "+a.statusText+"\r\n"+a.getAllResponseHeaders()+"\r\n");var c=new Uint8Array(a.byteLength+b.byteLength);c.set(a,0);c.set(new Uint8Array(b),a.byteLength);this.response=[c];this._signalReadSemaphore()}else this._otherEndClosed()},connect:function(a,b){this.host=a;this.port=b;this.status=e.Socket_Connected;this._signalConnSemaphore();this._signalWriteSemaphore()},close:function(){if(this.status==e.Socket_Connected||this.status==e.Socket_OtherEndClosed||this.status==e.Socket_WaitingForConnection)this.status=
e.Socket_Unconnected,this._signalConnSemaphore()},destroy:function(){this.status=e.Socket_InvalidSocket},dataAvailable:function(){if(this.status==e.Socket_InvalidSocket)return!1;if(this.status==e.Socket_Connected){if(this.response&&0<this.response.length)return this._signalReadSemaphore(),!0;this.responseSentCompletly&&(this.status=e.Socket_OtherEndClosed,this._signalConnSemaphore())}return!1},recv:function(a){if(null===this.response)return[];var b=this.response[0];if(b.length>a){var c=b.subarray(a);
c?this.response[0]=c:this.response.shift();b=b.subarray(0,a)}else this.response.shift();this.responseReceived&&0===this.response.length&&(this.responseSentCompletly=!0);return b},send:function(a,b,c){null!==this.sendTimeout&&window.clearTimeout(this.sendTimeout);this.lastSend=Date.now();a=a.bytes.subarray(b,c);null===this.sendBuffer?this.sendBuffer=a:(b=new Uint8Array(this.sendBuffer.byteLength+a.byteLength),b.set(this.sendBuffer,0),b.set(a,this.sendBuffer.byteLength),this.sendBuffer=b);this.sendTimeout=
setTimeout(this._performRequest.bind(this),50);return a.byteLength}}},primitiveHasSocketAccess:function(l){this.interpreterProxy.popthenPush(1,this.interpreterProxy.trueObject());return!0},primitiveInitializeNetwork:function(l){this.interpreterProxy.pop(1);return!0},primitiveResolverNameLookupResult:function(l){if(0!==l)return!1;null!==this.lastLookup?(l=this.primHandler.makeStString(this.lastLookup),this.lastLookup=null):l=this.interpreterProxy.nilObject();this.interpreterProxy.popthenPush(1,l);
return!0},primitiveResolverStartNameLookup:function(l){if(1!==l)return!1;this.lastLookup=this.interpreterProxy.stackValue(0).bytesAsString();this.interpreterProxy.popthenPush(1,this.interpreterProxy.nilObject());return!0},primitiveResolverStatus:function(l){this.interpreterProxy.popthenPush(1,this.Resolver_Ready);return!0},primitiveSocketConnectionStatus:function(l){if(1!==l)return!1;l=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===l)return!1;l=l.status;void 0===l&&(l=this.Socket_InvalidSocket);
this.interpreterProxy.popthenPush(1,l);return!0},primitiveSocketConnectToPort:function(l){if(3!==l)return!1;var a=this.interpreterProxy.stackObjectValue(2).handle;if(void 0===a)return!1;var b=this.interpreterProxy.stackObjectValue(1).bytesAsString(),c=this.interpreterProxy.stackIntegerValue(0);a.connect(b,c);this.interpreterProxy.popthenPush(l,this.interpreterProxy.nilObject());return!0},primitiveSocketCloseConnection:function(l){if(1!==l)return!1;l=this.interpreterProxy.stackObjectValue(0).handle;
if(void 0===l)return!1;l.close();this.interpreterProxy.popthenPush(1,this.interpreterProxy.nilObject());return!0},primitiveSocketCreate3Semaphores:function(l){if(7!==l)return!1;var a=this.interpreterProxy.stackIntegerValue(0),b=this.interpreterProxy.stackIntegerValue(1),c=this.interpreterProxy.stackIntegerValue(2),e=this.interpreterProxy.stackIntegerValue(3);if(this.interpreterProxy.stackIntegerValue(5)!==this.TCP_Socket_Type)return!1;var g="{SqueakJS Socket #"+ ++this.handleCounter+"}";g=this.primHandler.makeStString(g);
g.handle=this._newSocketHandle(e,c,b,a);this.interpreterProxy.popthenPush(l,g);return!0},primitiveSocketDestroy:function(l){if(1!==l)return!1;l=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===l)return!1;l.destroy();this.interpreterProxy.popthenPush(1,l.status);return!0},primitiveSocketReceiveDataAvailable:function(l){if(1!==l)return!1;l=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===l)return!1;var a=this.interpreterProxy.falseObject();l.dataAvailable()&&(a=this.interpreterProxy.trueObject());
this.interpreterProxy.popthenPush(1,a);return!0},primitiveSocketReceiveDataBufCount:function(l){if(4!==l)return!1;var a=this.interpreterProxy.stackObjectValue(3).handle;if(void 0===a)return!1;var b=this.interpreterProxy.stackObjectValue(2),c=this.interpreterProxy.stackIntegerValue(1)-1,e=this.interpreterProxy.stackIntegerValue(0);if(c+e>b.bytes.length)return!1;a=a.recv(e);b.bytes.set(a,c);this.interpreterProxy.popthenPush(l,a.length);return!0},primitiveSocketSendDataBufCount:function(l){if(4!==l)return!1;
l=this.interpreterProxy.stackObjectValue(3).handle;if(void 0===l)return!1;var a=this.interpreterProxy.stackObjectValue(2),b=this.interpreterProxy.stackIntegerValue(1)-1;if(0>b)return!1;var c=this.interpreterProxy.stackIntegerValue(0);c=b+c;if(c>a.length)return!1;l=l.send(a,b,c);this.interpreterProxy.popthenPush(1,l);return!0},primitiveSocketSendDone:function(l){if(1!==l)return!1;this.interpreterProxy.popthenPush(1,this.interpreterProxy.trueObject());return!0}}}
function registerSocketPlugin(){"object"===typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SocketPlugin",SocketPlugin()):window.setTimeout(registerSocketPlugin,100)}registerSocketPlugin();module("users.bert.SqueakJS.plugins.SoundGenerationPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a,c){return a-(Math.floor(a/c)|0)*c|0}var a=null;Squeak.registerExternalModule("SoundGenerationPlugin",{primitiveMixFMSound:function(){var b;var c=a.stackValue(5);var e=a.stackIntegerValue(4);var g=a.stackInt16Array(3);var h=a.stackIntegerValue(2);var f=a.stackIntegerValue(1);var d=a.stackIntegerValue(0);var n=a.fetchIntegerofObject(3,c);var k=a.fetchIntegerofObject(4,c);var y=
a.fetchIntegerofObject(5,c);var w=a.fetchIntegerofObject(7,c);var t=a.fetchInt16ArrayofObject(8,c);var p=a.fetchIntegerofObject(9,c);var m=a.fetchIntegerofObject(10,c);var x=a.fetchIntegerofObject(11,c);var q=a.fetchIntegerofObject(14,c);var u=a.fetchIntegerofObject(15,c);var A=a.fetchIntegerofObject(16,c);if(a.failed())return null;var B=0!==q&&0!==A;var D=h+e-1;for(b=h;b<=D;b++){h=n*t[m>>15]>>15;if(B){var P=q*t[u>>15];u=l(u+A,p);0>u&&(u+=p);m=l(m+x+P,p);0>m&&(m+=p)}else m=l(m+x,p);if(0<f){P=2*b-
1;var O=g[P-1]+(h*f>>15);32767<O&&(O=32767);-32767>O&&(O=-32767);g[P-1]=O}0<d&&(P=2*b,O=g[P-1]+(h*d>>15),32767<O&&(O=32767),-32767>O&&(O=-32767),g[P-1]=O);0!==k&&(n+=k,0<k&&n>=y||0>k&&n<=y)&&(n=y,k=0)}w-=e;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,c,n);a.storeIntegerofObjectwithValue(4,c,k);a.storeIntegerofObjectwithValue(7,c,w);a.storeIntegerofObjectwithValue(10,c,m);a.storeIntegerofObjectwithValue(15,c,u);a.pop(5)},primitiveMixSampledSound:function(){var b;var c=a.stackValue(5);
var e=a.stackIntegerValue(4);var g=a.stackInt16Array(3);var h=a.stackIntegerValue(2);var f=a.stackIntegerValue(1);var d=a.stackIntegerValue(0);var l=a.fetchIntegerofObject(3,c);var k=a.fetchIntegerofObject(4,c);var y=a.fetchIntegerofObject(5,c);var w=a.fetchIntegerofObject(7,c);var t=a.fetchInt16ArrayofObject(8,c);var p=a.fetchIntegerofObject(10,c);var m=a.fetchIntegerofObject(11,c);var x=a.fetchIntegerofObject(12,c);var q=a.fetchIntegerofObject(13,c);if(a.failed())return null;var u=h+e-1;for(b=x+
(m>>>16);b<=p&&h<=u;){var A=t[b-1]*l>>15;if(0<f){b=2*h-1;var B=g[b-1]+(A*f>>15);32767<B&&(B=32767);-32767>B&&(B=-32767);g[b-1]=B}0<d&&(b=2*h,B=g[b-1]+(A*d>>15),32767<B&&(B=32767),-32767>B&&(B=-32767),g[b-1]=B);0!==k&&(l+=k,0<k&&l>=y||0>k&&l<=y)&&(l=y,k=0);m+=q;536870912<=m&&(b=m>>>16,x+=b,m-=b<<16);b=x+(m>>>16);++h}w-=e;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,c,l);a.storeIntegerofObjectwithValue(4,c,k);a.storeIntegerofObjectwithValue(7,c,w);a.storeIntegerofObjectwithValue(11,c,
m);a.storeIntegerofObjectwithValue(12,c,x);a.pop(5)},setInterpreter:function(b){a=b;b=1==a.majorVersion();return!1===b?!1:b=11<=a.minorVersion()},getModuleName:function(){return"SoundGenerationPlugin 3 November 2014 (e)"},primitiveApplyReverb:function(){var b,c,e;var g=a.stackValue(3);var h=a.stackInt16Array(2);var f=a.stackIntegerValue(1);var d=a.stackIntegerValue(0);var n=a.fetchInt32ArrayofObject(7,g);var k=a.fetchInt32ArrayofObject(8,g);var y=a.fetchIntegerofObject(9,g);var w=a.fetchIntegerofObject(10,
g);var t=a.fetchIntegerofObject(11,g);var p=a.fetchInt16ArrayofObject(12,g);var m=a.fetchInt16ArrayofObject(13,g);if(a.failed())return null;for(c=f;c<=f+d-1;c++){var x=b=0;for(e=1;e<=y;e++){var q=t-n[e-1];1>q&&(q+=w);var u=k[e-1];x+=u*p[q-1];b+=u*m[q-1]}q=2*c-1;x=h[q-1]+(x>>15);32767<x&&(x=32767);-32767>x&&(x=-32767);h[q-1]=x;p[t-1]=x;++q;x=h[q-1]+(b>>15);32767<x&&(x=32767);-32767>x&&(x=-32767);h[q-1]=x;m[t-1]=x;t=l(t,w)+1}if(a.failed())return null;a.storeIntegerofObjectwithValue(11,g,t);a.pop(3)},
primitiveMixPluckedSound:function(){var b;var c=a.stackValue(5);var e=a.stackIntegerValue(4);var g=a.stackInt16Array(3);var h=a.stackIntegerValue(2);var f=a.stackIntegerValue(1);var d=a.stackIntegerValue(0);var l=a.fetchIntegerofObject(3,c);var k=a.fetchIntegerofObject(4,c);var y=a.fetchIntegerofObject(5,c);var w=a.fetchIntegerofObject(7,c);var t=a.fetchInt16ArrayofObject(8,c);var p=a.fetchIntegerofObject(9,c);var m=a.fetchIntegerofObject(10,c);var x=a.fetchIntegerofObject(11,c);if(a.failed())return null;
var q=h+e-1;for(b=p;h<=q;h++){p=b+m;p>=x&&(p=32768+(p-x));var u=t[(b>>15)-1]+t[(p>>15)-1]>>1;t[(b>>15)-1]=u;var A=u*l>>15;b=p;if(0<f){u=2*h-1;var B=g[u-1]+(A*f>>15);32767<B&&(B=32767);-32767>B&&(B=-32767);g[u-1]=B}0<d&&(u=2*h,B=g[u-1]+(A*d>>15),32767<B&&(B=32767),-32767>B&&(B=-32767),g[u-1]=B);0!==k&&(l+=k,0<k&&l>=y||0>k&&l<=y)&&(l=y,k=0)}w-=e;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,c,l);a.storeIntegerofObjectwithValue(4,c,k);a.storeIntegerofObjectwithValue(7,c,w);a.storeIntegerofObjectwithValue(9,
c,p);a.pop(5)},primitiveMixLoopedSampledSound:function(){var b,c,e;var g=a.stackValue(5);var h=a.stackIntegerValue(4);var f=a.stackInt16Array(3);var d=a.stackIntegerValue(2);var l=a.stackIntegerValue(1);var k=a.stackIntegerValue(0);var y=a.fetchIntegerofObject(3,g);var w=a.fetchIntegerofObject(4,g);var t=a.fetchIntegerofObject(5,g);var p=a.fetchIntegerofObject(7,g);var m=a.fetchIntegerofObject(8,g);var x=a.fetchInt16ArrayofObject(10,g);var q=a.fetchInt16ArrayofObject(11,g);var u=a.fetchIntegerofObject(16,
g);var A=a.fetchIntegerofObject(17,g);var B=a.fetchIntegerofObject(18,g);var D=a.fetchIntegerofObject(19,g);var P=a.fetchIntegerofObject(20,g);if(a.failed())return null;var O=x!==q;var F=l*y>>15;var C=k*y>>15;var H=2*d-1;var I=d+h-1;for(e=d;e<=I;e++){var M=(D+=P)>>9;M>A&&p>m&&(M=(D-=B)>>9);if((c=M+1)>u){if(M>u){p=0;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,g,y);a.storeIntegerofObjectwithValue(4,g,w);a.storeIntegerofObjectwithValue(7,g,p);a.storeIntegerofObjectwithValue(19,g,D);a.popthenPush(6,
null);return null}c=0===B?M:(D-B>>9)+1}var v=D&511;d=b=x[M-1]*(512-v)+x[c-1]*v>>9;O&&(d=q[M-1]*(512-v)+q[c-1]*v>>9);0<l&&(b=f[H-1]+(F*b>>15),32767<b&&(b=32767),-32767>b&&(b=-32767),f[H-1]=b);++H;0<k&&(b=f[H-1]+(C*d>>15),32767<b&&(b=32767),-32767>b&&(b=-32767),f[H-1]=b);++H;if(0!==w){y+=w;if(0<w&&y>=t||0>w&&y<=t)y=t,w=0;F=l*y>>15;C=k*y>>15}}p-=h;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,g,y);a.storeIntegerofObjectwithValue(4,g,w);a.storeIntegerofObjectwithValue(7,g,p);a.storeIntegerofObjectwithValue(19,
g,D);a.pop(5)}})});function SpeechPlugin(){return{getModuleName:function(){return"SpeechPlugin"},interpreterProxy:null,primHandler:null,voiceInput:null,semaphoreIndex:null,shouldListen:!1,recognition:null,synth:window.speechSynthesis,setInterpreter:function(l){this.interpreterProxy=l;this.primHandler=this.interpreterProxy.vm.primHandler;return!0},primitiveSpeak:function(l){if(1===l)var a=this.interpreterProxy.stackValue(0).bytesAsString();else if(2===l){a=this.interpreterProxy.stackValue(1).bytesAsString();var b=this.interpreterProxy.stackValue(0).bytesAsString();
var c=this.synth.getVoices().filter(function(a){return a.name===b})}else return!1;a=new SpeechSynthesisUtterance(a);c&&0<c.length&&(a.voice=c[0]);this.synth.speak(a);this.interpreterProxy.pop(l);return!0},primitiveRegisterSemaphore:function(l){if(1!==l)return!1;this.semaphoreIndex=this.interpreterProxy.stackIntegerValue(0);return!0},primitiveUnregisterSemaphore:function(l){if(0!==l)return!1;this.semaphoreIndex=null;return!0},primitiveGetLastRecognitionResult:function(l){if(0!==l||null===this.semaphoreIndex||
null===this.voiceInput)return!1;l=this.primHandler.makeStArray(this.voiceInput);this.voiceInput=[];this.interpreterProxy.popthenPush(1,l);return!0},primitiveStartListening:function(l){if(0!==l)return!1;this.recognition=new webkitSpeechRecognition;this.recognition.lang="en-US";this.recognition.interimResults=!0;this.recognition.onresult=this._onRecognitionResult.bind(this);this.recognition.onerror=function(a){console.log(a)};this.recognition.onend=function(a){this.shouldListen&&this.recognition.start()}.bind(this);
this.shouldListen=!0;this.recognition.start();return!0},_onRecognitionResult:function(l){this.voiceInput=[];for(var a=l.resultIndex;a<l.results.length;a++){for(var b=l.results[a],c=[b.isFinal,[]],e=0;e<b.length;e++){var g=b[e].transcript;Date.now();c[1].push([g,b[e].confidence])}0<c[1].length&&this.voiceInput.push(c)}null!==this.semaphoreIndex&&0<this.voiceInput.length&&this.primHandler.signalSemaphoreWithIndex(this.semaphoreIndex)},primitiveStopListening:function(l){if(0!==l)return!1;this.voiceInput=
[];this.recognition.stop();this.shouldListen=!1;return!0}}}function registerSpeechPlugin(){"object"===typeof Squeak&&Squeak.registerExternalModule?"webkitSpeechRecognition"in window?Squeak.registerExternalModule("SpeechPlugin",SpeechPlugin()):console.warn("SpeechPlugin: Web Speech API is not supported by this browser."):window.setTimeout(registerSpeechPlugin,100)}registerSpeechPlugin();function SqueakSSL(){return{getModuleName:function(){return"SqueakSSL (fake)"},interpreterProxy:null,primHandler:null,handleCounter:0,SQSSL_OK:0,SQSSL_NEED_MORE_DATA:-1,SQSSL_INVALID_STATE:-2,SQSSL_BUFFER_TOO_SMALL:-3,SQSSL_INPUT_TOO_LARGE:-4,SQSSL_GENERIC_ERROR:-5,SQSSL_OUT_OF_MEMORY:-6,SQSSL_PROP_VERSION:0,SQSSL_PROP_LOGLEVEL:1,SQSSL_PROP_SSLSTATE:2,SQSSL_PROP_CERTSTATE:3,SQSSL_PROP_PEERNAME:0,SQSSL_PROP_CERTNAME:1,SQSSL_PROP_SERVERNAME:2,setInterpreter:function(l){this.interpreterProxy=l;this.primHandler=
this.interpreterProxy.vm.primHandler;return!0},primitiveCreate:function(l){var a="{SqueakJS SSL #"+ ++this.handleCounter+"}";a=this.primHandler.makeStString(a);a.handle=!0;this.interpreterProxy.popthenPush(l,a);return!0},primitiveConnect:function(l){if(5!==l)return!1;this.interpreterProxy.popthenPush(l,0);return!0},primitiveDestroy:function(l){if(1!==l)return!1;this.interpreterProxy.popthenPush(1,1);return!0},primitiveGetIntProperty:function(l){if(2!==l||void 0===this.interpreterProxy.stackObjectValue(1).handle)return!1;
var a=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_CERTSTATE?this.SQSSL_OK:0;this.interpreterProxy.popthenPush(l,a);return!0},primitiveGetStringProperty:function(l){if(2!==l||void 0===this.interpreterProxy.stackObjectValue(1).handle)return!1;var a=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_PEERNAME?this.primHandler.makeStString("*"):this.interpreterProxy.nilObject();this.interpreterProxy.popthenPush(l,a);return!0},primitiveEncrypt:function(l){if(5!==l||void 0===this.interpreterProxy.stackObjectValue(4).handle)return!1;
var a=this.interpreterProxy.stackObjectValue(3);this.interpreterProxy.stackIntegerValue(2);var b=this.interpreterProxy.stackIntegerValue(1);this.interpreterProxy.stackObjectValue(0).bytes=a.bytes;this.interpreterProxy.popthenPush(l,b);return!0},primitiveDecrypt:function(l){if(5!==l||void 0===this.interpreterProxy.stackObjectValue(4).handle)return!1;var a=this.interpreterProxy.stackObjectValue(3);this.interpreterProxy.stackIntegerValue(2);var b=this.interpreterProxy.stackIntegerValue(1);this.interpreterProxy.stackObjectValue(0).bytes=
a.bytes;this.interpreterProxy.popthenPush(l,b);return!0}}}function registerSqueakSSL(){"object"===typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SqueakSSL",SqueakSSL()):window.setTimeout(registerSqueakSSL,100)}registerSqueakSSL();module("users.bert.SqueakJS.plugins.StarSqueakPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a){b.success(b.isWords(a));return b.failed()?0:a.words}var b=null;Squeak.registerExternalModule("StarSqueakPlugin",{primitiveDiffuseFromToWidthHeightDelta:function(){var c,e,g,h;var f=b.stackValue(4);var d=b.stackValue(3);var n=b.stackIntegerValue(2);var k=b.stackIntegerValue(1);var y=
b.stackIntegerValue(0);var w=a(f);var t=a(d);b.success(l(f)===l(d));b.success(l(f)===n*k);if(b.failed())return null;d=(2*y+1)*(2*y+1);for(g=0;g<=k-1;g++){var p=g-y;0>p&&(p=0);var m=g+y;m>=k&&(m=k-1);for(c=0;c<=n-1;c++){var x=c-y;0>x&&(x=0);f=c+y;f>=n&&(f=n-1);var q=0;for(h=p;h<=m;h++){var u=h*n;for(e=x;e<=f;e++)q+=w[u+e]}t[g*n+c]=Math.floor(q/d)|0}}b.pop(5)},primitiveEvaporateRate:function(){var c=b.stackValue(1);var e=b.stackIntegerValue(0);var g=a(c);var h=l(c);if(b.failed())return null;for(c=0;c<=
h-1;c++)g[c]=g[c]*e>>>10;b.pop(2)},setInterpreter:function(a){b=a;a=1==b.majorVersion();return!1===a?!1:a=11<=b.minorVersion()},primitiveMapFromToWidthHeightPatchSizeRgbFlagsShift:function(){var c,e,g;var h=b.stackValue(6);var f=b.stackValue(5);var d=b.stackIntegerValue(4);var n=b.stackIntegerValue(3);var k=b.stackIntegerValue(2);var y=b.stackIntegerValue(1);var w=b.stackIntegerValue(0);var t=a(h);var p=a(f);b.success(l(f)===d*n);b.success(l(f)===l(h)*k*k);if(b.failed())return null;f=0;0<(y&4)&&(f+=
65536);0<(y&2)&&(f+=256);0<(y&1)&&++f;y=-1;for(g=0;g<=(Math.floor(n/k)|0)-1;g++)for(h=0;h<=(Math.floor(d/k)|0)-1;h++){var m=t[++y];m=0>w?-31>w?0:m>>>0-w:31<w?0:m<<w;255<m&&(m=255);var x=0>=m?1:m*f;for(e=c=(g*d+h)*k;e<=c+(k-1)*d;e+=d)for(m=e;m<=e+k-1;m++)p[m]=x}b.pop(7)},getModuleName:function(){return"StarSqueakPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.ZipPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function l(a){return"number"===typeof a?t.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function c(a){for(a=l(a);!a.isNil&&7<=a.classInstSize();)a=a.superclass();if(a.isNil)return!1;m=a.classInstSize();return!0}function e(a,b,c,d,e){var f=b<<16|c;if(258<=
b)return f;c=G[(ba<<5^D[a+3-1])&32767];var g=a-c;if(!(0<g&&32768>g))return f;for(g=32768<a?a-32768:0;;){if(D[a+b]!==D[c+b]||D[a+b-1]!==D[c+b-1]||D[a]!==D[c])var h=0;else if(D[a+1]!==D[c+1])h=1;else for(h=2;258>h&&D[a+h]===D[c+h];)++h;a+h>Ka&&(h=Ka-a);3===h&&8192<a-c&&(h=2);if(h>b&&(f=h<<16|c,b=h,258<=b||b>e)||!(0<--d))return f;c=K[c&32767];if(c<=g)return f}}function g(a){ba=(ba<<5^D[a+3-1])&32767;var b=G[ba];G[ba]=a;K[a&32767]=b}function h(d){if(!(t.isPointers(d)&&15<=a(d)))return!1;var e=t.fetchPointerofObject(0,
d);if(!t.isBytes(e))return!1;if(0===m){if(!c(d))return!1;if(a(d)<m+5)return m=0,!1}D=e.bytes;P=b(e);Ka=t.fetchIntegerofObject(1,d);oa=t.fetchIntegerofObject(2,d);e=t.fetchPointerofObject(m+0,d);if(!t.isWords(e)||32768!==a(e))return!1;G=e.words;e=t.fetchPointerofObject(m+1,d);if(!t.isWords(e)||32768!==a(e))return!1;K=e.words;ba=t.fetchIntegerofObject(m+2,d);B=t.fetchIntegerofObject(m+3,d);e=t.fetchPointerofObject(m+5,d);if(!t.isBytes(e))return!1;T=a(e);R=e.bytes;e=t.fetchPointerofObject(m+6,d);if(!(t.isWords(e)&&
a(e)>=T))return!1;M=e.words;e=t.fetchPointerofObject(m+7,d);if(!t.isWords(e)||286!==a(e))return!1;L=e.words;e=t.fetchPointerofObject(m+8,d);if(!t.isWords(e)||30!==a(e))return!1;I=e.words;Q=t.fetchIntegerofObject(m+9,d);ca=t.fetchIntegerofObject(m+10,d);return!t.failed()}function f(d){if(0===m){if(!c(d))return!1;if(a(d)<m+3)return m=0,!1}if(!(t.isPointers(d)&&a(d)>=m+3))return!1;var e=t.fetchPointerofObject(0,d);if(!t.isBytes(e))return t.primitiveFail();D=e.bytes;P=b(e);Ka=t.fetchIntegerofObject(1,
d);oa=t.fetchIntegerofObject(2,d);u=t.fetchIntegerofObject(m+1,d);A=t.fetchIntegerofObject(m+2,d);return!t.failed()}function d(a,b){if(!(0<=b&&(31<a?0:1<<a)>b))return t.primitiveFail();u|=31<A?0:b<<A;for(A+=a;8<=A&&Ka<P;)D[Ka]=u&255,++Ka,u>>>=8,A-=8}function n(c,e,f,g){var h;var k=t.fetchPointerofObject(0,c);var m=t.fetchIntegerofObject(1,c);var l=t.fetchIntegerofObject(2,c);if(!(m<=l&&t.isBytes(k)&&l<=b(k)))return t.primitiveFail();var p=k.bytes;k=t.fetchPointerofObject(0,e);if(!(t.isWords(k)&&l<=
a(k)&&t.fetchIntegerofObject(1,e)===m&&t.fetchIntegerofObject(2,e)===l))return t.primitiveFail();var n=k.words;k=t.fetchPointerofObject(0,f);if(!t.isWords(k))return t.primitiveFail();var I=a(k);var w=k.words;k=t.fetchPointerofObject(1,f);if(!t.isWords(k)||I!==a(k))return t.primitiveFail();var u=k.words;k=t.fetchPointerofObject(0,g);if(!t.isWords(k))return t.primitiveFail();var A=a(k);f=k.words;k=t.fetchPointerofObject(1,g);if(!t.isWords(k)||A!==a(k))return t.primitiveFail();var y=k.words;d(0,0);for(h=
0;m<l&&Ka+4<P;){var F=p[m];k=n[m];++m;if(0===k){++h;if(!(F<I))return t.primitiveFail();d(w[F],u[F])}else{h=h+F+3;if(!(256>F))return t.primitiveFail();g=ua[F];if(!(g<I))return t.primitiveFail();d(w[g],u[g]);var L=N[g-257];0!==L&&(F-=q[g-257],d(L,F));--k;if(!(32768>k))return t.primitiveFail();g=256>k?H[k]:H[256+(k>>>7)];if(!(g<A))return t.primitiveFail();d(f[g],y[g]);L=v[g];0!==L&&(k-=x[g],d(L,k))}}if(t.failed())return null;t.storeIntegerofObjectwithValue(1,c,m);t.storeIntegerofObjectwithValue(1,e,
m);return h}function k(){if(Q===T)return!0;if(0!==(Q&4095)||10*ca<=Q)return!1;var a=Q-ca;return a<=ca?!1:4*a<=ca}function y(a,b){var c;var d=a[0]>>>24;if(16<d)return t.primitiveFail(),0;for(c=2;;){d=w(d);c=c+d-1;if(c>=b){t.primitiveFail();break}d=a[c];if(0===(d&1056964608))return d;c=d&65535;d=d>>>24&255;if(16<d){t.primitiveFail();break}}return 0}function w(a){for(var b;A<a;)b=va[++Ba],u+=31<A?0:b<<A,A+=8;b=u&(31<a?0:1<<a)-1;u=31<a?0:u>>>a;A-=a;return b}var t=null,p=0,m=0,x=[0,1,2,3,4,6,8,12,16,24,
32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],q=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],u=0,A=0,B=0,D=null,P=0,O=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,
1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,
2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,
3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,
906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,
4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],F=null,C=0,H=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,
10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,
15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,
27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29],I=null,M=null,v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,
11,12,12,13,13],N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],G=null,K=null,ba=0,aa=null,ha=0,Q=0,L=null,T=0,R=null,ca=0,ua=[257,258,259,260,261,262,263,264,265,265,266,266,267,267,268,268,269,269,269,269,270,270,270,270,271,271,271,271,272,272,272,272,273,273,273,273,273,273,273,273,274,274,274,274,274,274,274,274,275,275,275,275,275,275,275,275,276,276,276,276,276,276,276,276,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,278,278,278,278,278,278,278,278,278,278,
278,278,278,278,278,278,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,
283,283,283,283,283,283,283,283,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284],Ka=0,oa=0,va=null,wa=0,Ba=0,ta=0;Squeak.registerExternalModule("ZipPlugin",{primitiveZipSendBlock:function(){if(4!==t.methodArgumentCount())return t.primitiveFail();var b=t.stackObjectValue(0);var c=t.stackObjectValue(1);var d=t.stackObjectValue(2);var e=t.stackObjectValue(3);var g=t.stackObjectValue(4);if(t.failed())return null;if(!(f(g)&&
t.isPointers(b)&&2<=a(b)&&t.isPointers(c)&&2<=a(c)&&t.isPointers(e)&&3<=a(e)&&t.isPointers(d)&&3<=a(d)))return t.primitiveFail();d=n(e,d,c,b);t.failed()||(t.storeIntegerofObjectwithValue(1,g,Ka),t.storeIntegerofObjectwithValue(p+1,g,u),t.storeIntegerofObjectwithValue(p+2,g,A));t.failed()||(t.pop(5),t.pushInteger(d))},primitiveUpdateAdler32:function(){if(4!==t.methodArgumentCount())return t.primitiveFail();var a=t.stackObjectValue(0);var c=t.stackIntegerValue(1);var d=t.stackIntegerValue(2);var e=
t.positive32BitValueOf(t.stackValue(3));if(t.failed())return 0;if(!(t.isBytes(a)&&c>=d&&0<d))return t.primitiveFail();var f=b(a);if(!(c<=f))return t.primitiveFail();a=a.bytes;--d;--c;f=e&65535;for(e=e>>>16&65535;d<=c;d++){var g=a[d];f+=g;f=f-65521*(Math.floor(f/65521)|0)|0;e+=f;e=e-65521*(Math.floor(e/65521)|0)|0}t.popthenPush(5,t.positive32BitIntegerFor((e<<16)+f))},primitiveUpdateGZipCrc32:function(){if(4!==t.methodArgumentCount())return t.primitiveFail();var a=t.stackObjectValue(0);var c=t.stackIntegerValue(1);
var d=t.stackIntegerValue(2);var e=t.positive32BitValueOf(t.stackValue(3));if(t.failed())return 0;if(!(t.isBytes(a)&&c>=d&&0<d))return t.primitiveFail();var f=b(a);if(!(c<=f))return t.primitiveFail();a=a.bytes;--d;for(--c;d<=c;d++)e=O[(e^a[d])&255]^e>>>8;t.popthenPush(5,t.positive32BitIntegerFor(e))},primitiveDeflateUpdateHashTable:function(){var b;if(2!==t.methodArgumentCount())return t.primitiveFail();var c=t.stackIntegerValue(0);var d=t.stackObjectValue(1);if(t.failed())return null;if(!t.isWords(d))return t.primitiveFail();
var e=a(d);var f=d.wordsAsInt32Array();for(b=0;b<=e-1;b++)d=f[b],f[b]=d>=c?d-c:0;t.pop(2)},setInterpreter:function(a){t=a;a=1==t.majorVersion();return!1===a?!1:a=11<=t.minorVersion()},getModuleName:function(){return"ZipPlugin 3 November 2014 (e)"},primitiveDeflateBlock:function(){if(3!==t.methodArgumentCount())return t.primitiveFail();var a=t.stackIntegerValue(0);var b=t.stackIntegerValue(1);var c=t.stackIntegerValue(2);var d=t.stackObjectValue(3);if(t.failed())return null;if(!h(d))return t.primitiveFail();
a:{var f;if(B>c)b=!1;else if(Q>=T)b=!0;else{var l=!1;for(f=B;f<=c;){if(!l){var p=e(f,2,f,b,a);g(f);var q=p&65535;var n=p>>>16}p=e(f+1,n,q,b,a);var v=p&65535;var w=p>>>16;if(n>=w&&3<=n){l=n;v=f-q;R[Q]=l-3;M[Q]=v;L[ua[l-3]]++;I[257>v?H[v-1]:H[256+(v-1>>>7)]]++;++Q;++ca;p=Q===T||0===(Q&4095)&&k();for(l=1;l<=n-1;l++)g(++f);l=!1;++f}else p=D[f],R[Q]=p,M[Q]=0,L[p]++,++Q,p=Q===T||0===(Q&4095)&&k(),++f,f<=c&&!p&&(g(f),l=!0,q=v,n=w);if(p){B=f;b=!0;break a}}B=f;b=!1}}t.failed()||(t.storeIntegerofObjectwithValue(m+
2,d,ba),t.storeIntegerofObjectwithValue(m+3,d,B),t.storeIntegerofObjectwithValue(m+9,d,Q),t.storeIntegerofObjectwithValue(m+10,d,ca));t.failed()||(t.pop(4),t.pushBool(b))},primitiveInflateDecompressBlock:function(){if(2!==t.methodArgumentCount())return t.primitiveFail();var c=t.stackValue(0);if(!t.isWords(c))return t.primitiveFail();F=c.words;C=a(c);c=t.stackValue(1);if(!t.isWords(c))return t.primitiveFail();aa=c.words;ha=a(c);var d=t.stackValue(2);if(!t.isPointers(d))return t.primitiveFail();if(0===
p){for(c=l(d);!c.isNil&&13<=c.classInstSize();)c=c.superclass();c.isNil?c=!1:(p=c.classInstSize(),c=!0);if(!c)return t.primitiveFail();if(a(d)<p+8)return p=0,t.primitiveFail()}if(a(d)<p+8)return t.primitiveFail();oa=t.fetchIntegerofObject(2,d);ta=t.fetchIntegerofObject(p+0,d);u=t.fetchIntegerofObject(p+1,d);A=t.fetchIntegerofObject(p+2,d);Ba=t.fetchIntegerofObject(p+4,d);wa=t.fetchIntegerofObject(p+5,d);if(t.failed())return null;--oa;--Ba;--wa;c=t.fetchPointerofObject(0,d);if(!t.isBytes(c))return t.primitiveFail();
D=c.bytes;P=b(c);c=t.fetchPointerofObject(p+3,d);if(!t.isBytes(c))return t.primitiveFail();va=c.bytes;a:{var e;for(e=P-1;oa<e&&Ba<=wa;){var f=u;var g=A;var h=Ba;var k=y(aa,ha);if(256>k)D[++oa]=k;else{if(256===k){ta&=1;break a}var m=(k>>>16)-1;c=k&65535;0<m&&(c+=w(m));k=y(F,C);m=k>>>16;k&=65535;0<m&&(k+=w(m));if(oa+c>=e){u=f;A=g;Ba=h;break a}m=oa;g=oa-k;for(k=1;k<=c;k++)D[m+k]=D[g+k];oa+=c}}}t.failed()||(t.storeIntegerofObjectwithValue(2,d,oa+1),t.storeIntegerofObjectwithValue(p+0,d,ta),t.storeIntegerofObjectwithValue(p+
1,d,u),t.storeIntegerofObjectwithValue(p+2,d,A),t.storeIntegerofObjectwithValue(p+4,d,Ba+1),t.pop(2))}})});var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(l){if(null==l)return"";var a="",b=0;for(l=LZString.compress(l);b<2*l.length;){if(0==b%2){var c=l.charCodeAt(b/2)>>8;var e=l.charCodeAt(b/2)&255;var g=b/2+1<l.length?l.charCodeAt(b/2+1)>>8:NaN}else c=l.charCodeAt((b-1)/2)&255,(b+1)/2<l.length?(e=l.charCodeAt((b+1)/2)>>8,g=l.charCodeAt((b+1)/2)&255):e=g=NaN;b+=3;var h=c>>2;c=(c&3)<<4|e>>4;var f=(e&15)<<2|g>>6;var d=
g&63;isNaN(e)?f=d=64:isNaN(g)&&(d=64);a=a+LZString._keyStr.charAt(h)+LZString._keyStr.charAt(c)+LZString._keyStr.charAt(f)+LZString._keyStr.charAt(d)}return a},decompressFromBase64:function(l){if(null==l)return"";var a="",b=0,c=0,e=LZString._f;for(l=l.replace(/[^A-Za-z0-9\+\/=]/g,"");c<l.length;){var g=LZString._keyStr.indexOf(l.charAt(c++));var h=LZString._keyStr.indexOf(l.charAt(c++));var f=LZString._keyStr.indexOf(l.charAt(c++));var d=LZString._keyStr.indexOf(l.charAt(c++));g=g<<2|h>>4;h=(h&15)<<
4|f>>2;var n=(f&3)<<6|d;if(0==b%2){var k=g<<8;64!=f&&(a+=e(k|h));64!=d&&(k=n<<8)}else a+=e(k|g),64!=f&&(k=h<<8),64!=d&&(a+=e(k|n));b+=3}return LZString.decompress(a)},compressToUTF16:function(l){if(null==l)return"";var a="",b,c=0,e=LZString._f;l=LZString.compress(l);for(b=0;b<l.length;b++){var g=l.charCodeAt(b);switch(c++){case 0:a+=e((g>>1)+32);var h=(g&1)<<14;break;case 1:a+=e(h+(g>>2)+32);h=(g&3)<<13;break;case 2:a+=e(h+(g>>3)+32);h=(g&7)<<12;break;case 3:a+=e(h+(g>>4)+32);h=(g&15)<<11;break;case 4:a+=
e(h+(g>>5)+32);h=(g&31)<<10;break;case 5:a+=e(h+(g>>6)+32);h=(g&63)<<9;break;case 6:a+=e(h+(g>>7)+32);h=(g&127)<<8;break;case 7:a+=e(h+(g>>8)+32);h=(g&255)<<7;break;case 8:a+=e(h+(g>>9)+32);h=(g&511)<<6;break;case 9:a+=e(h+(g>>10)+32);h=(g&1023)<<5;break;case 10:a+=e(h+(g>>11)+32);h=(g&2047)<<4;break;case 11:a+=e(h+(g>>12)+32);h=(g&4095)<<3;break;case 12:a+=e(h+(g>>13)+32);h=(g&8191)<<2;break;case 13:a+=e(h+(g>>14)+32);h=(g&16383)<<1;break;case 14:a+=e(h+(g>>15)+32,(g&32767)+32),c=0}}return a+e(h+
32)},decompressFromUTF16:function(l){if(null==l)return"";for(var a="",b,c,e=0,g=0,h=LZString._f;g<l.length;){c=l.charCodeAt(g)-32;switch(e++){case 0:b=c<<1;break;case 1:a+=h(b|c>>14);b=(c&16383)<<2;break;case 2:a+=h(b|c>>13);b=(c&8191)<<3;break;case 3:a+=h(b|c>>12);b=(c&4095)<<4;break;case 4:a+=h(b|c>>11);b=(c&2047)<<5;break;case 5:a+=h(b|c>>10);b=(c&1023)<<6;break;case 6:a+=h(b|c>>9);b=(c&511)<<7;break;case 7:a+=h(b|c>>8);b=(c&255)<<8;break;case 8:a+=h(b|c>>7);b=(c&127)<<9;break;case 9:a+=h(b|c>>
6);b=(c&63)<<10;break;case 10:a+=h(b|c>>5);b=(c&31)<<11;break;case 11:a+=h(b|c>>4);b=(c&15)<<12;break;case 12:a+=h(b|c>>3);b=(c&7)<<13;break;case 13:a+=h(b|c>>2);b=(c&3)<<14;break;case 14:a+=h(b|c>>1);b=(c&1)<<15;break;case 15:a+=h(b|c),e=0}g++}return LZString.decompress(a)},compress:function(l){if(null==l)return"";var a,b={},c={},e="",g=2,h=3,f=2,d="",n=0,k=0,y,w=LZString._f;for(y=0;y<l.length;y+=1){var t=l.charAt(y);Object.prototype.hasOwnProperty.call(b,t)||(b[t]=h++,c[t]=!0);var p=e+t;if(Object.prototype.hasOwnProperty.call(b,
p))e=p;else{if(Object.prototype.hasOwnProperty.call(c,e)){if(256>e.charCodeAt(0)){for(a=0;a<f;a++)n<<=1,15==k?(k=0,d+=w(n),n=0):k++;var m=e.charCodeAt(0);for(a=0;8>a;a++)n=n<<1|m&1,15==k?(k=0,d+=w(n),n=0):k++,m>>=1}else{m=1;for(a=0;a<f;a++)n=n<<1|m,15==k?(k=0,d+=w(n),n=0):k++,m=0;m=e.charCodeAt(0);for(a=0;16>a;a++)n=n<<1|m&1,15==k?(k=0,d+=w(n),n=0):k++,m>>=1}g--;0==g&&(g=Math.pow(2,f),f++);delete c[e]}else for(m=b[e],a=0;a<f;a++)n=n<<1|m&1,15==k?(k=0,d+=w(n),n=0):k++,m>>=1;g--;0==g&&(g=Math.pow(2,
f),f++);b[p]=h++;e=String(t)}}if(""!==e){if(Object.prototype.hasOwnProperty.call(c,e)){if(256>e.charCodeAt(0)){for(a=0;a<f;a++)n<<=1,15==k?(k=0,d+=w(n),n=0):k++;m=e.charCodeAt(0);for(a=0;8>a;a++)n=n<<1|m&1,15==k?(k=0,d+=w(n),n=0):k++,m>>=1}else{m=1;for(a=0;a<f;a++)n=n<<1|m,15==k?(k=0,d+=w(n),n=0):k++,m=0;m=e.charCodeAt(0);for(a=0;16>a;a++)n=n<<1|m&1,15==k?(k=0,d+=w(n),n=0):k++,m>>=1}g--;0==g&&(g=Math.pow(2,f),f++);delete c[e]}else for(m=b[e],a=0;a<f;a++)n=n<<1|m&1,15==k?(k=0,d+=w(n),n=0):k++,m>>=
1;g--;0==g&&f++}m=2;for(a=0;a<f;a++)n=n<<1|m&1,15==k?(k=0,d+=w(n),n=0):k++,m>>=1;for(;;)if(n<<=1,15==k){d+=w(n);break}else k++;return d},decompress:function(l){if(null==l)return"";if(""==l)return null;var a=[],b=4,c=4,e=3,g,h,f,d=LZString._f,n=l.charCodeAt(0),k=32768,y=1;for(g=0;3>g;g+=1)a[g]=g;var w=0;var t=Math.pow(2,2);for(f=1;f!=t;){var p=n&k;k>>=1;0==k&&(k=32768,n=l.charCodeAt(y++));w|=(0<p?1:0)*f;f<<=1}switch(w){case 0:w=0;t=Math.pow(2,8);for(f=1;f!=t;)p=n&k,k>>=1,0==k&&(k=32768,n=l.charCodeAt(y++)),
w|=(0<p?1:0)*f,f<<=1;var m=d(w);break;case 1:w=0;t=Math.pow(2,16);for(f=1;f!=t;)p=n&k,k>>=1,0==k&&(k=32768,n=l.charCodeAt(y++)),w|=(0<p?1:0)*f,f<<=1;m=d(w);break;case 2:return""}for(h=g=a[3]=m;;){if(y>l.length)return"";w=0;t=Math.pow(2,e);for(f=1;f!=t;)p=n&k,k>>=1,0==k&&(k=32768,n=l.charCodeAt(y++)),w|=(0<p?1:0)*f,f<<=1;switch(m=w){case 0:w=0;t=Math.pow(2,8);for(f=1;f!=t;)p=n&k,k>>=1,0==k&&(k=32768,n=l.charCodeAt(y++)),w|=(0<p?1:0)*f,f<<=1;a[c++]=d(w);m=c-1;b--;break;case 1:w=0;t=Math.pow(2,16);for(f=
1;f!=t;)p=n&k,k>>=1,0==k&&(k=32768,n=l.charCodeAt(y++)),w|=(0<p?1:0)*f,f<<=1;a[c++]=d(w);m=c-1;b--;break;case 2:return g}0==b&&(b=Math.pow(2,e),e++);if(a[m])m=a[m];else if(m===c)m=h+h.charAt(0);else return null;g+=m;a[c++]=h+m.charAt(0);b--;h=m;0==b&&(b=Math.pow(2,e),e++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);/*
 JSZip - A Javascript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2014 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
 @overview es6-promise - a tiny implementation of Promises/A+.
 @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 @license   Licensed under MIT license
            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 @version   3.0.2
*/
(function(l){"object"===typeof exports&&"undefined"!==typeof module?module.exports=l():"function"===typeof define&&define.amd?define([],l):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).JSZip=l()})(function(){return function e(a,b,c){function g(d,f){if(!b[d]){if(!a[d]){var k="function"==typeof require&&require;if(!f&&k)return k(d,!0);if(h)return h(d,!0);f=Error("Cannot find module '"+d+"'");throw f.code="MODULE_NOT_FOUND",f;}f=b[d]={exports:{}};
a[d][0].call(f.exports,function(b){var c=a[d][1][b];return g(c?c:b)},f,f.exports,e,a,b,c)}return b[d].exports}for(var h="function"==typeof require&&require,f=0;f<c.length;f++)g(c[f]);return g}({1:[function(a,b,c){var e=a("./utils"),g=a("./support");c.encode=function(a){for(var b=[],c,g,h,y,w=0,t=a.length,p,m="string"!==e.getTypeOf(a);w<a.length;)p=t-w,m?(c=a[w++],g=w<t?a[w++]:0,h=w<t?a[w++]:0):(c=a.charCodeAt(w++),g=w<t?a.charCodeAt(w++):0,h=w<t?a.charCodeAt(w++):0),y=c>>2,c=(c&3)<<4|g>>4,g=1<p?(g&
15)<<2|h>>6:64,h=2<p?h&63:64,b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(y)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h));return b.join("")};c.decode=function(a){var b=0,c=0;a=a.replace(/[^A-Za-z0-9\+\/=]/g,"");var e=3*a.length/4;"="===a.charAt(a.length-1)&&e--;"="===a.charAt(a.length-
2)&&e--;var h;for(h=g.uint8array?new Uint8Array(e):Array(e);b<a.length;){var y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++));var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++));e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++));var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++));y=y<<2|w>>4;w=(w&15)<<4|e>>2;var p=(e&3)<<6|
t;h[c++]=y;64!==e&&(h[c++]=w);64!==t&&(h[c++]=p)}return h}},{"./support":27,"./utils":29}],2:[function(a,b,c){function e(a,b,c,d,e){this.compressedSize=a;this.uncompressedSize=b;this.crc32=c;this.compression=d;this.compressedContent=e}var g=a("./external"),h=a("./stream/DataWorker"),f=a("./stream/DataLengthProbe"),d=a("./stream/Crc32Probe");f=a("./stream/DataLengthProbe");e.prototype={getContentWorker:function(){var a=(new h(g.Promise.resolve(this.compressedContent))).pipe(this.compression.uncompressWorker()).pipe(new f("data_length")),
b=this;a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw Error("Bug : uncompressed data size mismatch");});return a},getCompressedWorker:function(){return(new h(g.Promise.resolve(this.compressedContent))).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};e.createWorkerFrom=function(a,b,c){return a.pipe(new d).pipe(new f("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new f("compressedSize")).withStreamInfo("compression",
b)};b.exports=e},{"./external":6,"./stream/Crc32Probe":22,"./stream/DataLengthProbe":23,"./stream/DataWorker":24}],3:[function(a,b,c){var e=a("./stream/GenericWorker");c.STORE={magic:"\x00\x00",compressWorker:function(a){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}};c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":25}],4:[function(a,b,c){var e=a("./utils"),g=function(){for(var a,b=[],c=0;256>c;c++){a=c;for(var e=0;8>e;e++)a=a&1?3988292384^
a>>>1:a>>>1;b[c]=a}return b}();b.exports=function(a,b){if("undefined"===typeof a||!a.length)return 0;if("string"!==e.getTypeOf(a)){var c=0+a.length;b=(b|0)^-1;for(var f=0;f<c;f++)b=b>>>8^g[(b^a[f])&255];return b^-1}c=0+a.length;b=(b|0)^-1;for(f=0;f<c;f++)b=b>>>8^g[(b^a.charCodeAt(f))&255];return b^-1}},{"./utils":29}],5:[function(a,b,c){c.base64=!1;c.binary=!1;c.dir=!1;c.createFolders=!0;c.date=null;c.compression=null;c.compressionOptions=null;c.comment=null;c.unixPermissions=null;c.dosPermissions=
null},{}],6:[function(a,b,c){a=a("es6-promise").Promise;b.exports={Promise:a}},{"es6-promise":37}],7:[function(a,b,c){function e(a,b){f.call(this,"FlateWorker/"+a);this._pako=new g[a]({raw:!0,level:b.level||-1});this.meta={};var c=this;this._pako.onData=function(a){c.push({data:a,meta:c.meta})}}b="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;var g=a("pako"),h=a("./utils"),f=a("./stream/GenericWorker"),d=b?"uint8array":"array";c.magic="\b\x00";
h.inherits(e,f);e.prototype.processChunk=function(a){this.meta=a.meta;this._pako.push(h.transformTo(d,a.data),!1)};e.prototype.flush=function(){f.prototype.flush.call(this);this._pako.push([],!0)};e.prototype.cleanUp=function(){f.prototype.cleanUp.call(this);this._pako=null};c.compressWorker=function(a){return new e("Deflate",a)};c.uncompressWorker=function(){return new e("Inflate",{})}},{"./stream/GenericWorker":25,"./utils":29,pako:38}],8:[function(a,b,c){function e(a,b,c,d){h.call(this,"ZipFileWorker");
this.bytesWritten=0;this.zipComment=b;this.zipPlatform=c;this.encodeFileName=d;this.streamFiles=a;this.accumulate=!1;this.contentBuffer=[];this.dirRecords=[];this.entriesCount=this.currentSourceOffset=0;this.currentFile=null;this._sources=[]}var g=a("../utils"),h=a("../stream/GenericWorker"),f=a("../utf8"),d=a("../crc32"),n=a("../signature"),k=function(a,b){var c="",d;for(d=0;d<b;d++)c+=String.fromCharCode(a&255),a>>>=8;return c},y=function(a,b,c,e,h,w){var m=a.file,p=a.compression,q=w!==f.utf8encode,
t=g.transformTo("string",w(m.name)),u=g.transformTo("string",f.utf8encode(m.name)),x=m.comment;w=g.transformTo("string",w(x));var y=g.transformTo("string",f.utf8encode(x)),H=u.length!==m.name.length,I=y.length!==x.length;x="";var M=m.dir;var v=m.date,N=0,G=0,K=0;if(!b||c)N=a.crc32,G=a.compressedSize,K=a.uncompressedSize;a=0;b&&(a|=8);q||!H&&!I||(a|=2048);b=0;M&&(b|=16);"UNIX"===h?(h=798,(q=m=m.unixPermissions)||(q=M?16893:33204),b|=(q&65535)<<16):(h=20,b|=(m.dosPermissions||0)&63);m=v.getUTCHours();
m=m<<6|v.getUTCMinutes();m=m<<5|v.getUTCSeconds()/2;M=v.getUTCFullYear()-1980;M=M<<4|v.getUTCMonth()+1;M=M<<5|v.getUTCDate();H&&(u=k(1,1)+k(d(t),4)+u,x+="up"+k(u.length,2)+u);I&&(u=k(1,1)+k(d(w),4)+y,x+="uc"+k(u.length,2)+u);u="\n\x00"+k(a,2);u+=p.magic;u+=k(m,2);u+=k(M,2);u+=k(N,4);u+=k(G,4);u+=k(K,4);u+=k(t.length,2);u+=k(x.length,2);p=n.LOCAL_FILE_HEADER+u+t+x;e=n.CENTRAL_FILE_HEADER+k(h,2)+u+k(w.length,2)+"\x00\x00\x00\x00"+k(b,4)+k(e,4)+t+x+w;return{fileRecord:p,dirRecord:e}},w=function(a){return n.DATA_DESCRIPTOR+
k(a.crc32,4)+k(a.compressedSize,4)+k(a.uncompressedSize,4)};g.inherits(e,h);e.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,h.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))};e.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten;this.currentFile=a.file.name;this.streamFiles&&!a.file.dir?(a=
y(a,this.streamFiles,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:a.fileRecord,meta:{percent:0}})):this.accumulate=!0};e.prototype.closedSource=function(a){this.accumulate=!1;var b=y(a,this.streamFiles,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(b.dirRecord);if(this.streamFiles&&!a.file.dir)this.push({data:w(a),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());
this.currentFile=null};e.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});b=this.dirRecords.length;var c=this.bytesWritten-a,d=g.transformTo("string",(0,this.encodeFileName)(this.zipComment));a=n.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+k(b,2)+k(b,2)+k(c,4)+k(a,4)+k(d.length,2)+d;this.push({data:a,meta:{percent:100}})};e.prototype.prepareNextSource=function(){this.previous=this._sources.shift();this.openedSource(this.previous.streamInfo);
this.isPaused?this.previous.pause():this.previous.resume()};e.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.closedSource(b.previous.streamInfo);b._sources.length?b.prepareNextSource():b.end()});a.on("error",function(a){b.error(a)});return this};e.prototype.resume=function(){if(!h.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&
!this._sources.length&&!this.generatedError)return this.end(),!0};e.prototype.error=function(a){var b=this._sources;if(!h.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(x){}return!0};e.prototype.lock=function(){h.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()};b.exports=e},{"../crc32":4,"../signature":20,"../stream/GenericWorker":25,"../utf8":28,"../utils":29}],9:[function(a,b,c){var e=a("../compressions"),g=a("./ZipFileWorker");
c.generateWorker=function(a,b,c){var d=new g(b.streamFiles,c,b.platform,b.encodeFileName),f=0;try{a.forEach(function(a,c){f++;var g=c.options.compression||b.compression,h=e[g];if(!h)throw Error(g+" is not a valid compression method !");g=c.dir;var k=c.date;c._compressWorker(h,c.options.compressionOptions||b.compressionOptions||{}).withStreamInfo("file",{name:a,dir:g,date:k,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(d)}),d.entriesCount=f}catch(y){d.error(y)}return d}},
{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,b,c){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={};this.comment=null;this.root="";this.clone=function(){var a=new e,b;for(b in this)"function"!==typeof this[b]&&(a[b]=this[b]);return a}}e.prototype=a("./object");e.prototype.loadAsync=a("./load");e.support=a("./support");e.defaults=a("./defaults");
e.loadAsync=function(a,b){return(new e).loadAsync(a,b)};e.external=a("./external");b.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":13,"./support":27}],11:[function(a,b,c){function e(a){return new h.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new n);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var g=a("./utils"),h=a("./external"),f=a("./utf8");g=a("./utils");
var d=a("./zipEntries"),n=a("./stream/Crc32Probe"),k=a("./nodejsUtils");b.exports=function(a,b){var c=this;b=g.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:f.utf8decode});return k.isNode&&k.isStream(a)?h.Promise.reject(Error("JSZip can't accept a stream when loading a zip file.")):g.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new d(b);c.load(a);return c}).then(function(a){var c=[h.Promise.resolve(a)];
a=a.files;if(b.checkCRC32)for(var d=0;d<a.length;d++)c.push(e(a[d]));return h.Promise.all(c)}).then(function(a){a=a.shift();for(var d=a.files,e=0;e<d.length;e++){var f=d[e];c.file(f.fileNameStr,f.decompressed,{binary:!0,optimizedBinaryString:!0,date:f.date,dir:f.dir,comment:f.fileCommentStr.length?f.fileCommentStr:null,unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions,createFolders:b.createFolders})}a.zipComment.length&&(c.comment=a.zipComment);return c})}},{"./external":6,"./nodejsUtils":12,
"./stream/Crc32Probe":22,"./utf8":28,"./utils":29,"./zipEntries":30}],12:[function(a,b,c){(function(a){b.exports={isNode:"undefined"!==typeof a,newBuffer:function(b,c){return new a(b,c)},isBuffer:function(b){return a.isBuffer(b)},isStream:function(a){return a&&"function"===typeof a.on&&"function"===typeof a.pause&&"function"===typeof a.resume}}}).call(this,"undefined"!==typeof Buffer?Buffer:void 0)},{}],13:[function(a,b,c){var e=a("./utf8"),g=a("./utils"),h=a("./stream/GenericWorker"),f=a("./stream/StreamHelper"),
d=a("./defaults"),n=a("./compressedObject"),k=a("./zipObject"),y=a("./generate"),w=a("./nodejsUtils"),t=a("./nodejs/NodejsStreamInputAdapter"),p=function(a,b,c){var e=g.getTypeOf(b);c=g.extend(c||{},d);c.date=c.date||new Date;null!==c.compression&&(c.compression=c.compression.toUpperCase());"string"===typeof c.unixPermissions&&(c.unixPermissions=parseInt(c.unixPermissions,8));c.unixPermissions&&c.unixPermissions&16384&&(c.dir=!0);c.dosPermissions&&c.dosPermissions&16&&(c.dir=!0);c.dir&&(a=m(a));var f;
if(f=c.createFolders){var p=a;"/"===p.slice(-1)&&(p=p.substring(0,p.length-1));f=p.lastIndexOf("/");f=p=0<f?p.substring(0,f):""}f&&x.call(this,p,!0);c.binary=!("string"===e&&!1===c.binary&&!1===c.base64);if(b instanceof n&&0===b.uncompressedSize||c.dir||!b||0===b.length)c.base64=!1,c.binary=!0,b="",c.compression="STORE";b=b instanceof n||b instanceof h?b:w.isNode&&w.isStream(b)?new t(a,b):g.prepareContent(a,b,c.binary,c.optimizedBinaryString,c.base64);c=new k(a,b,c);this.files[a]=c},m=function(a){"/"!==
a.slice(-1)&&(a+="/");return a},x=function(a,b){b="undefined"!==typeof b?b:d.createFolders;a=m(a);this.files[a]||p.call(this,a,null,{dir:!0,createFolders:b});return this.files[a]};b.exports={load:function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},forEach:function(a){var b,c;for(b in this.files)if(this.files.hasOwnProperty(b)){var d=this.files[b];(c=b.slice(this.root.length,b.length))&&b.slice(0,this.root.length)===this.root&&a(c,d)}},filter:function(a){var b=
[];this.forEach(function(c,d){a(c,d)&&b.push(d)});return b},file:function(a,b,c){if(1===arguments.length){if("[object RegExp]"===Object.prototype.toString.call(a)){var d=a;return this.filter(function(a,b){return!b.dir&&d.test(a)})}var e=this.files[this.root+a];return e&&!e.dir?e:null}a=this.root+a;p.call(this,a,b,c);return this},folder:function(a){if(!a)return this;if("[object RegExp]"===Object.prototype.toString.call(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=x.call(this,
this.root+a),c=this.clone();c.root=b.name;return c},remove:function(a){a=this.root+a;var b=this.files[a];b||("/"!==a.slice(-1)&&(a+="/"),b=this.files[a]);if(b&&!b.dir)delete this.files[a];else{b=this.filter(function(b,c){return c.name.slice(0,a.length)===a});for(var c=0;c<b.length;c++)delete this.files[b[c].name]}return this},generate:function(a){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},generateInternalStream:function(a){var b={};try{b=g.extend(a||
{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode});b.type=b.type.toLowerCase();b.compression=b.compression.toUpperCase();"binarystring"===b.type&&(b.type="string");if(!b.type)throw Error("No output type specified.");g.checkSupport(b.type);if("darwin"===a.platform||"freebsd"===a.platform||"linux"===a.platform||"sunos"===a.platform)a.platform="UNIX";"win32"===a.platform&&(a.platform="DOS");var c=
y.generateWorker(this,b,b.comment||this.comment||"")}catch(B){c=new h("error"),c.error(B)}return new f(c,b.type||"string",b.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){a=a||{};a.type||(a.type="nodebuffer");return this.generateInternalStream(a).toNodejsStream(b)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":35,"./nodejsUtils":12,"./stream/GenericWorker":25,"./stream/StreamHelper":26,
"./utf8":28,"./utils":29,"./zipObject":32}],14:[function(a,b,c){function e(a){g.call(this,a);for(var b=0;b<this.data.length;b++)a[b]&=255}var g=a("./DataReader");a("../utils").inherits(e,g);e.prototype.byteAt=function(a){return this.data[this.zero+a]};e.prototype.lastIndexOfSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),e=a.charCodeAt(2);a=a.charCodeAt(3);for(var g=this.length-4;0<=g;--g)if(this.data[g]===b&&this.data[g+1]===c&&this.data[g+2]===e&&this.data[g+3]===a)return g-this.zero;
return-1};e.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),e=a.charCodeAt(2);a=a.charCodeAt(3);var g=this.readData(4);return b===g[0]&&c===g[1]&&e===g[2]&&a===g[3]};e.prototype.readData=function(a){this.checkOffset(a);if(0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./DataReader":15}],15:[function(a,b,c){function e(a){this.data=a;this.length=a.length;this.zero=this.index=0}
var g=a("../utils");e.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||0>a)throw Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?");},setIndex:function(a){this.checkIndex(a);this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b=0,c;this.checkOffset(a);for(c=this.index+a-1;c>=this.index;c--)b=(b<<8)+this.byteAt(c);this.index+=a;return b},
readString:function(a){return g.transformTo("string",this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(a&31)<<1))}};b.exports=e},{"../utils":29}],16:[function(a,b,c){function e(a){g.call(this,a)}var g=a("./Uint8ArrayReader");a("../utils").inherits(e,g);e.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+
this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./Uint8ArrayReader":18}],17:[function(a,b,c){function e(a){g.call(this,a)}var g=a("./DataReader");a("../utils").inherits(e,g);e.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)};e.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero};e.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b};e.prototype.readData=function(a){this.checkOffset(a);
var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./DataReader":15}],18:[function(a,b,c){function e(a){g.call(this,a)}var g=a("./ArrayReader");a("../utils").inherits(e,g);e.prototype.readData=function(a){this.checkOffset(a);if(0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./ArrayReader":14}],19:[function(a,b,c){var e=a("../utils"),
g=a("../support"),h=a("./ArrayReader"),f=a("./StringReader"),d=a("./NodeBufferReader"),n=a("./Uint8ArrayReader");b.exports=function(a){var b=e.getTypeOf(a);e.checkSupport(b);return"string"!==b||g.uint8array?"nodebuffer"===b?new d(a):g.uint8array?new n(e.transformTo("uint8array",a)):new h(e.transformTo("array",a)):new f(a)}},{"../support":27,"../utils":29,"./ArrayReader":14,"./NodeBufferReader":16,"./StringReader":17,"./Uint8ArrayReader":18}],20:[function(a,b,c){c.LOCAL_FILE_HEADER="PK\u0003\u0004";
c.CENTRAL_FILE_HEADER="PK\u0001\u0002";c.CENTRAL_DIRECTORY_END="PK\u0005\u0006";c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\u0006\u0007";c.ZIP64_CENTRAL_DIRECTORY_END="PK\u0006\u0006";c.DATA_DESCRIPTOR="PK\u0007\b"},{}],21:[function(a,b,c){function e(a){g.call(this,"ConvertWorker to "+a);this.destType=a}var g=a("./GenericWorker"),h=a("../utils");h.inherits(e,g);e.prototype.processChunk=function(a){this.push({data:h.transformTo(this.destType,a.data),meta:a.meta})};b.exports=e},{"../utils":29,"./GenericWorker":25}],
22:[function(a,b,c){function e(){g.call(this,"Crc32Probe")}var g=a("./GenericWorker"),h=a("../crc32");a("../utils").inherits(e,g);e.prototype.processChunk=function(a){this.streamInfo.crc32=h(a.data,this.streamInfo.crc32||0);this.push(a)};b.exports=e},{"../crc32":4,"../utils":29,"./GenericWorker":25}],23:[function(a,b,c){function e(a){g.call(this,"DataLengthProbe for "+a);this.propName=a;this.withStreamInfo(a,0)}c=a("../utils");var g=a("./GenericWorker");c.inherits(e,g);e.prototype.processChunk=function(a){a&&
(this.streamInfo[this.propName]=(this.streamInfo[this.propName]||0)+a.data.length);g.prototype.processChunk.call(this,a)};b.exports=e},{"../utils":29,"./GenericWorker":25}],24:[function(a,b,c){function e(a){h.call(this,"DataWorker");var b=this;this.dataIsReady=!1;this.max=this.index=0;this.data=null;this.type="";this._tickScheduled=!1;a.then(function(a){b.dataIsReady=!0;b.data=a;b.max=a&&a.length||0;b.type=g.getTypeOf(a);b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var g=a("../utils"),
h=a("./GenericWorker");g.inherits(e,h);e.prototype.cleanUp=function(){h.prototype.cleanUp.call(this);this.data=null};e.prototype.resume=function(){if(!h.prototype.resume.call(this))return!1;!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,g.delay(this._tickAndRepeat,[],this));return!0};e.prototype._tickAndRepeat=function(){this._tickScheduled=!1;this.isPaused||this.isFinished||(this._tick(),this.isFinished||(g.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))};e.prototype._tick=
function(){if(this.isPaused||this.isFinished)return!1;var a=null,b=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case "string":a=this.data.substring(this.index,b);break;case "uint8array":a=this.data.subarray(this.index,b);break;case "array":case "nodebuffer":a=this.data.slice(this.index,b)}this.index=b;return this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})};b.exports=e},{"../utils":29,"./GenericWorker":25}],25:[function(a,b,c){function e(a){this.name=
a||"default";this.streamInfo={};this.generatedError=null;this.extraStreamInfo={};this.isPaused=!0;this.isLocked=this.isFinished=!1;this._listeners={data:[],end:[],error:[]};this.previous=null}e.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(g){this.emit("error",g)}return!0},error:function(a){if(this.isFinished)return!1;this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",
a),this.previous&&this.previous.error(a),this.cleanUp());return!0},on:function(a,b){this._listeners[a].push(b);return this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null;this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");
this.streamInfo=a.streamInfo;this.mergeStreamInfo();this.previous=a;var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.end()});a.on("error",function(a){b.error(a)});return this},pause:function(){if(this.isPaused||this.isFinished)return!1;this.isPaused=!0;this.previous&&this.previous.pause();return!0},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;this.generatedError&&(this.error(this.generatedError),a=!0);this.previous&&this.previous.resume();
return!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){this.extraStreamInfo[a]=b;this.mergeStreamInfo();return this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");this.isLocked=!0;this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?
this.previous+" -> "+a:a}};b.exports=e},{}],26:[function(a,b,c){(function(c){function e(a,b){var d,e=0,f=0;for(d=0;d<b.length;d++)f+=b[d].length;switch(a){case "string":return b.join("");case "array":return Array.prototype.concat.apply([],b);case "uint8array":a=new Uint8Array(f);for(d=0;d<b.length;d++)a.set(b[d],e),e+=b[d].length;return a;case "nodebuffer":return c.concat(b);default:throw Error("concat : unsupported type '"+a+"'");}}function h(a,b){return new t.Promise(function(c,f){var g=[],h=a._internalType,
k=a._outputType,m=a._mimeType;a.on("data",function(a,c){g.push(a);b&&b(c)}).on("error",function(a){g=[];f(a)}).on("end",function(){try{a:{var a=e(h,g);switch(k){case "blob":var b=d.newBlob(d.transformTo("arraybuffer",a),m);break a;case "base64":b=y.encode(a);break a;default:b=d.transformTo(k,a)}}c(b)}catch(F){f(F)}g=[]}).resume()})}function f(a,b,c){var e=b;switch(b){case "blob":case "arraybuffer":e="uint8array";break;case "base64":e="string"}try{this._internalType=e,this._outputType=b,this._mimeType=
c,d.checkSupport(e),this._worker=a.pipe(new n(e)),a.lock()}catch(u){this._worker=new k("error"),this._worker.error(u)}}var d=a("../utils"),n=a("./ConvertWorker"),k=a("./GenericWorker"),y=a("../base64"),w=a("../nodejs/NodejsStreamOutputAdapter"),t=a("../external");f.prototype={accumulate:function(a){return h(this,a)},on:function(a,b){var c=this;if("data"===a)this._worker.on(a,function(a){b.call(c,a.data,a.meta)});else this._worker.on(a,function(){d.delay(b,arguments,c)});return this},resume:function(){d.delay(this._worker.resume,
[],this._worker);return this},pause:function(){this._worker.pause();return this},toNodejsStream:function(a){d.checkSupport("nodestream");if("nodebuffer"!==this._outputType)throw Error(this._outputType+" is not supported by this method");return new w(this,{objectMode:"nodebuffer"!==this._outputType},a)}};b.exports=f}).call(this,"undefined"!==typeof Buffer?Buffer:void 0)},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":35,"../utils":29,"./ConvertWorker":21,"./GenericWorker":25}],
27:[function(a,b,c){b="undefined"!==typeof Buffer?Buffer:void 0;c.base64=!0;c.array=!0;c.string=!0;c.arraybuffer="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array;c.nodebuffer="undefined"!==typeof b;c.uint8array="undefined"!==typeof Uint8Array;if("undefined"===typeof ArrayBuffer)c.blob=!1;else{b=new ArrayBuffer(0);try{c.blob=0===(new Blob([b],{type:"application/zip"})).size}catch(g){try{var e=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);
e.append(b);c.blob=0===e.getBlob("application/zip").size}catch(h){c.blob=!1}}}c.nodestream=!!a("./nodejs/NodejsStreamOutputAdapter").prototype},{"./nodejs/NodejsStreamOutputAdapter":35}],28:[function(a,b,c){function e(){n.call(this,"utf-8 decode");this.leftOver=null}function g(){n.call(this,"utf-8 encode")}var h=a("./utils"),f=a("./support"),d=a("./nodejsUtils"),n=a("./stream/GenericWorker"),k=Array(256);for(a=0;256>a;a++)k[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;k[254]=k[254]=1;c.utf8encode=
function(a){if(f.nodebuffer)return d.newBuffer(a,"utf-8");var b,c,e=a.length,g=0;for(b=0;b<e;b++){var h=a.charCodeAt(b);if(55296===(h&64512)&&b+1<e){var k=a.charCodeAt(b+1);56320===(k&64512)&&(h=65536+(h-55296<<10)+(k-56320),b++)}g+=128>h?1:2048>h?2:65536>h?3:4}var n=f.uint8array?new Uint8Array(g):Array(g);for(b=c=0;c<g;b++)h=a.charCodeAt(b),55296===(h&64512)&&b+1<e&&(k=a.charCodeAt(b+1),56320===(k&64512)&&(h=65536+(h-55296<<10)+(k-56320),b++)),128>h?n[c++]=h:(2048>h?n[c++]=192|h>>>6:(65536>h?n[c++]=
224|h>>>12:(n[c++]=240|h>>>18,n[c++]=128|h>>>12&63),n[c++]=128|h>>>6&63),n[c++]=128|h&63);return n};c.utf8decode=function(a){if(f.nodebuffer)return h.transformTo("nodebuffer",a).toString("utf-8");a=h.transformTo(f.uint8array?"uint8array":"array",a);var b,c,d=a.length,e=Array(2*d);for(b=c=0;b<d;){var g=a[b++];if(128>g)e[c++]=g;else{var n=k[g];if(4<n)e[c++]=65533,b+=n-1;else{for(g&=2===n?31:3===n?15:7;1<n&&b<d;)g=g<<6|a[b++]&63,n--;1<n?e[c++]=65533:65536>g?e[c++]=g:(g-=65536,e[c++]=55296|g>>10&1023,
e[c++]=56320|g&1023)}}}e.length!==c&&(e.subarray?e=e.subarray(0,c):e.length=c);return h.applyFromCharCode(e)};h.inherits(e,n);e.prototype.processChunk=function(a){var b=h.transformTo(f.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(f.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length);b.set(this.leftOver,0);b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e;d=b.length;d>b.length&&(d=b.length);for(e=d-1;0<=e&&128===
(b[e]&192);)e--;d=0>e?d:0===e?d:e+k[b[e]]>d?e:d;e=b;d!==b.length&&(f.uint8array?(e=b.subarray(0,d),this.leftOver=b.subarray(d,b.length)):(e=b.slice(0,d),this.leftOver=b.slice(d,b.length)));this.push({data:c.utf8decode(e),meta:a.meta})};e.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)};c.Utf8DecodeWorker=e;h.inherits(g,n);g.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})};
c.Utf8EncodeWorker=g},{"./nodejsUtils":12,"./stream/GenericWorker":25,"./support":27,"./utils":29}],29:[function(a,b,c){function e(a){return a}function g(a,b){for(var c=0;c<a.length;++c)b[c]=a.charCodeAt(c)&255;return b}function h(a){var b=65536,d=c.getTypeOf(a),e=!0;"uint8array"===d?e=m.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=m.applyCanBeUsed.nodebuffer);if(e)for(;1<b;)try{return m.stringifyByChunk(a,d,b)}catch(D){b=Math.floor(b/2)}return m.stringifyByChar(a)}function f(a,b){for(var c=0;c<
a.length;c++)b[c]=a[c];return b}var d=a("./support"),n=a("./base64"),k=a("./nodejsUtils"),y=a("asap"),w=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(B){try{var d=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);d.append(a);return d.getBlob(b)}catch(D){throw Error("Bug : can't construct the Blob.");}}};try{var t=d.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(q){t=
!1}a=t;try{var p=d.nodebuffer&&1===String.fromCharCode.apply(null,k.newBuffer(1)).length}catch(q){p=!1}var m={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)"array"===b||"nodebuffer"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);
return b},applyCanBeUsed:{uint8array:a,nodebuffer:p}};c.applyFromCharCode=h;var x={};x.string={string:e,array:function(a){return g(a,Array(a.length))},arraybuffer:function(a){return x.string.uint8array(a).buffer},uint8array:function(a){return g(a,new Uint8Array(a.length))},nodebuffer:function(a){return g(a,k.newBuffer(a.length))}};x.array={string:h,array:e,arraybuffer:function(a){return(new Uint8Array(a)).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(a)}};
x.arraybuffer={string:function(a){return h(new Uint8Array(a))},array:function(a){return f(new Uint8Array(a),Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(new Uint8Array(a))}};x.uint8array={string:h,array:function(a){return f(a,Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return k.newBuffer(a)}};x.nodebuffer={string:h,array:function(a){return f(a,Array(a.length))},arraybuffer:function(a){return x.nodebuffer.uint8array(a).buffer},
uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:e};c.transformTo=function(a,b){b||(b="");if(!a)return b;c.checkSupport(a);var d=c.getTypeOf(b);return x[d][a](b)};c.getTypeOf=function(a){if("string"===typeof a)return"string";if("[object Array]"===Object.prototype.toString.call(a))return"array";if(d.nodebuffer&&k.isBuffer(a))return"nodebuffer";if(d.uint8array&&a instanceof Uint8Array)return"uint8array";if(d.arraybuffer&&a instanceof ArrayBuffer)return"arraybuffer"};c.checkSupport=
function(a){if(!d[a.toLowerCase()])throw Error(a+" is not supported by this platform");};c.MAX_VALUE_16BITS=65535;c.MAX_VALUE_32BITS=-1;c.pretty=function(a){var b="",c;for(c=0;c<(a||"").length;c++){var d=a.charCodeAt(c);b+="\\x"+(16>d?"0":"")+d.toString(16).toUpperCase()}return b};c.delay=function(a,b,c){y(function(){a.apply(c||null,b||[])})};c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c};c.extend=function(){var a={},b,c;for(b=0;b<arguments.length;b++)for(c in arguments[b])arguments[b].hasOwnProperty(c)&&
"undefined"===typeof a[c]&&(a[c]=arguments[b][c]);return a};c.prepareContent=function(a,b,e,f,h){var k=null;k=d.blob&&b instanceof Blob&&"undefined"!==typeof FileReader?new w.Promise(function(a,c){var d=new FileReader;d.onload=function(b){a(b.target.result)};d.onerror=function(a){c(a.target.error)};d.readAsArrayBuffer(b)}):w.Promise.resolve(b);return k.then(function(b){var k=c.getTypeOf(b);if(!k)return w.Promise.reject(Error("The data of '"+a+"' is in an unsupported format !"));"arraybuffer"===k?
b=c.transformTo("uint8array",b):"string"===k&&(h?b=n.decode(b):e&&!0!==f&&(k=d.uint8array?new Uint8Array(b.length):Array(b.length),b=g(b,k)));return b})}},{"./base64":1,"./external":6,"./nodejsUtils":12,"./support":27,asap:33}],30:[function(a,b,c){function e(a){this.files=[];this.loadOptions=a}var g=a("./reader/readerFor"),h=a("./utils"),f=a("./signature"),d=a("./zipEntry");a("./utf8");var n=a("./support");e.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=
4;var b=this.reader.readString(4);throw Error("Corrupted zip or bug : unexpected signature ("+h.pretty(b)+", expected "+h.pretty(a)+")");}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);a=this.reader.readString(4)===b;this.reader.setIndex(c);return a},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);
this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength);a=h.transformTo(n.uint8array?"uint8array":"array",a);this.zipComment=this.loadOptions.decodeFileName(a)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=
this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};for(var a=this.zip64EndOfCentralSize-44,b,c,d;0<a;)b=this.reader.readInt(2),c=this.reader.readInt(4),d=this.reader.readData(c),this.zip64ExtensibleData[b]={id:b,length:c,value:d}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=
this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(1<this.disksCount)throw Error("Multi-volumes zip are not supported");},readLocalFiles:function(){var a;for(a=0;a<this.files.length;a++){var b=this.files[a];this.reader.setIndex(b.localHeaderOffset);this.checkSignature(f.LOCAL_FILE_HEADER);b.readLocalPart(this.reader);b.handleUTF8();b.processAttributes()}},readCentralDir:function(){for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(f.CENTRAL_FILE_HEADER);){var a=
new d({zip64:this.zip64},this.loadOptions);a.readCentralPart(this.reader);this.files.push(a)}if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length);},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(f.CENTRAL_DIRECTORY_END);if(0>a){if(this.isSignature(0,f.LOCAL_FILE_HEADER))throw Error("Corrupted zip : can't find end of central directory");
throw Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html");}this.reader.setIndex(a);var b=a;this.checkSignature(f.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===h.MAX_VALUE_16BITS||this.diskWithCentralDirStart===h.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===h.MAX_VALUE_16BITS||this.centralDirRecords===h.MAX_VALUE_16BITS||this.centralDirSize===h.MAX_VALUE_32BITS||this.centralDirOffset===
h.MAX_VALUE_32BITS){this.zip64=!0;a=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(0>a)throw Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(a);this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();if(!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,f.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_END),
0>this.relativeOffsetEndOfZip64CentralDir))throw Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}a=this.centralDirOffset+this.centralDirSize;this.zip64&&(a=a+20+(12+this.zip64EndOfCentralSize));a=b-a;if(0<a)this.isSignature(b,f.CENTRAL_FILE_HEADER)||(this.reader.zero=a);else if(0>a)throw Error("Corrupted zip: missing "+Math.abs(a)+
" bytes.");},prepareReader:function(a){this.reader=g(a)},load:function(a){this.prepareReader(a);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};b.exports=e},{"./reader/readerFor":19,"./signature":20,"./support":27,"./utf8":28,"./utils":29,"./zipEntry":31}],31:[function(a,b,c){function e(a,b){this.options=a;this.loadOptions=b}var g=a("./reader/readerFor"),h=a("./utils"),f=a("./compressedObject"),d=a("./crc32"),n=a("./utf8"),k=a("./compressions"),y=a("./support");e.prototype={isEncrypted:function(){return 1===
(this.bitFlag&1)},useUTF8:function(){return 2048===(this.bitFlag&2048)},readLocalPart:function(a){a.skip(22);this.fileNameLength=a.readInt(2);var b=a.readInt(2);this.fileName=a.readData(this.fileNameLength);a.skip(b);if(-1===this.compressedSize||-1===this.uncompressedSize)throw Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");a:{b=this.compressionMethod;for(c in k)if(k.hasOwnProperty(c)&&k[c].magic===b){var c=
k[c];break a}c=null}if(null===c)throw Error("Corrupted zip : compression "+h.pretty(this.compressionMethod)+" unknown (inner file : "+h.transformTo("string",this.fileName)+")");this.decompressed=new f(this.compressedSize,this.uncompressedSize,this.crc32,c,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2);a.skip(2);this.bitFlag=a.readInt(2);this.compressionMethod=a.readString(2);this.date=a.readDate();this.crc32=a.readInt(4);this.compressedSize=a.readInt(4);
this.uncompressedSize=a.readInt(4);var b=a.readInt(2);this.extraFieldsLength=a.readInt(2);this.fileCommentLength=a.readInt(2);this.diskNumberStart=a.readInt(2);this.internalFileAttributes=a.readInt(2);this.externalFileAttributes=a.readInt(4);this.localHeaderOffset=a.readInt(4);if(this.isEncrypted())throw Error("Encrypted zip are not supported");a.skip(b);this.readExtraFields(a);this.parseZIP64ExtraField(a);this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.dosPermissions=
this.unixPermissions=null;var a=this.versionMadeBy>>8;this.dir=this.externalFileAttributes&16?!0:!1;0===a&&(this.dosPermissions=this.externalFileAttributes&63);3===a&&(this.unixPermissions=this.externalFileAttributes>>16&65535);this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){this.extraFields[1]&&(a=g(this.extraFields[1].value),this.uncompressedSize===h.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===h.MAX_VALUE_32BITS&&(this.compressedSize=
a.readInt(8)),this.localHeaderOffset===h.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===h.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4)))},readExtraFields:function(a){var b=a.index+this.extraFieldsLength;this.extraFields||(this.extraFields={});for(;a.index<b;){var c=a.readInt(2);var d=a.readInt(2);var e=a.readData(d);this.extraFields[c]={id:c,length:d,value:e}}},handleUTF8:function(){var a=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=
n.utf8decode(this.fileName),this.fileCommentStr=n.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();null!==b?this.fileNameStr=b:(b=h.transformTo(a,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(b));b=this.findExtraFieldUnicodeComment();null!==b?this.fileCommentStr=b:(a=h.transformTo(a,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(a))}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=g(a.value);return 1!==
b.readInt(1)||d(this.fileName)!==b.readInt(4)?null:n.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=g(a.value);return 1!==b.readInt(1)||d(this.fileComment)!==b.readInt(4)?null:n.utf8decode(b.readData(a.length-5))}return null}};b.exports=e},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":19,"./support":27,"./utf8":28,"./utils":29}],32:[function(a,b,c){var e=a("./stream/StreamHelper"),g=a("./stream/DataWorker"),
h=a("./utf8"),f=a("./compressedObject"),d=a("./stream/GenericWorker");a=function(a,b,c){this.name=a;this.dir=c.dir;this.date=c.date;this.comment=c.comment;this.unixPermissions=c.unixPermissions;this.dosPermissions=c.dosPermissions;this._data=b;this._dataBinary=c.binary;this.options={compression:c.compression,compressionOptions:c.compressionOptions}};a.prototype={internalStream:function(a){a=a.toLowerCase();var b="string"===a||"text"===a;if("binarystring"===a||"text"===a)a="string";var c=this._decompressWorker(),
d=!this._dataBinary;d&&!b&&(c=c.pipe(new h.Utf8EncodeWorker));!d&&b&&(c=c.pipe(new h.Utf8DecodeWorker));return new e(c,a,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof f&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();this._dataBinary||(c=c.pipe(new h.Utf8EncodeWorker));return f.createWorkerFrom(c,
a,b)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof d?this._data:new g(this._data)}};c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"];for(var n=function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},k=0;k<c.length;k++)a.prototype[c[k]]=n;b.exports=a},{"./compressedObject":2,"./stream/DataWorker":24,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28}],
33:[function(a,b,c){function e(a){var b=f.length?f.pop():new g;b.task=a;h(b)}function g(){this.task=null}var h=a("./raw"),f=[],d=[],n=h.makeRequestCallFromTimer(function(){if(d.length)throw d.shift();});b.exports=e;g.prototype.call=function(){try{this.task.call()}catch(k){if(e.onerror)e.onerror(k);else d.push(k),n()}finally{this.task=null,f[f.length]=this}}},{"./raw":34}],34:[function(a,b,c){(function(a){function c(a){n.length||w();n[n.length]=a}function e(){for(;k<n.length;){var a=k;k+=1;n[a].call();
if(1024<k){a=0;for(var b=n.length-k;a<b;a++)n[a]=n[a+k];n.length-=k;k=0}}k=n.length=0}function f(a){var b=1;a=new y(a);var c=document.createTextNode("");a.observe(c,{characterData:!0});return function(){b=-b;c.data=b}}function d(a){return function(){function b(){clearTimeout(c);clearInterval(d);a()}var c=setTimeout(b,0),d=setInterval(b,50)}}b.exports=c;var n=[],k=0,y=a.MutationObserver||a.WebKitMutationObserver;var w="function"===typeof y?f(e):d(e);c.requestFlush=w;c.makeRequestCallFromTimer=d}).call(this,
"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],35:[function(a,b,c){},{}],36:[function(a,b,c){function e(){n=!1;k.length?d=k.concat(d):y=-1;d.length&&g()}function g(){if(!n){var a=setTimeout(e);n=!0;for(var b=d.length;b;){k=d;for(d=[];++y<b;)k&&k[y].run();y=-1;b=d.length}k=null;n=!1;clearTimeout(a)}}function h(a,b){this.fun=a;this.array=b}function f(){}a=b.exports={};var d=[],n=!1,k,y=-1;a.nextTick=function(a){var b=Array(arguments.length-
1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];d.push(new h(a,b));1!==d.length||n||setTimeout(g,0)};h.prototype.run=function(){this.fun.apply(null,this.array)};a.title="browser";a.browser=!0;a.env={};a.argv=[];a.version="";a.versions={};a.on=f;a.addListener=f;a.once=f;a.off=f;a.removeListener=f;a.removeAllListeners=f;a.emit=f;a.binding=function(a){throw Error("process.binding is not supported");};a.cwd=function(){return"/"};a.chdir=function(a){throw Error("process.chdir is not supported");
};a.umask=function(){return 0}},{}],37:[function(a,b,c){(function(c,g){(function(){function e(a){return"function"===typeof a}function f(){return function(){c.nextTick(w)}}function d(){return function(){G(w)}}function n(){var a=0,b=new Q(w),c=document.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function k(){var a=new MessageChannel;a.port1.onmessage=w;return function(){a.port2.postMessage(0)}}function y(){return function(){setTimeout(w,1)}}function w(){for(var a=
0;a<N;a+=2)(0,T[a])(T[a+1]),T[a]=void 0,T[a+1]=void 0;N=0}function t(){try{var b=a("vertx");G=b.runOnLoop||b.runOnContext;return d()}catch(va){return y()}}function p(){}function m(a,b,c,d){try{a.call(b,c,d)}catch(ta){return ta}}function x(a,b,c){ba(function(a){var d=!1,e=m(c,b,function(c){d||(d=!0,b!==c?u(a,c):B(a,c))},function(b){d||(d=!0,D(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,D(a,e))},a)}function q(a,b){1===b._state?B(a,b._result):2===b._state?D(a,b._result):P(b,void 0,
function(b){u(a,b)},function(b){D(a,b)})}function u(a,b){if(a===b)D(a,new TypeError("You cannot resolve a promise with itself"));else if("function"===typeof b||"object"===typeof b&&null!==b)if(b.constructor===a.constructor)q(a,b);else{try{var c=b.then}catch(Ba){ca.error=Ba,c=ca}c===ca?D(a,ca.error):void 0===c?B(a,b):e(c)?x(a,b,c):B(a,b)}else B(a,b)}function A(a){a._onerror&&a._onerror(a._result);O(a)}function B(a,b){void 0===a._state&&(a._result=b,a._state=1,0!==a._subscribers.length&&ba(O,a))}function D(a,
b){void 0===a._state&&(a._state=2,a._result=b,ba(A,a))}function P(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null;e[f]=b;e[f+1]=c;e[f+2]=d;0===f&&a._state&&ba(O,a)}function O(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?C(c,d,e,f):e(f);a._subscribers.length=0}}function F(){this.error=null}function C(a,b,c,d){var f=e(c);if(f){try{var g=c(d)}catch(ib){ua.error=ib,g=ua}if(g===ua){var h=!0;var k=g.error;g=null}else var m=!0;
if(b===g){D(b,new TypeError("A promises callback cannot return that same promise."));return}}else g=d,m=!0;void 0===b._state&&(f&&m?u(b,g):h?D(b,k):1===a?B(b,g):2===a&&D(b,g))}function H(a,b){try{b(function(b){u(a,b)},function(b){D(a,b)})}catch(wa){D(a,wa)}}function I(a,b){this._instanceConstructor=a;this.promise=new a(p);this._validateInput(b)?(this._input=b,this._remaining=this.length=b.length,this._init(),0===this.length?B(this.promise,this._result):(this.length=this.length||0,this._enumerate(),
0===this._remaining&&B(this.promise,this._result))):D(this.promise,this._validationError())}function M(a){this._id=Ka++;this._result=this._state=void 0;this._subscribers=[];if(p!==a){if(!e(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof M))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");H(this,a)}}var v=Array.isArray?Array.isArray:
function(a){return"[object Array]"===Object.prototype.toString.call(a)},N=0,G,K,ba=function(a,b){T[N]=a;T[N+1]=b;N+=2;2===N&&(K?K(w):R())},aa="undefined"!==typeof window?window:void 0,ha=aa||{},Q=ha.MutationObserver||ha.WebKitMutationObserver;ha="undefined"!==typeof c&&"[object process]"==={}.toString.call(c);var L="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,T=Array(1E3);var R=ha?f():Q?n():L?k():void 0===aa&&"function"===typeof a?
t():y();var ca=new F,ua=new F;I.prototype._validateInput=function(a){return v(a)};I.prototype._validationError=function(){return Error("Array Methods must be provided an Array")};I.prototype._init=function(){this._result=Array(this.length)};I.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;void 0===b._state&&d<a;d++)this._eachEntry(c[d],d)};I.prototype._eachEntry=function(a,b){var c=this._instanceConstructor;"object"===typeof a&&null!==a?a.constructor===c&&void 0!==
a._state?(a._onerror=null,this._settledAt(a._state,b,a._result)):this._willSettleAt(c.resolve(a),b):(this._remaining--,this._result[b]=a)};I.prototype._settledAt=function(a,b,c){var d=this.promise;void 0===d._state&&(this._remaining--,2===a?D(d,c):this._result[b]=c);0===this._remaining&&B(d,this._result)};I.prototype._willSettleAt=function(a,b){var c=this;P(a,void 0,function(a){c._settledAt(1,b,a)},function(a){c._settledAt(2,b,a)})};var Ka=0;M.all=function(a){return(new I(this,a)).promise};M.race=
function(a){function b(a){u(d,a)}function c(a){D(d,a)}var d=new this(p);if(!v(a))return D(d,new TypeError("You must pass an array to race.")),d;for(var e=a.length,f=0;void 0===d._state&&f<e;f++)P(this.resolve(a[f]),void 0,b,c);return d};M.resolve=function(a){if(a&&"object"===typeof a&&a.constructor===this)return a;var b=new this(p);u(b,a);return b};M.reject=function(a){var b=new this(p);D(b,a);return b};M._setScheduler=function(a){K=a};M._setAsap=function(a){ba=a};M._asap=ba;M.prototype={constructor:M,
then:function(a,b){var c=this._state;if(1===c&&!a||2===c&&!b)return this;var d=new this.constructor(p),e=this._result;if(c){var f=arguments[c-1];ba(function(){C(c,d,f,e)})}else P(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}};aa=function(){if("undefined"!==typeof g)var a=g;else if("undefined"!==typeof self)a=self;else try{a=Function("return this")()}catch(wa){throw Error("polyfill failed because global object is unavailable in this environment");}var b=a.Promise;if(!b||"[object Promise]"!==
Object.prototype.toString.call(b.resolve())||b.cast)a.Promise=M};ha={Promise:M,polyfill:aa};"undefined"!==typeof b&&b.exports?b.exports=ha:"undefined"!==typeof this&&(this.ES6Promise=ha);aa()}).call(this)}).call(this,a("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{_process:36}],38:[function(a,b,c){c=a("./lib/utils/common").assign;var e=a("./lib/deflate"),g=a("./lib/inflate");a=a("./lib/zlib/constants");var h={};c(h,e,g,a);b.exports=
h},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(a,b,c){function e(a){if(!(this instanceof e))return new e(a);a=this.options=f.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},a||{});a.raw&&0<a.windowBits?a.windowBits=-a.windowBits:a.gzip&&0<a.windowBits&&16>a.windowBits&&(a.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new k;this.strm.avail_out=0;var b=h.deflateInit2(this.strm,
a.level,a.method,a.windowBits,a.memLevel,a.strategy);if(0!==b)throw Error(n[b]);a.header&&h.deflateSetHeader(this.strm,a.header);if(a.dictionary){a="string"===typeof a.dictionary?d.string2buf(a.dictionary):"[object ArrayBuffer]"===y.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary;b=h.deflateSetDictionary(this.strm,a);if(0!==b)throw Error(n[b]);this._dict_set=!0}}function g(a,b){b=new e(b);b.push(a,!0);if(b.err)throw b.msg;return b.result}var h=a("./zlib/deflate"),f=a("./utils/common"),
d=a("./utils/strings"),n=a("./zlib/messages"),k=a("./zlib/zstream"),y=Object.prototype.toString;e.prototype.push=function(a,b){var c=this.strm,e=this.options.chunkSize;if(this.ended)return!1;b=b===~~b?b:!0===b?4:0;"string"===typeof a?c.input=d.string2buf(a):"[object ArrayBuffer]"===y.call(a)?c.input=new Uint8Array(a):c.input=a;c.next_in=0;c.avail_in=c.input.length;do{0===c.avail_out&&(c.output=new f.Buf8(e),c.next_out=0,c.avail_out=e);a=h.deflate(c,b);if(1!==a&&0!==a)return this.onEnd(a),this.ended=
!0,!1;if(0===c.avail_out||0===c.avail_in&&(4===b||2===b))if("string"===this.options.to)this.onData(d.buf2binstring(f.shrinkBuf(c.output,c.next_out)));else this.onData(f.shrinkBuf(c.output,c.next_out))}while((0<c.avail_in||0===c.avail_out)&&1!==a);if(4===b)return a=h.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,0===a;2===b&&(this.onEnd(0),c.avail_out=0);return!0};e.prototype.onData=function(a){this.chunks.push(a)};e.prototype.onEnd=function(a){0===a&&(this.result="string"===this.options.to?this.chunks.join(""):
f.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};c.Deflate=e;c.deflate=g;c.deflateRaw=function(a,b){b=b||{};b.raw=!0;return g(a,b)};c.gzip=function(a,b){b=b||{};b.gzip=!0;return g(a,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(a,b,c){function e(a){if(!(this instanceof e))return new e(a);var b=this.options=f.assign({chunkSize:16384,windowBits:0,to:""},a||{});b.raw&&0<=b.windowBits&&16>b.windowBits&&
(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15));!(0<=b.windowBits&&16>b.windowBits)||a&&a.windowBits||(b.windowBits+=32);15<b.windowBits&&48>b.windowBits&&0===(b.windowBits&15)&&(b.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new y;this.strm.avail_out=0;a=h.inflateInit2(this.strm,b.windowBits);if(a!==n.Z_OK)throw Error(k[a]);this.header=new w;h.inflateGetHeader(this.strm,this.header)}function g(a,b){b=new e(b);b.push(a,!0);if(b.err)throw b.msg;return b.result}
var h=a("./zlib/inflate"),f=a("./utils/common"),d=a("./utils/strings"),n=a("./zlib/constants"),k=a("./zlib/messages"),y=a("./zlib/zstream"),w=a("./zlib/gzheader"),t=Object.prototype.toString;e.prototype.push=function(a,b){var c=this.strm,e=this.options.chunkSize,g=this.options.dictionary,k=!1;if(this.ended)return!1;b=b===~~b?b:!0===b?n.Z_FINISH:n.Z_NO_FLUSH;"string"===typeof a?c.input=d.binstring2buf(a):"[object ArrayBuffer]"===t.call(a)?c.input=new Uint8Array(a):c.input=a;c.next_in=0;c.avail_in=
c.input.length;do{0===c.avail_out&&(c.output=new f.Buf8(e),c.next_out=0,c.avail_out=e);a=h.inflate(c,n.Z_NO_FLUSH);a===n.Z_NEED_DICT&&g&&(a="string"===typeof g?d.string2buf(g):"[object ArrayBuffer]"===t.call(g)?new Uint8Array(g):g,a=h.inflateSetDictionary(this.strm,a));a===n.Z_BUF_ERROR&&!0===k&&(a=n.Z_OK,k=!1);if(a!==n.Z_STREAM_END&&a!==n.Z_OK)return this.onEnd(a),this.ended=!0,!1;if(c.next_out&&(0===c.avail_out||a===n.Z_STREAM_END||0===c.avail_in&&(b===n.Z_FINISH||b===n.Z_SYNC_FLUSH)))if("string"===
this.options.to){var m=d.utf8border(c.output,c.next_out);var p=c.next_out-m;var w=d.buf2string(c.output,m);c.next_out=p;c.avail_out=e-p;p&&f.arraySet(c.output,c.output,m,p,0);this.onData(w)}else this.onData(f.shrinkBuf(c.output,c.next_out));0===c.avail_in&&0===c.avail_out&&(k=!0)}while((0<c.avail_in||0===c.avail_out)&&a!==n.Z_STREAM_END);a===n.Z_STREAM_END&&(b=n.Z_FINISH);if(b===n.Z_FINISH)return a=h.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===n.Z_OK;b===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),
c.avail_out=0);return!0};e.prototype.onData=function(a){this.chunks.push(a)};e.prototype.onEnd=function(a){a===n.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):f.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};c.Inflate=e;c.inflate=g;c.inflateRaw=function(a,b){b=b||{};b.raw=!0;return g(a,b)};c.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],
41:[function(a,b,c){a="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!==typeof c)throw new TypeError(c+"must be non-object");for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])}}return a};c.shrinkBuf=function(a,b){if(a.length===b)return a;if(a.subarray)return a.subarray(0,b);a.length=b;return a};var e={arraySet:function(a,b,c,e,g){if(b.subarray&&
a.subarray)a.set(b.subarray(c,c+e),g);else for(var d=0;d<e;d++)a[g+d]=b[c+d]},flattenChunks:function(a){var b,c;var e=c=0;for(b=a.length;e<b;e++)c+=a[e].length;var g=new Uint8Array(c);e=c=0;for(b=a.length;e<b;e++){var h=a[e];g.set(h,c);c+=h.length}return g}},g={arraySet:function(a,b,c,e,g){for(var d=0;d<e;d++)a[g+d]=b[c+d]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=
Array,c.Buf32=Array,c.assign(c,g))};c.setTyped(a)},{}],42:[function(a,b,c){function e(a,b){if(65537>b&&(a.subarray&&f||!a.subarray&&h))return String.fromCharCode.apply(null,g.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var g=a("./common"),h=!0,f=!0;try{String.fromCharCode.apply(null,[0])}catch(n){h=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(n){f=!1}var d=new g.Buf8(256);for(a=0;256>a;a++)d[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;d[254]=
d[254]=1;c.string2buf=function(a){var b,c,d=a.length,e=0;for(b=0;b<d;b++){var f=a.charCodeAt(b);if(55296===(f&64512)&&b+1<d){var h=a.charCodeAt(b+1);56320===(h&64512)&&(f=65536+(f-55296<<10)+(h-56320),b++)}e+=128>f?1:2048>f?2:65536>f?3:4}var n=new g.Buf8(e);for(b=c=0;c<e;b++)f=a.charCodeAt(b),55296===(f&64512)&&b+1<d&&(h=a.charCodeAt(b+1),56320===(h&64512)&&(f=65536+(f-55296<<10)+(h-56320),b++)),128>f?n[c++]=f:(2048>f?n[c++]=192|f>>>6:(65536>f?n[c++]=224|f>>>12:(n[c++]=240|f>>>18,n[c++]=128|f>>>12&
63),n[c++]=128|f>>>6&63),n[c++]=128|f&63);return n};c.buf2binstring=function(a){return e(a,a.length)};c.binstring2buf=function(a){for(var b=new g.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b};c.buf2string=function(a,b){var c,f=b||a.length,g=Array(2*f);for(b=c=0;b<f;){var h=a[b++];if(128>h)g[c++]=h;else{var k=d[h];if(4<k)g[c++]=65533,b+=k-1;else{for(h&=2===k?31:3===k?15:7;1<k&&b<f;)h=h<<6|a[b++]&63,k--;1<k?g[c++]=65533:65536>h?g[c++]=h:(h-=65536,g[c++]=55296|h>>10&1023,g[c++]=
56320|h&1023)}}}return e(g,c)};c.utf8border=function(a,b){var c;b=b||a.length;b>a.length&&(b=a.length);for(c=b-1;0<=c&&128===(a[c]&192);)c--;return 0>c||0===c?b:c+d[a[c]]>b?c:b}},{"./common":41}],43:[function(a,b,c){b.exports=function(a,b,c,f){var d=a&65535|0;a=a>>>16&65535|0;for(var e;0!==c;){e=2E3<c?2E3:c;c-=e;do d=d+b[f++]|0,a=a+d|0;while(--e);d%=65521;a%=65521}return d|a<<16|0}},{}],44:[function(a,b,c){b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,
Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(a,b,c){var e=function(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=a&1?3988292384^a>>>1:a>>>1;b[c]=a}return b}();b.exports=function(a,b,c,d){c=d+c;for(a^=-1;d<c;d++)a=a>>>
8^e[(a^b[d])&255];return a^-1}},{}],46:[function(a,b,c){function e(a,b){a.msg=C[b];return b}function g(a){for(var b=a.length;0<=--b;)a[b]=0}function h(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out);0!==c&&(D.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function f(a,b){P._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,b);a.block_start=
a.strstart;h(a.strm)}function d(a,b){a.pending_buf[a.pending++]=b}function n(a,b){a.pending_buf[a.pending++]=b>>>8&255;a.pending_buf[a.pending++]=b&255}function k(a,b){var c=a.max_chain_length,d=a.strstart,e=a.prev_length,f=a.nice_match,g=a.strstart>a.w_size-262?a.strstart-(a.w_size-262):0,h=a.window,k=a.w_mask,m=a.prev,n=a.strstart+258,p=h[d+e-1],I=h[d+e];a.prev_length>=a.good_match&&(c>>=2);f>a.lookahead&&(f=a.lookahead);do{var q=b;if(h[q+e]===I&&h[q+e-1]===p&&h[q]===h[d]&&h[++q]===h[d+1]){d+=2;
for(q++;h[++d]===h[++q]&&h[++d]===h[++q]&&h[++d]===h[++q]&&h[++d]===h[++q]&&h[++d]===h[++q]&&h[++d]===h[++q]&&h[++d]===h[++q]&&h[++d]===h[++q]&&d<n;);q=258-(n-d);d=n-258;if(q>e){a.match_start=b;e=q;if(q>=f)break;p=h[d+e-1];I=h[d+e]}}}while((b=m[b&k])>g&&0!==--c);return e<=a.lookahead?e:a.lookahead}function y(a){var b=a.w_size,c;do{var d=a.window_size-a.lookahead-a.strstart;if(a.strstart>=b+(b-262)){D.arraySet(a.window,a.window,b,b,0);a.match_start-=b;a.strstart-=b;a.block_start-=b;var e=c=a.hash_size;
do{var f=a.head[--e];a.head[e]=f>=b?f-b:0}while(--c);e=c=b;do f=a.prev[--e],a.prev[e]=f>=b?f-b:0;while(--c);d+=b}if(0===a.strm.avail_in)break;e=a.strm;c=a.window;f=a.strstart+a.lookahead;var g=e.avail_in;g>d&&(g=d);0===g?c=0:(e.avail_in-=g,D.arraySet(c,e.input,e.next_in,g,f),1===e.state.wrap?e.adler=O(e.adler,c,g,f):2===e.state.wrap&&(e.adler=F(e.adler,c,g,f)),e.next_in+=g,e.total_in+=g,c=g);a.lookahead+=c;if(3<=a.lookahead+a.insert)for(d=a.strstart-a.insert,a.ins_h=a.window[d],a.ins_h=(a.ins_h<<
a.hash_shift^a.window[d+1])&a.hash_mask;a.insert&&!(a.ins_h=(a.ins_h<<a.hash_shift^a.window[d+3-1])&a.hash_mask,a.prev[d&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=d,d++,a.insert--,3>a.lookahead+a.insert););}while(262>a.lookahead&&0!==a.strm.avail_in)}function w(a,b){for(var c;;){if(262>a.lookahead){y(a);if(262>a.lookahead&&0===b)return 1;if(0===a.lookahead)break}c=0;3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],
a.head[a.ins_h]=a.strstart);0!==c&&a.strstart-c<=a.w_size-262&&(a.match_length=k(a,c));if(3<=a.match_length)if(c=P._tr_tally(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&3<=a.lookahead){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=
0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else c=P._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(c&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=2>a.strstart?a.strstart:2;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===a.strm.avail_out)?1:2}function t(a,b){for(var c,d;;){if(262>a.lookahead){y(a);if(262>a.lookahead&&0===b)return 1;if(0===a.lookahead)break}c=0;3<=a.lookahead&&(a.ins_h=(a.ins_h<<
a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);a.prev_length=a.match_length;a.prev_match=a.match_start;a.match_length=2;0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-262&&(a.match_length=k(a,c),5>=a.match_length&&(1===a.strategy||3===a.match_length&&4096<a.strstart-a.match_start)&&(a.match_length=2));if(3<=a.prev_length&&a.match_length<=a.prev_length){d=a.strstart+a.lookahead-3;c=P._tr_tally(a,a.strstart-
1-a.prev_match,a.prev_length-3);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=d&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);a.match_available=0;a.match_length=2;a.strstart++;if(c&&(f(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if((c=P._tr_tally(a,0,a.window[a.strstart-1]))&&f(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=
1,a.strstart++,a.lookahead--}a.match_available&&(P._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0);a.insert=2>a.strstart?a.strstart:2;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===a.strm.avail_out)?1:2}function p(a,b){for(var c,d,e,g=a.window;;){if(258>=a.lookahead){y(a);if(258>=a.lookahead&&0===b)return 1;if(0===a.lookahead)break}a.match_length=0;if(3<=a.lookahead&&0<a.strstart&&(d=a.strstart-1,c=g[d],c===g[++d]&&c===g[++d]&&c===g[++d])){for(e=a.strstart+258;c===
g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&d<e;);a.match_length=258-(e-d);a.match_length>a.lookahead&&(a.match_length=a.lookahead)}3<=a.match_length?(c=P._tr_tally(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=P._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++);if(c&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=0;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),
0===a.strm.avail_out)?1:2}function m(a,b){for(var c;;){if(0===a.lookahead&&(y(a),0===a.lookahead)){if(0===b)return 1;break}a.match_length=0;c=P._tr_tally(a,0,a.window[a.strstart]);a.lookahead--;a.strstart++;if(c&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=0;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===a.strm.avail_out)?1:2}function x(a,b,c,d,e){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=d;this.func=e}function q(){this.strm=null;this.status=
0;this.pending_buf=null;this.wrap=this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=0;this.method=8;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=null;this.window_size=0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=
this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0;this.dyn_ltree=new D.Buf16(1146);this.dyn_dtree=new D.Buf16(122);this.bl_tree=new D.Buf16(78);g(this.dyn_ltree);g(this.dyn_dtree);g(this.bl_tree);this.bl_desc=this.d_desc=this.l_desc=null;this.bl_count=new D.Buf16(16);this.heap=new D.Buf16(573);g(this.heap);this.heap_max=this.heap_len=0;this.depth=new D.Buf16(573);g(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=
this.l_buf=0}function u(a){if(!a||!a.state)return e(a,-2);a.total_in=a.total_out=0;a.data_type=2;var b=a.state;b.pending=0;b.pending_out=0;0>b.wrap&&(b.wrap=-b.wrap);b.status=b.wrap?42:113;a.adler=2===b.wrap?0:1;b.last_flush=0;P._tr_init(b);return 0}function A(a){var b=u(a);0===b&&(a=a.state,a.window_size=2*a.w_size,g(a.head),a.max_lazy_match=H[a.level].max_lazy,a.good_match=H[a.level].good_length,a.nice_match=H[a.level].nice_length,a.max_chain_length=H[a.level].max_chain,a.strstart=0,a.block_start=
0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0);return b}function B(a,b,c,d,f,g){if(!a)return-2;var h=1;-1===b&&(b=6);0>d?(h=0,d=-d):15<d&&(h=2,d-=16);if(1>f||9<f||8!==c||8>d||15<d||0>b||9<b||0>g||4<g)return e(a,-2);8===d&&(d=9);var k=new q;a.state=k;k.strm=a;k.wrap=h;k.gzhead=null;k.w_bits=d;k.w_size=1<<k.w_bits;k.w_mask=k.w_size-1;k.hash_bits=f+7;k.hash_size=1<<k.hash_bits;k.hash_mask=k.hash_size-1;k.hash_shift=~~((k.hash_bits+3-1)/3);k.window=new D.Buf8(2*
k.w_size);k.head=new D.Buf16(k.hash_size);k.prev=new D.Buf16(k.w_size);k.lit_bufsize=1<<f+6;k.pending_buf_size=4*k.lit_bufsize;k.pending_buf=new D.Buf8(k.pending_buf_size);k.d_buf=k.lit_bufsize>>1;k.l_buf=3*k.lit_bufsize;k.level=b;k.strategy=g;k.method=c;return A(a)}var D=a("../utils/common"),P=a("./trees"),O=a("./adler32"),F=a("./crc32"),C=a("./messages");var H=[new x(0,0,0,0,function(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(1>=a.lookahead){y(a);if(0===a.lookahead&&
0===b)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead;a.lookahead=0;var d=a.block_start+c;if(0===a.strstart||a.strstart>=d)if(a.lookahead=a.strstart-d,a.strstart=d,f(a,!1),0===a.strm.avail_out)return 1;if(a.strstart-a.block_start>=a.w_size-262&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=0;if(4===b)return f(a,!0),0===a.strm.avail_out?3:4;a.strstart>a.block_start&&f(a,!1);return 1}),new x(4,4,8,4,w),new x(4,5,16,8,w),new x(4,6,32,32,w),new x(4,4,16,16,t),new x(8,16,32,32,t),new x(8,
16,128,128,t),new x(8,32,128,256,t),new x(32,128,258,1024,t),new x(32,258,258,4096,t)];c.deflateInit=function(a,b){return B(a,b,8,15,8,0)};c.deflateInit2=B;c.deflateReset=A;c.deflateResetKeep=u;c.deflateSetHeader=function(a,b){if(!a||!a.state||2!==a.state.wrap)return-2;a.state.gzhead=b;return 0};c.deflate=function(a,b){if(!a||!a.state||5<b||0>b)return a?e(a,-2):-2;var c=a.state;if(!a.output||!a.input&&0!==a.avail_in||666===c.status&&4!==b)return e(a,0===a.avail_out?-5:-2);c.strm=a;var f=c.last_flush;
c.last_flush=b;if(42===c.status)if(2===c.wrap)a.adler=0,d(c,31),d(c,139),d(c,8),c.gzhead?(d(c,(c.gzhead.text?1:0)+(c.gzhead.hcrc?2:0)+(c.gzhead.extra?4:0)+(c.gzhead.name?8:0)+(c.gzhead.comment?16:0)),d(c,c.gzhead.time&255),d(c,c.gzhead.time>>8&255),d(c,c.gzhead.time>>16&255),d(c,c.gzhead.time>>24&255),d(c,9===c.level?2:2<=c.strategy||2>c.level?4:0),d(c,c.gzhead.os&255),c.gzhead.extra&&c.gzhead.extra.length&&(d(c,c.gzhead.extra.length&255),d(c,c.gzhead.extra.length>>8&255)),c.gzhead.hcrc&&(a.adler=
F(a.adler,c.pending_buf,c.pending,0)),c.gzindex=0,c.status=69):(d(c,0),d(c,0),d(c,0),d(c,0),d(c,0),d(c,9===c.level?2:2<=c.strategy||2>c.level?4:0),d(c,3),c.status=113);else{var k=8+(c.w_bits-8<<4)<<8;k|=(2<=c.strategy||2>c.level?0:6>c.level?1:6===c.level?2:3)<<6;0!==c.strstart&&(k|=32);c.status=113;n(c,k+(31-k%31));0!==c.strstart&&(n(c,a.adler>>>16),n(c,a.adler&65535));a.adler=1}if(69===c.status)if(c.gzhead.extra){for(k=c.pending;c.gzindex<(c.gzhead.extra.length&65535)&&(c.pending!==c.pending_buf_size||
(c.gzhead.hcrc&&c.pending>k&&(a.adler=F(a.adler,c.pending_buf,c.pending-k,k)),h(a),k=c.pending,c.pending!==c.pending_buf_size));)d(c,c.gzhead.extra[c.gzindex]&255),c.gzindex++;c.gzhead.hcrc&&c.pending>k&&(a.adler=F(a.adler,c.pending_buf,c.pending-k,k));c.gzindex===c.gzhead.extra.length&&(c.gzindex=0,c.status=73)}else c.status=73;if(73===c.status)if(c.gzhead.name){k=c.pending;do{if(c.pending===c.pending_buf_size&&(c.gzhead.hcrc&&c.pending>k&&(a.adler=F(a.adler,c.pending_buf,c.pending-k,k)),h(a),k=
c.pending,c.pending===c.pending_buf_size)){var q=1;break}q=c.gzindex<c.gzhead.name.length?c.gzhead.name.charCodeAt(c.gzindex++)&255:0;d(c,q)}while(0!==q);c.gzhead.hcrc&&c.pending>k&&(a.adler=F(a.adler,c.pending_buf,c.pending-k,k));0===q&&(c.gzindex=0,c.status=91)}else c.status=91;if(91===c.status)if(c.gzhead.comment){k=c.pending;do{if(c.pending===c.pending_buf_size&&(c.gzhead.hcrc&&c.pending>k&&(a.adler=F(a.adler,c.pending_buf,c.pending-k,k)),h(a),k=c.pending,c.pending===c.pending_buf_size)){q=1;
break}q=c.gzindex<c.gzhead.comment.length?c.gzhead.comment.charCodeAt(c.gzindex++)&255:0;d(c,q)}while(0!==q);c.gzhead.hcrc&&c.pending>k&&(a.adler=F(a.adler,c.pending_buf,c.pending-k,k));0===q&&(c.status=103)}else c.status=103;103===c.status&&(c.gzhead.hcrc?(c.pending+2>c.pending_buf_size&&h(a),c.pending+2<=c.pending_buf_size&&(d(c,a.adler&255),d(c,a.adler>>8&255),a.adler=0,c.status=113)):c.status=113);if(0!==c.pending){if(h(a),0===a.avail_out)return c.last_flush=-1,0}else if(0===a.avail_in&&(b<<1)-
(4<b?9:0)<=(f<<1)-(4<f?9:0)&&4!==b)return e(a,-5);if(666===c.status&&0!==a.avail_in)return e(a,-5);if(0!==a.avail_in||0!==c.lookahead||0!==b&&666!==c.status){f=2===c.strategy?m(c,b):3===c.strategy?p(c,b):H[c.level].func(c,b);if(3===f||4===f)c.status=666;if(1===f||3===f)return 0===a.avail_out&&(c.last_flush=-1),0;if(2===f&&(1===b?P._tr_align(c):5!==b&&(P._tr_stored_block(c,0,0,!1),3===b&&(g(c.head),0===c.lookahead&&(c.strstart=0,c.block_start=0,c.insert=0))),h(a),0===a.avail_out))return c.last_flush=
-1,0}if(4!==b)return 0;if(0>=c.wrap)return 1;2===c.wrap?(d(c,a.adler&255),d(c,a.adler>>8&255),d(c,a.adler>>16&255),d(c,a.adler>>24&255),d(c,a.total_in&255),d(c,a.total_in>>8&255),d(c,a.total_in>>16&255),d(c,a.total_in>>24&255)):(n(c,a.adler>>>16),n(c,a.adler&65535));h(a);0<c.wrap&&(c.wrap=-c.wrap);return 0!==c.pending?0:1};c.deflateEnd=function(a){if(!a||!a.state)return-2;var b=a.state.status;if(42!==b&&69!==b&&73!==b&&91!==b&&103!==b&&113!==b&&666!==b)return e(a,-2);a.state=null;return 113===b?e(a,
-3):0};c.deflateSetDictionary=function(a,b){var c=b.length;if(!a||!a.state)return-2;var d=a.state;var e=d.wrap;if(2===e||1===e&&42!==d.status||d.lookahead)return-2;1===e&&(a.adler=O(a.adler,b,c,0));d.wrap=0;if(c>=d.w_size){0===e&&(g(d.head),d.strstart=0,d.block_start=0,d.insert=0);var f=new D.Buf8(d.w_size);D.arraySet(f,b,c-d.w_size,d.w_size,0);b=f;c=d.w_size}f=a.avail_in;var h=a.next_in;var k=a.input;a.avail_in=c;a.next_in=0;a.input=b;for(y(d);3<=d.lookahead;){b=d.strstart;c=d.lookahead-2;do d.ins_h=
(d.ins_h<<d.hash_shift^d.window[b+3-1])&d.hash_mask,d.prev[b&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=b,b++;while(--c);d.strstart=b;d.lookahead=2;y(d)}d.strstart+=d.lookahead;d.block_start=d.strstart;d.insert=d.lookahead;d.lookahead=0;d.match_length=d.prev_length=2;d.match_available=0;a.next_in=h;a.input=k;a.avail_in=f;d.wrap=e;return 0};c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(a,b,c){b.exports=
function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1}},{}],48:[function(a,b,c){b.exports=function(a,b){var c=a.state;var e=a.next_in;var d=a.input;var g=e+(a.avail_in-5);var k=a.next_out;var y=a.output;b=k-(b-a.avail_out);var w=k+(a.avail_out-257);var t=c.dmax;var p=c.wsize;var m=c.whave;var x=c.wnext;var q=c.window;var u=c.hold;var A=c.bits;var B=c.lencode;var D=c.distcode;var P=(1<<c.lenbits)-1;var O=(1<<c.distbits)-
1;a:do{15>A&&(u+=d[e++]<<A,A+=8,u+=d[e++]<<A,A+=8);var F=B[u&P];b:for(;;){var C=F>>>24;u>>>=C;A-=C;C=F>>>16&255;if(0===C)y[k++]=F&65535;else if(C&16){var H=F&65535;if(C&=15)A<C&&(u+=d[e++]<<A,A+=8),H+=u&(1<<C)-1,u>>>=C,A-=C;15>A&&(u+=d[e++]<<A,A+=8,u+=d[e++]<<A,A+=8);F=D[u&O];c:for(;;){C=F>>>24;u>>>=C;A-=C;C=F>>>16&255;if(C&16){F&=65535;C&=15;A<C&&(u+=d[e++]<<A,A+=8,A<C&&(u+=d[e++]<<A,A+=8));F+=u&(1<<C)-1;if(F>t){a.msg="invalid distance too far back";c.mode=30;break a}u>>>=C;A-=C;C=k-b;if(F>C){C=
F-C;if(C>m&&c.sane){a.msg="invalid distance too far back";c.mode=30;break a}var I=0;var M=q;if(0===x){if(I+=p-C,C<H){H-=C;do y[k++]=q[I++];while(--C);I=k-F;M=y}}else if(x<C){if(I+=p+x-C,C-=x,C<H){H-=C;do y[k++]=q[I++];while(--C);I=0;if(x<H){C=x;H-=C;do y[k++]=q[I++];while(--C);I=k-F;M=y}}}else if(I+=x-C,C<H){H-=C;do y[k++]=q[I++];while(--C);I=k-F;M=y}for(;2<H;)y[k++]=M[I++],y[k++]=M[I++],y[k++]=M[I++],H-=3;H&&(y[k++]=M[I++],1<H&&(y[k++]=M[I++]))}else{I=k-F;do y[k++]=y[I++],y[k++]=y[I++],y[k++]=y[I++],
H-=3;while(2<H);H&&(y[k++]=y[I++],1<H&&(y[k++]=y[I++]))}}else if(0===(C&64)){F=D[(F&65535)+(u&(1<<C)-1)];continue c}else{a.msg="invalid distance code";c.mode=30;break a}break}}else if(0===(C&64)){F=B[(F&65535)+(u&(1<<C)-1)];continue b}else{C&32?c.mode=12:(a.msg="invalid literal/length code",c.mode=30);break a}break}}while(e<g&&k<w);H=A>>3;e-=H;A-=H<<3;a.next_in=e;a.next_out=k;a.avail_in=e<g?5+(g-e):5-(e-g);a.avail_out=k<w?257+(w-k):257-(k-w);c.hold=u&(1<<A)-1;c.bits=A}},{}],49:[function(a,b,c){function e(a){return(a>>>
24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24)}function g(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new y.Buf16(320);this.work=new y.Buf16(288);this.distdyn=this.lendyn=null;this.was=
this.back=this.sane=0}function h(a){if(!a||!a.state)return-2;var b=a.state;a.total_in=a.total_out=b.total=0;a.msg="";b.wrap&&(a.adler=b.wrap&1);b.mode=1;b.last=0;b.havedict=0;b.dmax=32768;b.head=null;b.hold=0;b.bits=0;b.lencode=b.lendyn=new y.Buf32(852);b.distcode=b.distdyn=new y.Buf32(592);b.sane=1;b.back=-1;return 0}function f(a){if(!a||!a.state)return-2;var b=a.state;b.wsize=0;b.whave=0;b.wnext=0;return h(a)}function d(a,b){if(!a||!a.state)return-2;var c=a.state;if(0>b){var d=0;b=-b}else d=(b>>
4)+1,48>b&&(b&=15);if(b&&(8>b||15<b))return-2;null!==c.window&&c.wbits!==b&&(c.window=null);c.wrap=d;c.wbits=b;return f(a)}function n(a,b){if(!a)return-2;var c=new g;a.state=c;c.window=null;b=d(a,b);0!==b&&(a.state=null);return b}function k(a,b,c,d){var e=a.state;null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new y.Buf8(e.wsize));d>=e.wsize?(y.arraySet(e.window,b,c-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(a=e.wsize-e.wnext,a>d&&(a=d),y.arraySet(e.window,b,c-d,a,e.wnext),(d-=
a)?(y.arraySet(e.window,b,c-d,d,0),e.wnext=d,e.whave=e.wsize):(e.wnext+=a,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=a)));return 0}var y=a("../utils/common"),w=a("./adler32"),t=a("./crc32"),p=a("./inffast"),m=a("./inftrees"),x=!0,q,u;c.inflateReset=f;c.inflateReset2=d;c.inflateResetKeep=h;c.inflateInit=function(a){return n(a,15)};c.inflateInit2=n;c.inflate=function(a,b){var c,d=new y.Buf8(4),f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==
a.avail_in)return-2;var g=a.state;12===g.mode&&(g.mode=13);var h=a.next_out;var n=a.output;var A=a.avail_out;var B=a.next_in;var v=a.input;var N=a.avail_in;var G=g.hold;var K=g.bits;var ba=N;var aa=A;var ha=0;a:for(;;)switch(g.mode){case 1:if(0===g.wrap){g.mode=13;break}for(;16>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}if(g.wrap&2&&35615===G){g.check=0;d[0]=G&255;d[1]=G>>>8&255;g.check=t(g.check,d,2,0);K=G=0;g.mode=2;break}g.flags=0;g.head&&(g.head.done=!1);if(!(g.wrap&1)||(((G&255)<<8)+(G>>8))%
31){a.msg="incorrect header check";g.mode=30;break}if(8!==(G&15)){a.msg="unknown compression method";g.mode=30;break}G>>>=4;K-=4;var Q=(G&15)+8;if(0===g.wbits)g.wbits=Q;else if(Q>g.wbits){a.msg="invalid window size";g.mode=30;break}g.dmax=1<<Q;a.adler=g.check=1;g.mode=G&512?10:12;K=G=0;break;case 2:for(;16>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}g.flags=G;if(8!==(g.flags&255)){a.msg="unknown compression method";g.mode=30;break}if(g.flags&57344){a.msg="unknown header flags set";g.mode=30;break}g.head&&
(g.head.text=G>>8&1);g.flags&512&&(d[0]=G&255,d[1]=G>>>8&255,g.check=t(g.check,d,2,0));K=G=0;g.mode=3;case 3:for(;32>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}g.head&&(g.head.time=G);g.flags&512&&(d[0]=G&255,d[1]=G>>>8&255,d[2]=G>>>16&255,d[3]=G>>>24&255,g.check=t(g.check,d,4,0));K=G=0;g.mode=4;case 4:for(;16>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}g.head&&(g.head.xflags=G&255,g.head.os=G>>8);g.flags&512&&(d[0]=G&255,d[1]=G>>>8&255,g.check=t(g.check,d,2,0));K=G=0;g.mode=5;case 5:if(g.flags&1024){for(;16>
K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}g.length=G;g.head&&(g.head.extra_len=G);g.flags&512&&(d[0]=G&255,d[1]=G>>>8&255,g.check=t(g.check,d,2,0));K=G=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(g.flags&1024){var L=g.length;L>N&&(L=N);L&&(g.head&&(Q=g.head.extra_len-g.length,g.head.extra||(g.head.extra=Array(g.head.extra_len)),y.arraySet(g.head.extra,v,B,L,Q)),g.flags&512&&(g.check=t(g.check,v,L,B)),N-=L,B+=L,g.length-=L);if(g.length)break a}g.length=0;g.mode=7;case 7:if(g.flags&2048){if(0===
N)break a;L=0;do Q=v[B+L++],g.head&&Q&&65536>g.length&&(g.head.name+=String.fromCharCode(Q));while(Q&&L<N);g.flags&512&&(g.check=t(g.check,v,L,B));N-=L;B+=L;if(Q)break a}else g.head&&(g.head.name=null);g.length=0;g.mode=8;case 8:if(g.flags&4096){if(0===N)break a;L=0;do Q=v[B+L++],g.head&&Q&&65536>g.length&&(g.head.comment+=String.fromCharCode(Q));while(Q&&L<N);g.flags&512&&(g.check=t(g.check,v,L,B));N-=L;B+=L;if(Q)break a}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(g.flags&512){for(;16>
K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}if(G!==(g.check&65535)){a.msg="header crc mismatch";g.mode=30;break}K=G=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0);a.adler=g.check=0;g.mode=12;break;case 10:for(;32>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}a.adler=g.check=e(G);K=G=0;g.mode=11;case 11:if(0===g.havedict)return a.next_out=h,a.avail_out=A,a.next_in=B,a.avail_in=N,g.hold=G,g.bits=K,2;a.adler=g.check=1;g.mode=12;case 12:if(5===b||6===b)break a;case 13:if(g.last){G>>>=K&7;K-=K&7;g.mode=
27;break}for(;3>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}g.last=G&1;G>>>=1;--K;switch(G&3){case 0:g.mode=14;break;case 1:Q=g;if(x){q=new y.Buf32(512);u=new y.Buf32(32);for(L=0;144>L;)Q.lens[L++]=8;for(;256>L;)Q.lens[L++]=9;for(;280>L;)Q.lens[L++]=7;for(;288>L;)Q.lens[L++]=8;m(1,Q.lens,0,288,q,0,Q.work,{bits:9});for(L=0;32>L;)Q.lens[L++]=5;m(2,Q.lens,0,32,u,0,Q.work,{bits:5});x=!1}Q.lencode=q;Q.lenbits=9;Q.distcode=u;Q.distbits=5;g.mode=20;if(6===b){G>>>=2;K-=2;break a}break;case 2:g.mode=17;break;
case 3:a.msg="invalid block type",g.mode=30}G>>>=2;K-=2;break;case 14:G>>>=K&7;for(K-=K&7;32>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}if((G&65535)!==(G>>>16^65535)){a.msg="invalid stored block lengths";g.mode=30;break}g.length=G&65535;K=G=0;g.mode=15;if(6===b)break a;case 15:g.mode=16;case 16:if(L=g.length){L>N&&(L=N);L>A&&(L=A);if(0===L)break a;y.arraySet(n,v,B,L,h);N-=L;B+=L;A-=L;h+=L;g.length-=L;break}g.mode=12;break;case 17:for(;14>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}g.nlen=(G&31)+257;
G>>>=5;K-=5;g.ndist=(G&31)+1;G>>>=5;K-=5;g.ncode=(G&15)+4;G>>>=4;K-=4;if(286<g.nlen||30<g.ndist){a.msg="too many length or distance symbols";g.mode=30;break}g.have=0;g.mode=18;case 18:for(;g.have<g.ncode;){for(;3>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}g.lens[f[g.have++]]=G&7;G>>>=3;K-=3}for(;19>g.have;)g.lens[f[g.have++]]=0;g.lencode=g.lendyn;g.lenbits=7;L={bits:g.lenbits};ha=m(0,g.lens,0,19,g.lencode,0,g.work,L);g.lenbits=L.bits;if(ha){a.msg="invalid code lengths set";g.mode=30;break}g.have=
0;g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;;){var T=g.lencode[G&(1<<g.lenbits)-1];L=T>>>24;T&=65535;if(L<=K)break;if(0===N)break a;N--;G+=v[B++]<<K;K+=8}if(16>T)G>>>=L,K-=L,g.lens[g.have++]=T;else{if(16===T){for(Q=L+2;K<Q;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}G>>>=L;K-=L;if(0===g.have){a.msg="invalid bit length repeat";g.mode=30;break}Q=g.lens[g.have-1];L=3+(G&3);G>>>=2;K-=2}else if(17===T){for(Q=L+3;K<Q;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}G>>>=L;K-=L;Q=0;L=3+(G&7);G>>>=3;K-=3}else{for(Q=
L+7;K<Q;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}G>>>=L;K-=L;Q=0;L=11+(G&127);G>>>=7;K-=7}if(g.have+L>g.nlen+g.ndist){a.msg="invalid bit length repeat";g.mode=30;break}for(;L--;)g.lens[g.have++]=Q}}if(30===g.mode)break;if(0===g.lens[256]){a.msg="invalid code -- missing end-of-block";g.mode=30;break}g.lenbits=9;L={bits:g.lenbits};ha=m(1,g.lens,0,g.nlen,g.lencode,0,g.work,L);g.lenbits=L.bits;if(ha){a.msg="invalid literal/lengths set";g.mode=30;break}g.distbits=6;g.distcode=g.distdyn;L={bits:g.distbits};
ha=m(2,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,L);g.distbits=L.bits;if(ha){a.msg="invalid distances set";g.mode=30;break}g.mode=20;if(6===b)break a;case 20:g.mode=21;case 21:if(6<=N&&258<=A){a.next_out=h;a.avail_out=A;a.next_in=B;a.avail_in=N;g.hold=G;g.bits=K;p(a,aa);h=a.next_out;n=a.output;A=a.avail_out;B=a.next_in;v=a.input;N=a.avail_in;G=g.hold;K=g.bits;12===g.mode&&(g.back=-1);break}for(g.back=0;;){T=g.lencode[G&(1<<g.lenbits)-1];L=T>>>24;Q=T>>>16&255;T&=65535;if(L<=K)break;if(0===N)break a;
N--;G+=v[B++]<<K;K+=8}if(Q&&0===(Q&240)){var R=L;var ca=Q;for(c=T;;){T=g.lencode[c+((G&(1<<R+ca)-1)>>R)];L=T>>>24;Q=T>>>16&255;T&=65535;if(R+L<=K)break;if(0===N)break a;N--;G+=v[B++]<<K;K+=8}G>>>=R;K-=R;g.back+=R}G>>>=L;K-=L;g.back+=L;g.length=T;if(0===Q){g.mode=26;break}if(Q&32){g.back=-1;g.mode=12;break}if(Q&64){a.msg="invalid literal/length code";g.mode=30;break}g.extra=Q&15;g.mode=22;case 22:if(g.extra){for(Q=g.extra;K<Q;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}g.length+=G&(1<<g.extra)-1;G>>>=
g.extra;K-=g.extra;g.back+=g.extra}g.was=g.length;g.mode=23;case 23:for(;;){T=g.distcode[G&(1<<g.distbits)-1];L=T>>>24;Q=T>>>16&255;T&=65535;if(L<=K)break;if(0===N)break a;N--;G+=v[B++]<<K;K+=8}if(0===(Q&240)){R=L;ca=Q;for(c=T;;){T=g.distcode[c+((G&(1<<R+ca)-1)>>R)];L=T>>>24;Q=T>>>16&255;T&=65535;if(R+L<=K)break;if(0===N)break a;N--;G+=v[B++]<<K;K+=8}G>>>=R;K-=R;g.back+=R}G>>>=L;K-=L;g.back+=L;if(Q&64){a.msg="invalid distance code";g.mode=30;break}g.offset=T;g.extra=Q&15;g.mode=24;case 24:if(g.extra){for(Q=
g.extra;K<Q;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}g.offset+=G&(1<<g.extra)-1;G>>>=g.extra;K-=g.extra;g.back+=g.extra}if(g.offset>g.dmax){a.msg="invalid distance too far back";g.mode=30;break}g.mode=25;case 25:if(0===A)break a;L=aa-A;if(g.offset>L){L=g.offset-L;if(L>g.whave&&g.sane){a.msg="invalid distance too far back";g.mode=30;break}L>g.wnext?(L-=g.wnext,Q=g.wsize-L):Q=g.wnext-L;L>g.length&&(L=g.length);R=g.window}else R=n,Q=h-g.offset,L=g.length;L>A&&(L=A);A-=L;g.length-=L;do n[h++]=R[Q++];
while(--L);0===g.length&&(g.mode=21);break;case 26:if(0===A)break a;n[h++]=g.length;A--;g.mode=21;break;case 27:if(g.wrap){for(;32>K;){if(0===N)break a;N--;G|=v[B++]<<K;K+=8}aa-=A;a.total_out+=aa;g.total+=aa;aa&&(a.adler=g.check=g.flags?t(g.check,n,aa,h-aa):w(g.check,n,aa,h-aa));aa=A;if((g.flags?G:e(G))!==g.check){a.msg="incorrect data check";g.mode=30;break}K=G=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;32>K;){if(0===N)break a;N--;G+=v[B++]<<K;K+=8}if(G!==(g.total&4294967295)){a.msg="incorrect length check";
g.mode=30;break}K=G=0}g.mode=29;case 29:ha=1;break a;case 30:ha=-3;break a;case 31:return-4;default:return-2}a.next_out=h;a.avail_out=A;a.next_in=B;a.avail_in=N;g.hold=G;g.bits=K;if((g.wsize||aa!==a.avail_out&&30>g.mode&&(27>g.mode||4!==b))&&k(a,a.output,a.next_out,aa-a.avail_out))return g.mode=31,-4;ba-=a.avail_in;aa-=a.avail_out;a.total_in+=ba;a.total_out+=aa;g.total+=aa;g.wrap&&aa&&(a.adler=g.check=g.flags?t(g.check,n,aa,a.next_out-aa):w(g.check,n,aa,a.next_out-aa));a.data_type=g.bits+(g.last?
64:0)+(12===g.mode?128:0)+(20===g.mode||15===g.mode?256:0);(0===ba&&0===aa||4===b)&&0===ha&&(ha=-5);return ha};c.inflateEnd=function(a){if(!a||!a.state)return-2;var b=a.state;b.window&&(b.window=null);a.state=null;return 0};c.inflateGetHeader=function(a,b){if(!a||!a.state)return-2;a=a.state;if(0===(a.wrap&2))return-2;a.head=b;b.done=!1;return 0};c.inflateSetDictionary=function(a,b){var c=b.length;if(!a||!a.state)return-2;var d=a.state;if(0!==d.wrap&&11!==d.mode)return-2;if(11===d.mode){var e=w(1,
b,c,0);if(e!==d.check)return-3}if(k(a,b,c,c))return d.mode=31,-4;d.havedict=1;return 0};c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(a,b,c){var e=a("../utils/common"),g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,
193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,w,t,p,m,x){var k=x.bits,n,y,B,D,P,O,F=0,C=new e.Buf16(16);var H=new e.Buf16(16);var I,M=0;for(n=0;15>=n;n++)C[n]=0;for(y=0;y<w;y++)C[b[c+y]]++;var v=k;for(B=15;1<=B&&0===C[B];B--);v>B&&(v=B);if(0===B)return t[p++]=20971520,t[p++]=20971520,x.bits=1,0;for(k=1;k<B&&0===C[k];k++);v<k&&(v=k);for(n=D=1;15>=
n;n++)if(D<<=1,D-=C[n],0>D)return-1;if(0<D&&(0===a||1!==B))return-1;H[1]=0;for(n=1;15>n;n++)H[n+1]=H[n]+C[n];for(y=0;y<w;y++)0!==b[c+y]&&(m[H[b[c+y]]++]=y);if(0===a){var N=I=m;var G=19}else 1===a?(N=g,F-=257,I=h,M-=257,G=256):(N=f,I=d,G=-1);y=P=0;n=k;var K=p;w=v;H=0;var ba=-1;var aa=1<<v;var ha=aa-1;if(1===a&&852<aa||2===a&&592<aa)return 1;for(var Q=0;;){Q++;var L=n-H;if(m[y]<G){var T=0;var R=m[y]}else m[y]>G?(T=I[M+m[y]],R=N[F+m[y]]):(T=96,R=0);D=1<<n-H;k=O=1<<w;do O-=D,t[K+(P>>H)+O]=L<<24|T<<16|
R|0;while(0!==O);for(D=1<<n-1;P&D;)D>>=1;0!==D?(P&=D-1,P+=D):P=0;y++;if(0===--C[n]){if(n===B)break;n=b[c+m[y]]}if(n>v&&(P&ha)!==ba){0===H&&(H=v);K+=k;w=n-H;for(D=1<<w;w+H<B;){D-=C[w+H];if(0>=D)break;w++;D<<=1}aa+=1<<w;if(1===a&&852<aa||2===a&&592<aa)return 1;ba=P&ha;t[ba]=v<<24|w<<16|K-p|0}}0!==P&&(t[K+P]=n-H<<24|4194304);x.bits=v;return 0}},{"../utils/common":41}],51:[function(a,b,c){b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory",
"-5":"buffer error","-6":"incompatible version"}},{}],52:[function(a,b,c){function e(a){for(var b=a.length;0<=--b;)a[b]=0}function g(a,b,c,d,e){this.static_tree=a;this.extra_bits=b;this.extra_base=c;this.elems=d;this.max_length=e;this.has_stree=a&&a.length}function h(a,b){this.dyn_tree=a;this.max_code=0;this.stat_desc=b}function f(a,b){a.pending_buf[a.pending++]=b&255;a.pending_buf[a.pending++]=b>>>8&255}function d(a,b,c){a.bi_valid>16-c?(a.bi_buf|=b<<a.bi_valid&65535,f(a,a.bi_buf),a.bi_buf=b>>16-
a.bi_valid,a.bi_valid+=c-16):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function n(a,b,c){d(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=a&1,a>>>=1,c<<=1;while(0<--b);return c>>>1}function y(a,b,c){var d=Array(16),e=0,f;for(f=1;15>=f;f++)d[f]=e=e+c[f-1]<<1;for(c=0;c<=b;c++)e=a[2*c+1],0!==e&&(a[2*c]=k(d[e]++,e))}function w(a){var b;for(b=0;286>b;b++)a.dyn_ltree[2*b]=0;for(b=0;30>b;b++)a.dyn_dtree[2*b]=0;for(b=0;19>b;b++)a.bl_tree[2*b]=0;a.dyn_ltree[512]=1;a.opt_len=a.static_len=0;a.last_lit=
a.matches=0}function t(a){8<a.bi_valid?f(a,a.bi_buf):0<a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf);a.bi_buf=0;a.bi_valid=0}function p(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function m(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len;){e<a.heap_len&&p(b,a.heap[e+1],a.heap[e],a.depth)&&e++;if(p(b,d,a.heap[e],a.depth))break;a.heap[c]=a.heap[e];c=e;e<<=1}a.heap[c]=d}function x(a,b,c){var e=0;if(0!==a.last_lit){do{var f=a.pending_buf[a.d_buf+2*e]<<8|a.pending_buf[a.d_buf+
2*e+1];var g=a.pending_buf[a.l_buf+e];e++;if(0===f)n(a,g,b);else{var h=N[g];n(a,h+256+1,b);var k=O[h];0!==k&&(g-=G[h],d(a,g,k));f--;h=256>f?v[f]:v[256+(f>>>7)];n(a,h,c);k=F[h];0!==k&&(f-=K[h],d(a,f,k))}}while(e<a.last_lit)}n(a,256,b)}function q(a,b){var c=b.dyn_tree,d=b.stat_desc.static_tree,e=b.stat_desc.has_stree,f=b.stat_desc.elems,g,h=-1;a.heap_len=0;a.heap_max=573;for(g=0;g<f;g++)0!==c[2*g]?(a.heap[++a.heap_len]=h=g,a.depth[g]=0):c[2*g+1]=0;for(;2>a.heap_len;){var k=a.heap[++a.heap_len]=2>h?
++h:0;c[2*k]=1;a.depth[k]=0;a.opt_len--;e&&(a.static_len-=d[2*k+1])}b.max_code=h;for(g=a.heap_len>>1;1<=g;g--)m(a,c,g);k=f;do g=a.heap[1],a.heap[1]=a.heap[a.heap_len--],m(a,c,1),d=a.heap[1],a.heap[--a.heap_max]=g,a.heap[--a.heap_max]=d,c[2*k]=c[2*g]+c[2*d],a.depth[k]=(a.depth[g]>=a.depth[d]?a.depth[g]:a.depth[d])+1,c[2*g+1]=c[2*d+1]=k,a.heap[1]=k++,m(a,c,1);while(2<=a.heap_len);a.heap[--a.heap_max]=a.heap[1];g=b.dyn_tree;k=b.max_code;d=b.stat_desc.static_tree;e=b.stat_desc.has_stree;f=b.stat_desc.extra_bits;
var n=b.stat_desc.extra_base,p=b.stat_desc.max_length,q,t=0;for(q=0;15>=q;q++)a.bl_count[q]=0;g[2*a.heap[a.heap_max]+1]=0;for(b=a.heap_max+1;573>b;b++){var u=a.heap[b];q=g[2*g[2*u+1]+1]+1;q>p&&(q=p,t++);g[2*u+1]=q;if(!(u>k)){a.bl_count[q]++;var v=0;u>=n&&(v=f[u-n]);var w=g[2*u];a.opt_len+=w*(q+v);e&&(a.static_len+=w*(d[2*u+1]+v))}}if(0!==t){do{for(q=p-1;0===a.bl_count[q];)q--;a.bl_count[q]--;a.bl_count[q+1]+=2;a.bl_count[p]--;t-=2}while(0<t);for(q=p;0!==q;q--)for(u=a.bl_count[q];0!==u;)d=a.heap[--b],
d>k||(g[2*d+1]!==q&&(a.opt_len+=(q-g[2*d+1])*g[2*d],g[2*d+1]=q),u--)}y(c,h,a.bl_count)}function u(a,b,c){var d,e=-1,f=b[1],g=0,h=7,k=4;0===f&&(h=138,k=3);b[2*(c+1)+1]=65535;for(d=0;d<=c;d++){var m=f;f=b[2*(d+1)+1];++g<h&&m===f||(g<k?a.bl_tree[2*m]+=g:0!==m?(m!==e&&a.bl_tree[2*m]++,a.bl_tree[32]++):10>=g?a.bl_tree[34]++:a.bl_tree[36]++,g=0,e=m,0===f?(h=138,k=3):m===f?(h=6,k=3):(h=7,k=4))}}function A(a,b,c){var e,f=-1,g=b[1],h=0,k=7,m=4;0===g&&(k=138,m=3);for(e=0;e<=c;e++){var p=g;g=b[2*(e+1)+1];if(!(++h<
k&&p===g)){if(h<m){do n(a,p,a.bl_tree);while(0!==--h)}else 0!==p?(p!==f&&(n(a,p,a.bl_tree),h--),n(a,16,a.bl_tree),d(a,h-3,2)):10>=h?(n(a,17,a.bl_tree),d(a,h-3,3)):(n(a,18,a.bl_tree),d(a,h-11,7));h=0;f=p;0===g?(k=138,m=3):p===g?(k=6,m=3):(k=7,m=4)}}}function B(a){var b=4093624447,c;for(c=0;31>=c;c++,b>>>=1)if(b&1&&0!==a.dyn_ltree[2*c])return 0;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;for(c=32;256>c;c++)if(0!==a.dyn_ltree[2*c])return 1;return 0}function D(a,b,c,e){d(a,
0+(e?1:0),3);t(a);f(a,c);f(a,~c);P.arraySet(a.pending_buf,a.window,b,c,a.pending);a.pending+=c}var P=a("../utils/common"),O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],F=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=Array(576);e(I);var M=Array(60);e(M);var v=Array(512);e(v);var N=Array(256);e(N);var G=Array(29);e(G);var K=Array(30);e(K);var ba,aa,ha,Q=!1;c._tr_init=
function(a){if(!Q){var b,c,d,e=Array(16);for(d=c=0;28>d;d++)for(G[d]=c,b=0;b<1<<O[d];b++)N[c++]=d;N[c-1]=d;for(d=c=0;16>d;d++)for(K[d]=c,b=0;b<1<<F[d];b++)v[c++]=d;for(c>>=7;30>d;d++)for(K[d]=c<<7,b=0;b<1<<F[d]-7;b++)v[256+c++]=d;for(b=0;15>=b;b++)e[b]=0;for(b=0;143>=b;)I[2*b+1]=8,b++,e[8]++;for(;255>=b;)I[2*b+1]=9,b++,e[9]++;for(;279>=b;)I[2*b+1]=7,b++,e[7]++;for(;287>=b;)I[2*b+1]=8,b++,e[8]++;y(I,287,e);for(b=0;30>b;b++)M[2*b+1]=5,M[2*b]=k(b,5);ba=new g(I,O,257,286,15);aa=new g(M,F,0,30,15);ha=
new g([],C,0,19,7);Q=!0}a.l_desc=new h(a.dyn_ltree,ba);a.d_desc=new h(a.dyn_dtree,aa);a.bl_desc=new h(a.bl_tree,ha);a.bi_buf=0;a.bi_valid=0;w(a)};c._tr_stored_block=D;c._tr_flush_block=function(a,b,c,e){var f=0;if(0<a.level){2===a.strm.data_type&&(a.strm.data_type=B(a));q(a,a.l_desc);q(a,a.d_desc);u(a,a.dyn_ltree,a.l_desc.max_code);u(a,a.dyn_dtree,a.d_desc.max_code);q(a,a.bl_desc);for(f=18;3<=f&&0===a.bl_tree[2*H[f]+1];f--);a.opt_len+=3*(f+1)+14;var g=a.opt_len+3+7>>>3;var h=a.static_len+3+7>>>3;
h<=g&&(g=h)}else g=h=c+5;if(c+4<=g&&-1!==b)D(a,b,c,e);else if(4===a.strategy||h===g)d(a,2+(e?1:0),3),x(a,I,M);else{d(a,4+(e?1:0),3);b=a.l_desc.max_code+1;c=a.d_desc.max_code+1;f+=1;d(a,b-257,5);d(a,c-1,5);d(a,f-4,4);for(g=0;g<f;g++)d(a,a.bl_tree[2*H[g]+1],3);A(a,a.dyn_ltree,b-1);A(a,a.dyn_dtree,c-1);x(a,a.dyn_ltree,a.dyn_dtree)}w(a);e&&t(a)};c._tr_tally=function(a,b,c){a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255;a.pending_buf[a.d_buf+2*a.last_lit+1]=b&255;a.pending_buf[a.l_buf+a.last_lit]=c&255;
a.last_lit++;0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(N[c]+256+1)]++,a.dyn_dtree[2*(256>b?v[b]:v[256+(b>>>7)])]++);return a.last_lit===a.lit_bufsize-1};c._tr_align=function(a){d(a,2,3);n(a,256,I);16===a.bi_valid?(f(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):8<=a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf&255,a.bi_buf>>=8,a.bi_valid-=8)}},{"../utils/common":41}],53:[function(a,b,c){b.exports=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=
this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}},{}]},{},[10])(10)});/*
 @source http://purl.eligrey.com/github/FileSaver.js/blob/master/src/FileSaver.js */
(function(l){if(!("undefined"===typeof l||"undefined"!==typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var a=l.document.createElementNS("http://www.w3.org/1999/xhtml","a"),b="download"in a,c=/constructor/i.test(l.HTMLElement)||l.safari,e=/CriOS\/[\d]+/.test(navigator.userAgent),g=l.setImmediate||l.setTimeout,h=function(a){g(function(){throw a;},0)},f=function(a){setTimeout(function(){"string"===typeof a?(l.URL||l.webkitURL||l).revokeObjectURL(a):a.remove()},4E4)},d=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?
new Blob([String.fromCharCode(65279),a],{type:a.type}):a},n=function(k,n,t){t||(k=d(k));var p=this,m="application/octet-stream"===k.type,w=function(){var a=["writestart","progress","write","writeend"];a=[].concat(a);for(var b=a.length;b--;){var c=p["on"+a[b]];if("function"===typeof c)try{c.call(p,p)}catch(D){h(D)}}};p.readyState=p.INIT;if(b){var q=(l.URL||l.webkitURL||l).createObjectURL(k);g(function(){a.href=q;a.download=n;var b=new MouseEvent("click");a.dispatchEvent(b);w();f(q);p.readyState=p.DONE},
0)}else(function(){if((e||m&&c)&&l.FileReader){var a=new FileReader;a.onloadend=function(){var b=e?a.result:a.result.replace(/^data:[^;]*;/,"data:attachment/file;");l.open(b,"_blank")||(l.location.href=b);p.readyState=p.DONE;w()};a.readAsDataURL(k);p.readyState=p.INIT}else q||(q=(l.URL||l.webkitURL||l).createObjectURL(k)),m?l.location.href=q:l.open(q,"_blank")||(l.location.href=q),p.readyState=p.DONE,w(),f(q)})()},k=n.prototype;if("undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob)return function(a,
b,c){b=b||a.name||"download";c||(a=d(a));return navigator.msSaveOrOpenBlob(a,b)};k.abort=function(){};k.readyState=k.INIT=0;k.WRITING=1;k.DONE=2;k.error=k.onwritestart=k.onprogress=k.onwrite=k.onabort=k.onerror=k.onwriteend=null;l.FileSaver_saveAs=function(a,b,c){return new n(a,b||a.name||"download",c)}}})("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this); //# sourceMappingURL=squeak.min.js.map
